function generateId(){var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var n=0;n<16;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function createRenderer(){var e=40,t={};tagpro.renderer=t,tagpro.viewport={followPlayer:!0,source:{x:0,y:0}},tagpro.zooming=0,$.cookie.json=!0,PIXI.dontSayHello=!0,t.options={disableParticles:!!$.cookie("disableParticles"),forceCanvasRenderer:!!$.cookie("forceCanvasRenderer"),disableViewportScaling:!!$.cookie("disableViewportScaling"),transparent:!1},t.particleDefinitions=tagpro.particleDefinitions,t.canvas=$("#viewport").get(0),t.stage=new PIXI.Stage(0),t.canvas_width=1280,t.canvas_height=800,t.layers={},t.dynamicSprites={},t.frameRates=[],t.emitters=[],t.explosions=[],t.fadingSplats=[],t.frameCount=0,t.zoomThreshold=1.4,t.debug=!1,t.sayHello=function(){console.image("http://"+location.host+"/images/console.png"),console.log("TagPro version "+tagpro.version);var e=t.renderer.type===PIXI.WEBGL_RENDERER?"WebGL":"Canvas";console.log("Powered by PixiJS. Currently running in "+e+" mode"),console.log("Developers: LuckySpammer, steppin, NewCompte, AnkhMorpork, Ly, ylambda")},t.resizeView=function(){if(!t.renderer)return;var e=$(window),n=e.outerWidth(),r=e.outerHeight(),i,s;n>t.canvas_width&&(n=t.canvas_width),r>t.canvas_height&&(r=t.canvas_height),s=Math.round(n*t.canvas_height/t.canvas_width),i=0,s>r?(i=Math.round(r*t.canvas_width/t.canvas_height),s=r):i=n,t.renderer.resize(i,s)},t.resizeAndCenterView=function(){t.resizeView(),t.centerView()},t.centerView=function(){var e=$("#viewport"),n=$("#viewportDiv"),r=$(window).height(),i=$(window).width(),s=$("#options");e.css({position:"absolute",left:(i-e.outerWidth())/2,top:(r-e.outerHeight())/2}),n.css({position:"absolute",width:e.outerWidth(),height:e.outerHeight(),left:(i-e.outerWidth())/2,top:(r-e.outerHeight())/2}),s.css({position:"absolute",left:($(window).width()-s.width())/2,top:($(window).height()-s.height())/2}),tagpro.ui.resize(e.width(),e.height()),t.vpWidth=e.width(),t.vpHeight=e.height(),tagpro.chat.resize()},t.start=function(){t.renderer=t.createRenderer(),t.sayHello(),$(window).resize(t.resizeAndCenterView),t.resizeAndCenterView(),t.particleTexture=t.createParticle("#particle"),t.particleFireTexture=t.createParticle("#particleFire"),t.gameContainer=t.createGameContainer(t.stage),t.createBackground(t.gameContainer)},t.destroyPlayer=function(e){if(!e.sprites)return;var n=t.emitters.indexOf(e.sprites.emitter),r,i;n!==-1&&t.emitters.splice(n,1),e.sprites.emitter&&(e.sprites.emitter.destroy(),e.sprites.emitter=null),e.sprite&&e.sprite.parent.removeChild(e.sprite);for(r in e.sprites)e.sprites.hasOwnProperty(r)&&(i=e.sprites[r],i&&i.parent.removeChild(i))},t.measurePerformance=function(){t.frameCount+=1;var e=performance.now(),n=300;if(t.lastFrameTime){var r=e-t.lastFrameTime,i=1e3/r;isFinite(i)&&t.frameRates.push(i),t.frameRates.length>n&&t.frameRates.shift()}if(t.frameRates.length>=n/5){var s=t.frameRates.reduce(function(e,t){return e+t});tagpro.fps=Math.round(s/t.frameRates.length/5)*5}else tagpro.fps=0},t.render=function(){requestAnimationFrame(t.render),t.updateGraphics(),tagpro.world.update(),tagpro.ui.update(),t.renderer.render(t.stage),t.measurePerformance(),t.lastFrameTime=performance.now()},t.createLayers=function(){t.createMidground(t.gameContainer),t.createForeground(t.gameContainer),t.createOverlay(t.gameContainer),t.createUI(t.gameContainer)},t.createRenderer=function(){var e={view:t.canvas,antialias:!0,transparent:!!t.options.transparent};return t.options.forceCanvasRenderer?new PIXI.CanvasRenderer(t.canvas_width,t.canvas_height,e):PIXI.autoDetectRenderer(t.canvas_width,t.canvas_height,e)},t.createMidground=function(e){t.layers.midground||(t.layers.midground=new PIXI.DisplayObjectContainer,t.layers.splats=new PIXI.SpriteBatch,t.layers.midground.addChild(t.layers.splats)),e.addChild(t.layers.midground)},t.createOverlay=function(e){t.layers.overlay=new PIXI.SpriteBatch,e.addChild(t.layers.overlay)},t.createGameContainer=function(e){var t=new PIXI.DisplayObjectContainer;return e.addChild(t),t},t.createBackground=function(){t.layers.background=new PIXI.DisplayObjectContainer,t.createLayers(),t.drawBackground()},t.createForeground=function(e){t.layers.foreground||(t.layers.foreground=new PIXI.DisplayObjectContainer),e.addChild(t.layers.foreground)},t.createUI=function(){t.layers.ui=new PIXI.DisplayObjectContainer,t.stage.addChild(t.layers.ui)},t.clearBackground=function(){t.layers.background.removeChildren()},t.readyToDrawBackground=function(){return tagpro.map&&tagpro.tiles.image},t.drawMarsball=function(e,n){tagpro.spectator&&(e.draw=!0),e.sprite=tagpro.tiles.draw(t.layers.midground,"marsball",n,80,80),e.sprite.keep=!0,e.draw||(e.sprite.visible=!1)},t.createGravityWellEmitter=function(e,n){if(t.options.disableParticles){var r=new PIXI.Graphics;r.alpha=.075,r.beginFill(0).drawCircle(e,n,260),t.layers.foreground.addChild(r)}else{var i=new cloudkid.Emitter(t.layers.foreground,[t.particleTexture,t.particleFireTexture],tagpro.particleDefinitions.gravityWell);i.updateSpawnPos(e,n),t.emitters.push(i)}},t.drawBackgroundTiles=function(n){var r={x:0,y:0};for(var i=0,s=tagpro.map.length;i!==s;i++){r.x=i*e;for(var o=0,u=tagpro.map[0].length;o!==u;o++)r.y=o*e,tagpro.tiles.drawLayers(n,i,o,r,t.layers.midground),tagpro.map[i][o]===22&&(t.createGravityWellEmitter(r.x+e/2,r.y+e/2),tagpro.world.createGravityWell(i*.4,o*.4))}},t.drawStartingSplats=function(){if(tagpro.map.splats)for(var e=0;e<tagpro.map.splats.length;e++){var n=tagpro.map.splats[e];t.drawSplat(n.x,n.y,n.t)}},t.drawBackground=function(){if(!t.readyToDrawBackground())return setTimeout(t.drawBackground,0),!1;t.drawBackgroundTiles(t.layers.background),t.createBackgroundTexture(t.layers.background),t.layers.backgroundDrawn||(t.gameContainer.addChildAt(t.layers.background,0),t.drawStartingSplats(),requestAnimationFrame(t.render)),t.drawDynamicTiles(),t.layers.backgroundDrawn=!0,tagpro.chat.resize()},t.drawDynamicTile=function(n,r){var i=tagpro.tiles[tagpro.map[n][r]];if(!i)return;var s={x:n*e,y:r*e},o;if(i instanceof PIXI.MovieClip)o=t.drawAnimation(i,s);else{if(!i.dynamic)return;o=tagpro.tiles.draw(t.layers.midground,tagpro.map[n][r],s)}t.dynamicSprites[n]||(t.dynamicSprites[n]={}),t.dynamicSprites[n][r]=o},t.drawDynamicTiles=function(){for(var e=0;e<tagpro.map.length;e++)for(var n=0;n<tagpro.map[0].length;n++)t.drawDynamicTile(e,n)},t.drawAnimation=function(e,n){var r=new PIXI.MovieClip(e.textures);return t.addStatePlayer(r),r.x=n.x,r.y=n.y,r.fps=4+Math.random()/10,r.playSequence(),t.layers.midground.addChild(r),r},t.chunkifyBackground=function(n){t.backgroundChunks=[];var r=n.baseTexture,i=tagpro.map.length*e,s=tagpro.map[0].length*e,o=1024;if(t.renderer.gl){var u=t.renderer.gl.getParameter(t.renderer.gl.MAX_TEXTURE_SIZE);o>u&&(o=Math.pow(2,Math.round(Math.log(u/2)/Math.log(2))),console.log("Chunk size was too large. Reducing to closest power of two below gl.MAX_TEXTURE_SIZE, which is "+o))}t.layers.background.removeChildren();for(var a=0;a<i;a+=o)for(var f=0;f<s;f+=o){var l=a+o>i?i-a:o,c=f+o>s?s-f:o,h=document.createElement("canvas");h.width=h.height=o;var p=h.getContext("2d");p.drawImage(r.source,a,f,l,c,0,0,l,c);var d=PIXI.Texture.fromCanvas(h),v=new PIXI.Sprite(d);v.x=a,v.y=f,t.backgroundChunks.push(v),t.layers.background.addChild(v)}},t.createBackgroundTexture=function(n){var r=new PIXI.RenderTexture(tagpro.map.length*e,tagpro.map[0].length*e,new PIXI.CanvasRenderer);r.render(n),t.chunkifyBackground(r)},t.updateDeathStatus=function(e,t){e.toUpdate&&(t.x=-1e3,t.y=-1e3,e.sprite.x=-1e3,e.sprite.y=-1e3,e.toUpdate=!1)},t.getLockedPosition=function(e){return{x:Math.round(e.x),y:Math.round(e.y)}},t.updatePlayerColor=function(e){var t=e.team===1?"red":"blue",n=t+"ball";if(e.sprites.actualBall.tileId!==n){var r=tagpro.tiles.getTexture(n),i=new PIXI.Texture(r);e.sprites.actualBall.setTexture(i),e.sprites.actualBall.tileId=n}},t.drawPlayer=function(e,n){tagpro.spectator&&(e.draw=!0);var r=t.getLockedPosition(e);return t.updateFlagsFromPlayer(e),t.updatePlayerSpritePosition(e),t.updateDeathStatus(e,r),t.updatePlayerFlag(e,r),t.updatePlayerPowerUps(e,n,r),t.updatePlayerVisibility(e),t.updatePlayerColor(e),r},t.drawPlayers=function(e){for(var n in tagpro.players){if(!tagpro.players.hasOwnProperty(n))continue;var r=tagpro.players[n];t.drawPlayer(r,e)}},t.drawDegree=function(e){tagpro.settings.ui.degrees&&(!e.sprites.degrees&&e.degree&&(e.sprites.degrees=t.veryPrettyText(e.degree+"Â°"),e.sprites.info.addChild(e.sprites.degrees)),e.sprites.degrees&&(e.sprites.degrees.x=25,e.sprites.degrees.y=-10))},t.prettyText=function(e,t){return new PIXI.Text(e,{font:"bold 8pt Arial",fill:t||"#FFFFFF",stroke:"#000000",strokeThickness:3})},t.veryPrettyText=function(e,t){var n=document.createElement("canvas");n.width=128,n.height=32;var r=n.getContext("2d");r.clearRect(0,0,n.width,n.height),r.font="bold 11px arial",r.fillStyle=t||"#ffffff",r.strokeStyle="#000000",r.shadowColor="#000000",r.shadowOffsetX=0,r.shadowOffsetY=0,r.lineWidth=2,r.shadowBlur=10,r.strokeText(e,16,16),r.shadowBlur=0,r.fillText(e,16,16);var i=PIXI.Texture.fromCanvas(n);return new PIXI.Sprite(i)},t.largeText=function(e,t){return new PIXI.Text(e,{font:"bold 48pt arial",fill:t||"#ffffff",stroke:"#000000",strokeThickness:2})},t.drawName=function(e,n){if(!e.sprites.name||n){e.sprites.name&&e.sprites.info.removeChild(e.sprites.name);if(!tagpro.settings.ui.names)return;var r=e.auth?"#BFFF00":"#ffffff";e.sprites.name=t.veryPrettyText(e.name,r),e.sprites.info.addChild(e.sprites.name)}e.sprites.name.x=20,e.sprites.name.y=-21,e.sprites.name.visible=tagpro.settings.ui.names?!0:!1},t.getFlairTexture=function(e,t){var n=PIXI.TextureCache[e];if(!n){var r=document.createElement("canvas");r.width=16,r.height=16;var i=r.getContext("2d");i.drawImage($("#flair").get(0),t.x*16,t.y*16,16,16,0,0,16,16),n=PIXI.Texture.fromCanvas(r),PIXI.TextureCache[e]=n}return n},t.drawFlair=function(e){e.sprites.flair&&e.sprites.flair.flairName!==e.flair&&(e.sprites.info.removeChild(e.sprites.flair),e.sprites.flair=null);if(e.flair&&!e.sprites.flair){var n="flair-"+e.flair.x+","+e.flair.y,r=t.getFlairTexture(n,e.flair);e.sprites.flair=new PIXI.Sprite(r),e.sprites.flair.x=12,e.sprites.flair.y=-17,e.sprites.info.addChild(e.sprites.flair),e.sprites.flair.flairName=e.flair}!e.flair&&e.sprites.flair&&e.sprites.info.removeChild(e.sprites.flair)},t.createParticle=function(e){var t=document.createElement("canvas"),n=$(e)[0];t.width=n.width,t.height=n.height;var r=t.getContext("2d");return r.drawImage(n,0,0),PIXI.Texture.fromCanvas(t)},t.createExplosion=function(e,n){if(t.options.disableParticles){var r=new PIXI.Graphics;r.tagpro={started:performance.now(),length:150,x:e,y:n,size:200},t.layers.foreground.addChild(r),t.explosions.push(r)}else{var i=new cloudkid.Emitter(t.layers.foreground,[t.particleTexture],tagpro.particleDefinitions.explosion);i.updateSpawnPos(e,n),t.emitters.push(i)}},t.updateExplosions=function(){if(!t.options.disableParticles)return;var e=performance.now();t.explosions.slice().forEach(function(n){var r=e-n.tagpro.started;if(r>=n.tagpro.length){t.layers.foreground.removeChild(n),t.explosions.splice(t.explosions.indexOf(n),1);return}var i=n.tagpro.size*(r/n.tagpro.length);n.alpha=1-r/n.tagpro.length,n.clear().beginFill(n.tagpro.color||16776960).drawCircle(n.tagpro.x+20,n.tagpro.y+20,i)})},t.updateFadingSplats=function(){var e=performance.now();t.fadingSplats.slice().forEach(function(n){if(e>=n.fadeUntil){t.layers.splats.removeChild(n),t.fadingSplats.splice(t.fadingSplats.indexOf(n),1);return}n.alpha=1-(e-n.fadeStart)/(n.fadeUntil-n.fadeStart)})},t.startDeathEmitter=function(e,n,r,i){if(t.options.disableParticles)return;var s=new cloudkid.Emitter(t.layers.foreground,[t.particleTexture],tagpro.particleDefinitions.death);s.startColor=cloudkid.ParticleUtils.hexToRGB(e),s.stopColor=cloudkid.ParticleUtils.hexToRGB(n),s.updateSpawnPos(r,i),t.emitters.push(s)},t.drawBallPop=function(e,n,r){var i=new PIXI.Graphics;i.tagpro={started:performance.now(),length:150,x:e-20,y:n-20,size:60,color:r===1?16711680:255},t.layers.foreground.addChild(i),t.explosions.push(i)},t.drawSplat=function(e,n,r,i,s){var o,u;r===1?o="ff0000":o="0000ff",u="ffffff",i&&(t.options.disableParticles?t.drawBallPop(e+19,n+19,r):t.startDeathEmitter(o,u,e+19,n+19)),t.addSplat(r,e,n,s)},t.addSplat=function(e,n,r,i){var s=Math.floor(Math.random()*tagpro.tiles.splats.red.length),o;e===1?o=tagpro.tiles.splats.red:o=tagpro.tiles.splats.blue;var u=o[s],a=new PIXI.Sprite(u);a.x=n+20,a.y=r+20,a.width=90*(.8+.2*Math.random()),a.height=90*(.8+.2*Math.random()),a.anchor.x=.5,a.anchor.y=.5,a.rotation=Math.random()*2*Math.PI,a.alpha=1,i&&(a.fadeStart=performance.now(),a.fadeUntil=a.fadeStart+5e3,t.fadingSplats.push(a)),t.layers.splats.addChild(a)},t.createPlayerEmitter=function(e){if(t.options.disableParticles)return;e.sprites.emitter=new cloudkid.Emitter(t.layers.midground,[t.particleTexture,t.particleFireTexture],tagpro.particleDefinitions.playerEmitter),e.sprites.emitter.keep=!0,t.emitters.push(e.sprites.emitter),e.sprites.emitter.emit=!1},t.updateMarsBall=function(e,n){e.sprite||t.drawMarsball(e,n),e.draw?e.sprite.visible=!0:e.sprite.visible=!!tagpro.spectator,e.sprite.x=n.x,e.sprite.y=n.y},t.updateObjects=function(){for(var e in tagpro.objects){if(!tagpro.objects.hasOwnProperty(e))continue;var n=tagpro.objects[e],r={x:Math.round(n.x-20),y:Math.round(n.y-20)};t.updateMarsBall(n,r)}},t.updateGraphics=function(){t.updatePlayers(),t.updateExplosions(),t.updateFadingSplats(),t.updateCamera(),t.updateObjects(),t.updateBackgroundVisibility(),t.options.disableParticles||t.updateEmitters()},t.checkIfVisible=function(){return!0},t.updateBackgroundVisibility=function(){for(var e=0;e<t.backgroundChunks.length;e++){var n=t.backgroundChunks[e];if(!n)continue;n.visible=t.checkIfVisible(n.x,n.y,n.width,n.height)}},t.centerContainerToPoint=function(e,n){var r=t.options.disableViewportScaling?1:(this.vpHeight/t.canvas_height).toFixed(2);t.gameContainer.x=Math.round(this.vpWidth/2-e/tagpro.zoom*r),t.gameContainer.y=Math.round(this.vpHeight/2-n/tagpro.zoom*r)},t.updateCameraPosition=function(e){e.sprite.x!==-1e3&&e.sprite.y!==-1e3&&t.centerContainerToPoint(e.sprite.x+19,e.sprite.y+19)},t.updateCameraZoom=function(){var e=t.options.disableViewportScaling?1:this.vpHeight/t.canvas_height;tagpro.spectator?tagpro.zoom=tagpro.zoom+tagpro.zooming>.1?tagpro.zoom+tagpro.zooming:tagpro.zoom:tagpro.zoom=1;var n=new PIXI.Point(1/tagpro.zoom*e,1/tagpro.zoom*e),r=new PIXI.Point(tagpro.zoom,tagpro.zoom);t.gameContainer.scale=n;for(var i in tagpro.players){if(!tagpro.players.hasOwnProperty(i))continue;var s=tagpro.players[i],o=s.sprites.info;o.x=19-tagpro.zoom*19,o.scale=r;if(s.sprites){var u=tagpro.zoom<t.zoomThreshold;s.sprites.flair&&(s.sprites.flair.visible=u),s.sprites.degrees&&(s.sprites.degrees.visible=u)}}},t.centerCameraPosition=function(){var n=tagpro.map.length||0,r=tagpro.map[0]?tagpro.map[0].length:0;t.centerContainerToPoint(n/2*e,r/2*e)},t.updateCamera=function(e){e=e||tagpro.playerId;var n=tagpro.players[e];t.updateCameraZoom(),tagpro.viewport.followPlayer&&n?t.updateCameraPosition(n):t.centerCameraPosition()},t.resetFlagStatuses=function(){tagpro.ui.blueFlagTaken=!1,tagpro.ui.redFlagTaken=!1,tagpro.ui.yellowFlagTakenByRed=!1,tagpro.ui.yellowFlagTakenByBlue=!1,tagpro.ui.bluePotatoTaken=!1,tagpro.ui.redPotatoTaken=!1,tagpro.ui.yellowPotatoTakenByRed=!1,tagpro.ui.yellowPotatoTakenByBlue=!1},t.updateFlagsFromPlayer=function(e){e.flag&&(e.potatoFlag?(tagpro.ui.bluePotatoTaken=tagpro.ui.bluePotatoTaken||e.flag===2,tagpro.ui.redPotatoTaken=tagpro.ui.redPotatoTaken||e.flag===1,tagpro.ui.yellowPotatoTakenByRed=tagpro.ui.yellowPotatoTakenByRed||e.team===1&&e.flag===3,tagpro.ui.yellowPotatoTakenByBlue=tagpro.ui.yellowPotatoTakenByBlue||e.team===2&&e.flag===3):(tagpro.ui.blueFlagTaken=tagpro.ui.blueFlagTaken||e.flag===2,tagpro.ui.redFlagTaken=tagpro.ui.redFlagTaken||e.flag===1,tagpro.ui.yellowFlagTakenByRed=tagpro.ui.yellowFlagTakenByRed||e.team===1&&e.flag===3,tagpro.ui.yellowFlagTakenByBlue=tagpro.ui.yellowFlagTakenByBlue||e.team===2&&e.flag===3))},t.setupPlayerSprites=function(e){e.sprites={tagpro:null,grip:null,flag:null,ball:null,bomb:null}},t.createBallSprite=function(e){var t=e.team===1?"redball":"blueball";e.sprites.actualBall=tagpro.tiles.draw(e.sprites.ball,t,{x:0,y:0}),e.sprites.actualBall.tileId=t},t.addPlayerSprite=function(e){t.createBallSprite(e),t.layers.foreground.addChild(e.sprite)},t.createPlayerSprite=function(e){e.sprite=new PIXI.DisplayObjectContainer,e.sprites.ball=new PIXI.DisplayObjectContainer,e.sprite.addChild(e.sprites.ball),e.sprite.interactive=!0,e.sprite.click=function(){tagpro.kick.player(e)},e.sprite.id=e.id,t.addPlayerSprite(e)},t.updatePlayerSpritePosition=function(e){e.sprite.x=Math.round(e.x),e.sprite.y=Math.round(e.y)},t.checkSelfDestruct=function(e){if(e.sprites.flag&&e.selfDestructSoon&&!e.sprites.selfDestructSoon)t.options.disableParticles||(e.sprites.selfDestructSoon=new cloudkid.Emitter(e.sprites.flag,[t.particleTexture],tagpro.particleDefinitions.rollingBomb),t.emitters.push(e.sprites.selfDestructSoon));else if(!e.selfDestructSoon&&e.sprites.selfDestructSoon){e.sprites.selfDestructSoon.emit=!1,e.sprites.flag.removeChild(e.sprites.selfDestructSoon);var n=t.emitters.indexOf(e.sprites.selfDestructSoon);t.emitters.splice(n,1),e.sprites.selfDestructSoon.destroy(),e.sprites.selfDestructSoon=null}},t.updatePlayerFlag=function(e){e.sprites.flagLayer||(e.sprites.flagLayer=new PIXI.DisplayObjectContainer,e.sprites.info.addChildAt(e.sprites.flagLayer,0)),t.checkSelfDestruct(e);if(e.flag){var n;e.flag===1?n=e.potatoFlag?"redpotato":"redflag":e.flag===2?n=e.potatoFlag?"bluepotato":"blueflag":e.flag===3&&(n=e.potatoFlag?"yellowpotato":"yellowflag");if(!e.sprites.flag||e.sprites.flag.name!==n)e.sprites.flag=tagpro.tiles.draw(e.sprites.flagLayer,n,{x:13,y:-32},null,null,null,!0),e.sprites.flag.name=n}else e.sprites.flag&&(e.sprites.flagLayer.removeChild(e.sprites.flag),e.sprites.flag=null)},t.updateGrip=function(e,t,n){e.grip?e.sprites.grip?(e.sprites.grip.x=n.x,e.sprites.grip.y=n.y+23):e.sprites.grip=tagpro.tiles.draw(t,"grip",{x:n.x,y:n.y+23},17,17):e.sprites.grip&&(t.removeChild(e.sprites.grip),e.sprites.grip=null)},t.updateTagpro=function(e){if(e.tagpro){if(!e.sprites.tagproTint){var n=e.sprites.tagproTint=new PIXI.Graphics;n.beginFill(65280,.25).lineStyle(3,65280).drawCircle(20,20,20),e.sprites.ball.addChild(n),t.options.disableParticles||(e.sprites.tagproSparks=new cloudkid.Emitter(e.sprites.ball,[t.particleFireTexture],tagpro.particleDefinitions.tagproSparks),e.sprites.tagproSparks.player=e.id,t.emitters.push(e.sprites.tagproSparks))}}else{e.sprites.tagproTint&&(e.sprites.ball.removeChild(e.sprites.tagproTint),e.sprites.tagproTint=null);if(e.sprites.tagproSparks){e.sprites.tagproSparks.emit=!1;var r=t.emitters.indexOf(e.sprites.tagproSparks);t.emitters.splice(r,1),e.sprites.tagproSparks.destroy(),e.sprites.tagproSparks=null}}},t.updateRollingBomb=function(e){if(e.bomb)if(!e.sprites.bomb){t.options.disableParticles||(e.sprites.rollingBomb=new cloudkid.Emitter(e.sprites.ball,[t.particleTexture],tagpro.particleDefinitions.rollingBomb),t.emitters.push(e.sprites.rollingBomb));var n=e.sprites.bomb=new PIXI.Graphics;n.beginFill(16776960,.75).drawCircle(20,20,20),e.sprites.ball.addChild(n)}else e.sprites.bomb.alpha=Math.abs(.75*Math.sin(performance.now()/150));else e.sprites.bomb&&(e.sprites.ball.removeChild(e.sprites.bomb),e.sprites.bomb=null),e.sprites.rollingBomb&&(e.sprites.rollingBomb instanceof cloudkid.Emitter?(e.sprites.rollingBomb.emit=!1,t.emitters.splice(t.emitters.indexOf(e.sprites.rollingBomb),1),e.sprites.rollingBomb.destroy()):e.sprites.rollingBomb.visible=!1,e.sprites.rollingBomb=null)},t.updatePlayerPowerUps=function(e,n,r){t.updateGrip(e,n,r),t.updateTagpro(e),t.updateRollingBomb(e)},t.updatePlayerVisibility=function(e){for(var t in e.sprites)if(e.sprites.hasOwnProperty(t)){var n=e.sprites[t];n&&(n.visible=e.sprite.visible)}},t.updatePlayerEmitter=function(e){var t=e.sprite.visible&&!e.dead&&(e.ac>.025||Math.sqrt(e.lx*e.lx+e.ly*e.ly)>e.ms*1.5),n=t&&!e.sprites.emitter.emit;e.sprites.emitter.emit=t,e.sprites.emitter.updateOwnerPos(e.x,e.y),n&&e.sprites.emitter.resetPositionTracking()},t.updatePlayer=function(e){e.sprites||t.setupPlayerSprites(e),e.sprite||t.createPlayerSprite(e),e.sprites.emitter||t.createPlayerEmitter(e),!e.sprite.visible&&e.draw&&!e.dead&&(e.toUpdate=!0);if(!e.sprites.info){var n=e.sprites.info=new PIXI.DisplayObjectContainer;e.sprite.addChild(n)}e.sprite.visible=!!e.draw&&!e.dead,t.drawDegree(e),t.drawName(e),t.drawFlair(e),t.options.disableParticles||t.updatePlayerEmitter(e)},t.updatePlayers=function(){t.resetFlagStatuses();for(var e in tagpro.players){if(!tagpro.players.hasOwnProperty(e))continue;var n=tagpro.players[e];t.updatePlayer(n)}t.drawPlayers(t.layers.foreground)},t.updateEmitters=function(){var e=performance.now();t.renderDelta||(t.renderDelta=e);var n=[];t.emitters.forEach(function(r){r.emit||r._activeParticles.length>0?r.update((e-t.renderDelta)*.001):r.keep||n.push(r)}),n.forEach(function(e){var n=t.emitters.indexOf(e);n!==-1&&t.emitters.splice(n,1)}),t.renderDelta=performance.now()},t.updateDynamicTile=function(e){tagpro.map[e.x][e.y]=e.v,t.dynamicSprites[e.x]&&t.layers.midground.removeChild(t.dynamicSprites[e.x][e.y]),t.drawDynamicTile(e.x,e.y)},t.handleMapUpdate=function(e){if(tagpro.map){Array.isArray(e)||(e=[e]);for(var n=0,r=e.length;n!==r;n++){var i=e[n];t.updateDynamicTile(i)}}},t.drawSpawn=function(e,n,r,i){if(!t.layers.foreground){setTimeout(t.drawSpawn,0,e,n,r,i);return}var s=r===1?"redball":"blueball",o=tagpro.tiles.draw(t.layers.foreground,s,{x:e,y:n},null,null,.25,!0);setTimeout(function(){o.parent.removeChild(o)},i)},tagpro.socket.on("mapupdate",t.handleMapUpdate),tagpro.socket.on("bomb",function(e){t.createExplosion(e.x,e.y)}),tagpro.socket.on("splat",function(e){t.drawSplat(e.x,e.y,e.t,!0,e.temp)}),tagpro.socket.on("spawn",function(e){t.drawSpawn(e.x,e.y,e.t,e.w)}),t.addStatePlayer=function(e){function u(t){l(),e.gotoAndStop(t)}function a(t){l(),t?(r=t[0],i=t[1]):(r=0,i=e.totalFrames),n=i-r,e.fps||(e.fps=4);var u=600/e.fps;e.gotoAndStop(r),o||(s=setInterval(f.bind(this),u),o=!0)}function f(){t<n?(e.gotoAndStop(e.currentFrame+1),t+=1):e.loop&&(e.gotoAndStop(r),t=1)}function l(){s!==undefined&&o===!0&&(o=!1,t=0,r=0,i=0,n=0,clearInterval(s))}if(!(e instanceof PIXI.MovieClip))throw new Error("You can only animate PIXI.MovieClip sprites");var t=0,n=0,r=0,i=0,s,o=!1;e.show=u,e.playSequence=a},tagpro.ready.after(t.start)}(function(window,undefined){function isArraylike(e){var t=e.length,n=jQuery.type(e);return jQuery.isWindow(e)?!1:e.nodeType===1&&t?!0:n==="array"||n!=="function"&&(t===0||typeof t=="number"&&t>0&&t-1 in e)}function createOptions(e){var t=optionsCache[e]={};return jQuery.each(e.match(core_rnotwhite)||[],function(e,n){t[n]=!0}),t}function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=jQuery.expando+Math.random()}function dataAttr(e,t,n){var r;if(n===undefined&&e.nodeType===1){r="data-"+t.replace(rmultiDash,"-$1").toLowerCase(),n=e.getAttribute(r);if(typeof n=="string"){try{n=n==="true"?!0:n==="false"?!1:n==="null"?null:+n+""===n?+n:rbrace.test(n)?JSON.parse(n):n}catch(i){}data_user.set(e,t,n)}else n=undefined}return n}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(e){}}function sibling(e,t){while((e=e[t])&&e.nodeType!==1);return e}function winnow(e,t,n){if(jQuery.isFunction(t))return jQuery.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return jQuery.grep(e,function(e){return e===t!==n});if(typeof t=="string"){if(isSimple.test(t))return jQuery.filter(t,e,n);t=jQuery.filter(t,e)}return jQuery.grep(e,function(e){return core_indexOf.call(t,e)>=0!==n})}function manipulationTarget(e,t){return jQuery.nodeName(e,"table")&&jQuery.nodeName(t.nodeType===1?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function disableScript(e){return e.type=(e.getAttribute("type")!==null)+"/"+e.type,e}function restoreScript(e){var t=rscriptTypeMasked.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function setGlobalEval(e,t){var n=e.length,r=0;for(;r<n;r++)data_priv.set(e[r],"globalEval",!t||data_priv.get(t[r],"globalEval"))}function cloneCopyEvent(e,t){var n,r,i,s,o,u,a,f;if(t.nodeType!==1)return;if(data_priv.hasData(e)){s=data_priv.access(e),o=data_priv.set(t,s),f=s.events;if(f){delete o.handle,o.events={};for(i in f)for(n=0,r=f[i].length;n<r;n++)jQuery.event.add(t,i,f[i][n])}}data_user.hasData(e)&&(u=data_user.access(e),a=jQuery.extend({},u),data_user.set(t,a))}function getAll(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return t===undefined||t&&jQuery.nodeName(e,t)?jQuery.merge([e],n):n}function fixInput(e,t){var n=t.nodeName.toLowerCase();if(n==="input"&&manipulation_rcheckableType.test(e.type))t.checked=e.checked;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}function vendorPropName(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=cssPrefixes.length;while(i--){t=cssPrefixes[i]+n;if(t in e)return t}return r}function isHidden(e,t){return e=t||e,jQuery.css(e,"display")==="none"||!jQuery.contains(e.ownerDocument,e)}function getStyles(e){return window.getComputedStyle(e,null)}function showHide(e,t){var n,r,i,s=[],o=0,u=e.length;for(;o<u;o++){r=e[o];if(!r.style)continue;s[o]=data_priv.get(r,"olddisplay"),n=r.style.display,t?(!s[o]&&n==="none"&&(r.style.display=""),r.style.display===""&&isHidden(r)&&(s[o]=data_priv.access(r,"olddisplay",css_defaultDisplay(r.nodeName)))):s[o]||(i=isHidden(r),(n&&n!=="none"||!i)&&data_priv.set(r,"olddisplay",i?n:jQuery.css(r,"display")))}for(o=0;o<u;o++){r=e[o];if(!r.style)continue;if(!t||r.style.display==="none"||r.style.display==="")r.style.display=t?s[o]||"":"none"}return e}function setPositiveNumber(e,t,n){var r=rnumsplit.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function augmentWidthOrHeight(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2)n==="margin"&&(o+=jQuery.css(e,n+cssExpand[s],!0,i)),r?(n==="content"&&(o-=jQuery.css(e,"padding"+cssExpand[s],!0,i)),n!=="margin"&&(o-=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i))):(o+=jQuery.css(e,"padding"+cssExpand[s],!0,i),n!=="padding"&&(o+=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i)));return o}function getWidthOrHeight(e,t,n){var r=!0,i=t==="width"?e.offsetWidth:e.offsetHeight,s=getStyles(e),o=jQuery.support.boxSizing&&jQuery.css(e,"boxSizing",!1,s)==="border-box";if(i<=0||i==null){i=curCSS(e,t,s);if(i<0||i==null)i=e.style[t];if(rnumnonpx.test(i))return i;r=o&&(jQuery.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+augmentWidthOrHeight(e,t,n||(o?"border":"content"),r,s)+"px"}function css_defaultDisplay(e){var t=document,n=elemdisplay[e];if(!n){n=actualDisplay(e,t);if(n==="none"||!n)iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(iframe[0].contentWindow||iframe[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=actualDisplay(e,t),iframe.detach();elemdisplay[e]=n}return n}function actualDisplay(e,t){var n=jQuery(t.createElement(e)).appendTo(t.body),r=jQuery.css(n[0],"display");return n.remove(),r}function buildParams(e,t,n,r){var i;if(jQuery.isArray(t))jQuery.each(t,function(t,i){n||rbracket.test(e)?r(e,i):buildParams(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&jQuery.type(t)==="object")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}function addToPrefiltersOrTransports(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(n))while(r=s[i++])r[0]==="+"?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function inspectPrefiltersOrTransports(e,t,n,r){function o(u){var a;return i[u]=!0,jQuery.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f=="string"&&!s&&!i[f])return t.dataTypes.unshift(f),o(f),!1;if(s)return!(a=f)}),a}var i={},s=e===transports;return o(t.dataTypes[0])||!i["*"]&&o("*")}function ajaxExtend(e,t){var n,r,i=jQuery.ajaxSettings.flatOptions||{};for(n in t)t[n]!==undefined&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&jQuery.extend(!0,e,r),e}function ajaxHandleResponses(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while(a[0]==="*")a.shift(),r===undefined&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in u)if(u[i]&&u[i].test(r)){a.unshift(i);break}if(a[0]in n)s=a[0];else{for(i in n){if(!a[0]||e.converters[i+" "+a[0]]){s=i;break}o||(o=i)}s=s||o}if(s)return s!==a[0]&&a.unshift(s),n[s]}function ajaxConvert(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s){e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift();if(s)if(s==="*")s=a;else if(a!=="*"&&a!==s){o=f[a+" "+s]||f["* "+s];if(!o)for(i in f){u=i.split(" ");if(u[1]===s){o=f[a+" "+u[0]]||f["* "+u[0]];if(o){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}}}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}}return{state:"success",data:t}}function createFxNow(){return setTimeout(function(){fxNow=undefined}),fxNow=jQuery.now()}function createTween(e,t,n){var r,i=(tweeners[t]||[]).concat(tweeners["*"]),s=0,o=i.length;for(;s<o;s++)if(r=i[s].call(n,t,e))return r}function Animation(e,t,n){var r,i,s=0,o=animationPrefilters.length,u=jQuery.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=fxNow||createFxNow(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),s<1&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:jQuery.extend({},t),opts:jQuery.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:fxNow||createFxNow(),duration:n.duration,tweens:[],createTween:function(t,n){var r=jQuery.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;propFilter(l,f.opts.specialEasing);for(;s<o;s++){r=animationPrefilters[s].call(f,e,l,f.opts);if(r)return r}return jQuery.map(l,createTween,f),jQuery.isFunction(f.opts.start)&&f.opts.start.call(e,f),jQuery.fx.timer(jQuery.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function propFilter(e,t){var n,r,i,s,o;for(n in e){r=jQuery.camelCase(n),i=t[r],s=e[n],jQuery.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=jQuery.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function defaultPrefilter(e,t,n){var r,i,s,o,u,a,f=this,l={},c=e.style,h=e.nodeType&&isHidden(e),p=data_priv.get(e,"fxshow");n.queue||(u=jQuery._queueHooks(e,"fx"),u.unqueued==null&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,f.always(function(){f.always(function(){u.unqueued--,jQuery.queue(e,"fx").length||u.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[c.overflow,c.overflowX,c.overflowY],jQuery.css(e,"display")==="inline"&&jQuery.css(e,"float")==="none"&&(c.display="inline-block")),n.overflow&&(c.overflow="hidden",f.always(function(){c.overflow=n.overflow[0],c.overflowX=n.overflow[1],c.overflowY=n.overflow[2]}));for(r in t){i=t[r];if(rfxtypes.exec(i)){delete t[r],s=s||i==="toggle";if(i===(h?"hide":"show")){if(i!=="show"||!p||p[r]===undefined)continue;h=!0}l[r]=p&&p[r]||jQuery.style(e,r)}}if(!jQuery.isEmptyObject(l)){p?"hidden"in p&&(h=p.hidden):p=data_priv.access(e,"fxshow",{}),s&&(p.hidden=!h),h?jQuery(e).show():f.done(function(){jQuery(e).hide()}),f.done(function(){var t;data_priv.remove(e,"fxshow");for(t in l)jQuery.style(e,t,l[t])});for(r in l)o=createTween(h?p[r]:0,r,f),r in p||(p[r]=o.start,h&&(o.end=o.start,o.start=r==="width"||r==="height"?1:0))}}function Tween(e,t,n,r,i){return new Tween.prototype.init(e,t,n,r,i)}function genFx(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=cssExpand[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function getWindow(e){return jQuery.isWindow(e)?e:e.nodeType===9&&e.defaultView}var rootjQuery,readyList,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="2.0.3",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(e,t){return new jQuery.fn.init(e,t,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(e,t){return t.toUpperCase()},completed=function(){document.removeEventListener("DOMContentLoaded",completed,!1),window.removeEventListener("load",completed,!1),jQuery.ready()};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(e,t,n){var r,i;if(!e)return this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?r=[null,e,null]:r=rquickExpr.exec(e);if(r&&(r[1]||!t)){if(r[1]){t=t instanceof jQuery?t[0]:t,jQuery.merge(this,jQuery.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:document,!0));if(rsingleTag.test(r[1])&&jQuery.isPlainObject(t))for(r in t)jQuery.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=document.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=document,this.selector=e,this}return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e)}return e.nodeType?(this.context=this[0]=e,this.length=1,this):jQuery.isFunction(e)?n.ready(e):(e.selector!==undefined&&(this.selector=e.selector,this.context=e.context),jQuery.makeArray(e,this))},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=jQuery.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return jQuery.each(this,e,t)},ready:function(e){return jQuery.ready.promise().done(e),this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},map:function(e){return this.pushStack(jQuery.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice},jQuery.fn.init.prototype=jQuery.fn,jQuery.extend=jQuery.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u=2),typeof o!="object"&&!jQuery.isFunction(o)&&(o={}),a===u&&(o=this,--u);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(jQuery.isPlainObject(r)||(i=jQuery.isArray(r)))?(i?(i=!1,s=n&&jQuery.isArray(n)?n:[]):s=n&&jQuery.isPlainObject(n)?n:{},o[t]=jQuery.extend(f,s,r)):r!==undefined&&(o[t]=r)}return o},jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(e){return window.$===jQuery&&(window.$=_$),e&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},isReady:!1,readyWait:1,holdReady:function(e){e?jQuery.readyWait++:jQuery.ready(!0)},ready:function(e){if(e===!0?--jQuery.readyWait:jQuery.isReady)return;jQuery.isReady=!0;if(e!==!0&&--jQuery.readyWait>0)return;readyList.resolveWith(document,[jQuery]),jQuery.fn.trigger&&jQuery(document).trigger("ready").off("ready")},isFunction:function(e){return jQuery.type(e)==="function"},isArray:Array.isArray,isWindow:function(e){return e!=null&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?class2type[core_toString.call(e)]||"object":typeof e},isPlainObject:function(e){if(jQuery.type(e)!=="object"||e.nodeType||jQuery.isWindow(e))return!1;try{if(e.constructor&&!core_hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||document;var r=rsingleTag.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=jQuery.buildFragment([e],t,i),i&&jQuery(i).remove(),jQuery.merge([],r.childNodes))},parseJSON:JSON.parse,parseXML:function(e){var t,n;if(!e||typeof e!="string")return null;try{n=new DOMParser,t=n.parseFromString(e,"text/xml")}catch(r){t=undefined}return(!t||t.getElementsByTagName("parsererror").length)&&jQuery.error("Invalid XML: "+e),t},noop:function(){},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code),code&&(code.indexOf("use strict")===1?(script=document.createElement("script"),script.text=code,document.head.appendChild(script).parentNode.removeChild(script)):indirect(code))},camelCase:function(e){return e.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e);if(n)if(o)for(;i<s;i++){r=t.apply(e[i],n);if(r===!1)break}else for(i in e){r=t.apply(e[i],n);if(r===!1)break}else if(o)for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===!1)break}else for(i in e){r=t.call(e[i],i,e[i]);if(r===!1)break}return e},trim:function(e){return e==null?"":core_trim.call(e)},makeArray:function(e,t){var n=t||[];return e!=null&&(isArraylike(Object(e))?jQuery.merge(n,typeof e=="string"?[e]:e):core_push.call(n,e)),n},inArray:function(e,t,n){return t==null?-1:core_indexOf.call(t,e,n)},merge:function(e,t){var n=t.length,r=e.length,i=0;if(typeof n=="number")for(;i<n;i++)e[r++]=t[i];else while(t[i]!==undefined)e[r++]=t[i++];return e.length=r,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e),u=[];if(o)for(;i<s;i++)r=t(e[i],i,n),r!=null&&(u[u.length]=r);else for(i in e)r=t(e[i],i,n),r!=null&&(u[u.length]=r);return core_concat.apply([],u)},guid:1,proxy:function(e,t){var n,r,i;return typeof t=="string"&&(n=e[t],t=e,e=n),jQuery.isFunction(e)?(r=core_slice.call(arguments,2),i=function(){return e.apply(t||this,r.concat(core_slice.call(arguments)))},i.guid=e.guid=e.guid||jQuery.guid++,i):undefined},access:function(e,t,n,r,i,s,o){var u=0,a=e.length,f=n==null;if(jQuery.type(n)==="object"){i=!0;for(u in n)jQuery.access(e,t,u,n[u],!0,s,o)}else if(r!==undefined){i=!0,jQuery.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(jQuery(e),n)}));if(t)for(;u<a;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)))}return i?e:f?t.call(e):a?t(e[0],n):s},now:Date.now,swap:function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}}),jQuery.ready.promise=function(e){return readyList||(readyList=jQuery.Deferred(),document.readyState==="complete"?setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed,!1),window.addEventListener("load",completed,!1))),readyList.promise(e)},jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){class2type["[object "+t+"]"]=t.toLowerCase()}),rootjQuery=jQuery(document),function(e,t){function st(e,t,n,i){var s,o,u,a,f,l,p,m,g,E;(t?t.ownerDocument||t:w)!==h&&c(t),t=t||h,n=n||[];if(!e||typeof e!="string")return n;if((a=t.nodeType)!==1&&a!==9)return[];if(d&&!i){if(s=Y.exec(e))if(u=s[1]){if(a===9){o=t.getElementById(u);if(!o||!o.parentNode)return n;if(o.id===u)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(u))&&y(t,o)&&o.id===u)return n.push(o),n}else{if(s[2])return P.apply(n,t.getElementsByTagName(e)),n;if((u=s[3])&&r.getElementsByClassName&&t.getElementsByClassName)return P.apply(n,t.getElementsByClassName(u)),n}if(r.qsa&&(!v||!v.test(e))){m=p=b,g=t,E=a===9&&e;if(a===1&&t.nodeName.toLowerCase()!=="object"){l=vt(e),(p=t.getAttribute("id"))?m=p.replace(tt,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",f=l.length;while(f--)l[f]=m+mt(l[f]);g=V.test(e)&&t.parentNode||t,E=l.join(",")}if(E)try{return P.apply(n,g.querySelectorAll(E)),n}catch(S){}finally{p||t.removeAttribute("id")}}}return Tt(e.replace(z,"$1"),t,n,i)}function ot(){function t(n,r){return e.push(n+=" ")>s.cacheLength&&delete t[e.shift()],t[n]=r}var e=[];return t}function ut(e){return e[b]=!0,e}function at(e){var t=h.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ft(e,t){var n=e.split("|"),r=e.length;while(r--)s.attrHandle[n[r]]=t}function lt(e,t){var n=t&&e,r=n&&e.nodeType===1&&t.nodeType===1&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function pt(e){return ut(function(t){return t=+t,ut(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function dt(){}function vt(e,t){var n,r,i,o,u,a,f,l=T[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=s.preFilter;while(u){if(!n||(r=W.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(i=[]);n=!1;if(r=X.exec(u))n=r.shift(),i.push({value:n,type:r[0].replace(z," ")}),u=u.slice(n.length);for(o in s.filter)(r=Q[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(n=r.shift(),i.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?st.error(e):T(e,a).slice(0)}function mt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function gt(e,t,n){var r=t.dir,s=n&&r==="parentNode",o=S++;return t.first?function(t,n,i){while(t=t[r])if(t.nodeType===1||s)return e(t,n,i)}:function(t,n,u){var a,f,l,c=E+" "+o;if(u){while(t=t[r])if(t.nodeType===1||s)if(e(t,n,u))return!0}else while(t=t[r])if(t.nodeType===1||s){l=t[b]||(t[b]={});if((f=l[r])&&f[0]===c){if((a=f[1])===!0||a===i)return a===!0}else{f=l[r]=[c],f[1]=e(t,n,u)||i;if(f[1]===!0)return!0}}}}function yt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function bt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function wt(e,t,n,r,i,s){return r&&!r[b]&&(r=wt(r)),i&&!i[b]&&(i=wt(i,s)),ut(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||xt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?bt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=bt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?B.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=bt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):P.apply(o,g)})}function Et(e){var t,n,r,i=e.length,o=s.relative[e[0].type],u=o||s.relative[" "],a=o?1:0,l=gt(function(e){return e===t},u,!0),c=gt(function(e){return B.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;a<i;a++)if(n=s.relative[e[a].type])h=[gt(yt(h),n)];else{n=s.filter[e[a].type].apply(null,e[a].matches);if(n[b]){r=++a;for(;r<i;r++)if(s.relative[e[r].type])break;return wt(a>1&&yt(h),a>1&&mt(e.slice(0,a-1).concat({value:e[a-2].type===" "?"*":""})).replace(z,"$1"),n,a<r&&Et(e.slice(a,r)),r<i&&Et(e=e.slice(r)),r<i&&mt(e))}h.push(n)}return yt(h)}function St(e,t){var n=0,r=t.length>0,o=e.length>0,u=function(u,a,l,c,p){var d,v,m,g=[],y=0,b="0",w=u&&[],S=p!=null,x=f,T=u||o&&s.find.TAG("*",p&&a.parentNode||a),N=E+=x==null?1:Math.random()||.1;S&&(f=a!==h&&a,i=n);for(;(d=T[b])!=null;b++){if(o&&d){v=0;while(m=e[v++])if(m(d,a,l)){c.push(d);break}S&&(E=N,i=++n)}r&&((d=!m&&d)&&y--,u&&w.push(d))}y+=b;if(r&&b!==y){v=0;while(m=t[v++])m(w,g,a,l);if(u){if(y>0)while(b--)!w[b]&&!g[b]&&(g[b]=_.call(c));g=bt(g)}P.apply(c,g),S&&!u&&g.length>0&&y+t.length>1&&st.uniqueSort(c)}return S&&(E=N,f=x),w};return r?ut(u):u}function xt(e,t,n){var r=0,i=t.length;for(;r<i;r++)st(e,t[r],n);return n}function Tt(e,t,n,i){var o,u,f,l,c,h=vt(e);if(!i&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&r.getById&&t.nodeType===9&&d&&s.relative[u[1].type]){t=(s.find.ID(f.matches[0].replace(nt,rt),t)||[])[0];if(!t)return n;e=e.slice(u.shift().value.length)}o=Q.needsContext.test(e)?0:u.length;while(o--){f=u[o];if(s.relative[l=f.type])break;if(c=s.find[l])if(i=c(f.matches[0].replace(nt,rt),V.test(u[0].type)&&t.parentNode||t)){u.splice(o,1),e=i.length&&mt(u);if(!e)return P.apply(n,i),n;break}}}return a(e,h)(i,t,!d,n,V.test(e)),n}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b="sizzle"+ -(new Date),w=e.document,E=0,S=0,x=ot(),T=ot(),N=ot(),C=!1,k=function(e,t){return e===t?(C=!0,0):0},L=typeof t,A=1<<31,O={}.hasOwnProperty,M=[],_=M.pop,D=M.push,P=M.push,H=M.slice,B=M.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",q=I.replace("w","w#"),R="\\["+F+"*("+I+")"+F+"*(?:([*^$|!~]?=)"+F+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+q+")|)|)"+F+"*\\]",U=":("+I+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+R.replace(3,8)+")*)|.*)\\)|)",z=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),W=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),V=new RegExp(F+"*[+~]"),$=new RegExp("="+F+"*([^\\]'\"]*)"+F+"*\\]","g"),J=new RegExp(U),K=new RegExp("^"+q+"$"),Q={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I.replace("w","w*")+")"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},G=/^[^{]+\{\s*\[native \w/,Y=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Z=/^(?:input|select|textarea|button)$/i,et=/^h\d$/i,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+F+"?|("+F+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)};try{P.apply(M=H.call(w.childNodes),w.childNodes),M[w.childNodes.length].nodeType}catch(it){P={apply:M.length?function(e,t){D.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}u=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},r=st.support={},c=st.setDocument=function(e){var t=e?e.ownerDocument||e:w,n=t.defaultView;if(t===h||t.nodeType!==9||!t.documentElement)return h;h=t,p=t.documentElement,d=!u(t),n&&n.attachEvent&&n!==n.top&&n.attachEvent("onbeforeunload",function(){c()}),r.attributes=at(function(e){return e.className="i",!e.getAttribute("className")}),r.getElementsByTagName=at(function(e){return e.appendChild(t.createComment("")),!e.getElementsByTagName("*").length}),r.getElementsByClassName=at(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",e.getElementsByClassName("i").length===2}),r.getById=at(function(e){return p.appendChild(e).id=b,!t.getElementsByName||!t.getElementsByName(b).length}),r.getById?(s.find.ID=function(e,t){if(typeof t.getElementById!==L&&d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},s.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete s.find.ID,s.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),s.find.TAG=r.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==L)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},s.find.CLASS=r.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==L&&d)return t.getElementsByClassName(e)},m=[],v=[];if(r.qsa=G.test(t.querySelectorAll))at(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||v.push("\\["+F+"*(?:value|"+j+")"),e.querySelectorAll(":checked").length||v.push(":checked")}),at(function(e){var n=t.createElement("input");n.setAttribute("type","hidden"),e.appendChild(n).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&v.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")});return(r.matchesSelector=G.test(g=p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&at(function(e){r.disconnectedMatch=g.call(e,"div"),g.call(e,"[s!='']:x"),m.push("!=",U)}),v=v.length&&new RegExp(v.join("|")),m=m.length&&new RegExp(m.join("|")),y=G.test(p.contains)||p.compareDocumentPosition?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=p.compareDocumentPosition?function(e,n){if(e===n)return C=!0,0;var i=n.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(n);if(i)return i&1||!r.sortDetached&&n.compareDocumentPosition(e)===i?e===t||y(w,e)?-1:n===t||y(w,n)?1:l?B.call(l,e)-B.call(l,n):0:i&4?-1:1;return e.compareDocumentPosition?-1:1}:function(e,n){var r,i=0,s=e.parentNode,o=n.parentNode,u=[e],a=[n];if(e===n)return C=!0,0;if(!s||!o)return e===t?-1:n===t?1:s?-1:o?1:l?B.call(l,e)-B.call(l,n):0;if(s===o)return lt(e,n);r=e;while(r=r.parentNode)u.unshift(r);r=n;while(r=r.parentNode)a.unshift(r);while(u[i]===a[i])i++;return i?lt(u[i],a[i]):u[i]===w?-1:a[i]===w?1:0},t},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){(e.ownerDocument||e)!==h&&c(e),t=t.replace($,"='$1']");if(r.matchesSelector&&d&&(!m||!m.test(t))&&(!v||!v.test(t)))try{var n=g.call(e,t);if(n||r.disconnectedMatch||e.document&&e.document.nodeType!==11)return n}catch(i){}return st(t,h,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==h&&c(e),y(e,t)},st.attr=function(e,n){(e.ownerDocument||e)!==h&&c(e);var i=s.attrHandle[n.toLowerCase()],o=i&&O.call(s.attrHandle,n.toLowerCase())?i(e,n,!d):t;return o===t?r.attributes||!d?e.getAttribute(n):(o=e.getAttributeNode(n))&&o.specified?o.value:null:o},st.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,n=[],i=0,s=0;C=!r.detectDuplicates,l=!r.sortStable&&e.slice(0),e.sort(k);if(C){while(t=e[s++])t===e[s]&&(i=n.push(s));while(i--)e.splice(n[i],1)}return e},o=st.getText=function(e){var t,n="",r=0,i=e.nodeType;if(!i)for(;t=e[r];r++)n+=o(t);else if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(i===3||i===4)return e.nodeValue;return n},s=st.selectors={cacheLength:50,createPseudo:ut,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[4]||e[5]||"").replace(nt,rt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var n,r=!e[5]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]&&e[4]!==t?e[2]=e[4]:r&&J.test(r)&&(n=vt(r,!0))&&(n=r.indexOf(")",r.length-n)-r.length)&&(e[0]=e[0].slice(0,n),e[2]=r.slice(0,n)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return e==="*"?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=x[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&x(e,function(e){return t.test(typeof e.className=="string"&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&y){l=m[b]||(m[b]={}),f=l[e]||[],p=f[0]===E&&f[1],h=f[0]===E&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[E,p,h];break}}else if(y&&(f=(t[b]||(t[b]={}))[e])&&f[0]===E)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){y&&((c[b]||(c[b]={}))[e]=[E,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,r=s.pseudos[e]||s.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return r[b]?r(t):r.length>1?(n=[e,e,"",t],s.setFilters.hasOwnProperty(e.toLowerCase())?ut(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=B.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ut(function(e){var t=[],n=[],r=a(e.replace(z,"$1"));return r[b]?ut(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:ut(function(e){return function(t){return st(e,t).length>0}}),contains:ut(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:ut(function(e){return K.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=d?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===p},focus:function(e){return e===h.activeElement&&(!h.hasFocus||h.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||e.nodeType===3||e.nodeType===4)return!1;return!0},parent:function(e){return!s.pseudos.empty(e)},header:function(e){return et.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()===e.type)},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[n<0?n+t:n]}),even:pt(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:pt(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}},s.pseudos.nth=s.pseudos.eq;for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[n]=ct(n);for(n in{submit:!0,reset:!0})s.pseudos[n]=ht(n);dt.prototype=s.filters=s.pseudos,s.setFilters=new dt,a=st.compile=function(e,t){var n,r=[],i=[],s=N[e+" "];if(!s){t||(t=vt(e)),n=t.length;while(n--)s=Et(t[n]),s[b]?r.push(s):i.push(s);s=N(e,St(i,r))}return s},r.sortStable=b.split("").sort(k).join("")===b,r.detectDuplicates=C,c(),r.sortDetached=at(function(e){return e.compareDocumentPosition(h.createElement("div"))&1}),at(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild.getAttribute("href")==="#"})||ft("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,t.toLowerCase()==="type"?1:2)}),(!r.attributes||!at(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),e.firstChild.getAttribute("value")===""}))&&ft("value",function(e,t,n){if(!n&&e.nodeName.toLowerCase()==="input")return e.defaultValue}),at(function(e){return e.getAttribute("disabled")==null})||ft(j,function(e,t,n){var r;if(!n)return(r=e.getAttributeNode(t))&&r.specified?r.value:e[t]===!0?t.toLowerCase():null}),jQuery.find=st,jQuery.expr=st.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=st.uniqueSort,jQuery.text=st.getText,jQuery.isXMLDoc=st.isXML,jQuery.contains=st.contains}(window);var optionsCache={};jQuery.Callbacks=function(e){e=typeof e=="string"?optionsCache[e]||createOptions(e):jQuery.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){t=e.memory&&c,n=!0,o=i||0,i=0,s=u.length,r=!0;for(;u&&o<s;o++)if(u[o].apply(c[0],c[1])===!1&&e.stopOnFalse){t=!1;break}r=!1,u&&(a?a.length&&f(a.shift()):t?u=[]:l.disable())},l={add:function(){if(u){var n=u.length;(function o(t){jQuery.each(t,function(t,n){var r=jQuery.type(n);r==="function"?(!e.unique||!l.has(n))&&u.push(n):n&&n.length&&r!=="string"&&o(n)})})(arguments),r?s=u.length:t&&(i=n,f(t))}return this},remove:function(){return u&&jQuery.each(arguments,function(e,t){var n;while((n=jQuery.inArray(t,u,n))>-1)u.splice(n,1),r&&(n<=s&&s--,n<=o&&o--)}),this},has:function(e){return e?jQuery.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],s=0,this},disable:function(){return u=a=t=undefined,this},disabled:function(){return!u},lock:function(){return a=undefined,t||l.disable(),this},locked:function(){return!a},fireWith:function(e,t){return u&&(!n||a)&&(t=t||[],t=[e,t.slice?t.slice():t],r?a.push(t):f(t)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!n}};return l},jQuery.extend({Deferred:function(e){var t=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return jQuery.Deferred(function(n){jQuery.each(t,function(t,s){var o=s[0],u=jQuery.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&jQuery.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return e!=null?jQuery.extend(e,r):r}},i={};return r.pipe=r.then,jQuery.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=core_slice.call(arguments),r=n.length,i=r!==1||e&&jQuery.isFunction(e.promise)?r:0,s=i===1?e:jQuery.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?core_slice.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&jQuery.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),jQuery.support=function(e){var t=document.createElement("input"),n=document.createDocumentFragment(),r=document.createElement("div"),i=document.createElement("select"),s=i.appendChild(document.createElement("option"));return t.type?(t.type="checkbox",e.checkOn=t.value!=="",e.optSelected=s.selected,e.reliableMarginRight=!0,e.boxSizingReliable=!0,e.pixelPosition=!1,t.checked=!0,e.noCloneChecked=t.cloneNode(!0).checked,i.disabled=!0,e.optDisabled=!s.disabled,t=document.createElement("input"),t.value="t",t.type="radio",e.radioValue=t.value==="t",t.setAttribute("checked","t"),t.setAttribute("name","t"),n.appendChild(t),e.checkClone=n.cloneNode(!0).cloneNode(!0).lastChild.checked,e.focusinBubbles="onfocusin"in window,r.style.backgroundClip="content-box",r.cloneNode(!0).style.backgroundClip="",e.clearCloneStyle=r.style.backgroundClip==="content-box",jQuery(function(){var t,n,i="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",s=document.getElementsByTagName("body")[0];if(!s)return;t=document.createElement("div"),t.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",s.appendChild(t).appendChild(r),r.innerHTML="",r.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",jQuery.swap(s,s.style.zoom!=null?{zoom:1}:{},function(){e.boxSizing=r.offsetWidth===4}),window.getComputedStyle&&(e.pixelPosition=(window.getComputedStyle(r,null)||{}).top!=="1%",e.boxSizingReliable=(window.getComputedStyle(r,null)||{width:"4px"}).width==="4px",n=r.appendChild(document.createElement("div")),n.style.cssText=r.style.cssText=i,n.style.marginRight=n.style.width="0",r.style.width="1px",e.reliableMarginRight=!parseFloat((window.getComputedStyle(n,null)||{}).marginRight)),s.removeChild(t)}),e):e}({});var data_user,data_priv,rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;Data.uid=1,Data.accepts=function(e){return e.nodeType?e.nodeType===1||e.nodeType===9:!0},Data.prototype={key:function(e){if(!Data.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=Data.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(r){t[this.expando]=n,jQuery.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var r,i=this.key(e),s=this.cache[i];if(typeof t=="string")s[t]=n;else if(jQuery.isEmptyObject(s))jQuery.extend(this.cache[i],t);else for(r in t)s[r]=t[r];return s},get:function(e,t){var n=this.cache[this.key(e)];return t===undefined?n:n[t]},access:function(e,t,n){var r;return t===undefined||t&&typeof t=="string"&&n===undefined?(r=this.get(e,t),r!==undefined?r:this.get(e,jQuery.camelCase(t))):(this.set(e,t,n),n!==undefined?n:t)},remove:function(e,t){var n,r,i,s=this.key(e),o=this.cache[s];if(t===undefined)this.cache[s]={};else{jQuery.isArray(t)?r=t.concat(t.map(jQuery.camelCase)):(i=jQuery.camelCase(t),t in o?r=[t,i]:(r=i,r=r in o?[r]:r.match(core_rnotwhite)||[])),n=r.length;while(n--)delete o[r[n]]}},hasData:function(e){return!jQuery.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}},data_user=new Data,data_priv=new Data,jQuery.extend({acceptData:Data.accepts,hasData:function(e){return data_user.hasData(e)||data_priv.hasData(e)},data:function(e,t,n){return data_user.access(e,t,n)},removeData:function(e,t){data_user.remove(e,t)},_data:function(e,t,n){return data_priv.access(e,t,n)},_removeData:function(e,t){data_priv.remove(e,t)}}),jQuery.fn.extend({data:function(e,t){var n,r,i=this[0],s=0,o=null;if(e===undefined){if(this.length){o=data_user.get(i);if(i.nodeType===1&&!data_priv.get(i,"hasDataAttrs")){n=i.attributes;for(;s<n.length;s++)r=n[s].name,r.indexOf("data-")===0&&(r=jQuery.camelCase(r.slice(5)),dataAttr(i,r,o[r]));data_priv.set(i,"hasDataAttrs",!0)}}return o}return typeof e=="object"?this.each(function(){data_user.set(this,e)}):jQuery.access(this,function(t){var n,r=jQuery.camelCase(e);if(i&&t===undefined){n=data_user.get(i,e);if(n!==undefined)return n;n=data_user.get(i,r);if(n!==undefined)return n;n=dataAttr(i,r,undefined);if(n!==undefined)return n;return}this.each(function(){var n=data_user.get(this,r);data_user.set(this,r,t),e.indexOf("-")!==-1&&n!==undefined&&data_user.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){data_user.remove(this,e)})}}),jQuery.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=data_priv.get(e,t),n&&(!r||jQuery.isArray(n)?r=data_priv.access(e,t,jQuery.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=jQuery.queue(e,t),r=n.length,i=n.shift(),s=jQuery._queueHooks(e,t),o=function(){jQuery.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return data_priv.get(e,n)||data_priv.access(e,n,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(e,[t+"queue",n])})})}}),jQuery.fn.extend({queue:function(e,t){var n=2;return typeof e!="string"&&(t=e,e="fx",n--),arguments.length<n?jQuery.queue(this[0],e):t===undefined?this:this.each(function(){var n=jQuery.queue(this,e,t);jQuery._queueHooks(this,e),e==="fx"&&n[0]!=="inprogress"&&jQuery.dequeue(this,e)})},dequeue:function(e){return this.each(function(){jQuery.dequeue(this,e)})},delay:function(e,t){return e=jQuery.fx?jQuery.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=jQuery.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};typeof e!="string"&&(t=e,e=undefined),e=e||"fx";while(o--)n=data_priv.get(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var nodeHook,boolHook,rclass=/[\t\r\n\f]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({attr:function(e,t){return jQuery.access(this,jQuery.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){jQuery.removeAttr(this,e)})},prop:function(e,t){return jQuery.access(this,jQuery.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[jQuery.propFix[e]||e]})},addClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=typeof e=="string"&&e;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).addClass(e.call(this,t,this.className))});if(a){t=(e||"").match(core_rnotwhite)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):" ");if(r){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");n.className=jQuery.trim(r)}}}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=arguments.length===0||typeof e=="string"&&e;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).removeClass(e.call(this,t,this.className))});if(a){t=(e||"").match(core_rnotwhite)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):"");if(r){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?jQuery.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e;return typeof t=="boolean"&&n==="string"?t?this.addClass(e):this.removeClass(e):jQuery.isFunction(e)?this.each(function(n){jQuery(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var t,r=0,i=jQuery(this),s=e.match(core_rnotwhite)||[];while(t=s[r++])i.hasClass(t)?i.removeClass(t):i.addClass(t)}else if(n===core_strundefined||n==="boolean")this.className&&data_priv.set(this,"__className__",this.className),this.className=this.className||e===!1?"":data_priv.get(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(rclass," ").indexOf(t)>=0)return!0;return!1},val:function(e){var t,n,r,i=this[0];if(!arguments.length){if(i)return t=jQuery.valHooks[i.type]||jQuery.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&(n=t.get(i,"value"))!==undefined?n:(n=i.value,typeof n=="string"?n.replace(rreturn,""):n==null?"":n);return}return r=jQuery.isFunction(e),this.each(function(n){var i;if(this.nodeType!==1)return;r?i=e.call(this,n,jQuery(this).val()):i=e,i==null?i="":typeof i=="number"?i+="":jQuery.isArray(i)&&(i=jQuery.map(i,function(e){return e==null?"":e+""})),t=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!t||!("set"in t)||t.set(this,i,"value")===undefined)this.value=i})}}),jQuery.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(jQuery.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!jQuery.nodeName(n.parentNode,"optgroup"))){t=jQuery(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n,r,i=e.options,s=jQuery.makeArray(t),o=i.length;while(o--){r=i[o];if(r.selected=jQuery.inArray(jQuery(r).val(),s)>=0)n=!0}return n||(e.selectedIndex=-1),s}}},attr:function(e,t,n){var r,i,s=e.nodeType;if(!e||s===3||s===8||s===2)return;if(typeof e.getAttribute===core_strundefined)return jQuery.prop(e,t,n);if(s!==1||!jQuery.isXMLDoc(e))t=t.toLowerCase(),r=jQuery.attrHooks[t]||(jQuery.expr.match.bool.test(t)?boolHook:nodeHook);if(n===undefined)return r&&"get"in r&&(i=r.get(e,t))!==null?i:(i=jQuery.find.attr(e,t),i==null?undefined:i);if(n!==null)return r&&"set"in r&&(i=r.set(e,n,t))!==undefined?i:(e.setAttribute(t,n+""),n);jQuery.removeAttr(e,t)},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(core_rnotwhite);if(s&&e.nodeType===1)while(n=s[i++])r=jQuery.propFix[n]||n,jQuery.expr.match.bool.test(n)&&(e[r]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!jQuery.support.radioValue&&t==="radio"&&jQuery.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(!e||o===3||o===8||o===2)return;return s=o!==1||!jQuery.isXMLDoc(e),s&&(t=jQuery.propFix[t]||t,i=jQuery.propHooks[t]),n!==undefined?i&&"set"in i&&(r=i.set(e,n,t))!==undefined?r:e[t]=n:i&&"get"in i&&(r=i.get(e,t))!==null?r:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||rfocusable.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),boolHook={set:function(e,t,n){return t===!1?jQuery.removeAttr(e,n):e.setAttribute(n,n),n}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(e,t){var n=jQuery.expr.attrHandle[t]||jQuery.find.attr;jQuery.expr.attrHandle[t]=function(e,t,r){var i=jQuery.expr.attrHandle[t],s=r?undefined:(jQuery.expr.attrHandle[t]=undefined)!=n(e,t,r)?t.toLowerCase():null;return jQuery.expr.attrHandle[t]=i,s}}),jQuery.support.optSelected||(jQuery.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(e,t){if(jQuery.isArray(t))return e.checked=jQuery.inArray(jQuery(e).val(),t)>=0}},jQuery.support.checkOn||(jQuery.valHooks[this].get=function(e){return e.getAttribute("value")===null?"on":e.value})});var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;jQuery.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.get(e);if(!m)return;n.handler&&(s=n,n=s.handler,i=s.selector),n.guid||(n.guid=jQuery.guid++),(a=m.events)||(a=m.events={}),(o=m.handle)||(o=m.handle=function(e){return typeof jQuery===core_strundefined||!!e&&jQuery.event.triggered===e.type?undefined:jQuery.event.dispatch.apply(o.elem,arguments)},o.elem=e),t=(t||"").match(core_rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p)continue;c=jQuery.event.special[p]||{},p=(i?c.delegateType:c.bindType)||p,c=jQuery.event.special[p]||{},l=jQuery.extend({type:p,origType:v,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&jQuery.expr.match.needsContext.test(i),namespace:d.join(".")},s),(h=a[p])||(h=a[p]=[],h.delegateCount=0,(!c.setup||c.setup.call(e,r,d,o)===!1)&&e.addEventListener&&e.addEventListener(p,o,!1)),c.add&&(c.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,l):h.push(l),jQuery.event.global[p]=!0}e=null},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.hasData(e)&&data_priv.get(e);if(!m||!(a=m.events))return;t=(t||"").match(core_rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p){for(p in a)jQuery.event.remove(e,p+t[f],n,r,!0);continue}c=jQuery.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=a[p]||[],u=u[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=h.length;while(s--)l=h[s],(i||v===l.origType)&&(!n||n.guid===l.guid)&&(!u||u.test(l.namespace))&&(!r||r===l.selector||r==="**"&&l.selector)&&(h.splice(s,1),l.selector&&h.delegateCount--,c.remove&&c.remove.call(e,l));o&&!h.length&&((!c.teardown||c.teardown.call(e,d,m.handle)===!1)&&jQuery.removeEvent(e,p,m.handle),delete a[p])}jQuery.isEmptyObject(a)&&(delete m.handle,data_priv.remove(e,"events"))},trigger:function(e,t,n,r){var i,s,o,u,a,f,l,c=[n||document],h=core_hasOwn.call(e,"type")?e.type:e,p=core_hasOwn.call(e,"namespace")?e.namespace.split("."):[];s=o=n=n||document;if(n.nodeType===3||n.nodeType===8)return;if(rfocusMorph.test(h+jQuery.event.triggered))return;h.indexOf(".")>=0&&(p=h.split("."),h=p.shift(),p.sort()),a=h.indexOf(":")<0&&"on"+h,e=e[jQuery.expando]?e:new jQuery.Event(h,typeof e=="object"&&e),e.isTrigger=r?2:3,e.namespace=p.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=undefined,e.target||(e.target=n),t=t==null?[e]:jQuery.makeArray(t,[e]),l=jQuery.event.special[h]||{};if(!r&&l.trigger&&l.trigger.apply(n,t)===!1)return;if(!r&&!l.noBubble&&!jQuery.isWindow(n)){u=l.delegateType||h,rfocusMorph.test(u+h)||(s=s.parentNode);for(;s;s=s.parentNode)c.push(s),o=s;o===(n.ownerDocument||document)&&c.push(o.defaultView||o.parentWindow||window)}i=0;while((s=c[i++])&&!e.isPropagationStopped())e.type=i>1?u:l.bindType||h,f=(data_priv.get(s,"events")||{})[e.type]&&data_priv.get(s,"handle"),f&&f.apply(s,t),f=a&&s[a],f&&jQuery.acceptData(s)&&f.apply&&f.apply(s,t)===!1&&e.preventDefault();return e.type=h,!r&&!e.isDefaultPrevented()&&(!l._default||l._default.apply(c.pop(),t)===!1)&&jQuery.acceptData(n)&&a&&jQuery.isFunction(n[h])&&!jQuery.isWindow(n)&&(o=n[a],o&&(n[a]=null),jQuery.event.triggered=h,n[h](),jQuery.event.triggered=undefined,o&&(n[a]=o)),e.result},dispatch:function(e){e=jQuery.event.fix(e);var t,n,r,i,s,o=[],u=core_slice.call(arguments),a=(data_priv.get(this,"events")||{})[e.type]||[],f=jQuery.event.special[e.type]||{};u[0]=e,e.delegateTarget=this;if(f.preDispatch&&f.preDispatch.call(this,e)===!1)return;o=jQuery.event.handlers.call(this,e,a),t=0;while((i=o[t++])&&!e.isPropagationStopped()){e.currentTarget=i.elem,n=0;while((s=i.handlers[n++])&&!e.isImmediatePropagationStopped())if(!e.namespace_re||e.namespace_re.test(s.namespace))e.handleObj=s,e.data=s.data,r=((jQuery.event.special[s.origType]||{}).handle||s.handler).apply(i.elem,u),r!==undefined&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation())}return f.postDispatch&&f.postDispatch.call(this,e),e.result},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||e.type!=="click"))for(;a!==this;a=a.parentNode||this)if(a.disabled!==!0||e.type!=="click"){r=[];for(n=0;n<u;n++)s=t[n],i=s.selector+" ",r[i]===undefined&&(r[i]=s.needsContext?jQuery(i,this).index(a)>=0:jQuery.find(i,this,null,[a]).length),r[i]&&r.push(s);r.length&&o.push({elem:a,handlers:r})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;return e.pageX==null&&t.clientX!=null&&(n=e.target.ownerDocument||document,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!e.which&&s!==undefined&&(e.which=s&1?1:s&2?3:s&4?2:0),e}},fix:function(e){if(e[jQuery.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=rmouseEvent.test(i)?this.mouseHooks:rkeyEvent.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new jQuery.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=document),e.target.nodeType===3&&(e.target=e.target.parentNode),o.filter?o.filter(e,s):e},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input"))return this.click(),!1},_default:function(e){return jQuery.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==undefined&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=jQuery.extend(new jQuery.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?jQuery.event.trigger(i,null,t):jQuery.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},jQuery.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},jQuery.Event=function(e,t){if(!(this instanceof jQuery.Event))return new jQuery.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.getPreventDefault&&e.getPreventDefault()?returnTrue:returnFalse):this.type=e,t&&jQuery.extend(this,t),this.timeStamp=e&&e.timeStamp||jQuery.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){jQuery.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!jQuery.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),jQuery.support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){jQuery.event.simulate(t,e.target,jQuery.event.fix(e),!0)};jQuery.event.special[t]={setup:function(){n++===0&&document.addEventListener(e,r,!0)},teardown:function(){--n===0&&document.removeEventListener(e,r,!0)}}}),jQuery.fn.extend({on:function(e,t,n,r,i){var s,o;if(typeof e=="object"){typeof t!="string"&&(n=n||t,t=undefined);for(o in e)this.on(o,t,n,e[o],i);return this}n==null&&r==null?(r=t,n=t=undefined):r==null&&(typeof t=="string"?(r=n,n=undefined):(r=n,n=t,t=undefined));if(r===!1)r=returnFalse;else if(!r)return this;return i===1&&(s=r,r=function(e){return jQuery().off(e),s.apply(this,arguments)},r.guid=s.guid||(s.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,jQuery(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if(typeof e=="object"){for(i in e)this.off(i,t,e[i]);return this}if(t===!1||typeof t=="function")n=t,t=undefined;return n===!1&&(n=returnFalse),this.each(function(){jQuery.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){jQuery.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return jQuery.event.trigger(e,t,n,!0)}});var isSimple=/^.[^:#\[\.,]*$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if(typeof e!="string")return this.pushStack(jQuery(e).filter(function(){for(t=0;t<i;t++)if(jQuery.contains(r[t],this))return!0}));for(t=0;t<i;t++)jQuery.find(e,r[t],n);return n=this.pushStack(i>1?jQuery.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t=jQuery(e,this),n=t.length;return this.filter(function(){var e=0;for(;e<n;e++)if(jQuery.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(winnow(this,e||[],!0))},filter:function(e){return this.pushStack(winnow(this,e||[],!1))},is:function(e){return!!winnow(this,typeof e=="string"&&rneedsContext.test(e)?jQuery(e):e||[],!1).length},closest:function(e,t){var n,r=0,i=this.length,s=[],o=rneedsContext.test(e)||typeof e!="string"?jQuery(e,t||this.context):0;for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:n.nodeType===1&&jQuery.find.matchesSelector(n,e))){n=s.push(n);break}return this.pushStack(s.length>1?jQuery.unique(s):s)},index:function(e){return e?typeof e=="string"?core_indexOf.call(jQuery(e),this[0]):core_indexOf.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?jQuery(e,t):jQuery.makeArray(e&&e.nodeType?[e]:e),r=jQuery.merge(this.get(),n);return this.pushStack(jQuery.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),jQuery.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return jQuery.dir(e,"parentNode")},parentsUntil:function(e,t,n){return jQuery.dir(e,"parentNode",n)},next:function(e){return sibling(e,"nextSibling")},prev:function(e){return sibling(e,"previousSibling")},nextAll:function(e){return jQuery.dir(e,"nextSibling")},prevAll:function(e){return jQuery.dir(e,"previousSibling")},nextUntil:function(e,t,n){return jQuery.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return jQuery.dir(e,"previousSibling",n)},siblings:function(e){return jQuery.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return jQuery.sibling(e.firstChild)},contents:function(e){return e.contentDocument||jQuery.merge([],e.childNodes)}},function(e,t){jQuery.fn[e]=function(n,r){var i=jQuery.map(this,t,n);return e.slice(-5)!=="Until"&&(r=n),r&&typeof r=="string"&&(i=jQuery.filter(r,i)),this.length>1&&(guaranteedUnique[e]||jQuery.unique(i),rparentsprev.test(e)&&i.reverse()),this.pushStack(i)}}),jQuery.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),t.length===1&&r.nodeType===1?jQuery.find.matchesSelector(r,e)?[r]:[]:jQuery.find.matches(e,jQuery.grep(t,function(e){return e.nodeType===1}))},dir:function(e,t,n){var r=[],i=n!==undefined;while((e=e[t])&&e.nodeType!==9)if(e.nodeType===1){if(i&&jQuery(e).is(n))break;r.push(e)}return r},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.fn.extend({text:function(e){return jQuery.access(this,function(e){return e===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?jQuery.filter(e,this):this,i=0;for(;(n=r[i])!=null;i++)!t&&n.nodeType===1&&jQuery.cleanData(getAll(n)),n.parentNode&&(t&&jQuery.contains(n.ownerDocument,n)&&setGlobalEval(getAll(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++)e.nodeType===1&&(jQuery.cleanData(getAll(e,!1)),e.textContent="");return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return jQuery.clone(this,e,t)})},html:function(e){return jQuery.access(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===undefined&&t.nodeType===1)return t.innerHTML;if(typeof e=="string"&&!rnoInnerhtml.test(e)&&!wrapMap[(rtagName.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(rxhtmlTag,"<$1></$2>");try{for(;n<r;n++)t=this[n]||{},t.nodeType===1&&(jQuery.cleanData(getAll(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=jQuery.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],s=e[t++];s&&(r&&r.parentNode!==s&&(r=this.nextSibling),jQuery(this).remove(),s.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=core_concat.apply([],e);var r,i,s,o,u,a,f=0,l=this.length,c=this,h=l-1,p=e[0],d=jQuery.isFunction(p);if(d||!(l<=1||typeof p!="string"||jQuery.support.checkClone||!rchecked.test(p)))return this.each(function(r){var i=c.eq(r);d&&(e[0]=p.call(this,r,i.html())),i.domManip(e,t,n)});if(l){r=jQuery.buildFragment(e,this[0].ownerDocument,!1,!n&&this),i=r.firstChild,r.childNodes.length===1&&(r=i);if(i){s=jQuery.map(getAll(r,"script"),disableScript),o=s.length;for(;f<l;f++)u=r,f!==h&&(u=jQuery.clone(u,!0,!0),o&&jQuery.merge(s,getAll(u,"script"))),t.call(this[f],u,f);if(o){a=s[s.length-1].ownerDocument,jQuery.map(s,restoreScript);for(f=0;f<o;f++)u=s[f],rscriptType.test(u.type||"")&&!data_priv.access(u,"globalEval")&&jQuery.contains(a,u)&&(u.src?jQuery._evalUrl(u.src):jQuery.globalEval(u.textContent.replace(rcleanScript,"")))}}}return this}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){jQuery.fn[e]=function(e){var n,r=[],i=jQuery(e),s=i.length-1,o=0;for(;o<=s;o++)n=o===s?this:this.clone(!0),jQuery(i[o])[t](n),core_push.apply(r,n.get());return this.pushStack(r)}}),jQuery.extend({clone:function(e,t,n){var r,i,s,o,u=e.cloneNode(!0),a=jQuery.contains(e.ownerDocument,e);if(!jQuery.support.noCloneChecked&&(e.nodeType===1||e.nodeType===11)&&!jQuery.isXMLDoc(e)){o=getAll(u),s=getAll(e);for(r=0,i=s.length;r<i;r++)fixInput(s[r],o[r])}if(t)if(n){s=s||getAll(e),o=o||getAll(u);for(r=0,i=s.length;r<i;r++)cloneCopyEvent(s[r],o[r])}else cloneCopyEvent(e,u);return o=getAll(u,"script"),o.length>0&&setGlobalEval(o,!a&&getAll(e,"script")),u},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l=0,c=e.length,h=t.createDocumentFragment(),p=[];for(;l<c;l++){i=e[l];if(i||i===0)if(jQuery.type(i)==="object")jQuery.merge(p,i.nodeType?[i]:i);else if(!rhtml.test(i))p.push(t.createTextNode(i));else{s=s||h.appendChild(t.createElement("div")),o=(rtagName.exec(i)||["",""])[1].toLowerCase(),u=wrapMap[o]||wrapMap._default,s.innerHTML=u[1]+i.replace(rxhtmlTag,"<$1></$2>")+u[2],f=u[0];while(f--)s=s.lastChild;jQuery.merge(p,s.childNodes),s=h.firstChild,s.textContent=""}}h.textContent="",l=0;while(i=p[l++]){if(r&&jQuery.inArray(i,r)!==-1)continue;a=jQuery.contains(i.ownerDocument,i),s=getAll(h.appendChild(i),"script"),a&&setGlobalEval(s);if(n){f=0;while(i=s[f++])rscriptType.test(i.type||"")&&n.push(i)}}return h},cleanData:function(e){var t,n,r,i,s,o,u=jQuery.event.special,a=0;for(;(n=e[a])!==undefined;a++){if(Data.accepts(n)){s=n[data_priv.expando];if(s&&(t=data_priv.cache[s])){r=Object.keys(t.events||{});if(r.length)for(o=0;(i=r[o])!==undefined;o++)u[i]?jQuery.event.remove(n,i):jQuery.removeEvent(n,i,t.handle);data_priv.cache[s]&&delete data_priv.cache[s]}}delete data_user.cache[n[data_user.expando]]}},_evalUrl:function(e){return jQuery.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),jQuery.fn.extend({wrapAll:function(e){var t;return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapAll(e.call(this,t))}):(this[0]&&(t=jQuery(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapInner(e.call(this,t))}):this.each(function(){var t=jQuery(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=jQuery.isFunction(e);return this.each(function(n){jQuery(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}});var curCSS,iframe,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];jQuery.fn.extend({css:function(e,t){return jQuery.access(this,function(e,t,n){var r,i,s={},o=0;if(jQuery.isArray(t)){r=getStyles(e),i=t.length;for(;o<i;o++)s[t[o]]=jQuery.css(e,t[o],!1,r);return s}return n!==undefined?jQuery.style(e,t,n):jQuery.css(e,t)},e,t,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(e){return typeof e=="boolean"?e?this.show():this.hide():this.each(function(){isHidden(this)?jQuery(this).show():jQuery(this).hide()})}}),jQuery.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=curCSS(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,n,r){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var i,s,o,u=jQuery.camelCase(t),a=e.style;t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(a,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u];if(n===undefined)return o&&"get"in o&&(i=o.get(e,!1,r))!==undefined?i:a[t];s=typeof n,s==="string"&&(i=rrelNum.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(jQuery.css(e,t)),s="number");if(n==null||s==="number"&&isNaN(n))return;s==="number"&&!jQuery.cssNumber[u]&&(n+="px"),!jQuery.support.clearCloneStyle&&n===""&&t.indexOf("background")===0&&(a[t]="inherit");if(!o||!("set"in o)||(n=o.set(e,n,r))!==undefined)a[t]=n},css:function(e,t,n,r){var i,s,o,u=jQuery.camelCase(t);return t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(e.style,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u],o&&"get"in o&&(i=o.get(e,!0,n)),i===undefined&&(i=curCSS(e,t,r)),i==="normal"&&t in cssNormalTransform&&(i=cssNormalTransform[t]),n===""||n?(s=parseFloat(i),n===!0||jQuery.isNumeric(s)?s||0:i):i}}),curCSS=function(e,t,n){var r,i,s,o=n||getStyles(e),u=o?o.getPropertyValue(t)||o[t]:undefined,a=e.style;return o&&(u===""&&!jQuery.contains(e.ownerDocument,e)&&(u=jQuery.style(e,t)),rnumnonpx.test(u)&&rmargin.test(t)&&(r=a.width,i=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=u,u=o.width,a.width=r,a.minWidth=i,a.maxWidth=s)),u},jQuery.each(["height","width"],function(e,t){jQuery.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&rdisplayswap.test(jQuery.css(e,"display"))?jQuery.swap(e,cssShow,function(){return getWidthOrHeight(e,t,r)}):getWidthOrHeight(e,t,r)},set:function(e,n,r){var i=r&&getStyles(e);return setPositiveNumber(e,n,r?augmentWidthOrHeight(e,t,r,jQuery.support.boxSizing&&jQuery.css(e,"boxSizing",!1,i)==="border-box",i):0)}}}),jQuery(function(){jQuery.support.reliableMarginRight||(jQuery.cssHooks.marginRight={get:function(e,t){if(t)return jQuery.swap(e,{display:"inline-block"},curCSS,[e,"marginRight"])}}),!jQuery.support.pixelPosition&&jQuery.fn.position&&jQuery.each(["top","left"],function(e,t){jQuery.cssHooks[t]={get:function(e,n){if(n)return n=curCSS(e,t),rnumnonpx.test(n)?jQuery(e).position()[t]+"px":n}}})}),jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},jQuery.expr.filters.visible=function(e){return!jQuery.expr.filters.hidden(e)}),jQuery.each({margin:"",padding:"",border:"Width"},function(e,t){jQuery.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n=="string"?n.split(" "):[n];for(;r<4;r++)i[e+cssExpand[r]+t]=s[r]||s[r-2]||s[0];return i}},rmargin.test(e)||(jQuery.cssHooks[e+t].set=setPositiveNumber)});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(e)&&(this.checked||!manipulation_rcheckableType.test(e))}).map(function(e,t){var n=jQuery(this).val();return n==null?null:jQuery.isArray(n)?jQuery.map(n,function(e){return{name:t.name,value:e.replace(rCRLF,"\r\n")}}):{name:t.name,value:n.replace(rCRLF,"\r\n")}}).get()}}),jQuery.param=function(e,t){var n,r=[],i=function(e,t){t=jQuery.isFunction(t)?t():t==null?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};t===undefined&&(t=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional);if(jQuery.isArray(e)||e.jquery&&!jQuery.isPlainObject(e))jQuery.each(e,function(){i(this.name,this.value)});else for(n in e)buildParams(n,e[n],t,i);return r.join("&").replace(r20,"+")},jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){jQuery.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),jQuery.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],jQuery.fn.load=function(e,t,n){if(typeof e!="string"&&_load)return _load.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=e.slice(u),e=e.slice(0,u)),jQuery.isFunction(t)?(n=t,t=undefined):t&&typeof t=="object"&&(i="POST"),o.length>0&&jQuery.ajax({url:e,type:i,dataType:"html",data:t}).done(function(e){s=arguments,o.html(r?jQuery("<div>").append(jQuery.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,s||[e.responseText,t,e])}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){jQuery.fn[t]=function(e){return this.on(t,e)}}),jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?ajaxExtend(ajaxExtend(e,jQuery.ajaxSettings),t):ajaxExtend(jQuery.ajaxSettings,e)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(e,t){function S(e,t,s,u){var f,m,g,b,E,S=t;if(y===2)return;y=2,o&&clearTimeout(o),n=undefined,i=u||"",w.readyState=e>0?4:0,f=e>=200&&e<300||e===304,s&&(b=ajaxHandleResponses(l,w,s)),b=ajaxConvert(l,b,w,f);if(f)l.ifModified&&(E=w.getResponseHeader("Last-Modified"),E&&(jQuery.lastModified[r]=E),E=w.getResponseHeader("etag"),E&&(jQuery.etag[r]=E)),e===204||l.type==="HEAD"?S="nocontent":e===304?S="notmodified":(S=b.state,m=b.data,g=b.error,f=!g);else{g=S;if(e||!S)S="error",e<0&&(e=0)}w.status=e,w.statusText=(t||S)+"",f?p.resolveWith(c,[m,S,w]):p.rejectWith(c,[w,S,g]),w.statusCode(v),v=undefined,a&&h.trigger(f?"ajaxSuccess":"ajaxError",[w,l,f?m:g]),d.fireWith(c,[w,S]),a&&(h.trigger("ajaxComplete",[w,l]),--jQuery.active||jQuery.event.trigger("ajaxStop"))}typeof e=="object"&&(t=e,e=undefined),t=t||{};var n,r,i,s,o,u,a,f,l=jQuery.ajaxSetup({},t),c=l.context||l,h=l.context&&(c.nodeType||c.jquery)?jQuery(c):jQuery.event,p=jQuery.Deferred(),d=jQuery.Callbacks("once memory"),v=l.statusCode||{},m={},g={},y=0,b="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(y===2){if(!s){s={};while(t=rheaders.exec(i))s[t[1].toLowerCase()]=t[2]}t=s[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return y===2?i:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return y||(e=g[n]=g[n]||e,m[e]=t),this},overrideMimeType:function(e){return y||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(y<2)for(t in e)v[t]=[v[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||b;return n&&n.abort(t),S(0,t),this}};p.promise(w).complete=d.add,w.success=w.done,w.error=w.fail,l.url=((e||l.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=jQuery.trim(l.dataType||"*").toLowerCase().match(core_rnotwhite)||[""],l.crossDomain==null&&(u=rurl.exec(l.url.toLowerCase()),l.crossDomain=!(!u||u[1]===ajaxLocParts[1]&&u[2]===ajaxLocParts[2]&&(u[3]||(u[1]==="http:"?"80":"443"))===(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443")))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=jQuery.param(l.data,l.traditional)),inspectPrefiltersOrTransports(prefilters,l,t,w);if(y===2)return w;a=l.global,a&&jQuery.active++===0&&jQuery.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!rnoContent.test(l.type),r=l.url,l.hasContent||(l.data&&(r=l.url+=(ajax_rquery.test(r)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=rts.test(r)?r.replace(rts,"$1_="+ajax_nonce++):r+(ajax_rquery.test(r)?"&":"?")+"_="+ajax_nonce++)),l.ifModified&&(jQuery.lastModified[r]&&w.setRequestHeader("If-Modified-Since",jQuery.lastModified[r]),jQuery.etag[r]&&w.setRequestHeader("If-None-Match",jQuery.etag[r])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&w.setRequestHeader("Content-Type",l.contentType),w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):l.accepts["*"]);for(f in l.headers)w.setRequestHeader(f,l.headers[f]);if(!l.beforeSend||l.beforeSend.call(c,w,l)!==!1&&y!==2){b="abort";for(f in{success:1,error:1,complete:1})w[f](l[f]);n=inspectPrefiltersOrTransports(transports,l,t,w);if(!n)S(-1,"No Transport");else{w.readyState=1,a&&h.trigger("ajaxSend",[w,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){w.abort("timeout")},l.timeout));try{y=1,n.send(m,S)}catch(E){if(!(y<2))throw E;S(-1,E)}}return w}return w.abort()},getJSON:function(e,t,n){return jQuery.get(e,t,n,"json")},getScript:function(e,t){return jQuery.get(e,undefined,t,"script")}}),jQuery.each(["get","post"],function(e,t){jQuery[t]=function(e,n,r,i){return jQuery.isFunction(n)&&(i=i||r,r=n,n=undefined),jQuery.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return jQuery.globalEval(e),e}}}),jQuery.ajaxPrefilter("script",function(e){e.cache===undefined&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),jQuery.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=jQuery("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i(e.type==="error"?404:200,e.type)}),document.head.appendChild(t[0])},abort:function(){n&&n()}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=oldCallbacks.pop()||jQuery.expando+"_"+ajax_nonce++;return this[e]=!0,e}}),jQuery.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,s,o=e.jsonp!==!1&&(rjsonp.test(e.url)?"url":typeof e.data=="string"&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(e.data)&&"data");if(o||e.dataTypes[0]==="jsonp")return r=e.jsonpCallback=jQuery.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,o?e[o]=e[o].replace(rjsonp,"$1"+r):e.jsonp!==!1&&(e.url+=(ajax_rquery.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return s||jQuery.error(r+" was not called"),s[0]},e.dataTypes[0]="json",i=window[r],window[r]=function(){s=arguments},n.always(function(){window[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,oldCallbacks.push(r)),s&&jQuery.isFunction(i)&&i(s[0]),s=i=undefined}),"script"}),jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrSupported=jQuery.ajaxSettings.xhr(),xhrSuccessStatus={0:200,1223:204},xhrId=0,xhrCallbacks={};window.ActiveXObject&&jQuery(window).on("unload",function(){for(var e in xhrCallbacks)xhrCallbacks[e]();xhrCallbacks=undefined}),jQuery.support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,jQuery.support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(e){var t;if(jQuery.support.cors||xhrSupported&&!e.crossDomain)return{send:function(n,r){var i,s,o=e.xhr();o.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields)for(i in e.xhrFields)o[i]=e.xhrFields[i];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),!e.crossDomain&&!n["X-Requested-With"]&&(n["X-Requested-With"]="XMLHttpRequest");for(i in n)o.setRequestHeader(i,n[i]);t=function(e){return function(){t&&(delete xhrCallbacks[s],t=o.onload=o.onerror=null,e==="abort"?o.abort():e==="error"?r(o.status||404,o.statusText):r(xhrSuccessStatus[o.status]||o.status,o.statusText,typeof o.responseText=="string"?{text:o.responseText}:undefined,o.getAllResponseHeaders()))}},o.onload=t(),o.onerror=t("error"),t=xhrCallbacks[s=xhrId++]=t("abort"),o.send(e.hasContent&&e.data||null)},abort:function(){t&&t()}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=rfxnum.exec(t),s=i&&i[3]||(jQuery.cssNumber[e]?"":"px"),o=(jQuery.cssNumber[e]||s!=="px"&&+r)&&rfxnum.exec(jQuery.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,jQuery.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&u!==1&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};jQuery.Animation=jQuery.extend(Animation,{tweener:function(e,t){jQuery.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],tweeners[n]=tweeners[n]||[],tweeners[n].unshift(t)},prefilter:function(e,t){t?animationPrefilters.unshift(e):animationPrefilters.push(e)}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(jQuery.cssNumber[n]?"":"px")},cur:function(){var e=Tween.propHooks[this.prop];return e&&e.get?e.get(this):Tween.propHooks._default.get(this)},run:function(e){var t,n=Tween.propHooks[this.prop];return this.options.duration?this.pos=t=jQuery.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=jQuery.css(e.elem,e.prop,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){jQuery.fx.step[e.prop]?jQuery.fx.step[e.prop](e):e.elem.style&&(e.elem.style[jQuery.cssProps[e.prop]]!=null||jQuery.cssHooks[e.prop])?jQuery.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},jQuery.each(["toggle","show","hide"],function(e,t){var n=jQuery.fn[t];jQuery.fn[t]=function(e,r,i){return e==null||typeof e=="boolean"?n.apply(this,arguments):this.animate(genFx(t,!0),e,r,i)}}),jQuery.fn.extend({fadeTo:function(e,t,n,r){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=jQuery.isEmptyObject(e),s=jQuery.speed(t,n,r),o=function(){var t=Animation(this,jQuery.extend({},e),s);(i||data_priv.get(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return typeof e!="string"&&(n=t,t=e,e=undefined),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=e!=null&&e+"queueHooks",s=jQuery.timers,o=data_priv.get(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&rrun.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem===this&&(e==null||s[i].queue===e)&&(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&jQuery.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=data_priv.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=jQuery.timers,o=r?r.length:0;n.finish=!0,jQuery.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0);for(t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){jQuery.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),jQuery.speed=function(e,t,n){var r=e&&typeof e=="object"?jQuery.extend({},e):{complete:n||!n&&t||jQuery.isFunction(e)&&e,duration:e,easing:n&&t||t&&!jQuery.isFunction(t)&&t};r.duration=jQuery.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in jQuery.fx.speeds?jQuery.fx.speeds[r.duration]:jQuery.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){jQuery.isFunction(r.old)&&r.old.call(this),r.queue&&jQuery.dequeue(this,r.queue)},r},jQuery.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},jQuery.timers=[],jQuery.fx=Tween.prototype.init,jQuery.fx.tick=function(){var e,t=jQuery.timers,n=0;fxNow=jQuery.now();for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||jQuery.fx.stop(),fxNow=undefined},jQuery.fx.timer=function(e){e()&&jQuery.timers.push(e)&&jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fx.step={},jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.animated=function(e){return jQuery.grep(jQuery.timers,function(t){return e===t.elem}).length}),jQuery.fn.offset=function(e){if(arguments.length)return e===undefined?this:this.each(function(t){jQuery.offset.setOffset(this,e,t)});var t,n,r=this[0],i={top:0,left:0},s=r&&r.ownerDocument;if(!s)return;return t=s.documentElement,jQuery.contains(t,r)?(typeof r.getBoundingClientRect!==core_strundefined&&(i=r.getBoundingClientRect()),n=getWindow(s),{top:i.top+n.pageYOffset-t.clientTop,left:i.left+n.pageXOffset-t.clientLeft}):i},jQuery.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=jQuery.css(e,"position"),c=jQuery(e),h={};l==="static"&&(e.style.position="relative"),u=c.offset(),s=jQuery.css(e,"top"),a=jQuery.css(e,"left"),f=(l==="absolute"||l==="fixed")&&(s+a).indexOf("auto")>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),jQuery.isFunction(t)&&(t=t.call(e,n,u)),t.top!=null&&(h.top=t.top-u.top+o),t.left!=null&&(h.left=t.left-u.left+i),"using"in t?t.using.call(e,h):c.css(h)}},jQuery.fn.extend({position:function(){if(!this[0])return;var e,t,n=this[0],r={top:0,left:0};return jQuery.css(n,"position")==="fixed"?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),jQuery.nodeName(e[0],"html")||(r=e.offset()),r.top+=jQuery.css(e[0],"borderTopWidth",!0),r.left+=jQuery.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-jQuery.css(n,"marginTop",!0),left:t.left-r.left-jQuery.css(n,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||docElem;while(e&&!jQuery.nodeName(e,"html")&&jQuery.css(e,"position")==="static")e=e.offsetParent;return e||docElem})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;jQuery.fn[e]=function(r){return jQuery.access(this,function(e,r,i){var s=getWindow(e);if(i===undefined)return s?s[t]:e[r];s?s.scrollTo(n?window.pageXOffset:i,n?i:window.pageYOffset):e[r]=i},e,r,arguments.length,null)}}),jQuery.each({Height:"height",Width:"width"},function(e,t){jQuery.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){jQuery.fn[r]=function(r,i){var s=arguments.length&&(n||typeof r!="boolean"),o=n||(r===!0||i===!0?"margin":"border");return jQuery.access(this,function(t,n,r){var i;return jQuery.isWindow(t)?t.document.documentElement["client"+e]:t.nodeType===9?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):r===undefined?jQuery.css(t,n,o):jQuery.style(t,n,r,o)},t,s?r:undefined,s,null)}})}),jQuery.fn.size=function(){return this.length},jQuery.fn.andSelf=jQuery.fn.addBack,typeof module=="object"&&module&&typeof module.exports=="object"?module.exports=jQuery:typeof define=="function"&&define.amd&&define("jquery",[],function(){return jQuery}),typeof window=="object"&&typeof window.document=="object"&&(window.jQuery=window.$=jQuery)})(window),window.Modernizr=function(e,t,n){function x(e){f.cssText=e}function T(e,t){return x(prefixes.join(e+";")+(t||""))}function N(e,t){return typeof e===t}function C(e,t){return!!~(""+e).indexOf(t)}function k(e,t,r){for(var i in e){var s=t[e[i]];if(s!==n)return r===!1?e[i]:N(s,"function")?s.bind(r||t):s}return!1}var r="2.6.2",i={},s=!0,o=t.documentElement,u="modernizr",a=t.createElement(u),f=a.style,l,c={}.toString,h="Webkit Moz O ms",p=h.split(" "),d=h.toLowerCase().split(" "),v={},m={},g={},y=[],b=y.slice,w,E={}.hasOwnProperty,S;!N(E,"undefined")&&!N(E.call,"undefined")?S=function(e,t){return E.call(e,t)}:S=function(e,t){return t in e&&N(e.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if(typeof n!="function")throw new TypeError;var r=b.call(arguments,1),i=function(){if(this instanceof i){var e=function(){};e.prototype=n.prototype;var s=new e,o=n.apply(s,r.concat(b.call(arguments)));return Object(o)===o?o:s}return n.apply(t,r.concat(b.call(arguments)))};return i}),v.canvas=function(){var e=t.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},v.websockets=function(){return"WebSocket"in e||"MozWebSocket"in e};for(var L in v)S(v,L)&&(w=L.toLowerCase(),i[w]=v[L](),y.push((i[w]?"":"no-")+w));return i.addTest=function(e,t){if(typeof e=="object")for(var r in e)S(e,r)&&i.addTest(r,e[r]);else{e=e.toLowerCase();if(i[e]!==n)return i;t=typeof t=="function"?t():t,typeof s!="undefined"&&s&&(o.className+=" "+(t?"":"no-")+e),i[e]=t}return i},x(""),a=l=null,function(e,t){function l(e,t){var n=e.createElement("p"),r=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",r.insertBefore(n.lastChild,r.firstChild)}function c(){var e=g.elements;return typeof e=="string"?e.split(" "):e}function h(e){var t=a[e[o]];return t||(t={},u++,e[o]=u,a[u]=t),t}function p(e,n,s){n||(n=t);if(f)return n.createElement(e);s||(s=h(n));var o;return s.cache[e]?o=s.cache[e].cloneNode():i.test(e)?o=(s.cache[e]=s.createElem(e)).cloneNode():o=s.createElem(e),o.canHaveChildren&&!r.test(e)?s.frag.appendChild(o):o}function d(e,n){e||(e=t);if(f)return e.createDocumentFragment();n=n||h(e);var r=n.frag.cloneNode(),i=0,s=c(),o=s.length;for(;i<o;i++)r.createElement(s[i]);return r}function v(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return g.shivMethods?p(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+c().join().replace(/\w+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(g,t.frag)}function m(e){e||(e=t);var n=h(e);return g.shivCSS&&!s&&!n.hasCSS&&(n.hasCSS=!!l(e,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),f||v(e,n),e}var n=e.html5||{},r=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,i=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,s,o="_html5shiv",u=0,a={},f;(function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",s="hidden"in e,f=e.childNodes.length==1||function(){t.createElement("a");var e=t.createDocumentFragment();return typeof e.cloneNode=="undefined"||typeof e.createDocumentFragment=="undefined"||typeof e.createElement=="undefined"}()}catch(n){s=!0,f=!0}})();var g={elements:n.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:n.shivCSS!==!1,supportsUnknownElements:f,shivMethods:n.shivMethods!==!1,type:"default",shivDocument:m,createElement:p,createDocumentFragment:d};e.html5=g,m(t)}(this,t),i._version=r,i._domPrefixes=d,i._cssomPrefixes=p,o.className=o.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(s?" js "+y.join(" "):""),i}(this,this.document),function(e,t,n){function r(e){return"[object Function]"==d.call(e)}function i(e){return"string"==typeof e}function s(){}function o(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function u(){var e=v.shift();m=1,e?e.t?h(function(){("c"==e.t?k.injectCss:k.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),u()):m=0}function a(e,n,r,i,s,a,f){function l(t){if(!d&&o(c.readyState)&&(w.r=d=1,!m&&u(),c.onload=c.onreadystatechange=null,t)){"img"!=e&&h(function(){b.removeChild(c)},50);for(var r in T[n])T[n].hasOwnProperty(r)&&T[n][r].onload()}}var f=f||k.errorTimeout,c=t.createElement(e),d=0,g=0,w={t:r,s:n,e:s,a:a,x:f};1===T[n]&&(g=1,T[n]=[]),"object"==e?c.data=n:(c.src=n,c.type=e),c.width=c.height="0",c.onerror=c.onload=c.onreadystatechange=function(){l.call(this,g)},v.splice(i,0,w),"img"!=e&&(g||2===T[n]?(b.insertBefore(c,y?null:p),h(l,f)):T[n].push(c))}function f(e,t,n,r,s){return m=0,t=t||"j",i(e)?a("c"==t?E:w,e,t,this.i++,n,r,s):(v.splice(this.i++,0,e),1==v.length&&u()),this}function l(){var e=k;return e.loader={load:f,i:0},e}var c=t.documentElement,h=e.setTimeout,p=t.getElementsByTagName("script")[0],d={}.toString,v=[],m=0,g="MozAppearance"in c.style,y=g&&!!t.createRange().compareNode,b=y?c:p.parentNode,c=e.opera&&"[object Opera]"==d.call(e.opera),c=!!t.attachEvent&&!c,w=g?"object":c?"script":"img",E=c?"script":w,S=Array.isArray||function(e){return"[object Array]"==d.call(e)},x=[],T={},N={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}},C,k;k=function(e){function t(e){var e=e.split("!"),t=x.length,n=e.pop(),r=e.length,n={url:n,origUrl:n,prefixes:e},i,s,o;for(s=0;s<r;s++)o=e[s].split("="),(i=N[o.shift()])&&(n=i(n,o));for(s=0;s<t;s++)n=x[s](n);return n}function o(e,i,s,o,u){var a=t(e),f=a.autoCallback;a.url.split(".").pop().split("?").shift(),a.bypass||(i&&(i=r(i)?i:i[e]||i[o]||i[e.split("/").pop().split("?")[0]]),a.instead?a.instead(e,i,s,o,u):(T[a.url]?a.noexec=!0:T[a.url]=1,s.load(a.url,a.forceCSS||!a.forceJS&&"css"==a.url.split(".").pop().split("?").shift()?"c":n,a.noexec,a.attrs,a.timeout),(r(i)||r(f))&&s.load(function(){l(),i&&i(a.origUrl,u,o),f&&f(a.origUrl,u,o),T[a.url]=2})))}function u(e,t){function n(e,n){if(e){if(i(e))n||(f=function(){var e=[].slice.call(arguments);l.apply(this,e),c()}),o(e,f,t,0,u);else if(Object(e)===e)for(p in h=function(){var t=0,n;for(n in e)e.hasOwnProperty(n)&&t++;return t}(),e)e.hasOwnProperty(p)&&(!n&&!--h&&(r(f)?f=function(){var e=[].slice.call(arguments);l.apply(this,e),c()}:f[p]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),c()}}(l[p])),o(e[p],f,t,p,u))}else!n&&c()}var u=!!e.test,a=e.load||e.both,f=e.callback||s,l=f,c=e.complete||s,h,p;n(u?e.yep:e.nope,!!a),a&&n(a)}var a,f,c=this.yepnope.loader;if(i(e))o(e,0,c,0);else if(S(e))for(a=0;a<e.length;a++)f=e[a],i(f)?o(f,0,c,0):S(f)?k(f):Object(f)===f&&u(f,c);else Object(e)===e&&u(e,c)},k.addPrefix=function(e,t){N[e]=t},k.addFilter=function(e){x.push(e)},k.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",C=function(){t.removeEventListener("DOMContentLoaded",C,0),t.readyState="complete"},0)),e.yepnope=l(),e.yepnope.executeStack=u,e.yepnope.injectJs=function(e,n,r,i,a,f){var l=t.createElement("script"),c,d,i=i||k.errorTimeout;l.src=e;for(d in r)l.setAttribute(d,r[d]);n=f?u:n||s,l.onreadystatechange=l.onload=function(){!c&&o(l.readyState)&&(c=1,n(),l.onload=l.onreadystatechange=null)},h(function(){c||(c=1,n(1))},i),a?l.onload():p.parentNode.insertBefore(l,p)},e.yepnope.injectCss=function(e,n,r,i,o,a){var i=t.createElement("link"),f,n=a?u:n||s;i.href=e,i.rel="stylesheet",i.type="text/css";for(f in r)i.setAttribute(f,r[f]);o||(p.parentNode.insertBefore(i,p),h(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("cookies",function(){if(navigator.cookieEnabled)return!0;document.cookie="cookietest=1";var e=document.cookie.indexOf("cookietest=")!=-1;return document.cookie="cookietest=1; expires=Thu, 01-Jan-1970 00:00:01 GMT",e}),tagpro={version:"3.1.2",socket:null,players:null,chat:null,playerId:null,teamNames:null,score:null,state:null,sound:null,zoom:1,zooming:0,serverPort:null,serverHost:null,socketPort:null,socketHost:null,viewport:{followPlayer:!0,source:{x:0,y:0}},TILE_SIZE:40,kongregate:!1,settings:{ui:{allChat:!0,teamChat:!0,groupChat:!0,systemChat:!0,spectatorInfo:!0,performanceInfo:!0,names:!0,teamNames:"always",degrees:!0,matchState:!0}},keys:{left:[37,65,97],up:[38,87,119],right:[39,68,100],down:[40,83,115],space:[32],chatToTeam:[222,84],chatToGroup:[186,71,103],chatToAll:[13],sendChat:[13],cancelChat:[27],showOptions:[27],zoomOut:[173,189,109],zoomIn:[61,187,107],resetZoom:[90],centerZoom:[67],specNext:[81],specPrev:[87],specRedFC:[65],specBlueFC:[83],toggleAutoJoin:[32]},ping:{current:0,history:[],avg:0},host:document.location.host,gameEndsAt:null,disableControls:0,spectator:!1,spectators:0,movement:[],joinGame:function(e){location.href=e},api:{redrawBackground:function(){console.error("The redrawBackground function has been deprecated.")}},events:{register:function(e){for(var t in e)tagpro.events[t]||(tagpro.events[t]=[]),eventFunc={},eventFunc[t]=e[t],tagpro.events[t].push(eventFunc)}},resourcesLoaded:!1,_readyCallbacks:[],_afterReadyCallbacks:[],ready:function(e){if(tagpro.resourcesLoaded){e();return}tagpro._readyCallbacks.push(e)}},tagpro.ready.after=function(e){tagpro.resourcesLoaded?e():tagpro._afterReadyCallbacks.push(e)},$(document).ready(function(){function e(e,t){var n=$.cookie(e);$.removeCookie(e);var r=$.cookie(e)==undefined;(n==undefined||r)&&$.cookie(e,n||t,{expires:36500,path:"/",domain:tagpro.cookieHost})}function n(e){var t=0,n,r,i;if(e.length==0)return t;for(n=0,i=e.length;n<i;n++)r=e.charCodeAt(n),t=(t<<5)-t+r,t|=0;return t}function r(){tagpro.resourcesLoaded=!0,tagpro._readyCallbacks.forEach(function(e){e()}),tagpro._readyCallbacks=[],tagpro._afterReadyCallbacks.forEach(function(e){e()}),tagpro._afterReadyCallbacks=[]}e("music","false"),e("sound","true"),e("disableParticles","false"),e("forceCanvasRenderer","false"),e("disableViewportScaling","true");if(window.location.pathname!="/kongregate"){tagpro.kongregate=!!$.cookie("kongregate"),tagpro.kongregate&&window.self==window.top&&($.removeCookie("kongregate"),$.removeCookie("kongregate-username"),$.removeCookie("kongregate-token"),$.removeCookie("kongregate-userId"),document.location.href="/logout");if(tagpro.kongregate){var t=["tagpro.gg","koalabeast.com","localhost","jukejuice.com"];$("a").each(function(){var e=$(this),n=e.attr("href").toLowerCase(),r=!t.some(function(e){return n.indexOf(e)>-1});r&&n.substr(0,4)!="http"&&(r=!1),e.hasClass("ensureExternal")&&(r=!0),r&&e.attr("target","_parent")})}}setTimeout(function(){var e=$("#loadingMessage"),t=$("#assets img"),n=0;t.each(function(){$(this).prop("crossOrigin","Anonymous").attr("src",$(this).attr("src"))}),setTimeout(function(){if(tagpro.resourcesLoaded)return;t.not("[data-load]").each(function(){e.append($("<div></div>").css({"font-weight":"normal","font-size":"50%"}).text($(this).attr("id")+"..."))})},1e4);var i=function(){t.each(function(){var e=$(this)[0];if(e.loaded)return;e.complete&&e.naturalWidth>0&&(e.loaded=!0,n++)}),n<t.length?setTimeout(i,0):r()};i()},0)}),$(document).keydown(function(e){if(e.keyCode!=8)return;var t=e.target.nodeName.toLowerCase();if(t=="input"||t=="textarea")return;e.preventDefault()}),tagpro.helpers={pad:function(e,t){e=e.toString(),t=t.toString();var n=t+e,r=t.length>e.length?t.length:e.length;return n.substr(n.length-r)},timeFromSeconds:function(e,t){t==undefined&&(t=!1);var n=tagpro.helpers.pad;e=parseFloat(e);var r=parseInt(e/3600),i=parseInt(e/60)%60,s=e%60,o=n(i,"00")+":"+n(s,"00");if(!t||r>0)o=n(r,"00")+":"+o;return o}},function(){function r(e,t){e instanceof Uint8Array||(e.buffer instanceof ArrayBuffer?e=new Uint8Array(e.buffer):e=new Uint8Array(e));var r=~~t^-1;for(var i=0;i<e.length;i++)r=n[(r^e[i])&255]^r>>>8;return r^-1}var e={};e.DEBUG=!1,e.cache={},e.clearCache=function(){this.cache={}},e.uid=function(){var n=this.data();return t(n.canvasFingerprint+":"+t(n.fonts.join(":"))+":"+JSON.stringify(n.screen)+":"+JSON.stringify(n.browser)+":"+JSON.stringify(n.webgl)+":"+JSON.stringify(e.pluginNames()))},e.match=function(t){return e.uid()===t},e.data=function(){return{canvasFingerprint:e.canvas(),fonts:e.fonts(),browser:e.browser(),plugins:e.pluginNames(),screen:e.screen(),webgl:e.webgl()}},e.screen=function(){return{width:screen.width,height:screen.height,colorDepth:screen.colorDepth,pixelDepth:screen.pixelDepth}},e.browser=function(){return{userAgent:navigator.userAgent,cookies:navigator.cookieEnabled,java:navigator.javaEnabled(),dnt:navigator.doNotTrack,lang:navigator.language}},e.PLUGINS=["Google Talk Plugin Video Renderer","Google Talk Plugin","Java Applet Plug-in","QuickTime Plug-in 7.7.3","Default Browser Helper","Shockwave Flash","AdobeAAMDetect","AdobeExManDetect","iPhotoPhotocast","SharePoint Browser Plug-in","Google Earth Plug-in","RealPlayer Plugin.plugin","DivX Web Player","Wacom Pressure Plug-In","Microsoft Office Live Plug-in","Widevine Content Decryption Module","Chrome Remote Desktop Viewer","Chrome PDF Viewer","Native Client","Google Talk Plugin Video Renderer","Unity Player","Default Browser Helper","Silverlight Plug-In","Wacom Tablet Plug-In","WebKit-integrierte PDF"],e.plugins=function(){if(!navigator.plugins)return null;var e=[];return this.PLUGINS.forEach(function(t){var n=navigator.plugins[t];n!==undefined&&(e[t]=n)}),e.sort()},e.pluginNames=function(){return navigator.plugins?this.PLUGINS.filter(function(e){return navigator.plugins[e]!==undefined?!0:!1}):null},e.canvas=function(){if(e.cache.canvas!==undefined)return e.cache.canvas;var t=document.createElement("canvas");t.width=280,t.height=60,this.DEBUG||(t.style.display="none"),t.id="beaver-bird-canvas",document.body.appendChild(t);var n=t.getContext("2d"),i="BeaverBird is watching you";n.fillStyle="rgb(178, 214, 232)",n.fillRect(10,20,60,80),n.fillStyle="#111",n.font="16pt Arial",n.fillText(i,2,40),n.strokeStyle="rgb(120, 186, 176)",n.arc(80,10,20,0,Math.PI),n.stroke();var s=n.getImageData(0,0,280,60);this.DEBUG||document.body.removeChild(t);var o=r(s.data).toString();return e.cache.canvas=o,o},e.matchCanvas=function(t){return t===e.canvas()},e.fonts=function(t){if(this.cache.fonts!==undefined)return this.cache.fonts;var n=["Arial","Times New Roman","Helvetica","Open Sans","Source Sans Pro","Comic Sans MS","Century","Century Gothic","Monaco","Lato","Geneva","Futura","Fantasque Sans Mono","Courier","Courier New","Corsiva Hebrew","Comic Neue","Cambria","Calibri","TI-Nspire","Adobe Braille","Adobe Hebrew","Apple LiGothic","Apple Farben-Emoji","Avenir","Avenir Next","Batang","Bell MT","Birch Std","Damascus","Microsoft Sans Serif","Minion Pro","Times","Roboto","Oswald","Droid Sans","Droid Serif","Roboto Condensed","Ubuntu","Raleway","Lobster","Ubuntu Condensed","Helvetica Neue"];typeof t!="undefined"&&(n=t);var r="wwzrllTNMLllllliiimmqÃmmmmiiillâï¸ð»llplÃ¶ðÂ©_~Ã±",i=[{name:"serif"},{name:"sans-serif"},{name:"monospace"}],s=document.createElement("span");s.innerHTML=r,s.style.fontSize="86px",i.forEach(function(e){s.style.fontFamily=e.name,document.body.appendChild(s),e.width=s.offsetWidth,e.height=s.offsetHeight,document.body.removeChild(s)}),this.DEBUG&&console.log(i);var o=[];n.forEach(function(t){var n=!1;i.forEach(function(e){s.style.fontFamily=t+","+e.name,document.body.appendChild(s);if(s.offsetWidth!==e.width||s.offsetHeight!==e.height)n=!0;document.body.removeChild(s)}),n&&(e.DEBUG&&console.log("found font:",t),o.push(t))}),e.DEBUG&&console.log("found",o.length,"fonts");var u=o.sort();return this.cache.fonts=u,u},e.matchFonts=function(e){var t=this.fonts(),n=!1;return e.forEach(function(e){t.indexOf(e)===-1&&(n=!0)}),!n},e.WEBGL_PARAMETERS=["VENDOR","RENDERER","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_FRAGMENT_UNIFORM_VECTORS","MAX_RENDERBUFFER_SIZE","MAX_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_SIZE","MAX_VARYING_VECTORS","MAX_VERTEX_ATTRIBS","MAX_VERTEX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_UNIFORM_VECTORS","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS"],e.webgl=function(){var e={},t=document.createElement("canvas"),n=function(t){if(!window.WebGLRenderingContext)return null;var n=null;try{n=t.getContext("webgl")||t.getContext("moz-webgl")||t.getContext("experimental-webgl")||t.getContext("webkit-3d")}catch(r){}return n}(t);return n===null?null:(e.parameters={},this.WEBGL_PARAMETERS.forEach(function(t){n[t.toUpperCase()]!==undefined&&(e.parameters[t.toLowerCase()]=n.getParameter(n[t.toUpperCase()]))}),e.extensions=n.getSupportedExtensions(),e)},typeof module!="undefined"&&module.exports?module.exports=e:window.BeaverBird=e;var t;(function(){"use strict";var e=function(e,t){return e+t&4294967295},n=function(t,n,r,i,s,o){return n=e(e(n,t),e(i,o)),e(n<<s|n>>>32-s,r)},r=function(e,t,r,i,s,o,u){return n(t&r|~t&i,e,t,s,o,u)},i=function(e,t,r,i,s,o,u){return n(t&i|r&~i,e,t,s,o,u)},s=function(e,t,r,i,s,o,u){return n(t^r^i,e,t,s,o,u)},o=function(e,t,r,i,s,o,u){return n(r^(t|~i),e,t,s,o,u)},u=function(t,n){var u=t[0],a=t[1],f=t[2],l=t[3];u=r(u,a,f,l,n[0],7,-680876936),l=r(l,u,a,f,n[1],12,-389564586),f=r(f,l,u,a,n[2],17,606105819),a=r(a,f,l,u,n[3],22,-1044525330),u=r(u,a,f,l,n[4],7,-176418897),l=r(l,u,a,f,n[5],12,1200080426),f=r(f,l,u,a,n[6],17,-1473231341),a=r(a,f,l,u,n[7],22,-45705983),u=r(u,a,f,l,n[8],7,1770035416),l=r(l,u,a,f,n[9],12,-1958414417),f=r(f,l,u,a,n[10],17,-42063),a=r(a,f,l,u,n[11],22,-1990404162),u=r(u,a,f,l,n[12],7,1804603682),l=r(l,u,a,f,n[13],12,-40341101),f=r(f,l,u,a,n[14],17,-1502002290),a=r(a,f,l,u,n[15],22,1236535329),u=i(u,a,f,l,n[1],5,-165796510),l=i(l,u,a,f,n[6],9,-1069501632),f=i(f,l,u,a,n[11],14,643717713),a=i(a,f,l,u,n[0],20,-373897302),u=i(u,a,f,l,n[5],5,-701558691),l=i(l,u,a,f,n[10],9,38016083),f=i(f,l,u,a,n[15],14,-660478335),a=i(a,f,l,u,n[4],20,-405537848),u=i(u,a,f,l,n[9],5,568446438),l=i(l,u,a,f,n[14],9,-1019803690),f=i(f,l,u,a,n[3],14,-187363961),a=i(a,f,l,u,n[8],20,1163531501),u=i(u,a,f,l,n[13],5,-1444681467),l=i(l,u,a,f,n[2],9,-51403784),f=i(f,l,u,a,n[7],14,1735328473),a=i(a,f,l,u,n[12],20,-1926607734),u=s(u,a,f,l,n[5],4,-378558),l=s(l,u,a,f,n[8],11,-2022574463),f=s(f,l,u,a,n[11],16,1839030562),a=s(a,f,l,u,n[14],23,-35309556),u=s(u,a,f,l,n[1],4,-1530992060),l=s(l,u,a,f,n[4],11,1272893353),f=s(f,l,u,a,n[7],16,-155497632),a=s(a,f,l,u,n[10],23,-1094730640),u=s(u,a,f,l,n[13],4,681279174),l=s(l,u,a,f,n[0],11,-358537222),f=s(f,l,u,a,n[3],16,-722521979),a=s(a,f,l,u,n[6],23,76029189),u=s(u,a,f,l,n[9],4,-640364487),l=s(l,u,a,f,n[12],11,-421815835),f=s(f,l,u,a,n[15],16,530742520),a=s(a,f,l,u,n[2],23,-995338651),u=o(u,a,f,l,n[0],6,-198630844),l=o(l,u,a,f,n[7],10,1126891415),f=o(f,l,u,a,n[14],15,-1416354905),a=o(a,f,l,u,n[5],21,-57434055),u=o(u,a,f,l,n[12],6,1700485571),l=o(l,u,a,f,n[3],10,-1894986606),f=o(f,l,u,a,n[10],15,-1051523),a=o(a,f,l,u,n[1],21,-2054922799),u=o(u,a,f,l,n[8],6,1873313359),l=o(l,u,a,f,n[15],10,-30611744),f=o(f,l,u,a,n[6],15,-1560198380),a=o(a,f,l,u,n[13],21,1309151649),u=o(u,a,f,l,n[4],6,-145523070),l=o(l,u,a,f,n[11],10,-1120210379),f=o(f,l,u,a,n[2],15,718787259),a=o(a,f,l,u,n[9],21,-343485551),t[0]=e(u,t[0]),t[1]=e(a,t[1]),t[2]=e(f,t[2]),t[3]=e(l,t[3])},a=function(e){var t=[],n;for(n=0;n<64;n+=4)t[n>>2]=e.charCodeAt(n)+(e.charCodeAt(n+1)<<8)+(e.charCodeAt(n+2)<<16)+(e.charCodeAt(n+3)<<24);return t},f=function(e){var t=[],n;for(n=0;n<64;n+=4)t[n>>2]=e[n]+(e[n+1]<<8)+(e[n+2]<<16)+(e[n+3]<<24);return t},l=function(e){var t=e.length,n=[1732584193,-271733879,-1732584194,271733878],r,i,s,o,f,l;for(r=64;r<=t;r+=64)u(n,a(e.substring(r-64,r)));e=e.substring(r-64),i=e.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<i;r+=1)s[r>>2]|=e.charCodeAt(r)<<(r%4<<3);s[r>>2]|=128<<(r%4<<3);if(r>55){u(n,s);for(r=0;r<16;r+=1)s[r]=0}return o=t*8,o=o.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(o[2],16),l=parseInt(o[1],16)||0,s[14]=f,s[15]=l,u(n,s),n},c=function(e){var t=e.length,n=[1732584193,-271733879,-1732584194,271733878],r,i,s,o,a,l;for(r=64;r<=t;r+=64)u(n,f(e.subarray(r-64,r)));e=r-64<t?e.subarray(r-64):new Uint8Array(0),i=e.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<i;r+=1)s[r>>2]|=e[r]<<(r%4<<3);s[r>>2]|=128<<(r%4<<3);if(r>55){u(n,s);for(r=0;r<16;r+=1)s[r]=0}return o=t*8,o=o.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(o[2],16),l=parseInt(o[1],16)||0,s[14]=a,s[15]=l,u(n,s),n},h=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],p=function(e){var t="",n;for(n=0;n<4;n+=1)t+=h[e>>n*8+4&15]+h[e>>n*8&15];return t},d=function(e){var t;for(t=0;t<e.length;t+=1)e[t]=p(e[t]);return e.join("")},v=function(e){return d(l(e))};v("hello")!=="5d41402abc4b2a76b9719d911017c592"&&(e=function(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535}),t=function(e,t){/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e)));var n=l(e);return t?n:d(n)}})();var n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]}(),$(document).ready(function(){(window.location.port==tagpro.serverPort||window.location.port=="")&&$.post("/fingerprint",{id:BeaverBird.uid()})}),function(e){typeof define=="function"&&define.amd?define(["jquery"],e):typeof exports=="object"?e(require("jquery")):e(jQuery)}(function(e){function n(e){return u.raw?e:encodeURIComponent(e)}function r(e){return u.raw?e:decodeURIComponent(e)}function i(e){return n(u.json?JSON.stringify(e):String(e))}function s(e){e.indexOf('"')===0&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(t," ")),u.json?JSON.parse(e):e}catch(n){}}function o(t,n){var r=u.raw?t:s(t);return e.isFunction(n)?n(r):r}var t=/\+/g,u=e.cookie=function(t,s,a){if(arguments.length>1&&!e.isFunction(s)){a=e.extend({},u.defaults,a);if(typeof a.expires=="number"){var f=a.expires,l=a.expires=new Date;l.setTime(+l+f*864e5)}return document.cookie=[n(t),"=",i(s),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}var c=t?undefined:{},h=document.cookie?document.cookie.split("; "):[];for(var p=0,d=h.length;p<d;p++){var v=h[p].split("="),m=r(v.shift()),g=v.join("=");if(t&&t===m){c=o(g,s);break}!t&&(g=o(g))!==undefined&&(c[m]=g)}return c};u.defaults={},e.removeCookie=function(t,n){return e.cookie(t)===undefined?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}});var Stats=function(){var e=Date.now(),t=e,n=0,r=Infinity,i=0,s=0,o=Infinity,u=0,a=0,f=0,l=document.createElement("div");l.id="stats",l.addEventListener("mousedown",function(e){e.preventDefault(),y(++f%2)},!1),l.style.cssText="width:80px;opacity:0.9;cursor:pointer";var c=document.createElement("div");c.id="fps",c.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#002",l.appendChild(c);var h=document.createElement("div");h.id="fpsText",h.style.cssText="color:#0ff;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",h.innerHTML="FPS",c.appendChild(h);var p=document.createElement("div");p.id="fpsGraph",p.style.cssText="position:relative;width:74px;height:30px;background-color:#0ff";for(c.appendChild(p);74>p.children.length;){var d=document.createElement("span");d.style.cssText="width:1px;height:30px;float:left;background-color:#113",p.appendChild(d)}var v=document.createElement("div");v.id="ms",v.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:#020;display:none",l.appendChild(v);var m=document.createElement("div");m.id="msText",m.style.cssText="color:#0f0;font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",m.innerHTML="MS",v.appendChild(m);var g=document.createElement("div");g.id="msGraph",g.style.cssText="position:relative;width:74px;height:30px;background-color:#0f0";for(v.appendChild(g);74>g.children.length;)d=document.createElement("span"),d.style.cssText="width:1px;height:30px;float:left;background-color:#131",g.appendChild(d);var y=function(e){f=e;switch(f){case 0:c.style.display="block",v.style.display="none";break;case 1:c.style.display="none",v.style.display="block"}};return{REVISION:12,domElement:l,setMode:y,begin:function(){e=Date.now()},end:function(){var f=Date.now();n=f-e,r=Math.min(r,n),i=Math.max(i,n),m.textContent=n+" MS ("+r+"-"+i+")";var l=Math.min(30,30-30*(n/200));return g.appendChild(g.firstChild).style.height=l+"px",a++,f>t+1e3&&(s=Math.round(1e3*a/(f-t)),o=Math.min(o,s),u=Math.max(u,s),h.textContent=s+" FPS ("+o+"-"+u+")",l=Math.min(30,30-30*(s/100)),p.appendChild(p.firstChild).style.height=l+"px",t=f,a=0),f},update:function(){e=this.end()}}};"object"==typeof module&&(module.exports=Stats),$(document).ready(function(){if($("html").hasClass("no-websockets")){location.href="http://"+tagpro.serverHost+"/browser";return}if($("html").hasClass("no-cookies")){location.href="http://"+tagpro.serverHost+"/cookies";return}});var Sprite=function(e,t,n,r){var i={};this.createAnimation=function(e,t,n){return i[e]=new Sprite.Animation(t,n),i[e]},this.createInstance=function(s){return{start:(new Date).getTime(),animation:s,draw:function(n,r,s){var o=i[this.animation],u=Math.floor(((new Date).getTime()-this.start)%(o.frames.length*o.time)/o.time);n.drawImage(e,o.frames[u]*40,o.y*40,t,t,r,s,t,t)},drawFloor:n||!1,redrawFloor:r||!1}}};Sprite.Animation=function(e,t){this.y=e,this.time=t,this.frames=[],this.createFrame=function(e){this.frames.push(e)}},tagpro.createSocket=function(){var e=io.connect(tagpro.gameSocket||document.location.href+"?r="+Math.round(Math.random()*1e7),{reconnect:!1});return tagpro.rawSocket=e,{on:function(t,n){var r=function(){try{n.apply(this,arguments)}catch(i){console.error("Unhandled socket.io on() error. Mod makers, handle your errors!"),console.error(i),e.removeListener(t,r)}};e.on(t,r)},emit:function(t,n){e.emit(t,n)}}},tagpro.group={socket:null},$(document).ready(function(){function n(){setTimeout(n,3e4);if(!t.io.connected)return;t.emit("touch",t.playerLocation)}var e=$("#groupId").val();if(!e||e=="null")return;var t=io.connect("http://"+tagpro.socketHost+"/groups/"+e+"?r="+Math.round(Math.random()*1e7));t.playerLocation=null,tagpro.group.socket=t,setTimeout(n,3e3)}),tagpro.ready(function(){function h(e,t,n){var r=Math.abs(n);if(e.lastSync[t]==undefined||r>e.lastSync[t])e[t]=n>0,e.lastSync[t]=r}function p(e){function t(e){var t=[0,0,0,0],n=[1,1,1,1],r=[3,0,4,2];if(e=="1")return n;if(Math.floor(e)=="1"){for(offset=Number((e+"").substr(-1))-1;offset>0;offset--)r.unshift(r.pop());return r}return t}function n(e,t){return quadArray=[0,0,0,0],baseMap[e]&&(baseMap[e][t]&&(quadArray[0]=baseMap[e][t][0]),baseMap[e][t-1]&&(quadArray[3]=baseMap[e][t-1][3])),baseMap[e-1]&&(baseMap[e-1][t]&&(quadArray[1]=baseMap[e-1][t][1]),baseMap[e-1][t-1]&&(quadArray[2]=baseMap[e-1][t-1][2])),quadArray}function r(e,t,n){subMap[e]&&(subMap[e][t]&&(subMap[e][t][0]=n[0]),subMap[e][t-1]&&(subMap[e][t-1][3]=n[3])),subMap[e-1]&&(subMap[e-1][t]&&(subMap[e-1][t][1]=n[1]),subMap[e-1][t-1]&&(subMap[e-1][t-1][2]=n[2]))}function s(e,t){function v(e,t){e||(o.push(s),u=!u),s+=t}var i=n(e,t),s=0,o=[],u=(i[3]==1||i[3]==2||i[3]==3)&&(i[0]==1||i[0]==2||i[0]==4),a=u;if(i[0]+i[1]+i[2]+i[3]==0)return r(e,t,i);if(!(i[0]!=1&&i[0]!=2||i[1]!=1&&i[1]!=2||i[2]!=1&&i[2]!=2||i[3]!=1&&i[3]!=2)){for(k=0;k<4;k++){var f=i[k]==2?"d":"";i[k]="1."+(k+1)+"00"+f}return r(e,t,i)}for(k=0;k<4;k++){var c=i[k];c==0?v(!u,2):c==1||c==2?v(u,2):c==3?(v(!u,1),v(u,1)):c==4&&(v(u,1),v(!u,1))}a?o.push(o.shift()):u&&o.push(0);for(k=0;k<o.length;k+=2)for(l=0;l<4;l++){var h=(o[k]+6*l)%8,p=(o[k+1]+6*l)%8;if(h<p&&(h<2||p==2||p==1)||h>p&&(p>0||h<2)){var d=i[l]==2?"d":"";i[l]="1."+(l+1)+o[k]+o[k+1]+d}}r(e,t,i)}baseMap=[],subMap=[];for(i=0;i<e.length;i++){baseMap[i]=[],subMap[i]=[];for(j=0;j<e[0].length;j++)baseMap[i][j]=t(e[i][j]),subMap[i][j]=[]}for(i=0;i<=e.length;i++)for(j=0;j<=e[0].length;j++)s(i,j);return subMap}function d(e){function s(r,i){var s=!0,o,u=[r,i],a=[],f={};while(u.length>0){var l=u.shift(),c=u.shift();if(f[l+","+c])continue;f[l+","+c]=!0;var h=e[l]&&e[l][c]||0;if(t.indexOf(h)!=-1)o!==undefined&&o!=h?o=2:o=h;else{var p=tagpro.tiles[e[l][c]];if(p&&p.drawFloor){p.redrawFloor&&(s=!1);var d=Array.isArray(p.drawFloor)?p.drawFloor:[{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}];d.forEach(function(t){var n=l+t.x,r=c+t.y;if(e[n]&&e[n][r]&&tagpro.tiles[e[n][r]]&&Array.isArray(tagpro.tiles[e[n][r]].drawFloor)&&!tagpro.tiles[e[n][r]].drawFloor.some(function(e){return e.x==-t.x&&e.y==-t.y}))return;u.push(n),u.push(r)}),a.push(l),a.push(c)}}}if(o===undefined||!o&&!s)o=2;while(a.length>0){var l=a.shift(),c=a.shift();n[l][c]=o}}var t=[0,2,11,12,17,18],n=[];for(var r=0;r<e.length;r++){n[r]=[];for(var i=0;i<e[0].length;i++)n[r][i]=-1}for(var r=0;r<e.length;r++)for(var i=0;i<e[0].length;i++)n[r][i]==-1&&tagpro.tiles[e[r][i]]&&tagpro.tiles[e[r][i]].drawFloor&&s(r,i);return n}function v(e,t,n,r){if(n){var i=e.volume+t;i>1&&(i=1),i<0&&(i=0),e.volume=i,e.rampTimeout=setTimeout(function(){v(e,t,n-1,r)},10);return}r&&r()}function b(e,n){var i;n?i="keyup":i="keydown";var s=r[u];if(!s)return;if(!s.pressing[e]&&i=="keydown"||s.pressing[e]&&i=="keyup"){var o=y++;s.pressing[e]=!n,t.emit(i,{k:e,t:o}),tagpro.ping.avg&&setTimeout(function(){h(s,e,o)},tagpro.ping.avg/2)}}function w(e){zoomCursor=e?zoomCursor+1:zoomCursor-1,zoomCursor>=zoomValues.length&&(zoomCursor=zoomValues.length-1),zoomCursor<0&&(zoomCursor=0)}function E(e){tagpro.keys.specNext.indexOf(e.keyCode)!=-1&&t.emit("next"),tagpro.keys.specPrev.indexOf(e.keyCode)!=-1&&t.emit("prev"),tagpro.keys.specRedFC.indexOf(e.keyCode)!=-1&&t.emit("redflagcarrier"),tagpro.keys.specBlueFC.indexOf(e.keyCode)!=-1&&t.emit("blueflagcarrier"),tagpro.keys.zoomOut.indexOf(e.keyCode)!=-1&&(tagpro.zooming=.025),tagpro.keys.zoomIn.indexOf(e.keyCode)!=-1&&(tagpro.zooming=-0.025),tagpro.keys.centerZoom.indexOf(e.keyCode)!=-1&&(tagpro.viewport.followPlayer=!tagpro.viewport.followPlayer),tagpro.keys.toggleAutoJoin.indexOf(e.keyCode)!=-1&&t.emit("join")}var e=!1,t=tagpro.createSocket(),n={},r={},s={},o=null,u=null,a=0,f=1,c="";tagpro.socket=t,tagpro.teamNames=n,tagpro.players=r,tagpro.objects=s,tagpro.chat={},tagpro.playerId=null,tagpro.score={},tagpro.state=1,tagpro.sendKeyPress=b,tagpro.group.socket&&(tagpro.group.socket.playerLocation="game"),t.on("id",function(e){u=e,tagpro.playerId=u,tagpro.viewport.followPlayer=!0}),t.on("settings",function(e){tagpro.settings=e;for(var t in r)var n=r[t]}),t.on("teamNames",function(e){tagpro.teamNames=e}),t.on("spectator",function(e){tagpro.spectator=e,tagpro.spectator||(tagpro.zoom=1)}),t.on("spectators",function(e){tagpro.spectators=e}),setTimeout(function(){u==null&&(location.href="http://"+tagpro.serverHost)},1e4),t.on("p",function(e){var t=e.t||null;e=e.u||e;for(var n=0,i=e.length;n!=i;n++){var s=e[n],o=r[s.id];o||(o=s,r[o.id]=o,o.lastSync={},o.pressing={});var u=!1,a=!1;for(var f in s){if(f=="up"||f=="down"||f=="left"||f=="right"){h(o,f,s[f]);continue}if(!(t==null||o.lastSync[f]==undefined||t>o.lastSync[f]))continue;o[f]=s[f],t&&(o.lastSync[f]=t);if(f=="rx"||f=="ry"||f=="lx"||f=="ly"||f=="a"||f=="den"||f=="dead"||f=="draw")u=!0;if(f=="dead"||f=="draw"||f=="directSet")a=!0;o.sprites&&(f=="name"||f=="auth")&&tagpro.renderer.drawName(o,!0)}(a||u)&&tagpro.world&&tagpro.world.syncPlayer(o,a)}}),t.on("object",function(e){s[e.id]||(s[e.id]=e);var t=s[e.id],n=!1,r=!1;for(var i in e){t[i]=e[i];if(i=="rx"||i=="ry"||i=="lx"||i=="ly"||i=="a"||i=="draw")n=!0;i=="draw"&&(r=!0)}n&&tagpro.world.syncObject(t,r)}),t.on("playerLeft",function(e){if(f==2)return;tagpro.world.destoryPlayer(e),tagpro.renderer.destroyPlayer(tagpro.players[e]),delete r[e]}),t.on("map",function(e){o=e.tiles,tagpro.map=o,tagpro.wallMap=p(o),tagpro.floorMap=d(o),tagpro.map.splats=e.splats,e.info&&$("div#mapInfo").removeClass("hide").text("Map: "+(e.info.name||"Untitled")+" by "+(e.info.author||"Unknown"))}),t.on("time",function(e){tagpro.gameEndsAt=new Date((new Date).getTime()+e.time),tagpro.state=e.state||1}),tagpro.playSound=function(e,t){if(!tagpro.sound)return;var n=$("audio#"+e).get(0);if(n&&n.play){n.volume=t||1;if(t==0)n.pause(),n.currentTime=0;else{if($(n).attr("data-ramp")){n.rampTimeout&&clearTimeout(n.rampTimeout);var r=n.volume;n.volume=0;var i=.01,s=Math.ceil(Math.abs((r-n.volume)/i));v(n,i,s)}n.play()}}},tagpro.stopSound=function(e){var t=$("audio#"+e).get(0);if(!t||!t.pause)return;if($(t).attr("data-ramp")){t.rampTimeout&&clearTimeout(t.rampTimeout);var n=0,r=-0.01,i=Math.ceil(Math.abs((n-t.volume)/r));v(t,r,i,function(){t.pause(),t.currentTime=0})}},t.on("sound",function(e){if(tagpro.viewport.followPlayer)tagpro.playSound(e.s,e.v);else switch(e.s){case"cheering":case"sigh":tagpro.playSound("cheering",1);break;case"drop":case"friendlydrop":tagpro.playSound("friendlydrop",1);break;case"alert":case"friendlyalert":tagpro.playSound("friendlyalert",.5);break;default:}}),t.on("stopSound",function(e){tagpro.stopSound(e)}),t.on("score",function(e){tagpro.score=e});var m=!1;t.on("full",function(){m=!0,location.href="http://"+tagpro.serverHost+"/games/find?r="+(new Date).getTime()}),t.on("private",function(){m=!0,location.href="http://"+tagpro.serverHost+"/"}),t.on("banned",function(){m=!0,location.href="http://"+tagpro.serverHost+"/banned"}),t.on("duplicate",function(){m=!0,location.href="http://"+tagpro.serverHost+"/"}),t.on("joinWorld",function(e){m=!0,location.href="http://"+location.hostname+":"+e+"/?alert=true"}),t.on("disconnect",function(){if(tagpro.group.socket&&tagpro.group.socket.redirecting)return;f!=2&&!m&&(g?location.href="http://"+tagpro.serverHost+"/groups/"+g:location.href="http://"+tagpro.serverHost+"/")}),t.on("end",function(e){f=2,tagpro.state=2,c=e.winner,tagpro.winner=e.winner,tagpro.showOptions();if(N&&!tagpro.spectator){var t=$("#mapRatingContainer");t.show(),t.find("select").val()||(t.addClass("shake").addClass("shake-slow").addClass("shake-constant"),setTimeout(function(){t.removeClass("shake").removeClass("shake-slow").removeClass("shake-constant")},1500))}$("div.news").fadeIn(),setTimeout(function(){e.groupId?location.href="http://"+tagpro.serverHost+"/groups/"+e.groupId:location.href="http://"+tagpro.serverHost+"/games/find?r="+(new Date).getTime()},2e4)});var g=null;t.on("groupId",function(e){if(!e)return;g=e,$("#exit").attr("href","http://"+tagpro.serverHost+"/groups/"+g)});var y=1;$(document).keydown(function(e){if(tagpro.disableControls)return;tagpro.keys.resetZoom.indexOf(e.keyCode)!=-1&&(tagpro.zoom=1);if(tagpro.spectator)return E(e);var t=null;tagpro.keys.left.indexOf(e.keyCode)>-1&&(t="left"),tagpro.keys.up.indexOf(e.keyCode)>-1&&(t="up"),tagpro.keys.right.indexOf(e.keyCode)>-1&&(t="right"),tagpro.keys.down.indexOf(e.keyCode)>-1&&(t="down"),tagpro.keys.space.indexOf(e.keyCode)>-1&&(t="space"),t&&(e.preventDefault(),b(t))}),$(document).keyup(function(e){var n=null;tagpro.keys.zoomOut.indexOf(e.keyCode)!=-1&&(tagpro.zooming=0),tagpro.keys.zoomIn.indexOf(e.keyCode)!=-1&&(tagpro.zooming=0);if(tagpro.disableControls||tagpro.spectator)return;tagpro.keys.left.indexOf(e.keyCode)>-1&&(n="left"),tagpro.keys.up.indexOf(e.keyCode)>-1&&(n="up"),tagpro.keys.right.indexOf(e.keyCode)>-1&&(n="right"),tagpro.keys.down.indexOf(e.keyCode)>-1&&(n="down"),tagpro.keys.space.indexOf(e.keyCode)>-1&&(n="space");if(n){e.preventDefault();var i=r[u];if(i&&i.pressing[n]){var s=y++;i.pressing[n]=!1,t.emit("keyup",{k:n,t:s}),tagpro.ping.avg&&setTimeout(function(){h(i,n,-s)},tagpro.ping.avg/2)}}}),zoomValues=[1,20/15,20/12,2,2.5,20/6,4],zoomCursor=0;var S=!1;tagpro.showOptions=function(){if(S)return;S=!0;var e=$("div#options");e.find("#name").val(tagpro.players[tagpro.playerId].name);var t=function(){var n=e.find("tbody.stats"),i=n.find("tr.template"),s=[];n.find("tr").not(".template").remove();for(var o in r)s.push(r[o]);s.sort(function(e,t){return t.score-e.score}),tagpro.events.sortPlayers&&tagpro.events.sortPlayers.forEach(function(e){e.sortPlayers(s)}),s.forEach(function(e){var t=i.clone().data("model",e).removeClass("template").appendTo(n).find("td");t.eq(0).find(".scoreName").text(e.name).css("color",e.team==1?"#FFB5BD":"#CFCFFF").end().find(".scoreAuth").html(e.auth?"&#x2713;":"").end(),t.eq(1).text(e.score),t.eq(2).text(e["s-tags"]),t.eq(3).text(e["s-pops"]),t.eq(4).text(e["s-grabs"]),t.eq(5).text(e["s-drops"]),t.eq(6).text(tagpro.helpers.timeFromSeconds(e["s-hold"],!0)),t.eq(7).text(e["s-captures"]),t.eq(8).text(tagpro.helpers.timeFromSeconds(e["s-prevent"],!0)),t.eq(9).text(e["s-returns"]),t.eq(10).text(e["s-support"]),t.eq(11).text(e["points"]==0?"-":e.points),t.find("a.kick").attr("href",e.id)}),tagpro.musicPlayer.current?$("div#musicInfo").removeClass("hide").text("Music: "+(tagpro.musicPlayer.current.name||"Untitled")+" by "+(tagpro.musicPlayer.current.author||"Unknown")):$("div#musicInfo").addClass("hide"),S&&setTimeout(t,1e3),tagpro.events.modifyScoreUI&&tagpro.events.modifyScoreUI.forEach(function(e){e.modifyScoreUI($("#options > table:first"))})};S&&t(),e.show(),tagpro.kongregate&&$("#exit, #soundEffects, #soundMusic").show()};var x=$("div#kick");$("#switchButton").click(function(e){e.preventDefault(),t.emit("switch")}),$(window).keydown(function(e){e.which==27&&e.preventDefault()}),$(document).keyup(function(e){e.preventDefault();if(tagpro.keys.showOptions.indexOf(e.keyCode)>-1){if(!S){tagpro.showOptions();return}S=!1,$("div#options").hide(),$("#name").blur(),tagpro.kongregate&&$("#exit, #soundEffects, #soundMusic, #donate").hide()}});var T=function(){t.emit("name",$(this).val()),tagpro.group.socket&&tagpro.group.socket.emit("name",$(this).val())};$("#name").keyup(T).change(T).focus(function(){tagpro.disableControls=!0}).blur(function(){tagpro.disableControls=!1}),$("select#mapRating").change(function(){var e=parseInt($(this).val());if(e>1||e<-1)return;t.emit("mapRating",e)});var N=!1;t.on("mapRating",function(e){$("select#mapRating").val(e),N=!0}),$("select#preferredServer").change(function(){t.emit("preferredServer",$(this).val())}),t.on("preferredServer",function(e){$("select#preferredServer").val(e)});var C=$("div#sendToPreferred"),L=null;t.on("sendPreferred",function(e){C.find("span#preferredServer").text(e.name).end().css({left:$(document.body).width()/2-x.width()/2,top:$(document.body).height()/2-x.height()/2}).show();var t=8,n=$("span#countdown"),r=function(){t--,n.text(t),t>0?L=setTimeout(r,1e3):document.location=e.url+"games/find/?preferred=true"};r()}),$("a#sendToPreferredCancel").click(function(e){e.preventDefault(),C.hide(),clearTimeout(L),$("select#preferredServer").val(""),t.emit("preferredServer","")});if(e){var A=[];setInterval(function(){if(u==null)return;A.forEach(function(e){var t=$.Event("keyup");t.keyCode=e,$(document).trigger(t)}),A=[],A.push([37,39][Math.floor(Math.random()*2)]),A.push([38,40][Math.floor(Math.random()*2)]),A.forEach(function(e){var t=$.Event("keydown");t.keyCode=e,$(document).trigger(t)})},3e3)}var O=[],M=0,_=0,D=0;setInterval(function(){var e=(new Date).getTime(),n={sent:e,id:M++,time:null,lost:!1};O.push(n),t.emit("p",{id:n.id,c:tagpro.ping.avg}),_++,O.length>5&&O.shift();var r=0,i=0;O.forEach(function(t){if(t.lost)return;if(t.time>=1e3||t.time==null&&e-t.sent>=1e3){t.lost=!0,D++;return}t.time!=null&&(r++,i+=t.time)}),tagpro.ping.avg=Math.round(i/r)||0,tagpro.ping.current=tagpro.ping.avg,tagpro.ping.loss=D/_},2e3),t.on("pr",function(e){var t=(new Date).getTime(),n=O.filter(function(t){return t.id==e&&!t.lost});if(!n||!n.length)return;n=n[0],n.time=t-n.sent}),window.addEventListener("beforeunload",function(){m=!0})}),tagpro.ready(function(){function s(e,t,n,r){return tagpro.ui.sprites[n]=tagpro.tiles.draw(e,t,r,30,30),tagpro.ui.flags.push(tagpro.ui.sprites[n]),tagpro.ui.sprites[n]}function o(e,t,n){function r(e,r,i,s){return{tile:e,name:r,drawPos:{x:t.x+i,y:s|n.height-40},xOffset:i,yOffset:s|-40}}var i=[r("redflag","redFlag",110),r("blueflag","blueFlag",-110),r("yellowflag","yellowFlagTakenByRed",-80),r("yellowflag","yellowFlagTakenByBlue",80),r("redpotato","redPotatoTaken",110),r("bluepotato","bluePotatoTaken",-110),r("yellowpotato","yellowPotatoTakenByRed",-80),r("yellowpotato","yellowPotatoTakenByBlue",80)];for(var o=0;o<i.length;o++){var u=i[o],a=s(e,u.tile,u.name,u.drawPos);a.xOffset=u.xOffset,a.yOffset=u.yOffset,a.anchor.x=.5}}function a(){tagpro.renderer.layers.ui.debug={};var e=tagpro.renderer.renderer.type==PIXI.WEBGL_RENDERER?"WebGL":"Canvas",t=tagpro.renderer.prettyText("Engine Type: "+e);t.x=10,t.y=100,tagpro.renderer.layers.ui.debug.engineType=t,tagpro.renderer.layers.ui.addChild(t);var n=tagpro.renderer.prettyText("");n.x=10,n.y=120,tagpro.renderer.layers.ui.debug.childCount=n,tagpro.renderer.layers.ui.addChild(n);var r=tagpro.renderer.prettyText("Particles: "+!tagpro.renderer.options.disableParticles);r.x=10,r.y=140,tagpro.renderer.layers.ui.debug.particles=r,tagpro.renderer.layers.ui.addChild(r);var i=tagpro.renderer.prettyText("Scaling: "+!tagpro.renderer.options.disableViewportScaling);i.x=10,i.y=160,tagpro.renderer.layers.ui.debug.viewport=i,tagpro.renderer.layers.ui.addChild(i);var s=tagpro.renderer.prettyText("");s.x=10,s.y=180,tagpro.renderer.layers.ui.debug.position=s,tagpro.renderer.layers.ui.addChild(s);var o=tagpro.renderer.prettyText("");o.x=10,o.y=200,tagpro.renderer.layers.ui.debug.realPosition=o,tagpro.renderer.layers.ui.addChild(o)}function f(){tagpro.renderer.layers.ui.debug||a();var e=l(),t="Sprite Count: "+e;tagpro.renderer.layers.ui.debug.childCount.text!=t&&tagpro.renderer.layers.ui.debug.childCount.setText(t);var n=tagpro.playerId;if(n){var r=tagpro.players[n],i=r.x,s=r.y,o="X: "+i+", Y: "+s;tagpro.renderer.layers.ui.debug.position.text!==o&&tagpro.renderer.layers.ui.debug.position.setText(o);var u=r.rx,f=r.ry,c="RX: "+u+", RY: "+f;tagpro.renderer.layers.ui.debug.realPosition.text!==c&&tagpro.renderer.layers.ui.debug.realPosition.setText(c)}}function l(){function t(n){if(n.visible){e+=1;for(var r=0;r<n.children.length;r++){var i=n.children[r];t(i)}}}var e=0;return t(tagpro.renderer.stage),e}function c(){if(!tagpro.ui.enabled)return;n||(n=tagpro.renderer.layers.ui),tagpro.settings.ui.spectatorInfo&&tagpro.ui.spectatorInfo(n,t),tagpro.renderer.debug&&f();if(tagpro.settings.ui.matchState){if(tagpro.gameEndsAt){var s=tagpro.gameEndsAt-(new Date).getTime(),o="00"+Math.floor(s/6e4),a="00"+Math.floor(s%6e4/1e3),l=o.substr(o.length-2,2)+":"+a.substr(a.length-2,2);tagpro.state==2&&(l=u),tagpro.ui.timer(n,t,e,l),l=="00:03"&&l!=u&&(tagpro.state!=2&&tagpro.playSound("countdown",1),tagpro.state==3&&setTimeout(function(){tagpro.playSound("cheering",1)},3e3)),u=l}tagpro.ui.scores(n,t,e),tagpro.ui.updateFlags(tagpro.renderer.layers.ui,t,e);var c=Math.floor((tagpro.ping.loss||0)*100);tagpro.ui.performanceInfo(n,t,e,c),tagpro.ui.alignUI();if(tagpro.state==2)r||(tagpro.winner=="red"?(tagpro.ui.largeAlert(n,t,e,(tagpro.teamNames.redTeamName||"Blue")+" Wins!","#ff0000"),r=!0):tagpro.winner=="blue"?(tagpro.ui.largeAlert(n,t,e,(tagpro.teamNames.blueTeamName||"Red")+" Wins!","#0000ff"),r=!0):tagpro.winner=="tie"?(tagpro.ui.largeAlert(n,t,e,"It's a tie!"),r=!0):(tagpro.ui.largeAlert(n,t,e,tagpro.winner),r=!0));else if(tagpro.state==3&&!i){var h=tagpro.ui.largeAlert(n,t,e,"Match Begins Soon..."),p=function(){tagpro.state!=3?(n.removeChild(h),h.visible=!1):setTimeout(p,20)};setTimeout(p,20),i=!0}}}var e={width:0,height:0},t={x:0,y:0},n,r=!1,i=!1;setTimeout(function(){$("#loadingMessage").fadeOut(100),$("#viewportDiv").fadeIn(250),$("#viewport").fadeIn(250,function(){tagpro.chat.resize()})},0),tagpro.ui={redFlagTaken:!1,blueFlagTaken:!1,yellowFlagTakenByRed:!1,yellowFlagTakenByBlue:!1,enabled:!0,sprites:{},redPotatoTaken:!1,bluePotatoTaken:!1,yellowPotatoTakenByRed:!1,yellowPotatoTakenByBlue:!1,flags:[]},tagpro.ui.resize=function(n,r){e.width=n,e.height=r,t.x=n/2,t.y=r/2,tagpro.ui.alignUI()},tagpro.ui.alignUI=function(){if(!tagpro.ui.sprites){setTimeout(tagpro.ui.alignUI,1e3);return}var e=tagpro.ui.sprites,n=[!!e.redScore,!!e.blueScore,!!tagpro.ui.sprites.timer,!!e.performanceInfo,tagpro.ui.flags.length>0,!!e.xhr];if(n.every(function(e){return!!e})){var r=t.y*2;tagpro.ui.sprites.redScore.x=t.x-80,tagpro.ui.sprites.redScore.y=r-80,tagpro.ui.sprites.blueScore.x=t.x+80,tagpro.ui.sprites.blueScore.y=r-80,tagpro.ui.sprites.timer.x=t.x,tagpro.ui.sprites.timer.y=r-50,tagpro.ui.sprites.performanceInfo.x=10,tagpro.ui.sprites.performanceInfo.y=10,tagpro.ui.sprites.xhr.x=t.x-tagpro.ui.sprites.xhr.width/2,tagpro.ui.sprites.xhr.y=10;for(var i=0;i<tagpro.ui.flags.length;i++){var s=tagpro.ui.flags[i];s.x=t.x+s.xOffset,s.y=r+s.yOffset}}else setTimeout(tagpro.ui.alignUI,1e3)},tagpro.ui.scores=function(){var e="",t="",n=tagpro.settings.ui.teamNames=="always"||tagpro.settings.ui.teamNames=="spectating"&&tagpro.spectator==1;n&&tagpro.teamNames.redTeamName!=="Red"&&(e=tagpro.teamNames.redTeamName+" - "),n&&tagpro.teamNames.blueTeamName!=="Blue"&&(t=" - "+tagpro.teamNames.blueTeamName);var r=e+(tagpro.score.r?tagpro.score.r.toString():"0"),i=(tagpro.score.b?tagpro.score.b.toString():"0")+t;tagpro.ui.sprites.redScore?(tagpro.ui.sprites.redScore.text!=r&&tagpro.ui.sprites.redScore.setText(r),tagpro.ui.sprites.blueScore!=i&&tagpro.ui.sprites.blueScore.setText(i)):(tagpro.ui.sprites.redScore=new PIXI.Text(r,{fill:"#FF0000",font:"bold 40pt Arial"}),tagpro.ui.sprites.blueScore=new PIXI.Text(i,{fill:"#0000FF",font:"bold 40pt Arial"}),tagpro.ui.sprites.redScore.alpha=.5,tagpro.ui.sprites.blueScore.alpha=.5,tagpro.ui.sprites.redScore.anchor.x=1,tagpro.ui.sprites.blueScore.anchor.x=0,tagpro.renderer.layers.ui.addChild(tagpro.ui.sprites.redScore),tagpro.renderer.layers.ui.addChild(tagpro.ui.sprites.blueScore))},tagpro.ui.updateFlags=function(e,t,n){tagpro.ui.sprites.redFlag||o(e,t,n);var r=[["redFlag","redFlagTaken"],["blueFlag","blueFlagTaken"],["yellowFlagTakenByRed",null],["yellowFlagTakenByBlue",null],["redPotatoTaken",null],["bluePotatoTaken",null],["yellowPotatoTakenByRed",null],["yellowPotatoTakenByBlue",null]];for(var i=0;i<r.length;i++){var s=r[i],u=tagpro.ui.sprites[s[0]],a;s[1]?a=!!tagpro.ui[s[1]]:a=!!tagpro.ui[s[0]],u.visible=a}e.globalAlpha=1},tagpro.ui.timer=function(e,t,n,r){var i=tagpro.ui.sprites.timer;i||(i=tagpro.ui.sprites.timer=new PIXI.Text("",{fill:"#FFFFFF",strokeThickness:4,stroke:"#000000",font:"bold 30pt Arial"}),i.alpha=.5,i.anchor.x=.5,e.addChild(tagpro.ui.sprites.timer)),i.text!=r&&i.setText(r)},tagpro.ui.spectatorInfo=function(e,t){var n=tagpro.ui.sprites.spectatorInfo1,r=tagpro.ui.sprites.spectatorInfo2;if(tagpro.spectator){n||(n=tagpro.ui.sprites.spectatorInfo1=tagpro.renderer.prettyText("You are spectating"),e.addChild(n),n.x=t.x,n.y=10,n.anchor.x=.5,n.alpha=.6);if(!r||tagpro.spectator!=tagpro.ui.lastSpectatorValue)r&&e.removeChild(r),r=tagpro.ui.sprites.spectatorInfo2=tagpro.renderer.prettyText("auto-join is "+(tagpro.spectator=="waiting"?"on":"off")),e.addChild(r),r.x=t.x,r.y=25,r.anchor.x=.5,r.alpha=.6,tagpro.ui.lastSpectatorValue=tagpro.spectator}else n&&e.removeChild(n),r&&e.removeChild(r)},tagpro.ui.performanceInfo=function(e,t,n,r){var i,s;tagpro.ui.sprites.performanceInfo||(tagpro.ui.xhrStartTime=performance.now(),tagpro.ui.sprites.performanceInfo=tagpro.renderer.prettyText(""),tagpro.ui.sprites.xhr=tagpro.renderer.prettyText(""),tagpro.ui.sprites.xhr.tint=16711680,tagpro.renderer.layers.ui.addChild(tagpro.ui.sprites.performanceInfo),tagpro.renderer.layers.ui.addChild(tagpro.ui.sprites.xhr)),i=tagpro.ui.sprites.performanceInfo,s=tagpro.ui.sprites.xhr;var o=!!tagpro.settings.ui.performanceInfo;i.visible=o,s.visible=performance.now()-tagpro.ui.xhrStartTime>1e3&&!!tagpro.rawSocket.io.engine.transport.polling;if(o){var u="FPS: "+Math.round(tagpro.fps)+", Ping: "+tagpro.ping.avg+(r?", Loss: "+r+"%":"");if(tagpro.rawSocket.io.engine.transport.polling){var a="XHR Mode, this will be laggy! Check your firewall!";s.text!==a&&s.setText(a)}i.text!=u&&i.setText(u)}},tagpro.ui.largeAlert=function(e,t,n,r,i){var s=tagpro.renderer.largeText(r,i);return s.x=Math.round(t.x-s.width/2),s.y=100,e.addChild(s),s};var u="";tagpro.ui.update=c}),tagpro.ready(function(){var e=$("div#kick");tagpro.kick={player:function(t){e.find("#kickPlayer").text(" "+t.name).end().find("#kickSelect").attr("data-id",t.id).prop("selectedIndex",0).end().css({left:($(window).width()-e.width())/2,top:($(window).height()-e.height())/2}).show()},clickBall:function(e){var t,n=e.pageX-$canvas.offset().left,r=e.pageY-$canvas.offset().top,i=40,s=null,o=-1;for(var u in tagpro.players){var a=tagpro.players[u],f=tagpro.helpers.toLockedPos({x:a.x,y:a.y}),l=f.x+20,c=f.y+20,h=Math.pow(l-n,2)+Math.pow(c-r,2);if(s===null||h<o)s=a,o=h}s&&o<Math.pow(i,2)&&tagpro.kick.player(s)}},$("tbody.stats").on("click","a.kick",function(e){e.preventDefault();var t=tagpro.players[parseInt($(this).attr("href"))];tagpro.kick.player(t)}),$("#kickSelect").change(function(t){t.preventDefault(),e.hide(),tagpro.socket.emit("kick",{playerId:parseInt($(this).attr("data-id")),reason:parseInt($(this).val())})}),$("#kickCancelButton").click(function(t){t.preventDefault(),e.hide()})}),tagpro.ready(function(){function l(e){var t=tagpro.settings.ui||{allChat:!0,teamChat:!0,groupChat:!0,systemChat:!0};if(!t.allChat&&e.to=="all"&&e.from)return;if(!t.teamChat&&e.to=="team")return;if(!t.groupChat&&e.to=="group")return;if(!t.systemChat&&e.to=="all"&&!e.from)return;var n=null,i=null,s=f.clone();typeof e.from=="number"?(n=tagpro.players[e.from],s.data("player",n)):typeof e.from=="string"&&(n={name:e.from,auth:!1}),(!n||!n.auth)&&s.children(".auth").remove(),n?(n.team?i=n.team==1?"#FFB5BD":"#CFCFFF":e.to=="group"?i="#E7E700":e.from=="ADMIN_GLOBAL_BROADCAST"?(i="#FF0000",n.name="ANNOUNCEMENT"):e.mod&&(i="#00B900"),s.children(".name").css({color:i}).text(n.name)):s.children(".name").remove();var o=i;e.to=="all"&&(o=e.c||null),e.to=="group"&&!e.from&&(o="#E7E700"),s.children(".message").css({color:o}).text(e.message).end(),r.append(s).scrollTop(r.get(0).scrollHeight),setTimeout(function(){s.remove()},2e4)}function c(r,s){e=!0,tagpro.disableControls=!0,t=r,n=s,i.val("").show().focus()}function h(){var e=i.val();if(e.length>70||e==""){p();return}n?tagpro.group.socket&&tagpro.group.socket.emit("chat",e):a.emit("chat",{toAll:!t,message:e}),p()}function p(){e=!1,tagpro.disableControls=!1,i.hide()}var e=!1,t=!1,n=!1,r=$("div#chatHistory"),i=$("input#chat"),s=$("canvas"),o=s.offset(),u=s.get(0).height,a=tagpro.socket;$(document).keydown(function(t){var n=tagpro.keys.chatToTeam.indexOf(t.keyCode)!=-1,r=tagpro.keys.chatToGroup.indexOf(t.keyCode)!=-1&&tagpro.group.socket,i=tagpro.keys.chatToAll.indexOf(t.keyCode)!=-1;if((n||r||i)&&!e){if($("#name").is(":focus"))return;c(n,r),t.preventDefault()}else tagpro.keys.sendChat.indexOf(t.keyCode)!=-1&&e&&h()});var f=$("<div><span class='auth'>&#10004</span><span class='name'></span><span class='message'></span></div>");a.on("chat",l),tagpro.group.socket&&tagpro.group.socket.on("chat",l),i.keydown(function(e){[37,38,39,40].indexOf(e.keyCode)>=0&&e.preventDefault(),tagpro.keys.cancelChat.indexOf(e.keyCode)>-1&&p()}),tagpro.chat.resize=function(){o=s.offset(),u=s.get(0).height,i.css({left:o.left+10,top:o.top+u-40}),r.css({left:o.left+10,top:o.top+u-r.outerHeight()-50})},r.on("click","div",function(){var e=$(this).data("player");if(!e)return;tagpro.kick.player(e)})});var overrideableAssets={speedpad:"img#speedpad",speedpadRed:"img#speedpadred",speedpadBlue:"img#speedpadblue",portal:"img#portal",tiles:"img#tiles",splats:"img#splats",gravityWell:"img#gravityWell"};tagpro.loadAssets=function(e){var t=function(e){$(document).ready(function(){$("#assets").append(e)})};for(var n in e){var r=e[n],i=generateId(),s=new Image;s.crossOrigin=!0,s.src=r,s.id=i,s.className="asset",overrideableAssets[n]="img#"+i,t(s)}tagpro.loadAssets=function(){console.log("tagpro.loadAssets has already been called. Ignoring second invocation.")}},tagpro.ready(function(){function e(e,t,n){var r=new Sprite($(e).get(0),40,t,n),i=r.createAnimation("on",0,150);return i.createFrame(0),i.createFrame(1),i.createFrame(2),i.createFrame(3),i=r.createAnimation("off",0,1e3),i.createFrame(4),r}function n(e,t,n,r){var i=[],s=new PIXI.Rectangle(0,0,t.width,t.height),o=function(e){var n=new PIXI.Rectangle(r*e,0,r,r);i.push(new PIXI.Texture(t,n))};if(!n)for(var u=0;u<e-1;u++)o(u);else o(e-1);return i}function r(e,r,i,s){t[r]||(t[r]=new PIXI.BaseTexture(e));var o=t[r],u=o.width/s;return n(u,o,i,s)}function i(e){var t=new PIXI.MovieClip(e);return t.playing=!0,t}function s(e,t,n){n=n||40;var s=$(e).get(0),o=r(s,e,t,n);return i(o)}function g(){var e=$(overrideableAssets.splats).get(0),t=new PIXI.BaseTexture(e),n=t.width/120,r=function(e,n){var r=new PIXI.Rectangle(120*e,120*n,120,120);return new PIXI.Texture(t,r)};tagpro.tiles.splats={red:[],blue:[]};for(var i=0;i<n-1;i++)tagpro.tiles.splats.red.push(r(i,0)),tagpro.tiles.splats.blue.push(r(i,1))}var t={},o=s(overrideableAssets.speedpad),u=s(overrideableAssets.speedpad,!0),a=s(overrideableAssets.speedpadRed),f=s(overrideableAssets.speedpadRed,!0),l=s(overrideableAssets.speedpadBlue),c=s(overrideableAssets.speedpadBlue,!0),h=s(overrideableAssets.portal),p=s(overrideableAssets.portal,!0);tagpro.tiles={1:{},1.1:{drawFloor:[{x:1,y:0},{x:0,y:-1}]},1.2:{drawFloor:[{x:1,y:0},{x:0,y:1}]},1.3:{drawFloor:[{x:-1,y:0},{x:0,y:1}]},1.4:{drawFloor:[{x:-1,y:0},{x:0,y:-1}]},2:{x:13,y:4},16:{x:13,y:1,drawFloor:!0,redrawFloor:!0,isFlag:!0,dynamic:!0},yellowflag:{x:13,y:1,isFlag:!0,dynamic:!0},16.1:{x:13,y:2,drawFloor:!0,redrawFloor:!0,dynamic:!0},3:{x:14,y:1,drawFloor:!0,redrawFloor:!0,isFlag:!0,dynamic:!0},redflag:{x:14,y:1,isFlag:!0,dynamic:!0},3.1:{x:14,y:2,drawFloor:!0,redrawFloor:!0,dynamic:!0},4:{x:15,y:1,drawFloor:!0,redrawFloor:!0,isFlag:!0,dynamic:!0},blueflag:{x:15,y:1,isFlag:!0,dynamic:!0},4.1:{x:15,y:2,drawFloor:!0,redrawFloor:!0,dynamic:!0},5:o,5.1:u,14:a,14.1:f,15:l,15.1:c,6:{x:12,y:8,drawFloor:!0,redrawFloor:!0,dynamic:!0},6.1:{x:12,y:4,drawFloor:!0,redrawFloor:!0,dynamic:!0},grip:{x:12,y:4,dynamic:!0},6.2:{x:12,y:5,drawFloor:!0,redrawFloor:!0,dynamic:!0},bomb:{x:12,y:5,dynamic:!0},6.3:{x:12,y:6,drawFloor:!0,redrawFloor:!0,dynamic:!0},tagpro:{x:12,y:6,dynamic:!0},6.4:{x:12,y:7,drawFloor:!0,redrawFloor:!0,dynamic:!0},speed:{x:12,y:7,dynamic:!0},17:{x:14,y:5,dynamic:!0},18:{x:15,y:5,dynamic:!0},7:{x:12,y:0,drawFloor:!0,redrawFloor:!1,dynamic:!0},21:{x:14,y:6,drawFloor:!0,redrawFloor:!0,isFlag:!0,dynamic:!0},yellowpotato:{x:14,y:6,isFlag:!0,dynamic:!0},21.1:{x:15,y:6,drawFloor:!0,redrawFloor:!0,dynamic:!0},19:{x:14,y:7,drawFloor:!0,redrawFloor:!0,isFlag:!0,dynamic:!0},redpotato:{x:14,y:7,isFlag:!0,dynamic:!0},19.1:{x:15,y:7,drawFloor:!0,redrawFloor:!0,dynamic:!0},20:{x:14,y:8,drawFloor:!0,redrawFloor:!0,isFlag:!0,dynamic:!0},bluepotato:{x:14,y:8,isFlag:!0,dynamic:!0},20.1:{x:15,y:8,drawFloor:!0,redrawFloor:!0,dynamic:!0},22:{x:0,y:0,drawFloor:!0,source:"gravityWell"},redball:{x:14,y:0},blueball:{x:15,y:0},8:{x:13,y:6,drawFloor:!0,redrawFloor:!1,dynamic:!0},9:{x:12,y:3,dynamic:!0},9.1:{x:13,y:3,dynamic:!0},9.2:{x:14,y:3,dynamic:!0},9.3:{x:15,y:3,dynamic:!0},10:{x:12,y:1,drawFloor:!0,redrawFloor:!0,dynamic:!0},10.1:{x:12,y:2,drawFloor:!0,redrawFloor:!0,dynamic:!0},11:{x:14,y:4},12:{x:15,y:4},marsball:{x:12,y:9,size:80,keep:!0},13:h,13.1:p,"1.310":{x:10.5,y:7.5,size:20},"1.410":{x:11,y:7.5,size:20},"1.110":{x:11,y:8,size:20},"1.210":{x:10.5,y:8,size:20},"1.310d":{x:.5,y:3.5,size:20},"1.410d":{x:1,y:3.5,size:20},"1.210d":{x:.5,y:4,size:20},1.321:{x:4.5,y:9.5,size:20},1.421:{x:5,y:9.5,size:20},1.121:{x:5,y:10,size:20},1.221:{x:4.5,y:10,size:20},"1.321d":{x:1.5,y:2.5,size:20},"1.421d":{x:2,y:2.5,size:20},"1.221d":{x:1.5,y:3,size:20},1.332:{x:6.5,y:9.5,size:20},1.432:{x:7,y:9.5,size:20},1.132:{x:7,y:10,size:20},1.232:{x:6.5,y:10,size:20},"1.332d":{x:9.5,y:2.5,size:20},"1.432d":{x:10,y:2.5,size:20},"1.132d":{x:10,y:3,size:20},1.343:{x:.5,y:7.5,size:20},1.443:{x:1,y:7.5,size:20},1.143:{x:1,y:8,size:20},1.243:{x:.5,y:8,size:20},"1.343d":{x:10.5,y:3.5,size:20},"1.443d":{x:11,y:3.5,size:20},"1.143d":{x:11,y:4,size:20},1.354:{x:1.5,y:6.5,size:20},1.454:{x:2,y:6.5,size:20},1.154:{x:2,y:7,size:20},1.254:{x:1.5,y:7,size:20},"1.454d":{x:9,y:1.5,size:20},"1.154d":{x:9,y:2,size:20},"1.254d":{x:8.5,y:2,size:20},1.365:{x:6.5,y:8.5,size:20},1.465:{x:7,y:8.5,size:20},1.165:{x:7,y:9,size:20},1.265:{x:6.5,y:9,size:20},"1.465d":{x:11,y:1.5,size:20},"1.165d":{x:11,y:2,size:20},"1.265d":{x:10.5,y:2,size:20},1.376:{x:4.5,y:8.5,size:20},1.476:{x:5,y:8.5,size:20},1.176:{x:5,y:9,size:20},1.276:{x:4.5,y:9,size:20},"1.376d":{x:.5,y:1.5,size:20},"1.176d":{x:1,y:2,size:20},"1.276d":{x:.5,y:2,size:20},1.307:{x:9.5,y:6.5,size:20},1.407:{x:10,y:6.5,size:20},1.107:{x:10,y:7,size:20},1.207:{x:9.5,y:7,size:20},"1.307d":{x:2.5,y:1.5,size:20},"1.107d":{x:3,y:2,size:20},"1.207d":{x:2.5,y:2,size:20},"1.320":{x:1.5,y:7.5,size:20},"1.420":{x:2,y:7.5,size:20},"1.220":{x:1.5,y:8,size:20},"1.320d":{x:10.5,y:.5,size:20},"1.420d":{x:11,y:.5,size:20},"1.220d":{x:10.5,y:1,size:20},1.331:{x:5.5,y:6.5,size:20},1.431:{x:6,y:6.5,size:20},1.131:{x:6,y:7,size:20},1.231:{x:5.5,y:7,size:20},"1.331d":{x:5.5,y:.5,size:20},"1.431d":{x:6,y:.5,size:20},1.342:{x:9.5,y:7.5,size:20},1.442:{x:10,y:7.5,size:20},1.142:{x:10,y:8,size:20},"1.342d":{x:.5,y:.5,size:20},"1.442d":{x:1,y:.5,size:20},"1.142d":{x:1,y:1,size:20},1.353:{x:4.5,y:5.5,size:20},1.453:{x:5,y:5.5,size:20},1.153:{x:5,y:6,size:20},1.253:{x:4.5,y:6,size:20},"1.453d":{x:7,y:1.5,size:20},"1.153d":{x:7,y:2,size:20},1.464:{x:4,y:9.5,size:20},1.164:{x:4,y:10,size:20},1.264:{x:3.5,y:10,size:20},"1.464d":{x:2,y:3.5,size:20},"1.164d":{x:2,y:4,size:20},"1.264d":{x:1.5,y:4,size:20},1.375:{x:5.5,y:2.5,size:20},1.475:{x:6,y:2.5,size:20},1.175:{x:6,y:4,size:20},1.275:{x:5.5,y:4,size:20},"1.175d":{x:6,y:3,size:20},"1.275d":{x:5.5,y:3,size:20},1.306:{x:7.5,y:9.5,size:20},1.106:{x:8,y:10,size:20},1.206:{x:7.5,y:10,size:20},"1.306d":{x:9.5,y:3.5,size:20},"1.106d":{x:10,y:4,size:20},"1.206d":{x:9.5,y:4,size:20},1.317:{x:6.5,y:5.5,size:20},1.417:{x:7,y:5.5,size:20},1.117:{x:7,y:6,size:20},1.217:{x:6.5,y:6,size:20},"1.317d":{x:4.5,y:1.5,size:20},"1.217d":{x:4.5,y:2,size:20},1.327:{x:7.5,y:8.5,size:20},1.427:{x:8,y:8.5,size:20},1.101:{x:4,y:5,size:20},1.227:{x:7.5,y:9,size:20},"1.327d":{x:8.5,y:3.5,size:20},"1.227d":{x:8.5,y:4,size:20},"1.330":{x:8.5,y:7.5,size:20},"1.430":{x:9,y:7.5,size:20},1.112:{x:2,y:0,size:20},"1.230":{x:8.5,y:8,size:20},"1.330d":{x:3.5,y:.5,size:20},"1.430d":{x:4,y:.5,size:20},1.341:{x:2.5,y:7.5,size:20},1.441:{x:3,y:7.5,size:20},1.141:{x:3,y:8,size:20},1.223:{x:9.5,y:0,size:20},"1.341d":{x:7.5,y:.5,size:20},"1.441d":{x:8,y:.5,size:20},1.352:{x:3.5,y:8.5,size:20},1.452:{x:4,y:8.5,size:20},1.152:{x:4,y:9,size:20},1.234:{x:7.5,y:5,size:20},"1.452d":{x:3,y:3.5,size:20},"1.152d":{x:3,y:4,size:20},1.345:{x:7.5,y:6.5,size:20},1.463:{x:10,y:8.5,size:20},1.163:{x:10,y:9,size:20},1.263:{x:9.5,y:9,size:20},"1.463d":{x:2,y:.5,size:20},"1.163d":{x:2,y:1,size:20},1.356:{x:6.5,y:7.5,size:20},1.474:{x:9,y:9.5,size:20},1.174:{x:9,y:10,size:20},1.274:{x:8.5,y:10,size:20},"1.174d":{x:10,y:5,size:20},"1.274d":{x:9.5,y:5,size:20},1.305:{x:2.5,y:9.5,size:20},1.467:{x:5,y:7.5,size:20},1.105:{x:3,y:10,size:20},1.205:{x:2.5,y:10,size:20},"1.105d":{x:2,y:5,size:20},"1.205d":{x:1.5,y:5,size:20},1.316:{x:1.5,y:8.5,size:20},"1.470":{x:4,y:6.5,size:20},1.116:{x:2,y:9,size:20},1.216:{x:1.5,y:9,size:20},"1.316d":{x:9.5,y:.5,size:20},"1.216d":{x:9.5,y:1,size:20},1.337:{x:10.5,y:9.5,size:20},1.437:{x:11,y:9.5,size:20},1.102:{x:0,y:7,size:20},1.237:{x:10.5,y:10,size:20},"1.337d":{x:10.5,y:4.5,size:20},"1.102d":{x:0,y:0,size:20},"1.340":{x:8.5,y:10.5,size:20},"1.440":{x:9,y:10.5,size:20},1.113:{x:6,y:8,size:20},1.213:{x:5.5,y:8,size:20},"1.340d":{x:3.5,y:2.5,size:20},"1.440d":{x:8,y:2.5,size:20},1.351:{x:.5,y:9.5,size:20},1.451:{x:1,y:9.5,size:20},1.151:{x:1,y:10,size:20},1.224:{x:11.5,y:7,size:20},"1.224d":{x:11.5,y:0,size:20},"1.451d":{x:1,y:4.5,size:20},1.335:{x:11.5,y:8.5,size:20},1.462:{x:0,y:5.5,size:20},1.162:{x:0,y:5,size:20},1.235:{x:11.5,y:9,size:20},"1.462d":{x:0,y:4.5,size:20},"1.162d":{x:0,y:6,size:20},1.346:{x:11.5,y:7.5,size:20},1.473:{x:8,y:6.5,size:20},1.173:{x:8,y:7,size:20},1.273:{x:7.5,y:7,size:20},"1.346d":{x:2.5,y:4.5,size:20},"1.173d":{x:9,y:3,size:20},1.357:{x:5.5,y:10.5,size:20},1.457:{x:6,y:10.5,size:20},1.104:{x:6,y:5,size:20},1.204:{x:5.5,y:5,size:20},"1.104d":{x:7,y:5,size:20},"1.204d":{x:4.5,y:5,size:20},1.315:{x:3.5,y:6.5,size:20},"1.460":{x:0,y:7.5,size:20},1.115:{x:4,y:7,size:20},1.215:{x:3.5,y:7,size:20},"1.460d":{x:9,y:4.5,size:20},"1.215d":{x:2.5,y:3,size:20},1.326:{x:11.5,y:5.5,size:20},1.471:{x:0,y:8.5,size:20},1.171:{x:0,y:9,size:20},1.226:{x:11.5,y:5,size:20},"1.326d":{x:11.5,y:4.5,size:20},"1.226d":{x:11.5,y:6,size:20},1.347:{x:9.5,y:10.5,size:20},1.447:{x:10,y:10.5,size:20},1.103:{x:9,y:6,size:20},1.203:{x:8.5,y:6,size:20},"1.347d":{x:3.5,y:1.5,size:20},"1.103d":{x:4,y:1,size:20},"1.350":{x:1.5,y:10.5,size:20},"1.450":{x:2,y:10.5,size:20},1.114:{x:3,y:6,size:20},1.214:{x:2.5,y:6,size:20},"1.214d":{x:7.5,y:1,size:20},"1.450d":{x:8,y:1.5,size:20},1.325:{x:4.5,y:7.5,size:20},1.461:{x:4,y:3.5,size:20},1.161:{x:4,y:4,size:20},1.225:{x:4.5,y:8,size:20},"1.225d":{x:8.5,y:5,size:20},"1.461d":{x:8,y:4.5,size:20},1.336:{x:7.5,y:3.5,size:20},1.472:{x:7,y:7.5,size:20},1.172:{x:7,y:8,size:20},1.236:{x:7.5,y:4,size:20},"1.336d":{x:3.5,y:4.5,size:20},"1.172d":{x:3,y:5,size:20},"1.300":{x:5.5,y:5.5,size:20},"1.400":{x:6,y:5.5,size:20},"1.100":{x:6,y:6,size:20},"1.200":{x:5.5,y:6,size:20},"1.300d":{x:5.5,y:8.5,size:20},"1.400d":{x:6,y:8.5,size:20},"1.100d":{x:6,y:10,size:20},"1.200d":{x:5.5,y:10,size:20}},tagpro.tiles.tileCanvases={};var d=$(overrideableAssets.tiles);tagpro.tiles.image=d[0],tagpro.tiles.images={gravityWell:$(overrideableAssets.gravityWell)[0]},tagpro.events.defineCustomTiles&&tagpro.events.defineCustomTiles.forEach(function(e){e.defineCustomTiles(tagpro.tiles)});var v=[],m=[];tagpro.tiles.createAnimation=s,tagpro.tiles.drawNext=function(){while(m.length)m.pop()()},this.firstLoad=!1,tagpro.tiles.drawWithZoom=function(e,t,n,r,i,s){return tagpro.tiles.draw(e,t,n,r,i,s,!0)},tagpro.tiles.getTexture=function(e,t,n){if(!PIXI.TextureCache[e]){t||(t=tagpro.tiles[e]);var r=t.source?tagpro.tiles.images[t.source]:tagpro.tiles.image,i=document.createElement("canvas");i.width=t.size||40,i.height=t.size||40;var s=i.getContext("2d"),o=t.x*40-n,u=t.y*40-n,a=(t.size||40)+n*2;s.drawImage(r,o,u,a,a,0,0,a,a),PIXI.TextureCache[e]=PIXI.Texture.fromCanvas(i)}return PIXI.TextureCache[e]},tagpro.tiles.draw=function(e,t,n,r,i,s,o){var u=tagpro.tiles[t];if(!u||u.draw)return;var a=u.spread||0,f=u.size||r,l=u.size||i,c=function(){var f=tagpro.tiles.getTexture(t,u,a),l=new PIXI.Sprite(f);return l.position.x=n.x,l.position.y=n.y,l.width=r||40,l.height=i||40,l.alpha=s||1,o?e.addChildAt(l,0):e.addChild(l),l};if(!a)return c();m.push(c),n={x:n.x,y:n.y}},tagpro.tiles.animations={},tagpro.tiles.drawLayers=function(e,t,n,r,i){var s=tagpro.tiles[tagpro.map[t][n]];if(!s)return;var o=s instanceof PIXI.MovieClip;tagpro.tiles.draw(e,{x:1,y:0},r),tagpro.floorMap[t][n]&&tagpro.tiles.draw(e,tagpro.floorMap[t][n],r),o?tagpro.tiles.draw(e,2,r):Math.floor(tagpro.map[t][n])==1?(tagpro.tiles.draw(e,tagpro.wallMap[t][n][0],r,20,20),tagpro.tiles.draw(e,tagpro.wallMap[t][n][1],{x:r.x+20,y:r.y},20,20),tagpro.tiles.draw(e,tagpro.wallMap[t][n][2],{x:r.x+20,y:r.y+20},20,20),tagpro.tiles.draw(e,tagpro.wallMap[t][n][3],{x:r.x,y:r.y+20},20,20)):s.dynamic||tagpro.tiles.draw(e,tagpro.map[t][n],r)},g()}),function(){var e=this,t=t||{};t.WEBGL_RENDERER=0,t.CANVAS_RENDERER=1,t.VERSION="v2.0.0",t.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},t.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},t._UID=0,typeof Float32Array!="undefined"?(t.Float32Array=Float32Array,t.Uint16Array=Uint16Array):(t.Float32Array=Array,t.Uint16Array=Array),t.INTERACTION_FREQUENCY=30,t.AUTO_PREVENT_DEFAULT=!0,t.PI_2=Math.PI*2,t.RAD_TO_DEG=180/Math.PI,t.DEG_TO_RAD=Math.PI/180,t.RETINA_PREFIX="@2x",t.dontSayHello=!1,t.defaultRenderOptions={view:null,transparent:!1,antialias:!1,preserveDrawingBuffer:!1,resolution:1,clearBeforeRender:!0},t.sayHello=function(e){if(t.dontSayHello)return;if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var n=["%c %c %c Pixi.js "+t.VERSION+" - "+e+"  %c "+" %c "+" http://www.pixijs.com/  %c %c â¥%câ¥%câ¥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,n)}else window.console&&console.log("Pixi.js "+t.VERSION+" - http://www.pixijs.com/");t.dontSayHello=!0},t.Point=function(e,t){this.x=e||0,this.y=t||0},t.Point.prototype.clone=function(){return new t.Point(this.x,this.y)},t.Point.prototype.set=function(e,t){this.x=e||0,this.y=t||(t!==0?this.x:0)},t.Point.prototype.constructor=t.Point,t.Rectangle=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},t.Rectangle.prototype.clone=function(){return new t.Rectangle(this.x,this.y,this.width,this.height)},t.Rectangle.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=this.x;if(e>=n&&e<=n+this.width){var r=this.y;if(t>=r&&t<=r+this.height)return!0}return!1},t.Rectangle.prototype.constructor=t.Rectangle,t.EmptyRectangle=new t.Rectangle(0,0,0,0),t.Polygon=function(e){e instanceof Array||(e=Array.prototype.slice.call(arguments));if(e[0]instanceof t.Point){var n=[];for(var r=0,i=e.length;r<i;r++)n.push(e[r].x,e[r].y);e=n}this.closed=!0,this.points=e},t.Polygon.prototype.clone=function(){var e=this.points.slice();return new t.Polygon(e)},t.Polygon.prototype.contains=function(e,t){var n=!1,r=this.points.length/2;for(var i=0,s=r-1;i<r;s=i++){var o=this.points[i*2],u=this.points[i*2+1],a=this.points[s*2],f=this.points[s*2+1],l=u>t!=f>t&&e<(a-o)*(t-u)/(f-u)+o;l&&(n=!n)}return n},t.Polygon.prototype.constructor=t.Polygon,t.Circle=function(e,t,n){this.x=e||0,this.y=t||0,this.radius=n||0},t.Circle.prototype.clone=function(){return new t.Circle(this.x,this.y,this.radius)},t.Circle.prototype.contains=function(e,t){if(this.radius<=0)return!1;var n=this.x-e,r=this.y-t,i=this.radius*this.radius;return n*=n,r*=r,n+r<=i},t.Circle.prototype.getBounds=function(){return new t.Rectangle(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)},t.Circle.prototype.constructor=t.Circle,t.Ellipse=function(e,t,n,r){this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0},t.Ellipse.prototype.clone=function(){return new t.Ellipse(this.x,this.y,this.width,this.height)},t.Ellipse.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var n=(e-this.x)/this.width,r=(t-this.y)/this.height;return n*=n,r*=r,n+r<=1},t.Ellipse.prototype.getBounds=function(){return new t.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},t.Ellipse.prototype.constructor=t.Ellipse,t.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},t.Matrix.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},t.Matrix.prototype.toArray=function(e){this.array||(this.array=new t.Float32Array(9));var n=this.array;return e?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n},t.Matrix.prototype.apply=function(e,n){return n=n||new t.Point,n.x=this.a*e.x+this.c*e.y+this.tx,n.y=this.b*e.x+this.d*e.y+this.ty,n},t.Matrix.prototype.applyInverse=function(e,n){n=n||new t.Point;var r=1/(this.a*this.d+this.c*-this.b);return n.x=this.d*r*e.x+ -this.c*r*e.y+(this.ty*this.c-this.tx*this.d)*r,n.y=this.a*r*e.y+ -this.b*r*e.x+(-this.ty*this.a+this.tx*this.b)*r,n},t.Matrix.prototype.translate=function(e,t){return this.tx+=e,this.ty+=t,this},t.Matrix.prototype.scale=function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},t.Matrix.prototype.rotate=function(e){var t=Math.cos(e),n=Math.sin(e),r=this.a,i=this.c,s=this.tx;return this.a=r*t-this.b*n,this.b=r*n+this.b*t,this.c=i*t-this.d*n,this.d=i*n+this.d*t,this.tx=s*t-this.ty*n,this.ty=s*n+this.ty*t,this},t.Matrix.prototype.append=function(e){var t=this.a,n=this.b,r=this.c,i=this.d;return this.a=e.a*t+e.b*r,this.b=e.a*n+e.b*i,this.c=e.c*t+e.d*r,this.d=e.c*n+e.d*i,this.tx=e.tx*t+e.ty*r+this.tx,this.ty=e.tx*n+e.ty*i+this.ty,this},t.Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},t.identityMatrix=new t.Matrix,t.DisplayObject=function(){this.position=new t.Point,this.scale=new t.Point(1,1),this.pivot=new t.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new t.Matrix,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new t.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},t.DisplayObject.prototype.constructor=t.DisplayObject,Object.defineProperty(t.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(e){this._interactive=e,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"worldVisible",{get:function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}}),Object.defineProperty(t.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask&&(this._mask.isMask=!1),this._mask=e,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(t.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(e){if(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n].passes;for(var i=0;i<r.length;i++)t.push(r[i])}this._filterBlock={target:this,filterPasses:t}}this._filters=e}}),Object.defineProperty(t.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(e){if(this._cacheAsBitmap===e)return;e?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=e}}),t.DisplayObject.prototype.updateTransform=function(){var e=this.parent.worldTransform,n=this.worldTransform,r,i,s,o,u,a;if(this.rotation%t.PI_2){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),r=this._cr*this.scale.x,i=this._sr*this.scale.x,s=-this._sr*this.scale.y,o=this._cr*this.scale.y,u=this.position.x,a=this.position.y;if(this.pivot.x||this.pivot.y)u-=this.pivot.x*r+this.pivot.y*s,a-=this.pivot.x*i+this.pivot.y*o;n.a=r*e.a+i*e.c,n.b=r*e.b+i*e.d,n.c=s*e.a+o*e.c,n.d=s*e.b+o*e.d,n.tx=u*e.a+a*e.c+e.tx,n.ty=u*e.b+a*e.d+e.ty}else r=this.scale.x,o=this.scale.y,u=this.position.x-this.pivot.x*r,a=this.position.y-this.pivot.y*o,n.a=e.a*r,n.b=e.b*o,n.c=e.c*r,n.d=e.d*o,n.tx=u*e.a+a*e.c+e.tx,n.ty=u*e.b+a*e.d+e.ty;this.worldAlpha=this.alpha*this.parent.worldAlpha},t.DisplayObject.prototype.getBounds=function(e){return e=e,t.EmptyRectangle},t.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(t.identityMatrix)},t.DisplayObject.prototype.setStageReference=function(e){this.stage=e,this._interactive&&(this.stage.dirty=!0)},t.DisplayObject.prototype.generateTexture=function(e,n,r){var i=this.getLocalBounds(),s=new t.RenderTexture(i.width|0,i.height|0,r,n,e);return t.DisplayObject._tempMatrix.tx=-i.x,t.DisplayObject._tempMatrix.ty=-i.y,s.render(this,t.DisplayObject._tempMatrix),s},t.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},t.DisplayObject.prototype.toGlobal=function(e){return this.updateTransform(),this.worldTransform.apply(e)},t.DisplayObject.prototype.toLocal=function(e,t){return t&&(e=t.toGlobal(e)),this.updateTransform(),this.worldTransform.applyInverse(e)},t.DisplayObject.prototype._renderCachedSprite=function(e){this._cachedSprite.worldAlpha=this.worldAlpha,e.gl?t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e):t.Sprite.prototype._renderCanvas.call(this._cachedSprite,e)},t.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var e=this.getLocalBounds();if(!this._cachedSprite){var n=new t.RenderTexture(e.width|0,e.height|0);this._cachedSprite=new t.Sprite(n),this._cachedSprite.worldTransform=this.worldTransform}else this._cachedSprite.texture.resize(e.width|0,e.height|0);var r=this._filters;this._filters=null,this._cachedSprite.filters=r,t.DisplayObject._tempMatrix.tx=-e.x,t.DisplayObject._tempMatrix.ty=-e.y,this._cachedSprite.texture.render(this,t.DisplayObject._tempMatrix),this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this._filters=r,this._cacheAsBitmap=!0},t.DisplayObject.prototype._destroyCachedSprite=function(){if(!this._cachedSprite)return;this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},t.DisplayObject.prototype._renderWebGL=function(e){e=e},t.DisplayObject.prototype._renderCanvas=function(e){e=e},t.DisplayObject._tempMatrix=new t.Matrix,Object.defineProperty(t.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(e){this.position.x=e}}),Object.defineProperty(t.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(e){this.position.y=e}}),t.DisplayObjectContainer=function(){t.DisplayObject.call(this),this.children=[]},t.DisplayObjectContainer.prototype=Object.create(t.DisplayObject.prototype),t.DisplayObjectContainer.prototype.constructor=t.DisplayObjectContainer,Object.defineProperty(t.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(e){var t=this.getLocalBounds().width;t!==0?this.scale.x=e/(t/this.scale.x):this.scale.x=1,this._width=e}}),Object.defineProperty(t.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(e){var t=this.getLocalBounds().height;t!==0?this.scale.y=e/(t/this.scale.y):this.scale.y=1,this._height=e}}),t.DisplayObjectContainer.prototype.addChild=function(e){return this.addChildAt(e,this.children.length)},t.DisplayObjectContainer.prototype.addChildAt=function(e,t){if(t>=0&&t<=this.children.length)return e.parent&&e.parent.removeChild(e),e.parent=this,this.children.splice(t,0,e),this.stage&&e.setStageReference(this.stage),e;throw new Error(e+"addChildAt: The index "+t+" supplied is out of bounds "+this.children.length)},t.DisplayObjectContainer.prototype.swapChildren=function(e,t){if(e===t)return;var n=this.getChildIndex(e),r=this.getChildIndex(t);if(n<0||r<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[n]=t,this.children[r]=e},t.DisplayObjectContainer.prototype.getChildIndex=function(e){var t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t},t.DisplayObjectContainer.prototype.setChildIndex=function(e,t){if(t<0||t>=this.children.length)throw new Error("The supplied index is out of bounds");var n=this.getChildIndex(e);this.children.splice(n,1),this.children.splice(t,0,e)},t.DisplayObjectContainer.prototype.getChildAt=function(e){if(e<0||e>=this.children.length)throw new Error("getChildAt: Supplied index "+e+" does not exist in the child list, or the supplied DisplayObject must be a child of the caller");return this.children[e]},t.DisplayObjectContainer.prototype.removeChild=function(e){var t=this.children.indexOf(e);if(t===-1)return;return this.removeChildAt(t)},t.DisplayObjectContainer.prototype.removeChildAt=function(e){var t=this.getChildAt(e);return this.stage&&t.removeStageReference(),t.parent=undefined,this.children.splice(e,1),t},t.DisplayObjectContainer.prototype.removeChildren=function(e,t){var n=e||0,r=typeof t=="number"?t:this.children.length,i=r-n;if(i>0&&i<=r){var s=this.children.splice(n,i);for(var o=0;o<s.length;o++){var u=s[o];this.stage&&u.removeStageReference(),u.parent=undefined}return s}if(i===0&&this.children.length===0)return[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},t.DisplayObjectContainer.prototype.updateTransform=function(){if(!this.visible)return;t.DisplayObject.prototype.updateTransform.call(this);if(this._cacheAsBitmap)return;for(var e=0,n=this.children.length;e<n;e++)this.children[e].updateTransform()},t.DisplayObjectContainer.prototype.getBounds=function(){if(this.children.length===0)return t.EmptyRectangle;var e=Infinity,n=Infinity,r=-Infinity,i=-Infinity,s,o,u,a=!1;for(var f=0,l=this.children.length;f<l;f++){var c=this.children[f];if(!c.visible)continue;a=!0,s=this.children[f].getBounds(),e=e<s.x?e:s.x,n=n<s.y?n:s.y,o=s.width+s.x,u=s.height+s.y,r=r>o?r:o,i=i>u?i:u}if(!a)return t.EmptyRectangle;var h=this._bounds;return h.x=e,h.y=n,h.width=r-e,h.height=i-n,h},t.DisplayObjectContainer.prototype.getLocalBounds=function(){var e=this.worldTransform;this.worldTransform=t.identityMatrix;for(var n=0,r=this.children.length;n<r;n++)this.children[n].updateTransform();var i=this.getBounds();return this.worldTransform=e,i},t.DisplayObjectContainer.prototype.setStageReference=function(e){this.stage=e,this._interactive&&(this.stage.dirty=!0);for(var t=0,n=this.children.length;t<n;t++){var r=this.children[t];r.setStageReference(e)}},t.DisplayObjectContainer.prototype.removeStageReference=function(){for(var e=0,t=this.children.length;e<t;e++){var n=this.children[e];n.removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},t.DisplayObjectContainer.prototype._renderWebGL=function(e){if(!this.visible||this.alpha<=0)return;if(this._cacheAsBitmap){this._renderCachedSprite(e);return}var t,n;if(this._mask||this._filters){this._filters&&(e.spriteBatch.flush(),e.filterManager.pushFilter(this._filterBlock)),this._mask&&(e.spriteBatch.stop(),e.maskManager.pushMask(this.mask,e),e.spriteBatch.start());for(t=0,n=this.children.length;t<n;t++)this.children[t]._renderWebGL(e);e.spriteBatch.stop(),this._mask&&e.maskManager.popMask(this._mask,e),this._filters&&e.filterManager.popFilter(),e.spriteBatch.start()}else for(t=0,n=this.children.length;t<n;t++)this.children[t]._renderWebGL(e)},t.DisplayObjectContainer.prototype._renderCanvas=function(e){if(this.visible===!1||this.alpha===0)return;if(this._cacheAsBitmap){this._renderCachedSprite(e);return}this._mask&&e.maskManager.pushMask(this._mask,e);for(var t=0,n=this.children.length;t<n;t++){var r=this.children[t];r._renderCanvas(e)}this._mask&&e.maskManager.popMask(e)},t.Sprite=function(e){t.DisplayObjectContainer.call(this),this.anchor=new t.Point,this.texture=e,this._width=0,this._height=0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL,this.shader=null,e.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.on("update",this.onTextureUpdateBind)),this.renderable=!0},t.Sprite.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Sprite.prototype.constructor=t.Sprite,Object.defineProperty(t.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(t.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),t.Sprite.prototype.setTexture=function(e){this.texture=e,this.cachedTint=16777215},t.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},t.Sprite.prototype.getBounds=function(e){var t=this.texture.frame.width,n=this.texture.frame.height,r=t*(1-this.anchor.x),i=t*-this.anchor.x,s=n*(1-this.anchor.y),o=n*-this.anchor.y,u=e||this.worldTransform,a=u.a,f=u.c,l=u.b,c=u.d,h=u.tx,p=u.ty,d=a*i+l*o+h,v=c*o+f*i+p,m=a*r+l*o+h,g=c*o+f*r+p,y=a*r+l*s+h,b=c*s+f*r+p,w=a*i+l*s+h,E=c*s+f*i+p,S=-Infinity,x=-Infinity,T=Infinity,N=Infinity;T=d<T?d:T,T=m<T?m:T,T=y<T?y:T,T=w<T?w:T,N=v<N?v:N,N=g<N?g:N,N=b<N?b:N,N=E<N?E:N,S=d>S?d:S,S=m>S?m:S,S=y>S?y:S,S=w>S?w:S,x=v>x?v:x,x=g>x?g:x,x=b>x?b:x,x=E>x?E:x;var C=this._bounds;return C.x=T,C.width=S-T,C.y=N,C.height=x-N,this._currentBounds=C,C},t.Sprite.prototype._renderWebGL=function(e){if(!this.visible||this.alpha<=0)return;var t,n;if(this._mask||this._filters){var r=e.spriteBatch;this._filters&&(r.flush(),e.filterManager.pushFilter(this._filterBlock)),this._mask&&(r.stop(),e.maskManager.pushMask(this.mask,e),r.start()),r.render(this);for(t=0,n=this.children.length;t<n;t++)this.children[t]._renderWebGL(e);r.stop(),this._mask&&e.maskManager.popMask(this._mask,e),this._filters&&e.filterManager.popFilter(),r.start()}else{e.spriteBatch.render(this);for(t=0,n=this.children.length;t<n;t++)this.children[t]._renderWebGL(e)}},t.Sprite.prototype._renderCanvas=function(e){if(this.visible===!1||this.alpha===0||this.texture.crop.width<=0||this.texture.crop.height<=0)return;this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,e.context.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e);if(this.texture.valid){var n=this.texture.baseTexture.resolution/e.resolution;e.context.globalAlpha=this.worldAlpha,e.roundPixels?e.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*e.resolution|0,this.worldTransform.ty*e.resolution|0):e.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*e.resolution,this.worldTransform.ty*e.resolution),e.smoothProperty&&e.scaleMode!==this.texture.baseTexture.scaleMode&&(e.scaleMode=this.texture.baseTexture.scaleMode,e.context[e.smoothProperty]=e.scaleMode===t.scaleModes.LINEAR);var r=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,i=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;this.tint!==16777215?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=t.CanvasTinter.getTintedTexture(this,this.tint)),e.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,r/n,i/n,this.texture.crop.width/n,this.texture.crop.height/n)):e.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,r/n,i/n,this.texture.crop.width/n,this.texture.crop.height/n)}for(var s=0,o=this.children.length;s<o;s++)this.children[s]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)},t.Sprite.fromFrame=function(e){var n=t.TextureCache[e];if(!n)throw new Error('The frameId "'+e+'" does not exist in the texture cache'+this);return new t.Sprite(n)},t.Sprite.fromImage=function(e,n,r){var i=t.Texture.fromImage(e,n,r);return new t.Sprite(i)},t.SpriteBatch=function(e){t.DisplayObjectContainer.call(this),this.textureThing=e,this.ready=!1},t.SpriteBatch.prototype=Object.create(t.DisplayObjectContainer.prototype),t.SpriteBatch.prototype.constructor=t.SpriteBatch,t.SpriteBatch.prototype.initWebGL=function(e){this.fastSpriteBatch=new t.WebGLFastSpriteBatch(e),this.ready=!0},t.SpriteBatch.prototype.updateTransform=function(){t.DisplayObject.prototype.updateTransform.call(this)},t.SpriteBatch.prototype._renderWebGL=function(e){if(!this.visible||this.alpha<=0||!this.children.length)return;this.ready||this.initWebGL(e.gl),e.spriteBatch.stop(),e.shaderManager.setShader(e.shaderManager.fastShader),this.fastSpriteBatch.begin(this,e),this.fastSpriteBatch.render(this),e.spriteBatch.start()},t.SpriteBatch.prototype._renderCanvas=function(e){if(!this.visible||this.alpha<=0||!this.children.length)return;var n=e.context;n.globalAlpha=this.worldAlpha,t.DisplayObject.prototype.updateTransform.call(this);var r=this.worldTransform,i=!0;for(var s=0;s<this.children.length;s++){var o=this.children[s];if(!o.visible)continue;var u=o.texture,a=u.frame;n.globalAlpha=this.worldAlpha*o.alpha;if(o.rotation%(Math.PI*2)===0)i&&(n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),i=!1),n.drawImage(u.baseTexture.source,a.x,a.y,a.width,a.height,o.anchor.x*-a.width*o.scale.x+o.position.x+.5|0,o.anchor.y*-a.height*o.scale.y+o.position.y+.5|0,a.width*o.scale.x,a.height*o.scale.y);else{i||(i=!0),t.DisplayObject.prototype.updateTransform.call(o);var f=o.worldTransform;e.roundPixels?n.setTransform(f.a,f.b,f.c,f.d,f.tx|0,f.ty|0):n.setTransform(f.a,f.b,f.c,f.d,f.tx,f.ty),n.drawImage(u.baseTexture.source,a.x,a.y,a.width,a.height,o.anchor.x*-a.width+.5|0,o.anchor.y*-a.height+.5|0,a.width,a.height)}}},t.MovieClip=function(e){t.Sprite.call(this,e[0]),this.textures=e,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},t.MovieClip.prototype=Object.create(t.Sprite.prototype),t.MovieClip.prototype.constructor=t.MovieClip,Object.defineProperty(t.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),t.MovieClip.prototype.stop=function(){this.playing=!1},t.MovieClip.prototype.play=function(){this.playing=!0},t.MovieClip.prototype.gotoAndStop=function(e){this.playing=!1,this.currentFrame=e;var t=this.currentFrame+.5|0;this.setTexture(this.textures[t%this.textures.length])},t.MovieClip.prototype.gotoAndPlay=function(e){this.currentFrame=e,this.playing=!0},t.MovieClip.prototype.updateTransform=function(){t.Sprite.prototype.updateTransform.call(this);if(!this.playing)return;this.currentFrame+=this.animationSpeed;var e=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length,this.loop||e<this.textures.length?this.setTexture(this.textures[e%this.textures.length]):e>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())},t.MovieClip.fromFrames=function(e){var n=[];for(var r=0;r<e.length;r++)n.push(new t.Texture.fromFrame(e[r]));return new t.MovieClip(n)},t.MovieClip.fromImages=function(e){var n=[];for(var r=0;r<e.length;r++)n.push(new t.Texture.fromImage(e[r]));return new t.MovieClip(n)},t.FilterBlock=function(){this.visible=!0,this.renderable=!0},t.FilterBlock.prototype.constructor=t.FilterBlock,t.Text=function(e,n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=1,t.Sprite.call(this,t.Texture.fromCanvas(this.canvas)),this.setText(e),this.setStyle(n)},t.Text.prototype=Object.create(t.Sprite.prototype),t.Text.prototype.constructor=t.Text,Object.defineProperty(t.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(e){this.scale.x=e/this.texture.frame.width,this._width=e}}),Object.defineProperty(t.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(e){this.scale.y=e/this.texture.frame.height,this._height=e}}),t.Text.prototype.setStyle=function(e){e=e||{},e.font=e.font||"bold 20pt Arial",e.fill=e.fill||"black",e.align=e.align||"left",e.stroke=e.stroke||"black",e.strokeThickness=e.strokeThickness||0,e.wordWrap=e.wordWrap||!1,e.wordWrapWidth=e.wordWrapWidth||100,e.dropShadow=e.dropShadow||!1,e.dropShadowAngle=e.dropShadowAngle||Math.PI/6,e.dropShadowDistance=e.dropShadowDistance||4,e.dropShadowColor=e.dropShadowColor||"black",this.style=e,this.dirty=!0},t.Text.prototype.setText=function(e){this.text=e.toString()||" ",this.dirty=!0},t.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution,this.context.font=this.style.font;var e=this.text;this.style.wordWrap&&(e=this.wordWrap(this.text));var t=e.split(/(?:\r\n|\r|\n)/),n=[],r=0,i=this.determineFontProperties(this.style.font);for(var s=0;s<t.length;s++){var o=this.context.measureText(t[s]).width;n[s]=o,r=Math.max(r,o)}var u=r+this.style.strokeThickness;this.style.dropShadow&&(u+=this.style.dropShadowDistance),this.canvas.width=(u+this.context.lineWidth)*this.resolution;var a=i.fontSize+this.style.strokeThickness,f=a*t.length;this.style.dropShadow&&(f+=this.style.dropShadowDistance),this.canvas.height=f*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="alphabetic",this.context.lineJoin="round";var l,c;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var h=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,p=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(s=0;s<t.length;s++)l=this.style.strokeThickness/2,c=this.style.strokeThickness/2+s*a+i.ascent,this.style.align==="right"?l+=r-n[s]:this.style.align==="center"&&(l+=(r-n[s])/2),this.style.fill&&this.context.fillText(t[s],l+h,c+p)}this.context.fillStyle=this.style.fill;for(s=0;s<t.length;s++)l=this.style.strokeThickness/2,c=this.style.strokeThickness/2+s*a+i.ascent,this.style.align==="right"?l+=r-n[s]:this.style.align==="center"&&(l+=(r-n[s])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(t[s],l,c),this.style.fill&&this.context.fillText(t[s],l,c);this.updateTexture()},t.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.texture.baseTexture.dirty()},t.Text.prototype._renderWebGL=function(e){this.dirty&&(this.resolution=e.resolution,this.updateText(),this.dirty=!1),t.Sprite.prototype._renderWebGL.call(this,e)},t.Text.prototype._renderCanvas=function(e){this.dirty&&(this.resolution=e.resolution,this.updateText(),this.dirty=!1),t.Sprite.prototype._renderCanvas.call(this,e)},t.Text.prototype.determineFontProperties=function(e){var n=t.Text.fontPropertiesCache[e];if(!n){n={};var r=t.Text.fontPropertiesCanvas,i=t.Text.fontPropertiesContext;i.font=e;var s=Math.ceil(i.measureText("|Mq").width),o=Math.ceil(i.measureText("M").width),u=2*o;o=o*1.4|0,r.width=s,r.height=u,i.fillStyle="#f00",i.fillRect(0,0,s,u),i.font=e,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText("|Mq",0,o);var a=i.getImageData(0,0,s,u).data,f=a.length,l=s*4,c,h,p=0,d=!1;for(c=0;c<o;c++){for(h=0;h<l;h+=4)if(a[p+h]!==255){d=!0;break}if(!!d)break;p+=l}n.ascent=o-c,p=f-l,d=!1;for(c=u;c>o;c--){for(h=0;h<l;h+=4)if(a[p+h]!==255){d=!0;break}if(!!d)break;p-=l}n.descent=c-o,n.fontSize=n.ascent+n.descent,t.Text.fontPropertiesCache[e]=n}return n},t.Text.prototype.wordWrap=function(e){var t="",n=e.split("\n");for(var r=0;r<n.length;r++){var i=this.style.wordWrapWidth,s=n[r].split(" ");for(var o=0;o<s.length;o++){var u=this.context.measureText(s[o]).width,a=u+this.context.measureText(" ").width;o===0||a>i?(o>0&&(t+="\n"),t+=s[o],i=this.style.wordWrapWidth-u):(i-=a,t+=" "+s[o])}r<n.length-1&&(t+="\n")}return t},t.Text.prototype.destroy=function(e){this.context=null,this.canvas=null,this.texture.destroy(e===undefined?!0:e)},t.Text.fontPropertiesCache={},t.Text.fontPropertiesCanvas=document.createElement("canvas"),t.Text.fontPropertiesContext=t.Text.fontPropertiesCanvas.getContext("2d"),t.BitmapText=function(e,n){t.DisplayObjectContainer.call(this),this.textWidth=0,this.textHeight=0,this._pool=[],this.setText(e),this.setStyle(n),this.updateText(),this.dirty=!1},t.BitmapText.prototype=Object.create(t.DisplayObjectContainer.prototype),t.BitmapText.prototype.constructor=t.BitmapText,t.BitmapText.prototype.setText=function(e){this.text=e||" ",this.dirty=!0},t.BitmapText.prototype.setStyle=function(e){e=e||{},e.align=e.align||"left",this.style=e;var n=e.font.split(" ");this.fontName=n[n.length-1],this.fontSize=n.length>=2?parseInt(n[n.length-2],10):t.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=e.tint},t.BitmapText.prototype.updateText=function(){var e=t.BitmapText.fonts[this.fontName],n=new t.Point,r=null,i=[],s=0,o=[],u=0,a=this.fontSize/e.size;for(var f=0;f<this.text.length;f++){var l=this.text.charCodeAt(f);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(f))){o.push(n.x),s=Math.max(s,n.x),u++,n.x=0,n.y+=e.lineHeight,r=null;continue}var c=e.chars[l];if(!c)continue;r&&c.kerning[r]&&(n.x+=c.kerning[r]),i.push({texture:c.texture,line:u,charCode:l,position:new t.Point(n.x+c.xOffset,n.y+c.yOffset)}),n.x+=c.xAdvance,r=l}o.push(n.x),s=Math.max(s,n.x);var h=[];for(f=0;f<=u;f++){var p=0;this.style.align==="right"?p=s-o[f]:this.style.align==="center"&&(p=(s-o[f])/2),h.push(p)}var d=this.children.length,v=i.length,m=this.tint||16777215;for(f=0;f<v;f++){var g=f<d?this.children[f]:this._pool.pop();g?g.setTexture(i[f].texture):g=new t.Sprite(i[f].texture),g.position.x=(i[f].position.x+h[i[f].line])*a,g.position.y=i[f].position.y*a,g.scale.x=g.scale.y=a,g.tint=m,g.parent||this.addChild(g)}while(this.children.length>v){var y=this.getChildAt(this.children.length-1);this._pool.push(y),this.removeChild(y)}this.textWidth=s*a,this.textHeight=(n.y+e.lineHeight)*a},t.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.BitmapText.fonts={},t.InteractionData=function(){this.global=new t.Point,this.target=null,this.originalEvent=null},t.InteractionData.prototype.getLocalPosition=function(e,n){var r=e.worldTransform,i=this.global,s=r.a,o=r.b,u=r.tx,a=r.c,f=r.d,l=r.ty,c=1/(s*f+o*-a);return n=n||new t.Point,n.x=f*c*i.x+ -o*c*i.y+(l*o-u*f)*c,n.y=s*c*i.y+ -a*c*i.x+(-l*s+u*a)*c,n},t.InteractionData.prototype.constructor=t.InteractionData,t.InteractionManager=function(e){this.stage=e,this.mouse=new t.InteractionData,this.touches={},this.tempPoint=new t.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1,this.resolution=1},t.InteractionManager.prototype.constructor=t.InteractionManager,t.InteractionManager.prototype.collectInteractiveSprite=function(e,t){var n=e.children,r=n.length;for(var i=r-1;i>=0;i--){var s=n[i];s._interactive?(t.interactiveChildren=!0,this.interactiveItems.push(s),s.children.length>0&&this.collectInteractiveSprite(s,s)):(s.__iParent=null,s.children.length>0&&this.collectInteractiveSprite(s,t))}},t.InteractionManager.prototype.setTarget=function(e){this.target=e,this.resolution=e.resolution;if(this.interactionDOMElement!==null)return;this.setTargetDomElement(e.view)},t.InteractionManager.prototype.setTargetDomElement=function(e){this.removeEvents(),window.navigator.msPointerEnabled&&(e.style["-ms-content-zooming"]="none",e.style["-ms-touch-action"]="none"),this.interactionDOMElement=e,e.addEventListener("mousemove",this.onMouseMove,!0),e.addEventListener("mousedown",this.onMouseDown,!0),e.addEventListener("mouseout",this.onMouseOut,!0),e.addEventListener("touchstart",this.onTouchStart,!0),e.addEventListener("touchend",this.onTouchEnd,!0),e.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},t.InteractionManager.prototype.removeEvents=function(){if(!this.interactionDOMElement)return;this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0)},t.InteractionManager.prototype.update=function(){if(!this.target)return;var e=Date.now(),n=e-this.last;n=n*t.INTERACTION_FREQUENCY/1e3;if(n<1)return;this.last=e;var r=0;this.dirty&&this.rebuildInteractiveGraph();var i=this.interactiveItems.length,s="inherit",o=!1;for(r=0;r<i;r++){var u=this.interactiveItems[r];u.__hit=this.hitTest(u,this.mouse),this.mouse.target=u,u.__hit&&!o?(u.buttonMode&&(s=u.defaultCursor),u.interactiveChildren||(o=!0),u.__isOver||(u.mouseover&&u.mouseover(this.mouse),u.__isOver=!0)):u.__isOver&&(u.mouseout&&u.mouseout(this.mouse),u.__isOver=!1)}this.currentCursorStyle!==s&&(this.currentCursorStyle=s,this.interactionDOMElement.style.cursor=s)},t.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;var e=this.interactiveItems.length;for(var t=0;t<e;t++)this.interactiveItems[t].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)},t.InteractionManager.prototype.onMouseMove=function(e){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=e;var t=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(e.clientX-t.left)*(this.target.width/t.width)/this.resolution,this.mouse.global.y=(e.clientY-t.top)*(this.target.height/t.height)/this.resolution;var n=this.interactiveItems.length;for(var r=0;r<n;r++){var i=this.interactiveItems[r];i.mousemove&&i.mousemove(this.mouse)}},t.InteractionManager.prototype.onMouseDown=function(e){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=e,t.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();var n=this.interactiveItems.length,r=this.mouse.originalEvent,i=r.button===2||r.which===3,s=i?"rightdown":"mousedown",o=i?"rightclick":"click",u=i?"__rightIsDown":"__mouseIsDown",a=i?"__isRightDown":"__isDown";for(var f=0;f<n;f++){var l=this.interactiveItems[f];if(l[s]||l[o]){l[u]=!0,l.__hit=this.hitTest(l,this.mouse);if(l.__hit){l[s]&&l[s](this.mouse),l[a]=!0;if(!l.interactiveChildren)break}}}},t.InteractionManager.prototype.onMouseOut=function(e){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=e;var t=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var n=0;n<t;n++){var r=this.interactiveItems[n];r.__isOver&&(this.mouse.target=r,r.mouseout&&r.mouseout(this.mouse),r.__isOver=!1)}this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},t.InteractionManager.prototype.onMouseUp=function(e){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=e;var t=this.interactiveItems.length,n=!1,r=this.mouse.originalEvent,i=r.button===2||r.which===3,s=i?"rightup":"mouseup",o=i?"rightclick":"click",u=i?"rightupoutside":"mouseupoutside",a=i?"__isRightDown":"__isDown";for(var f=0;f<t;f++){var l=this.interactiveItems[f];if(l[o]||l[s]||l[u])l.__hit=this.hitTest(l,this.mouse),l.__hit&&!n?(l[s]&&l[s](this.mouse),l[a]&&l[o]&&l[o](this.mouse),l.interactiveChildren||(n=!0)):l[a]&&l[u]&&l[u](this.mouse),l[a]=!1}},t.InteractionManager.prototype.hitTest=function(e,n){var r=n.global;if(!e.worldVisible)return!1;var i=e.worldTransform,s,o=i.a,u=i.b,a=i.c,f=i.tx,l=i.d,c=i.ty,h=1/(o*l+a*-u),p=l*h*r.x+ -a*h*r.y+(c*a-f*l)*h,d=o*h*r.y+ -u*h*r.x+(-c*o+f*u)*h;n.target=e;if(e.hitArea&&e.hitArea.contains)return e.hitArea.contains(p,d)?(n.target=e,!0):!1;if(e instanceof t.Sprite){var v=e.texture.frame.width,m=e.texture.frame.height,g=-v*e.anchor.x,y;if(p>g&&p<g+v){y=-m*e.anchor.y;if(d>y&&d<y+m)return n.target=e,!0}}else if(e instanceof t.Graphics){var b=e.graphicsData;for(s=0;s<b.length;s++){var w=b[s];if(!w.fill)continue;if(w.shape&&w.shape.contains(p,d))return n.target=e,!0}}var E=e.children.length;for(s=0;s<E;s++){var S=e.children[s],x=this.hitTest(S,n);if(x)return n.target=e,!0}return!1},t.InteractionManager.prototype.onTouchMove=function(e){this.dirty&&this.rebuildInteractiveGraph();var t=this.interactionDOMElement.getBoundingClientRect(),n=e.changedTouches,r,i=0;for(i=0;i<n.length;i++){var s=n[i];r=this.touches[s.identifier],r.originalEvent=e,r.global.x=(s.clientX-t.left)*(this.target.width/t.width)/this.resolution,r.global.y=(s.clientY-t.top)*(this.target.height/t.height)/this.resolution,navigator.isCocoonJS&&!t.left&&!t.top&&!e.target.style.width&&!e.target.style.height&&(r.global.x=s.clientX,r.global.y=s.clientY);for(var o=0;o<this.interactiveItems.length;o++){var u=this.interactiveItems[o];u.touchmove&&u.__touchData&&u.__touchData[s.identifier]&&u.touchmove(r)}}},t.InteractionManager.prototype.onTouchStart=function(e){this.dirty&&this.rebuildInteractiveGraph();var n=this.interactionDOMElement.getBoundingClientRect();t.AUTO_PREVENT_DEFAULT&&e.preventDefault();var r=e.changedTouches;for(var i=0;i<r.length;i++){var s=r[i],o=this.pool.pop();o||(o=new t.InteractionData),o.originalEvent=e,this.touches[s.identifier]=o,o.global.x=(s.clientX-n.left)*(this.target.width/n.width)/this.resolution,o.global.y=(s.clientY-n.top)*(this.target.height/n.height)/this.resolution,navigator.isCocoonJS&&!n.left&&!n.top&&!e.target.style.width&&!e.target.style.height&&(o.global.x=s.clientX,o.global.y=s.clientY);var u=this.interactiveItems.length;for(var a=0;a<u;a++){var f=this.interactiveItems[a];if(f.touchstart||f.tap){f.__hit=this.hitTest(f,o);if(f.__hit){f.touchstart&&f.touchstart(o),f.__isDown=!0,f.__touchData=f.__touchData||{},f.__touchData[s.identifier]=o;if(!f.interactiveChildren)break}}}}},t.InteractionManager.prototype.onTouchEnd=function(e){this.dirty&&this.rebuildInteractiveGraph();var t=this.interactionDOMElement.getBoundingClientRect(),n=e.changedTouches;for(var r=0;r<n.length;r++){var i=n[r],s=this.touches[i.identifier],o=!1;s.global.x=(i.clientX-t.left)*(this.target.width/t.width)/this.resolution,s.global.y=(i.clientY-t.top)*(this.target.height/t.height)/this.resolution,navigator.isCocoonJS&&!t.left&&!t.top&&!e.target.style.width&&!e.target.style.height&&(s.global.x=i.clientX,s.global.y=i.clientY);var u=this.interactiveItems.length;for(var a=0;a<u;a++){var f=this.interactiveItems[a];if(f.__touchData&&f.__touchData[i.identifier]){f.__hit=this.hitTest(f,f.__touchData[i.identifier]),s.originalEvent=e;if(f.touchend||f.tap)f.__hit&&!o?(f.touchend&&f.touchend(s),f.__isDown&&f.tap&&f.tap(s),f.interactiveChildren||(o=!0)):f.__isDown&&f.touchendoutside&&f.touchendoutside(s),f.__isDown=!1;f.__touchData[i.identifier]=null}}this.pool.push(s),this.touches[i.identifier]=null}},t.Stage=function(e){t.DisplayObjectContainer.call(this),this.worldTransform=new t.Matrix,this.interactive=!0,this.interactionManager=new t.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new t.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(e)},t.Stage.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Stage.prototype.constructor=t.Stage,t.Stage.prototype.setInteractionDelegate=function(e){this.interactionManager.setTargetDomElement(e)},t.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var e=0,t=this.children.length;e<t;e++)this.children[e].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},t.Stage.prototype.setBackgroundColor=function(e){this.backgroundColor=e||0,this.backgroundColorSplit=t.hex2rgb(this.backgroundColor);var n=this.backgroundColor.toString(16);n="000000".substr(0,6-n.length)+n,this.backgroundColorString="#"+n},t.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},function(e){var t=0,n=["ms","moz","webkit","o"];for(var r=0;r<n.length&&!e.requestAnimationFrame;++r)e.requestAnimationFrame=e[n[r]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[r]+"CancelAnimationFrame"]||e[n[r]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(n){var r=(new Date).getTime(),i=Math.max(0,16-(r-t)),s=e.setTimeout(function(){n(r+i)},i);return t=r+i,s}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)}),e.requestAnimFrame=e.requestAnimationFrame}(this),t.hex2rgb=function(e){return[(e>>16&255)/255,(e>>8&255)/255,(e&255)/255]},t.rgb2hex=function(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255},typeof Function.prototype.bind!="function"&&(Function.prototype.bind=function(){return function(e){function i(){var n=arguments.length,s=new Array(n);while(n--)s[n]=arguments[n];return s=r.concat(s),t.apply(this instanceof i?this:e,s)}var t=this,n=arguments.length-1,r=[];if(n>0){r.length=n;while(n--)r[n]=arguments[n+1]}if(typeof t!="function")throw new TypeError;return i.prototype=function s(e){e&&(s.prototype=e);if(!(this instanceof s))return new s}(t.prototype),i}}()),t.AjaxRequest=function(){var e=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var t=0;t<e.length;t++)try{return new window.ActiveXObject(e[t])}catch(n){}},t.canUseNewCanvasBlendModes=function(){if(typeof document=="undefined")return!1;var e=document.createElement("canvas");e.width=1,e.height=1;var t=e.getContext("2d");return t.fillStyle="#000",t.fillRect(0,0,1,1),t.globalCompositeOperation="multiply",t.fillStyle="#fff",t.fillRect(0,0,1,1),t.getImageData(0,0,1,1).data[0]===0},t.getNextPowerOfTwo=function(e){if(e>0&&(e&e-1)===0)return e;var t=1;while(t<e)t<<=1;return t},t.EventTarget={call:function(n){n&&(n=n.prototype||n,t.EventTarget.mixin(n))},mixin:function(n){n.listeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?this._listeners[t].slice():[]},n.emit=n.dispatchEvent=function(n,r){this._listeners=this._listeners||{},typeof n=="object"&&(r=n,n=n.type);if(!r||r.__isEventObject!==!0)r=new t.Event(this,n,r);if(this._listeners&&this._listeners[n]){var i=this._listeners[n],s=i.length,o=i[0],u;for(u=0;u<s;o=i[++u]){o.call(this,r);if(r.stoppedImmediate)return this}if(r.stopped)return this}return this.parent&&this.parent.emit&&this.parent.emit.call(this.parent,n,r),this},n.on=n.addEventListener=function(t,n){return this._listeners=this._listeners||{},(this._listeners[t]=this._listeners[t]||[]).push(n),this},n.once=function(t,n){function i(){n.apply(r.off(t,i),arguments)}this._listeners=this._listeners||{};var r=this;return i._originalHandler=n,this.on(t,i)},n.off=n.removeEventListener=function(t,n){this._listeners=this._listeners||{};if(!this._listeners[t])return this;var r=this._listeners[t],i=n?r.length:0;while(i-->0)(r[i]===n||r[i]._originalHandler===n)&&r.splice(i,1);return r.length===0&&delete this._listeners[t],this},n.removeAllListeners=function(t){return this._listeners=this._listeners||{},this._listeners[t]?(delete this._listeners[t],this):this}}},t.Event=function(e,t,n){this.__isEventObject=!0,this.stopped=!1,this.stoppedImmediate=!1,this.target=e,this.type=t,this.data=n,this.content=n,this.timeStamp=Date.now()},t.Event.prototype.stopPropagation=function(){this.stopped=!0},t.Event.prototype.stopImmediatePropagation=function(){this.stoppedImmediate=!0},t.autoDetectRenderer=function(e,n,r){e||(e=800),n||(n=600);var i=function(){try{var e=document.createElement("canvas");return!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(t){return!1}}();return i?new t.WebGLRenderer(e,n,r):new t.CanvasRenderer(e,n,r)},t.autoDetectRecommendedRenderer=function(e,n,r){e||(e=800),n||(n=600);var i=function(){try{var e=document.createElement("canvas");return!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(t){return!1}}(),s=/Android/i.test(navigator.userAgent);return i&&!s?new t.WebGLRenderer(e,n,r):new t.CanvasRenderer(e,n,r)},t.PolyK={},t.PolyK.Triangulate=function(e){var n=!0,r=e.length>>1;if(r<3)return[];var i=[],s=[];for(var o=0;o<r;o++)s.push(o);o=0;var u=r;while(u>3){var a=s[(o+0)%u],f=s[(o+1)%u],l=s[(o+2)%u],c=e[2*a],h=e[2*a+1],p=e[2*f],d=e[2*f+1],v=e[2*l],m=e[2*l+1],g=!1;if(t.PolyK._convex(c,h,p,d,v,m,n)){g=!0;for(var y=0;y<u;y++){var b=s[y];if(b===a||b===f||b===l)continue;if(t.PolyK._PointInTriangle(e[2*b],e[2*b+1],c,h,p,d,v,m)){g=!1;break}}}if(g)i.push(a,f,l),s.splice((o+1)%u,1),u--,o=0;else if(o++>3*u){if(!n)return window.console.log("PIXI Warning: shape too complex to fill"),[];i=[],s=[];for(o=0;o<r;o++)s.push(o);o=0,u=r,n=!1}}return i.push(s[0],s[1],s[2]),i},t.PolyK._PointInTriangle=function(e,t,n,r,i,s,o,u){var a=o-n,f=u-r,l=i-n,c=s-r,h=e-n,p=t-r,d=a*a+f*f,v=a*l+f*c,m=a*h+f*p,g=l*l+c*c,y=l*h+c*p,b=1/(d*g-v*v),w=(g*m-v*y)*b,E=(d*y-v*m)*b;return w>=0&&E>=0&&w+E<1},t.PolyK._convex=function(e,t,n,r,i,s,o){return(t-r)*(i-n)+(n-e)*(s-r)>=0===o},t.initDefaultShaders=function(){},t.CompileVertexShader=function(e,n){return t._CompileShader(e,n,e.VERTEX_SHADER)},t.CompileFragmentShader=function(e,n){return t._CompileShader(e,n,e.FRAGMENT_SHADER)},t._CompileShader=function(e,t,n){var r=t.join("\n"),i=e.createShader(n);return e.shaderSource(i,r),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(window.console.log(e.getShaderInfoLog(i)),null)},t.compileProgram=function(e,n,r){var i=t.CompileFragmentShader(e,r),s=t.CompileVertexShader(e,n),o=e.createProgram();return e.attachShader(o,s),e.attachShader(o,i),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)||window.console.log("Could not initialise shaders"),o},t.PixiShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.firstRun=!0,this.dirty=!0,this.attributes=[],this.init()},t.PixiShader.prototype.constructor=t.PixiShader,t.PixiShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc||t.PixiShader.defaultVertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.dimensions=e.getUniformLocation(n,"dimensions"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.colorAttribute===-1&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var r in this.uniforms)this.uniforms[r].uniformLocation=e.getUniformLocation(n,r);this.initUniforms(),this.program=n},t.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var e=this.gl,t;for(var n in this.uniforms){t=this.uniforms[n];var r=t.type;r==="sampler2D"?(t._init=!1,t.value!==null&&this.initSampler2D(t)):r==="mat2"||r==="mat3"||r==="mat4"?(t.glMatrix=!0,t.glValueLength=1,r==="mat2"?t.glFunc=e.uniformMatrix2fv:r==="mat3"?t.glFunc=e.uniformMatrix3fv:r==="mat4"&&(t.glFunc=e.uniformMatrix4fv)):(t.glFunc=e["uniform"+r],r==="2f"||r==="2i"?t.glValueLength=2:r==="3f"||r==="3i"?t.glValueLength=3:r==="4f"||r==="4i"?t.glValueLength=4:t.glValueLength=1)}},t.PixiShader.prototype.initSampler2D=function(e){if(!e.value||!e.value.baseTexture||!e.value.baseTexture.hasLoaded)return;var t=this.gl;t.activeTexture(t["TEXTURE"+this.textureCount]),t.bindTexture(t.TEXTURE_2D,e.value.baseTexture._glTextures[t.id]);if(e.textureData){var n=e.textureData,r=n.magFilter?n.magFilter:t.LINEAR,i=n.minFilter?n.minFilter:t.LINEAR,s=n.wrapS?n.wrapS:t.CLAMP_TO_EDGE,o=n.wrapT?n.wrapT:t.CLAMP_TO_EDGE,u=n.luminance?t.LUMINANCE:t.RGBA;n.repeat&&(s=t.REPEAT,o=t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!!n.flipY);if(n.width){var a=n.width?n.width:512,f=n.height?n.height:2,l=n.border?n.border:0;t.texImage2D(t.TEXTURE_2D,0,u,a,f,l,u,t.UNSIGNED_BYTE,null)}else t.texImage2D(t.TEXTURE_2D,0,u,t.RGBA,t.UNSIGNED_BYTE,e.value.baseTexture.source);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,o)}t.uniform1i(e.uniformLocation,this.textureCount),e._init=!0,this.textureCount++},t.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var e,n=this.gl;for(var r in this.uniforms)e=this.uniforms[r],e.glValueLength===1?e.glMatrix===!0?e.glFunc.call(n,e.uniformLocation,e.transpose,e.value):e.glFunc.call(n,e.uniformLocation,e.value):e.glValueLength===2?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y):e.glValueLength===3?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y,e.value.z):e.glValueLength===4?e.glFunc.call(n,e.uniformLocation,e.value.x,e.value.y,e.value.z,e.value.w):e.type==="sampler2D"&&(e._init?(n.activeTexture(n["TEXTURE"+this.textureCount]),e.value.baseTexture._dirty[n.id]?t.defaultRenderer.updateTexture(e.value.baseTexture):n.bindTexture(n.TEXTURE_2D,e.value.baseTexture._glTextures[n.id]),n.uniform1i(e.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(e))},t.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"],t.PixiFastShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},t.PixiFastShader.prototype.constructor=t.PixiFastShader,t.PixiFastShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.dimensions=e.getUniformLocation(n,"dimensions"),this.uMatrix=e.getUniformLocation(n,"uMatrix"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aPositionCoord=e.getAttribLocation(n,"aPositionCoord"),this.aScale=e.getAttribLocation(n,"aScale"),this.aRotation=e.getAttribLocation(n,"aRotation"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.colorAttribute===-1&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=n},t.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.StripShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},t.StripShader.prototype.constructor=t.StripShader,t.StripShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.uSampler=e.getUniformLocation(n,"uSampler"),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.aTextureCoord=e.getAttribLocation(n,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.PrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},t.PrimitiveShader.prototype.constructor=t.PrimitiveShader,t.PrimitiveShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.tintColor=e.getUniformLocation(n,"tint"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.colorAttribute=e.getAttribLocation(n,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},t.ComplexPrimitiveShader=function(e){this._UID=t._UID++,this.gl=e,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},t.ComplexPrimitiveShader.prototype.constructor=t.ComplexPrimitiveShader,t.ComplexPrimitiveShader.prototype.init=function(){var e=this.gl,n=t.compileProgram(e,this.vertexSrc,this.fragmentSrc);e.useProgram(n),this.projectionVector=e.getUniformLocation(n,"projectionVector"),this.offsetVector=e.getUniformLocation(n,"offsetVector"),this.tintColor=e.getUniformLocation(n,"tint"),this.color=e.getUniformLocation(n,"color"),this.aVertexPosition=e.getAttribLocation(n,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=e.getUniformLocation(n,"translationMatrix"),this.alpha=e.getUniformLocation(n,"alpha"),this.program=n},t.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},t.WebGLGraphics=function(){},t.WebGLGraphics.renderGraphics=function(e,n){var r=n.gl,i=n.projection,s=n.offset,o=n.shaderManager.primitiveShader,u;e.dirty&&t.WebGLGraphics.updateGraphics(e,r);var a=e._webGL[r.id];for(var f=0;f<a.data.length;f++)a.data[f].mode===1?(u=a.data[f],n.stencilManager.pushStencil(e,u,n),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(u.indices.length-4)*2),n.stencilManager.popStencil(e,u,n)):(u=a.data[f],n.shaderManager.setShader(o),o=n.shaderManager.primitiveShader,r.uniformMatrix3fv(o.translationMatrix,!1,e.worldTransform.toArray(!0)),r.uniform2f(o.projectionVector,i.x,-i.y),r.uniform2f(o.offsetVector,-s.x,-s.y),r.uniform3fv(o.tintColor,t.hex2rgb(e.tint)),r.uniform1f(o.alpha,e.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,u.buffer),r.vertexAttribPointer(o.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(o.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,u.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,u.indices.length,r.UNSIGNED_SHORT,0))},t.WebGLGraphics.updateGraphics=function(e,n){var r=e._webGL[n.id];r||(r=e._webGL[n.id]={lastIndex:0,data:[],gl:n}),e.dirty=!1;var i;if(e.clearDirty){e.clearDirty=!1;for(i=0;i<r.data.length;i++){var s=r.data[i];s.reset(),t.WebGLGraphics.graphicsDataPool.push(s)}r.data=[],r.lastIndex=0}var o;for(i=r.lastIndex;i<e.graphicsData.length;i++){var u=e.graphicsData[i];u.type===t.Graphics.POLY?(u.points=u.shape.points.slice(),u.shape.closed&&u.points[0]!==u.points[u.points.length-2]&&u.points[1]!==u.points[u.points.length-1]&&u.points.push(u.points[0],u.points[1]),u.fill&&u.points.length>=6&&(u.points.length>10?(o=t.WebGLGraphics.switchMode(r,1),t.WebGLGraphics.buildComplexPoly(u,o)):(o=t.WebGLGraphics.switchMode(r,0),t.WebGLGraphics.buildPoly(u,o))),u.lineWidth>0&&(o=t.WebGLGraphics.switchMode(r,0),t.WebGLGraphics.buildLine(u,o))):(o=t.WebGLGraphics.switchMode(r,0),u.type===t.Graphics.RECT?t.WebGLGraphics.buildRectangle(u,o):u.type===t.Graphics.CIRC||u.type===t.Graphics.ELIP?t.WebGLGraphics.buildCircle(u,o):u.type===t.Graphics.RREC&&t.WebGLGraphics.buildRoundedRectangle(u,o)),r.lastIndex++}for(i=0;i<r.data.length;i++)o=r.data[i],o.dirty&&o.upload()},t.WebGLGraphics.switchMode=function(e,n){var r;if(!e.data.length)r=t.WebGLGraphics.graphicsDataPool.pop()||new t.WebGLGraphicsData(e.gl),r.mode=n,e.data.push(r);else{r=e.data[e.data.length-1];if(r.mode!==n||n===1)r=t.WebGLGraphics.graphicsDataPool.pop()||new t.WebGLGraphicsData(e.gl),r.mode=n,e.data.push(r)}return r.dirty=!0,r},t.WebGLGraphics.buildRectangle=function(e,n){var r=e.shape,i=r.x,s=r.y,o=r.width,u=r.height;if(e.fill){var a=t.hex2rgb(e.fillColor),f=e.fillAlpha,l=a[0]*f,c=a[1]*f,h=a[2]*f,p=n.points,d=n.indices,v=p.length/6;p.push(i,s),p.push(l,c,h,f),p.push(i+o,s),p.push(l,c,h,f),p.push(i,s+u),p.push(l,c,h,f),p.push(i+o,s+u),p.push(l,c,h,f),d.push(v,v,v+1,v+2,v+3,v+3)}if(e.lineWidth){var m=e.points;e.points=[i,s,i+o,s,i+o,s+u,i,s+u,i,s],t.WebGLGraphics.buildLine(e,n),e.points=m}},t.WebGLGraphics.buildRoundedRectangle=function(e,n){var r=e.shape.points,i=r[0],s=r[1],o=r[2],u=r[3],a=r[4],f=[];f.push(i,s+a),f=f.concat(t.WebGLGraphics.quadraticBezierCurve(i,s+u-a,i,s+u,i+a,s+u)),f=f.concat(t.WebGLGraphics.quadraticBezierCurve(i+o-a,s+u,i+o,s+u,i+o,s+u-a)),f=f.concat(t.WebGLGraphics.quadraticBezierCurve(i+o,s+a,i+o,s,i+o-a,s)),f=f.concat(t.WebGLGraphics.quadraticBezierCurve(i+a,s,i,s,i,s+a));if(e.fill){var l=t.hex2rgb(e.fillColor),c=e.fillAlpha,h=l[0]*c,p=l[1]*c,d=l[2]*c,v=n.points,m=n.indices,g=v.length/6,y=t.PolyK.Triangulate(f),b=0;for(b=0;b<y.length;b+=3)m.push(y[b]+g),m.push(y[b]+g),m.push(y[b+1]+g),m.push(y[b+2]+g),m.push(y[b+2]+g);for(b=0;b<f.length;b++)v.push(f[b],f[++b],h,p,d,c)}if(e.lineWidth){var w=e.points;e.points=f,t.WebGLGraphics.buildLine(e,n),e.points=w}},t.WebGLGraphics.quadraticBezierCurve=function(e,t,n,r,i,s){function d(e,t,n){var r=t-e;return e+r*n}var o,u,a,f,l,c,h=20,p=[],v=0;for(var m=0;m<=h;m++)v=m/h,o=d(e,n,v),u=d(t,r,v),a=d(n,i,v),f=d(r,s,v),l=d(o,a,v),c=d(u,f,v),p.push(l,c);return p},t.WebGLGraphics.buildCircle=function(e,n){var r=e.shape,i=r.x,s=r.y,o,u;e.type===t.Graphics.CIRC?(o=r.radius,u=r.radius):(o=r.width,u=r.height);var a=40,f=Math.PI*2/a,l=0;if(e.fill){var c=t.hex2rgb(e.fillColor),h=e.fillAlpha,p=c[0]*h,d=c[1]*h,v=c[2]*h,m=n.points,g=n.indices,y=m.length/6;g.push(y);for(l=0;l<a+1;l++)m.push(i,s,p,d,v,h),m.push(i+Math.sin(f*l)*o,s+Math.cos(f*l)*u,p,d,v,h),g.push(y++,y++);g.push(y-1)}if(e.lineWidth){var b=e.points;e.points=[];for(l=0;l<a+1;l++)e.points.push(i+Math.sin(f*l)*o,s+Math.cos(f*l)*u);t.WebGLGraphics.buildLine(e,n),e.points=b}},t.WebGLGraphics.buildLine=function(e,n){var r=0,i=e.points;if(i.length===0)return;if(e.lineWidth%2)for(r=0;r<i.length;r++)i[r]+=.5;var s=new t.Point(i[0],i[1]),o=new t.Point(i[i.length-2],i[i.length-1]);if(s.x===o.x&&s.y===o.y){i=i.slice(),i.pop(),i.pop(),o=new t.Point(i[i.length-2],i[i.length-1]);var u=o.x+(s.x-o.x)*.5,a=o.y+(s.y-o.y)*.5;i.unshift(u,a),i.push(u,a)}var f=n.points,l=n.indices,c=i.length/2,h=i.length,p=f.length/6,d=e.lineWidth/2,v=t.hex2rgb(e.lineColor),m=e.lineAlpha,g=v[0]*m,y=v[1]*m,b=v[2]*m,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U;S=i[0],x=i[1],T=i[2],N=i[3],L=-(x-N),A=S-T,U=Math.sqrt(L*L+A*A),L/=U,A/=U,L*=d,A*=d,f.push(S-L,x-A,g,y,b,m),f.push(S+L,x+A,g,y,b,m);for(r=1;r<c-1;r++){S=i[(r-1)*2],x=i[(r-1)*2+1],T=i[r*2],N=i[r*2+1],C=i[(r+1)*2],k=i[(r+1)*2+1],L=-(x-N),A=S-T,U=Math.sqrt(L*L+A*A),L/=U,A/=U,L*=d,A*=d,O=-(N-k),M=T-C,U=Math.sqrt(O*O+M*M),O/=U,M/=U,O*=d,M*=d,P=-A+x-(-A+N),H=-L+T-(-L+S),B=(-L+S)*(-A+N)-(-L+T)*(-A+x),j=-M+k-(-M+N),F=-O+T-(-O+C),I=(-O+C)*(-M+N)-(-O+T)*(-M+k),q=P*F-j*H;if(Math.abs(q)<.1){q+=10.1,f.push(T-L,N-A,g,y,b,m),f.push(T+L,N+A,g,y,b,m);continue}w=(H*I-F*B)/q,E=(j*B-P*I)/q,R=(w-T)*(w-T)+(E-N)+(E-N),R>19600?(_=L-O,D=A-M,U=Math.sqrt(_*_+D*D),_/=U,D/=U,_*=d,D*=d,f.push(T-_,N-D),f.push(g,y,b,m),f.push(T+_,N+D),f.push(g,y,b,m),f.push(T-_,N-D),f.push(g,y,b,m),h++):(f.push(w,E),f.push(g,y,b,m),f.push(T-(w-T),N-(E-N)),f.push(g,y,b,m))}S=i[(c-2)*2],x=i[(c-2)*2+1],T=i[(c-1)*2],N=i[(c-1)*2+1],L=-(x-N),A=S-T,U=Math.sqrt(L*L+A*A),L/=U,A/=U,L*=d,A*=d,f.push(T-L,N-A),f.push(g,y,b,m),f.push(T+L,N+A),f.push(g,y,b,m),l.push(p);for(r=0;r<h;r++)l.push(p++);l.push(p-1)},t.WebGLGraphics.buildComplexPoly=function(e,n){var r=e.points.slice();if(r.length<6)return;var i=n.indices;n.points=r,n.alpha=e.fillAlpha,n.color=t.hex2rgb(e.fillColor);var s=Infinity,o=-Infinity,u=Infinity,a=-Infinity,f,l;for(var c=0;c<r.length;c+=2)f=r[c],l=r[c+1],s=f<s?f:s,o=f>o?f:o,u=l<u?l:u,a=l>a?l:a;r.push(s,u,o,u,o,a,s,a);var h=r.length/2;for(c=0;c<h;c++)i.push(c)},t.WebGLGraphics.buildPoly=function(e,n){var r=e.points;if(r.length<6)return;var i=n.points,s=n.indices,o=r.length/2,u=t.hex2rgb(e.fillColor),a=e.fillAlpha,f=u[0]*a,l=u[1]*a,c=u[2]*a,h=t.PolyK.Triangulate(r),p=i.length/6,d=0;for(d=0;d<h.length;d+=3)s.push(h[d]+p),s.push(h[d]+p),s.push(h[d+1]+p),s.push(h[d+2]+p),s.push(h[d+2]+p);for(d=0;d<o;d++)i.push(r[d*2],r[d*2+1],f,l,c,a)},t.WebGLGraphics.graphicsDataPool=[],t.WebGLGraphicsData=function(e){this.gl=e,this.color=[0,0,0],this.points=[],this.indices=[],this.lastIndex=0,this.buffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},t.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[],this.lastIndex=0},t.WebGLGraphicsData.prototype.upload=function(){var e=this.gl;this.glPoints=new Float32Array(this.points),e.bindBuffer(e.ARRAY_BUFFER,this.buffer),e.bufferData(e.ARRAY_BUFFER,this.glPoints,e.STATIC_DRAW),this.glIndicies=new Uint16Array(this.indices),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.glIndicies,e.STATIC_DRAW),this.dirty=!1},t.glContexts=[],t.WebGLRenderer=function(e,n,r){if(r)for(var i in t.defaultRenderOptions)typeof r[i]=="undefined"&&(r[i]=t.defaultRenderOptions[i]);else r=t.defaultRenderOptions;t.defaultRenderer||(t.sayHello("webGL"),t.defaultRenderer=this),this.type=t.WEBGL_RENDERER,this.resolution=r.resolution,this.transparent=r.transparent,this.preserveDrawingBuffer=r.preserveDrawingBuffer,this.clearBeforeRender=r.clearBeforeRender,this.width=e||800,this.height=n||600,this.view=r.view||document.createElement("canvas"),this.contextLostBound=this.handleContextLost.bind(this),this.contextRestoredBound=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLostBound,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredBound,!1),this._contextOptions={alpha:this.transparent,antialias:r.antialias,premultipliedAlpha:this.transparent&&this.transparent!=="notMultiplied",stencil:!0,preserveDrawingBuffer:r.preserveDrawingBuffer},this.projection=new t.Point,this.offset=new t.Point(0,0),this.shaderManager=new t.WebGLShaderManager,this.spriteBatch=new t.WebGLSpriteBatch,this.maskManager=new t.WebGLMaskManager,this.filterManager=new t.WebGLFilterManager,this.stencilManager=new t.WebGLStencilManager,this.blendModeManager=new t.WebGLBlendModeManager,this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,this.renderSession.resolution=this.resolution,this.initContext(),this.mapBlendModes()},t.WebGLRenderer.prototype.constructor=t.WebGLRenderer,t.WebGLRenderer.prototype.initContext=function(){var e=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);this.gl=e;if(!e)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=e.id=t.WebGLRenderer.glContextId++,t.glContexts[this.glContextId]=e,e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.enable(e.BLEND),this.shaderManager.setContext(e),this.spriteBatch.setContext(e),this.maskManager.setContext(e),this.filterManager.setContext(e),this.blendModeManager.setContext(e),this.stencilManager.setContext(e),this.renderSession.gl=this.gl,this.resize(this.width,this.height)},t.WebGLRenderer.prototype.render=function(e){if(this.contextLost)return;this.__stage!==e&&(e.interactive&&e.interactionManager.removeEvents(),this.__stage=e),e.updateTransform();var t=this.gl;e._interactive?e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this)):e._interactiveEventsAdded&&(e._interactiveEventsAdded=!1,e.interactionManager.setTarget(this)),t.viewport(0,0,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?t.clearColor(0,0,0,0):t.clearColor(e.backgroundColorSplit[0],e.backgroundColorSplit[1],e.backgroundColorSplit[2],1),t.clear(t.COLOR_BUFFER_BIT)),this.renderDisplayObject(e,this.projection)},t.WebGLRenderer.prototype.renderDisplayObject=function(e,n,r){this.renderSession.blendModeManager.setBlendMode(t.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.projection=n,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,r),e._renderWebGL(this.renderSession),this.spriteBatch.end()},t.WebGLRenderer.prototype.resize=function(e,t){this.width=e*this.resolution,this.height=t*this.resolution,this.view.width=this.width,this.view.height=this.height,this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2/this.resolution,this.projection.y=-this.height/2/this.resolution},t.WebGLRenderer.prototype.updateTexture=function(e){if(!e.hasLoaded)return;var n=this.gl;return e._glTextures[n.id]||(e._glTextures[n.id]=n.createTexture()),n.bindTexture(n.TEXTURE_2D,e._glTextures[n.id]),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultipliedAlpha),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e.source),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR:n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e.scaleMode===t.scaleModes.LINEAR?n.LINEAR:n.NEAREST),e._powerOf2?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),e._dirty[n.id]=!1,e._glTextures[n.id]},t.WebGLRenderer.prototype.handleContextLost=function(e){e.preventDefault(),this.contextLost=!0},t.WebGLRenderer.prototype.handleContextRestored=function(){this.initContext();for(var e in t.TextureCache){var n=t.TextureCache[e].baseTexture;n._glTextures=[]}this.contextLost=!1},t.WebGLRenderer.prototype.destroy=function(){this.view.off("webglcontextlost",this.contextLostBound),this.view.off("webglcontextrestored",this.contextRestoredBound),t.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},t.WebGLRenderer.prototype.mapBlendModes=function(){var e=this.gl;t.blendModesWebGL||(t.blendModesWebGL=[],t.blendModesWebGL[t.blendModes.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.ADD]=[e.SRC_ALPHA,e.DST_ALPHA],t.blendModesWebGL[t.blendModes.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SCREEN]=[e.SRC_ALPHA,e.ONE],t.blendModesWebGL[t.blendModes.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t.blendModesWebGL[t.blendModes.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA])},t.WebGLRenderer.glContextId=0,t.WebGLBlendModeManager=function(){this.currentBlendMode=99999},t.WebGLBlendModeManager.prototype.constructor=t.WebGLBlendModeManager,t.WebGLBlendModeManager.prototype.setContext=function(e){this.gl=e},t.WebGLBlendModeManager.prototype.setBlendMode=function(e){if(this.currentBlendMode===e)return!1;this.currentBlendMode=e;var n=t.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(n[0],n[1]),!0},t.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},t.WebGLMaskManager=function(){},t.WebGLMaskManager.prototype.constructor=t.WebGLMaskManager,t.WebGLMaskManager.prototype.setContext=function(e){this.gl=e},t.WebGLMaskManager.prototype.pushMask=function(e,n){var r=n.gl;e.dirty&&t.WebGLGraphics.updateGraphics(e,r);if(!e._webGL[r.id].data.length)return;n.stencilManager.pushStencil(e,e._webGL[r.id].data[0],n)},t.WebGLMaskManager.prototype.popMask=function(e,t){var n=this.gl;t.stencilManager.popStencil(e,e._webGL[n.id].data[0],t)},t.WebGLMaskManager.prototype.destroy=function(){this.gl=null},t.WebGLStencilManager=function(){this.stencilStack=[],this.reverse=!0,this.count=0},t.WebGLStencilManager.prototype.setContext=function(e){this.gl=e},t.WebGLStencilManager.prototype.pushStencil=function(e,t,n){var r=this.gl;this.bindGraphics(e,t,n),this.stencilStack.length===0&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(t);var i=this.count;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),t.mode===1?(r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-i,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,i,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(t.indices.length-4)*2),this.reverse?r.stencilFunc(r.EQUAL,255-(i+1),255):r.stencilFunc(r.EQUAL,i+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,i,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-i,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,i+1,255):r.stencilFunc(r.EQUAL,255-(i+1),255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),this.count++},t.WebGLStencilManager.prototype.bindGraphics=function(e,n,r){this._currentGraphics=e;var i=this.gl,s=r.projection,o=r.offset,u;n.mode===1?(u=r.shaderManager.complexPrimitiveShader,r.shaderManager.setShader(u),i.uniformMatrix3fv(u.translationMatrix,!1,e.worldTransform.toArray(!0)),i.uniform2f(u.projectionVector,s.x,-s.y),i.uniform2f(u.offsetVector,-o.x,-o.y),i.uniform3fv(u.tintColor,t.hex2rgb(e.tint)),i.uniform3fv(u.color,n.color),i.uniform1f(u.alpha,e.worldAlpha*n.alpha),i.bindBuffer(i.ARRAY_BUFFER,n.buffer),i.vertexAttribPointer(u.aVertexPosition,2,i.FLOAT,!1,8,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.indexBuffer)):(u=r.shaderManager.primitiveShader,r.shaderManager.setShader(u),i.uniformMatrix3fv(u.translationMatrix,!1,e.worldTransform.toArray(!0)),i.uniform2f(u.projectionVector,s.x,-s.y),i.uniform2f(u.offsetVector,-o.x,-o.y),i.uniform3fv(u.tintColor,t.hex2rgb(e.tint)),i.uniform1f(u.alpha,e.worldAlpha),i.bindBuffer(i.ARRAY_BUFFER,n.buffer),i.vertexAttribPointer(u.aVertexPosition,2,i.FLOAT,!1,24,0),i.vertexAttribPointer(u.colorAttribute,4,i.FLOAT,!1,24,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n.indexBuffer))},t.WebGLStencilManager.prototype.popStencil=function(e,t,n){var r=this.gl;this.stencilStack.pop(),this.count--;if(this.stencilStack.length===0)r.disable(r.STENCIL_TEST);else{var i=this.count;this.bindGraphics(e,t,n),r.colorMask(!1,!1,!1,!1),t.mode===1?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(i+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,i+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(t.indices.length-4)*2),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,i,255):r.stencilFunc(r.EQUAL,255-i,255)):(this.reverse?(r.stencilFunc(r.EQUAL,i+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(i+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,i,255):r.stencilFunc(r.EQUAL,255-i,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}},t.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null,this.gl=null},t.WebGLShaderManager=function(){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var e=0;e<this.maxAttibs;e++)this.attribState[e]=!1;this.stack=[]},t.WebGLShaderManager.prototype.constructor=t.WebGLShaderManager,t.WebGLShaderManager.prototype.setContext=function(e){this.gl=e,this.primitiveShader=new t.PrimitiveShader(e),this.complexPrimitiveShader=new t.ComplexPrimitiveShader(e),this.defaultShader=new t.PixiShader(e),this.fastShader=new t.PixiFastShader(e),this.stripShader=new t.StripShader(e),this.setShader(this.defaultShader)},t.WebGLShaderManager.prototype.setAttribs=function(e){var t;for(t=0;t<this.tempAttribState.length;t++)this.tempAttribState[t]=!1;for(t=0;t<e.length;t++){var n=e[t];this.tempAttribState[n]=!0}var r=this.gl;for(t=0;t<this.attribState.length;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?r.enableVertexAttribArray(t):r.disableVertexAttribArray(t))},t.WebGLShaderManager.prototype.setShader=function(e){return this._currentId===e._UID?!1:(this._currentId=e._UID,this.currentShader=e,this.gl.useProgram(e.program),this.setAttribs(e.attributes),!0)},t.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},t.WebGLSpriteBatch=function(){this.vertSize=6,this.size=2e3;var e=this.size*4*this.vertSize,n=this.size*6;this.vertices=new Float32Array(e),this.indices=new Uint16Array(n),this.lastIndexCount=0;for(var r=0,i=0;r<n;r+=6,i+=4)this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.dirty=!0,this.textures=[],this.blendModes=[],this.shaders=[],this.sprites=[],this.defaultShader=new t.AbstractFilter(["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"])},t.WebGLSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW),this.currentBlendMode=99999;var n=new t.PixiShader(e);n.fragmentSrc=this.defaultShader.fragmentSrc,n.uniforms={},n.init(),this.defaultShader.shaders[e.id]=n},t.WebGLSpriteBatch.prototype.begin=function(e){this.renderSession=e,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},t.WebGLSpriteBatch.prototype.end=function(){this.flush()},t.WebGLSpriteBatch.prototype.render=function(e){var t=e.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=t.baseTexture);var n=t._uvs;if(!n)return;var r=e.worldAlpha,i=e.tint,s=this.vertices,o=e.anchor.x,u=e.anchor.y,a,f,l,c;if(t.trim){var h=t.trim;f=h.x-o*h.width,a=f+t.crop.width,c=h.y-u*h.height,l=c+t.crop.height}else a=t.frame.width*(1-o),f=t.frame.width*-o,l=t.frame.height*(1-u),c=t.frame.height*-u;var p=this.currentBatchSize*4*this.vertSize,d=t.baseTexture.resolution,v=e.worldTransform,m=v.a/d,g=v.b/d,y=v.c/d,b=v.d/d,w=v.tx,E=v.ty;s[p++]=m*f+y*c+w,s[p++]=b*c+g*f+E,s[p++]=n.x0,s[p++]=n.y0,s[p++]=r,s[p++]=i,s[p++]=m*a+y*c+w,s[p++]=b*c+g*a+E,s[p++]=n.x1,s[p++]=n.y1,s[p++]=r,s[p++]=i,s[p++]=m*a+y*l+w,s[p++]=b*l+g*a+E,s[p++]=n.x2,s[p++]=n.y2,s[p++]=r,s[p++]=i,s[p++]=m*f+y*l+w,s[p++]=b*l+g*f+E,s[p++]=n.x3,s[p++]=n.y3,s[p++]=r,s[p++]=i,this.sprites[this.currentBatchSize++]=e},t.WebGLSpriteBatch.prototype.renderTilingSprite=function(e){var n=e.tilingTexture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=n.baseTexture),e._uvs||(e._uvs=new t.TextureUvs);var r=e._uvs;e.tilePosition.x%=n.baseTexture.width*e.tileScaleOffset.x,e.tilePosition.y%=n.baseTexture.height*e.tileScaleOffset.y;var i=e.tilePosition.x/(n.baseTexture.width*e.tileScaleOffset.x),s=e.tilePosition.y/(n.baseTexture.height*e.tileScaleOffset.y),o=e.width/n.baseTexture.width/(e.tileScale.x*e.tileScaleOffset.x),u=e.height/n.baseTexture.height/(e.tileScale.y*e.tileScaleOffset.y);r.x0=0-i,r.y0=0-s,r.x1=1*o-i,r.y1=0-s,r.x2=1*o-i,r.y2=1*u-s,r.x3=0-i,r.y3=1*u-s;var a=e.worldAlpha,f=e.tint,l=this.vertices,c=e.width,h=e.height,p=e.anchor.x,d=e.anchor.y,v=c*(1-p),m=c*-p,g=h*(1-d),y=h*-d,b=this.currentBatchSize*4*this.vertSize,w=n.baseTexture.resolution,E=e.worldTransform,S=E.a/w,x=E.b/w,T=E.c/w,N=E.d/w,C=E.tx,k=E.ty;l[b++]=S*m+T*y+C,l[b++]=N*y+x*m+k,l[b++]=r.x0,l[b++]=r.y0,l[b++]=a,l[b++]=f,l[b++]=S*v+T*y+C,l[b++]=N*y+x*v+k,l[b++]=r.x1,l[b++]=r.y1,l[b++]=a,l[b++]=f,l[b++]=S*v+T*g+C,l[b++]=N*g+x*v+k,l[b++]=r.x2,l[b++]=r.y2,l[b++]=a,l[b++]=f,l[b++]=S*m+T*g+C,l[b++]=N*g+x*m+k,l[b++]=r.x3,l[b++]=r.y3,l[b++]=a,l[b++]=f,this.sprites[this.currentBatchSize++]=e},t.WebGLSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0)return;var e=this.gl,n;if(this.dirty){this.dirty=!1,e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),n=this.defaultShader.shaders[e.id];var r=this.vertSize*4;e.vertexAttribPointer(n.aVertexPosition,2,e.FLOAT,!1,r,0),e.vertexAttribPointer(n.aTextureCoord,2,e.FLOAT,!1,r,8),e.vertexAttribPointer(n.colorAttribute,2,e.FLOAT,!1,r,16)}if(this.currentBatchSize>this.size*.5)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{var i=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);e.bufferSubData(e.ARRAY_BUFFER,0,i)}var s,o,u,a=0,f=0,l=null,c=this.renderSession.blendModeManager.currentBlendMode,h=null,p=!1,d=!1,v;for(var m=0,g=this.currentBatchSize;m<g;m++){v=this.sprites[m],s=v.texture.baseTexture,o=v.blendMode,u=v.shader||this.defaultShader,p=c!==o,d=h!==u;if(l!==s||p||d){this.renderBatch(l,a,f),f=m,a=0,l=s,p&&(c=o,this.renderSession.blendModeManager.setBlendMode(c));if(d){h=u,n=h.shaders[e.id],n||(n=new t.PixiShader(e),n.fragmentSrc=h.fragmentSrc,n.uniforms=h.uniforms,n.init(),h.shaders[e.id]=n),this.renderSession.shaderManager.setShader(n),n.dirty&&n.syncUniforms();var y=this.renderSession.projection;e.uniform2f(n.projectionVector,y.x,y.y);var b=this.renderSession.offset;e.uniform2f(n.offsetVector,b.x,b.y)}}a++}this.renderBatch(l,a,f),this.currentBatchSize=0},t.WebGLSpriteBatch.prototype.renderBatch=function(e,t,n){if(t===0)return;var r=this.gl;e._dirty[r.id]?this.renderSession.renderer.updateTexture(e):r.bindTexture(r.TEXTURE_2D,e._glTextures[r.id]),r.drawElements(r.TRIANGLES,t*6,r.UNSIGNED_SHORT,n*6*2),this.renderSession.drawCount++},t.WebGLSpriteBatch.prototype.stop=function(){this.flush(),this.dirty=!0},t.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},t.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},t.WebGLFastSpriteBatch=function(e){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var t=this.size*4*this.vertSize,n=this.maxSize*6;this.vertices=new Float32Array(t),this.indices=new Uint16Array(n),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var r=0,i=0;r<n;r+=6,i+=4)this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(e)},t.WebGLFastSpriteBatch.prototype.constructor=t.WebGLFastSpriteBatch,t.WebGLFastSpriteBatch.prototype.setContext=function(e){this.gl=e,this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indices,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertices,e.DYNAMIC_DRAW)},t.WebGLFastSpriteBatch.prototype.begin=function(e,t){this.renderSession=t,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=e.worldTransform.toArray(!0),this.start()},t.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.render=function(e){var t=e.children,n=t[0];if(!n.texture._uvs)return;this.currentBaseTexture=n.texture.baseTexture,n.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(n.blendMode));for(var r=0,i=t.length;r<i;r++)this.renderSprite(t[r]);this.flush()},t.WebGLFastSpriteBatch.prototype.renderSprite=function(e){if(!e.visible)return;if(e.texture.baseTexture!==this.currentBaseTexture){this.flush(),this.currentBaseTexture=e.texture.baseTexture;if(!e.texture._uvs)return}var t,n=this.vertices,r,i,s,o,u,a,f;t=e.texture._uvs,r=e.texture.frame.width,i=e.texture.frame.height;if(e.texture.trim){var l=e.texture.trim;o=l.x-e.anchor.x*l.width,s=o+e.texture.crop.width,a=l.y-e.anchor.y*l.height,u=a+e.texture.crop.height}else s=e.texture.frame.width*(1-e.anchor.x),o=e.texture.frame.width*-e.anchor.x,u=e.texture.frame.height*(1-e.anchor.y),a=e.texture.frame.height*-e.anchor.y;f=this.currentBatchSize*4*this.vertSize,n[f++]=o,n[f++]=a,n[f++]=e.position.x,n[f++]=e.position.y,n[f++]=e.scale.x,n[f++]=e.scale.y,n[f++]=e.rotation,n[f++]=t.x0,n[f++]=t.y1,n[f++]=e.alpha,n[f++]=s,n[f++]=a,n[f++]=e.position.x,n[f++]=e.position.y,n[f++]=e.scale.x,n[f++]=e.scale.y,n[f++]=e.rotation,n[f++]=t.x1,n[f++]=t.y1,n[f++]=e.alpha,n[f++]=s,n[f++]=u,n[f++]=e.position.x,n[f++]=e.position.y,n[f++]=e.scale.x,n[f++]=e.scale.y,n[f++]=e.rotation,n[f++]=t.x2,n[f++]=t.y2,n[f++]=e.alpha,n[f++]=o,n[f++]=u,n[f++]=e.position.x,n[f++]=e.position.y,n[f++]=e.scale.x,n[f++]=e.scale.y,n[f++]=e.rotation,n[f++]=t.x3,n[f++]=t.y3,n[f++]=e.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()},t.WebGLFastSpriteBatch.prototype.flush=function(){if(this.currentBatchSize===0)return;var e=this.gl;this.currentBaseTexture._glTextures[e.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,e),e.bindTexture(e.TEXTURE_2D,this.currentBaseTexture._glTextures[e.id]);if(this.currentBatchSize>this.size*.5)e.bufferSubData(e.ARRAY_BUFFER,0,this.vertices);else{var t=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize);e.bufferSubData(e.ARRAY_BUFFER,0,t)}e.drawElements(e.TRIANGLES,this.currentBatchSize*6,e.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++},t.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},t.WebGLFastSpriteBatch.prototype.start=function(){var e=this.gl;e.activeTexture(e.TEXTURE0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var t=this.renderSession.projection;e.uniform2f(this.shader.projectionVector,t.x,t.y),e.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var n=this.vertSize*4;e.vertexAttribPointer(this.shader.aVertexPosition,2,e.FLOAT,!1,n,0),e.vertexAttribPointer(this.shader.aPositionCoord,2,e.FLOAT,!1,n,8),e.vertexAttribPointer(this.shader.aScale,2,e.FLOAT,!1,n,16),e.vertexAttribPointer(this.shader.aRotation,1,e.FLOAT,!1,n,24),e.vertexAttribPointer(this.shader.aTextureCoord,2,e.FLOAT,!1,n,28),e.vertexAttribPointer(this.shader.colorAttribute,1,e.FLOAT,!1,n,36)},t.WebGLFilterManager=function(){this.filterStack=[],this.offsetX=0,this.offsetY=0},t.WebGLFilterManager.prototype.constructor=t.WebGLFilterManager,t.WebGLFilterManager.prototype.setContext=function(e){this.gl=e,this.texturePool=[],this.initShaderBuffers()},t.WebGLFilterManager.prototype.begin=function(e,t){this.renderSession=e,this.defaultShader=e.shaderManager.defaultShader;var n=this.renderSession.projection;this.width=n.x*2,this.height=-n.y*2,this.buffer=t},t.WebGLFilterManager.prototype.pushFilter=function(e){var n=this.gl,r=this.renderSession.projection,i=this.renderSession.offset;e._filterArea=e.target.filterArea||e.target.getBounds(),this.filterStack.push(e);var s=e.filterPasses[0];this.offsetX+=e._filterArea.x,this.offsetY+=e._filterArea.y;var o=this.texturePool.pop();o?o.resize(this.width,this.height):o=new t.FilterTexture(this.gl,this.width,this.height),n.bindTexture(n.TEXTURE_2D,o.texture);var u=e._filterArea,a=s.padding;u.x-=a,u.y-=a,u.width+=a*2,u.height+=a*2,u.x<0&&(u.x=0),u.width>this.width&&(u.width=this.width),u.y<0&&(u.y=0),u.height>this.height&&(u.height=this.height),n.bindFramebuffer(n.FRAMEBUFFER,o.frameBuffer),n.viewport(0,0,u.width,u.height),r.x=u.width/2,r.y=-u.height/2,i.x=-u.x,i.y=-u.y,n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),e._glFilterTexture=o},t.WebGLFilterManager.prototype.popFilter=function(){var e=this.gl,n=this.filterStack.pop(),r=n._filterArea,i=n._glFilterTexture,s=this.renderSession.projection,o=this.renderSession.offset;if(n.filterPasses.length>1){e.viewport(0,0,r.width,r.height),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=r.height,this.vertexArray[2]=r.width,this.vertexArray[3]=r.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=r.width,this.vertexArray[7]=0,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=r.width/this.width,this.uvArray[5]=r.height/this.height,this.uvArray[6]=r.width/this.width,this.uvArray[7]=r.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray);var u=i,a=this.texturePool.pop();a||(a=new t.FilterTexture(this.gl,this.width,this.height)),a.resize(this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,a.frameBuffer),e.clear(e.COLOR_BUFFER_BIT),e.disable(e.BLEND);for(var f=0;f<n.filterPasses.length-1;f++){var l=n.filterPasses[f];e.bindFramebuffer(e.FRAMEBUFFER,a.frameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,u.texture),this.applyFilterPass(l,r,r.width,r.height);var c=u;u=a,a=c}e.enable(e.BLEND),i=u,this.texturePool.push(a)}var h=n.filterPasses[n.filterPasses.length-1];this.offsetX-=r.x,this.offsetY-=r.y;var p=this.width,d=this.height,v=0,m=0,g=this.buffer;if(this.filterStack.length===0)e.colorMask(!0,!0,!0,!0);else{var y=this.filterStack[this.filterStack.length-1];r=y._filterArea,p=r.width,d=r.height,v=r.x,m=r.y,g=y._glFilterTexture.frameBuffer}s.x=p/2,s.y=-d/2,o.x=v,o.y=m,r=n._filterArea;var b=r.x-v,w=r.y-m;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=b,this.vertexArray[1]=w+r.height,this.vertexArray[2]=b+r.width,this.vertexArray[3]=w+r.height,this.vertexArray[4]=b,this.vertexArray[5]=w,this.vertexArray[6]=b+r.width,this.vertexArray[7]=w,e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=r.width/this.width,this.uvArray[5]=r.height/this.height,this.uvArray[6]=r.width/this.width,this.uvArray[7]=r.height/this.height,e.bufferSubData(e.ARRAY_BUFFER,0,this.uvArray),e.viewport(0,0,p,d),e.bindFramebuffer(e.FRAMEBUFFER,g),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i.texture),this.applyFilterPass(h,r,p,d),this.texturePool.push(i),n._glFilterTexture=null},t.WebGLFilterManager.prototype.applyFilterPass=function(e,n,r,i){var s=this.gl,o=e.shaders[s.id];o||(o=new t.PixiShader(s),o.fragmentSrc=e.fragmentSrc,o.uniforms=e.uniforms,o.init(),e.shaders[s.id]=o),this.renderSession.shaderManager.setShader(o),s.uniform2f(o.projectionVector,r/2,-i/2),s.uniform2f(o.offsetVector,0,0),e.uniforms.dimensions&&(e.uniforms.dimensions.value[0]=this.width,e.uniforms.dimensions.value[1]=this.height,e.uniforms.dimensions.value[2]=this.vertexArray[0],e.uniforms.dimensions.value[3]=this.vertexArray[5]),o.syncUniforms(),s.bindBuffer(s.ARRAY_BUFFER,this.vertexBuffer),s.vertexAttribPointer(o.aVertexPosition,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.uvBuffer),s.vertexAttribPointer(o.aTextureCoord,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this.colorBuffer),s.vertexAttribPointer(o.colorAttribute,2,s.FLOAT,!1,0,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer),s.drawElements(s.TRIANGLES,6,s.UNSIGNED_SHORT,0),this.renderSession.drawCount++},t.WebGLFilterManager.prototype.initShaderBuffers=function(){var e=this.gl;this.vertexBuffer=e.createBuffer(),this.uvBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvArray,e.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.bufferData(e.ARRAY_BUFFER,this.colorArray,e.STATIC_DRAW),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),e.STATIC_DRAW)},t.WebGLFilterManager.prototype.destroy=function(){var e=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var t=0;t<this.texturePool.length;t++)this.texturePool[t].destroy();this.texturePool=null,e.deleteBuffer(this.vertexBuffer),e.deleteBuffer(this.uvBuffer),e.deleteBuffer(this.colorBuffer),e.deleteBuffer(this.indexBuffer)},t.FilterTexture=function(e,n,r,i){this.gl=e,this.frameBuffer=e.createFramebuffer(),this.texture=e.createTexture(),i=i||t.scaleModes.DEFAULT,e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i===t.scaleModes.LINEAR?e.LINEAR:e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture,0),this.renderBuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,this.renderBuffer),this.resize(n,r)},t.FilterTexture.prototype.constructor=t.FilterTexture,t.FilterTexture.prototype.clear=function(){var e=this.gl;e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT)},t.FilterTexture.prototype.resize=function(e,t){if(this.width===e&&this.height===t)return;this.width=e,this.height=t;var n=this.gl;n.bindTexture(n.TEXTURE_2D,this.texture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,null),n.bindRenderbuffer(n.RENDERBUFFER,this.renderBuffer),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,e,t)},t.FilterTexture.prototype.destroy=function(){var e=this.gl;e.deleteFramebuffer(this.frameBuffer),e.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},t.CanvasBuffer=function(e,t){this.width=e,this.height=t,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=e,this.canvas.height=t},t.CanvasBuffer.prototype.constructor=t.CanvasBuffer,t.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},t.CanvasBuffer.prototype.resize=function(e,t){this.width=this.canvas.width=e,this.height=this.canvas.height=t},t.CanvasMaskManager=function(){},t.CanvasMaskManager.prototype.constructor=t.CanvasMaskManager,t.CanvasMaskManager.prototype.pushMask=function(e,n){var r=n.context;r.save();var i=e.alpha,s=e.worldTransform,o=n.resolution;r.setTransform(s.a*o,s.b*o,s.c*o,s.d*o,s.tx*o,s.ty*o),t.CanvasGraphics.renderGraphicsMask(e,r),r.clip(),e.worldAlpha=i},t.CanvasMaskManager.prototype.popMask=function(e){e.context.restore()},t.CanvasTinter=function(){},t.CanvasTinter.getTintedTexture=function(e,n){var r=e.texture;n=t.CanvasTinter.roundColor(n);var i="#"+("00000"+(n|0).toString(16)).substr(-6);r.tintCache=r.tintCache||{};if(r.tintCache[i])return r.tintCache[i];var s=t.CanvasTinter.canvas||document.createElement("canvas");t.CanvasTinter.tintMethod(r,n,s);if(t.CanvasTinter.convertTintToImage){var o=new Image;o.src=s.toDataURL(),r.tintCache[i]=o}else r.tintCache[i]=s,t.CanvasTinter.canvas=null;return s},t.CanvasTinter.tintWithMultiply=function(e,t,n){var r=n.getContext("2d"),i=e.crop;n.width=i.width,n.height=i.height,r.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="multiply",r.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height)},t.CanvasTinter.tintWithOverlay=function(e,t,n){var r=n.getContext("2d"),i=e.crop;n.width=i.width,n.height=i.height,r.globalCompositeOperation="copy",r.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(e.baseTexture.source,i.x,i.y,i.width,i.height,0,0,i.width,i.height)},t.CanvasTinter.tintWithPerPixel=function(e,n,r){var i=r.getContext("2d"),s=e.crop;r.width=s.width,r.height=s.height,i.globalCompositeOperation="copy",i.drawImage(e.baseTexture.source,s.x,s.y,s.width,s.height,0,0,s.width,s.height);var o=t.hex2rgb(n),u=o[0],a=o[1],f=o[2],l=i.getImageData(0,0,s.width,s.height),c=l.data;for(var h=0;h<c.length;h+=4)c[h+0]*=u,c[h+1]*=a,c[h+2]*=f;i.putImageData(l,0,0)},t.CanvasTinter.roundColor=function(e){var n=t.CanvasTinter.cacheStepsPerColorChannel,r=t.hex2rgb(e);return r[0]=Math.min(255,r[0]/n*n),r[1]=Math.min(255,r[1]/n*n),r[2]=Math.min(255,r[2]/n*n),t.rgb2hex(r)},t.CanvasTinter.cacheStepsPerColorChannel=8,t.CanvasTinter.convertTintToImage=!1,t.CanvasTinter.canUseMultiply=t.canUseNewCanvasBlendModes(),t.CanvasTinter.tintMethod=t.CanvasTinter.canUseMultiply?t.CanvasTinter.tintWithMultiply:t.CanvasTinter.tintWithPerPixel,t.CanvasRenderer=function(e,n,r){if(r)for(var i in t.defaultRenderOptions)typeof r[i]=="undefined"&&(r[i]=t.defaultRenderOptions[i]);else r=t.defaultRenderOptions;t.defaultRenderer||(t.sayHello("Canvas"),t.defaultRenderer=this),this.type=t.CANVAS_RENDERER,this.resolution=r.resolution,this.clearBeforeRender=r.clearBeforeRender,this.transparent=r.transparent,this.width=e||800,this.height=n||600,this.width*=this.resolution,this.height*=this.resolution,this.view=r.view||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width*this.resolution,this.view.height=this.height*this.resolution,this.count=0,this.maskManager=new t.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},this.mapBlendModes(),this.resize(e,n),"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="oImageSmoothingEnabled":"msImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="msImageSmoothingEnabled")},t.CanvasRenderer.prototype.constructor=t.CanvasRenderer,t.CanvasRenderer.prototype.render=function(e){e.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.currentBlendMode=t.blendModes.NORMAL,this.context.globalCompositeOperation=t.blendModesCanvas[t.blendModes.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=e.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(e),e.interactive&&(e._interactiveEventsAdded||(e._interactiveEventsAdded=!0,e.interactionManager.setTarget(this)))},t.CanvasRenderer.prototype.destroy=function(e){typeof e=="undefined"&&(e=!0),e&&this.view.parent&&this.view.parent.removeChild(this.view),this.view=null,this.context=null,this.maskManager=null,this.renderSession=null},t.CanvasRenderer.prototype.resize=function(e,t){this.width=e*this.resolution,this.height=t*this.resolution,this.view.width=this.width,this.view.height=this.height,this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px"},t.CanvasRenderer.prototype.renderDisplayObject=function(e,t){this.renderSession.context=t||this.context,this.renderSession.resolution=this.resolution,e._renderCanvas(this.renderSession)},t.CanvasRenderer.prototype.mapBlendModes=function(){t.blendModesCanvas||(t.blendModesCanvas=[],t.canUseNewCanvasBlendModes()?(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="multiply",t.blendModesCanvas[t.blendModes.SCREEN]="screen",t.blendModesCanvas[t.blendModes.OVERLAY]="overlay",t.blendModesCanvas[t.blendModes.DARKEN]="darken",t.blendModesCanvas[t.blendModes.LIGHTEN]="lighten",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="color-dodge",t.blendModesCanvas[t.blendModes.COLOR_BURN]="color-burn",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="hard-light",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="soft-light",t.blendModesCanvas[t.blendModes.DIFFERENCE]="difference",t.blendModesCanvas[t.blendModes.EXCLUSION]="exclusion",t.blendModesCanvas[t.blendModes.HUE]="hue",t.blendModesCanvas[t.blendModes.SATURATION]="saturation",t.blendModesCanvas[t.blendModes.COLOR]="color",t.blendModesCanvas[t.blendModes.LUMINOSITY]="luminosity"):(t.blendModesCanvas[t.blendModes.NORMAL]="source-over",t.blendModesCanvas[t.blendModes.ADD]="lighter",t.blendModesCanvas[t.blendModes.MULTIPLY]="source-over",t.blendModesCanvas[t.blendModes.SCREEN]="source-over",t.blendModesCanvas[t.blendModes.OVERLAY]="source-over",t.blendModesCanvas[t.blendModes.DARKEN]="source-over",t.blendModesCanvas[t.blendModes.LIGHTEN]="source-over",t.blendModesCanvas[t.blendModes.COLOR_DODGE]="source-over",t.blendModesCanvas[t.blendModes.COLOR_BURN]="source-over",t.blendModesCanvas[t.blendModes.HARD_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.SOFT_LIGHT]="source-over",t.blendModesCanvas[t.blendModes.DIFFERENCE]="source-over",t.blendModesCanvas[t.blendModes.EXCLUSION]="source-over",t.blendModesCanvas[t.blendModes.HUE]="source-over",t.blendModesCanvas[t.blendModes.SATURATION]="source-over",t.blendModesCanvas[t.blendModes.COLOR]="source-over",t.blendModesCanvas[t.blendModes.LUMINOSITY]="source-over"))},t.CanvasGraphics=function(){},t.CanvasGraphics.renderGraphics=function(e,n){var r=e.worldAlpha,i="";for(var s=0;s<e.graphicsData.length;s++){var o=e.graphicsData[s],u=o.shape;n.strokeStyle=i="#"+("00000"+(o.lineColor|0).toString(16)).substr(-6),n.lineWidth=o.lineWidth;if(o.type===t.Graphics.POLY){n.beginPath();var a=u.points;n.moveTo(a[0],a[1]);for(var f=1;f<a.length/2;f++)n.lineTo(a[f*2],a[f*2+1]);u.closed&&n.lineTo(a[0],a[1]),a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&n.closePath(),o.fill&&(n.globalAlpha=o.fillAlpha*r,n.fillStyle=i="#"+("00000"+(o.fillColor|0).toString(16)).substr(-6),n.fill()),o.lineWidth&&(n.globalAlpha=o.lineAlpha*r,n.stroke())}else if(o.type===t.Graphics.RECT){if(o.fillColor||o.fillColor===0)n.globalAlpha=o.fillAlpha*r,n.fillStyle=i="#"+("00000"+(o.fillColor|0).toString(16)).substr(-6),n.fillRect(u.x,u.y,u.width,u.height);o.lineWidth&&(n.globalAlpha=o.lineAlpha*r,n.strokeRect(u.x,u.y,u.width,u.height))}else if(o.type===t.Graphics.CIRC)n.beginPath(),n.arc(u.x,u.y,u.radius,0,2*Math.PI),n.closePath(),o.fill&&(n.globalAlpha=o.fillAlpha*r,n.fillStyle=i="#"+("00000"+(o.fillColor|0).toString(16)).substr(-6),n.fill()),o.lineWidth&&(n.globalAlpha=o.lineAlpha*r,n.stroke());else if(o.type===t.Graphics.ELIP){var l=u.width*2,c=u.height*2,h=u.x-l/2,p=u.y-c/2;n.beginPath();var d=.5522848,v=l/2*d,m=c/2*d,g=h+l,y=p+c,b=h+l/2,w=p+c/2;n.moveTo(h,w),n.bezierCurveTo(h,w-m,b-v,p,b,p),n.bezierCurveTo(b+v,p,g,w-m,g,w),n.bezierCurveTo(g,w+m,b+v,y,b,y),n.bezierCurveTo(b-v,y,h,w+m,h,w),n.closePath(),o.fill&&(n.globalAlpha=o.fillAlpha*r,n.fillStyle=i="#"+("00000"+(o.fillColor|0).toString(16)).substr(-6),n.fill()),o.lineWidth&&(n.globalAlpha=o.lineAlpha*r,n.stroke())}else if(o.type===t.Graphics.RREC){var E=u.points,S=E[0],x=E[1],T=E[2],N=E[3],C=E[4],k=Math.min(T,N)/2|0;C=C>k?k:C,n.beginPath(),n.moveTo(S,x+C),n.lineTo(S,x+N-C),n.quadraticCurveTo(S,x+N,S+C,x+N),n.lineTo(S+T-C,x+N),n.quadraticCurveTo(S+T,x+N,S+T,x+N-C),n.lineTo(S+T,x+C),n.quadraticCurveTo(S+T,x,S+T-C,x),n.lineTo(S+C,x),n.quadraticCurveTo(S,x,S,x+C),n.closePath();if(o.fillColor||o.fillColor===0)n.globalAlpha=o.fillAlpha*r,n.fillStyle=i="#"+("00000"+(o.fillColor|0).toString(16)).substr(-6),n.fill();o.lineWidth&&(n.globalAlpha=o.lineAlpha*r,n.stroke())}}},t.CanvasGraphics.renderGraphicsMask=function(e,n){var r=e.graphicsData.length;if(r===0)return;r>1&&(r=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var i=0;i<1;i++){var s=e.graphicsData[i],o=s.shape;if(s.type===t.Graphics.POLY){n.beginPath();var u=o.points;n.moveTo(u[0],u[1]);for(var a=1;a<u.length/2;a++)n.lineTo(u[a*2],u[a*2+1]);u[0]===u[u.length-2]&&u[1]===u[u.length-1]&&n.closePath()}else if(s.type===t.Graphics.RECT)n.beginPath(),n.rect(o.x,o.y,o.width,o.height),n.closePath();else if(s.type===t.Graphics.CIRC)n.beginPath(),n.arc(o.x,o.y,o.radius,0,2*Math.PI),n.closePath();else if(s.type===t.Graphics.ELIP){var f=o.width*2,l=o.height*2,c=o.x-f/2,h=o.y-l/2;n.beginPath();var p=.5522848,d=f/2*p,v=l/2*p,m=c+f,g=h+l,y=c+f/2,b=h+l/2;n.moveTo(c,b),n.bezierCurveTo(c,b-v,y-d,h,y,h),n.bezierCurveTo(y+d,h,m,b-v,m,b),n.bezierCurveTo(m,b+v,y+d,g,y,g),n.bezierCurveTo(y-d,g,c,b+v,c,b),n.closePath()}else if(s.type===t.Graphics.RREC){var w=o.points,E=w[0],S=w[1],x=w[2],T=w[3],N=w[4],C=Math.min(x,T)/2|0;N=N>C?C:N,n.beginPath(),n.moveTo(E,S+N),n.lineTo(E,S+T-N),n.quadraticCurveTo(E,S+T,E+N,S+T),n.lineTo(E+x-N,S+T),n.quadraticCurveTo(E+x,S+T,E+x,S+T-N),n.lineTo(E+x,S+N),n.quadraticCurveTo(E+x,S,E+x-N,S),n.lineTo(E+N,S),n.quadraticCurveTo(E,S,E,S+N),n.closePath()}}},t.Graphics=function(){t.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this.blendMode=t.blendModes.NORMAL,this.currentPath=null,this._webGL=[],this.isMask=!1,this.boundsPadding=0,this.dirty=!0,this.webGLDirty=!1,this.cachedSpriteDirty=!1},t.Graphics.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Graphics.prototype.constructor=t.Graphics,Object.defineProperty(t.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(e){this._cacheAsBitmap=e,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),t.Graphics.prototype.lineStyle=function(e,n,r){this.lineWidth=e||0,this.lineColor=n||0,this.lineAlpha=arguments.length<3?1:r;if(this.currentPath){if(this.currentPath.shape.points.length)return this.drawShape(new t.Polygon(this.currentPath.shape.points.slice(-2))),this;this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha}return this},t.Graphics.prototype.moveTo=function(e,n){return this.drawShape(new t.Polygon([e,n])),this},t.Graphics.prototype.lineTo=function(e,t){return this.currentPath.shape.points.push(e,t),this.dirty=!0,this},t.Graphics.prototype.quadraticCurveTo=function(e,t,n,r){this.currentPath?this.currentPath.shape.points.length===0&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var i,s,o=20,u=this.currentPath.shape.points;u.length===0&&this.moveTo(0,0);var a=u[u.length-2],f=u[u.length-1],l=0;for(var c=1;c<=o;c++)l=c/o,i=a+(e-a)*l,s=f+(t-f)*l,u.push(i+(e+(n-e)*l-i)*l,s+(t+(r-t)*l-s)*l);return this.dirty=!0,this},t.Graphics.prototype.bezierCurveTo=function(e,t,n,r,i,s){this.currentPath?this.currentPath.shape.points.length===0&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var o=20,u,a,f,l,c,h=this.currentPath.shape.points,p=h[h.length-2],d=h[h.length-1],v=0;for(var m=1;m<=o;m++)v=m/o,u=1-v,a=u*u,f=a*u,l=v*v,c=l*v,h.push(f*p+3*a*v*e+3*u*l*n+c*i,f*d+3*a*v*t+3*u*l*r+c*s);return this.dirty=!0,this},t.Graphics.prototype.arcTo=function(e,t,n,r,i){this.currentPath?this.currentPath.shape.points.length===0&&(this.currentPath.shape.points=[e,t]):this.moveTo(e,t),this.currentPath.length===0&&this.moveTo(e,t);var s=this.currentPath,o=s[s.length-2],u=s[s.length-1],a=u-t,f=o-e,l=r-t,c=n-e,h=Math.abs(a*c-f*l);if(h<1e-8||i===0)s.push(e,t);else{var p=a*a+f*f,d=l*l+c*c,v=a*l+f*c,m=i*Math.sqrt(p)/h,g=i*Math.sqrt(d)/h,y=m*v/p,b=g*v/d,w=m*c+g*f,E=m*l+g*a,S=f*(g+y),x=a*(g+y),T=c*(m+b),N=l*(m+b),C=Math.atan2(x-E,S-w),k=Math.atan2(N-E,T-w);this.arc(w+e,E+t,i,C,k,f*l>c*a)}return this.dirty=!0,this},t.Graphics.prototype.arc=function(e,t,n,r,i,s){var o=e+Math.cos(r)*n,u=t+Math.sin(r)*n,a=this.currentPath.shape.points;if(a.length!==0&&a[a.length-2]!==o||a[a.length-1]!==u)this.moveTo(o,u),a=this.currentPath.shape.points;if(r===i)return this;!s&&i<=r?i+=Math.PI*2:s&&r<=i&&(r+=Math.PI*2);var f=s?(r-i)*-1:i-r,l=Math.abs(f)/(Math.PI*2)*40;if(f===0)return this;var c=f/(l*2),h=c*2,p=Math.cos(c),d=Math.sin(c),v=l-1,m=v%1/v;for(var g=0;g<=v;g++){var y=g+m*g,b=c+r+h*y,w=Math.cos(b),E=-Math.sin(b);a.push((p*w+d*E)*n+e,(p*-E+d*w)*n+t)}return this.dirty=!0,this},t.Graphics.prototype.beginFill=function(e,t){return this.filling=!0,this.fillColor=e||0,this.fillAlpha=t===undefined?1:t,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},t.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},t.Graphics.prototype.drawRect=function(e,n,r,i){return this.drawShape(new t.Rectangle(e,n,r,i)),this},t.Graphics.prototype.drawRoundedRect=function(e,n,r,i,s){return this.drawShape({points:[e,n,r,i,s],type:t.Graphics.RREC}),this},t.Graphics.prototype.drawCircle=function(e,n,r){return this.drawShape(new t.Circle(e,n,r)),this},t.Graphics.prototype.drawEllipse=function(e,n,r,i){return this.drawShape(new t.Ellipse(e,n,r,i)),this},t.Graphics.prototype.drawPolygon=function(e){return e instanceof Array||(e=Array.prototype.slice.call(arguments)),this.drawShape(new t.Polygon(e)),this},t.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},t.Graphics.prototype.generateTexture=function(e,n){e=e||1;var r=this.getBounds(),i=new t.CanvasBuffer(r.width*e,r.height*e),s=t.Texture.fromCanvas(i.canvas,n);return s.baseTexture.resolution=e,i.context.scale(e,e),i.context.translate(-r.x,-r.y),t.CanvasGraphics.renderGraphics(this,i.context),s},t.Graphics.prototype._renderWebGL=function(e){if(this.visible===!1||this.alpha===0||this.isMask===!0)return;if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty)this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1;this._cachedSprite.alpha=this.alpha,t.Sprite.prototype._renderWebGL.call(this._cachedSprite,e);return}e.spriteBatch.stop(),e.blendModeManager.setBlendMode(this.blendMode),this._mask&&e.maskManager.pushMask(this._mask,e),this._filters&&e.filterManager.pushFilter(this._filterBlock);if(this.blendMode!==e.spriteBatch.currentBlendMode){e.spriteBatch.currentBlendMode=this.blendMode;var n=t.blendModesWebGL[e.spriteBatch.currentBlendMode];e.spriteBatch.gl.blendFunc(n[0],n[1])}this.webGLDirty&&(this.dirty=!0,this.webGLDirty=!1),t.WebGLGraphics.renderGraphics(this,e);if(this.children.length){e.spriteBatch.start();for(var r=0,i=this.children.length;r<i;r++)this.children[r]._renderWebGL(e);e.spriteBatch.stop()}this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(this.mask,e),e.drawCount++,e.spriteBatch.start()},t.Graphics.prototype._renderCanvas=function(e){if(this.visible===!1||this.alpha===0||this.isMask===!0)return;if(this._cacheAsBitmap){if(this.dirty||this.cachedSpriteDirty)this._generateCachedSprite(),this.updateCachedSpriteTexture(),this.cachedSpriteDirty=!1,this.dirty=!1;this._cachedSprite.alpha=this.alpha,t.Sprite.prototype._renderCanvas.call(this._cachedSprite,e);return}var n=e.context,r=this.worldTransform;this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,n.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]),this._mask&&e.maskManager.pushMask(this._mask,e);var i=e.resolution;n.setTransform(r.a*i,r.b*i,r.c*i,r.d*i,r.tx*i,r.ty*i),t.CanvasGraphics.renderGraphics(this,n);for(var s=0,o=this.children.length;s<o;s++)this.children[s]._renderCanvas(e);this._mask&&e.maskManager.popMask(e)},t.Graphics.prototype.getBounds=function(e){this.dirty&&(this.updateBounds(),this.webGLDirty=!0,this.cachedSpriteDirty=!0,this.dirty=!1);var t=this._bounds,n=t.x,r=t.width+t.x,i=t.y,s=t.height+t.y,o=e||this.worldTransform,u=o.a,a=o.c,f=o.b,l=o.d,c=o.tx,h=o.ty,p=u*r+f*s+c,d=l*s+a*r+h,v=u*n+f*s+c,m=l*s+a*n+h,g=u*n+f*i+c,y=l*i+a*n+h,b=u*r+f*i+c,w=l*i+a*r+h,E=p,S=d,x=p,T=d;return x=v<x?v:x,x=g<x?g:x,x=b<x?b:x,T=m<T?m:T,T=y<T?y:T,T=w<T?w:T,E=v>E?v:E,E=g>E?g:E,E=b>E?b:E,S=m>S?m:S,S=y>S?y:S,S=w>S?w:S,t.x=x,t.width=E-x,t.y=T,t.height=S-T,t},t.Graphics.prototype.updateBounds=function(){var e=Infinity,n=-Infinity,r=Infinity,i=-Infinity;if(this.graphicsData.length){var s,o,u,a,f,l;for(var c=0;c<this.graphicsData.length;c++){var h=this.graphicsData[c],p=h.type,d=h.lineWidth;s=h.shape;if(p===t.Graphics.RECT||p===t.Graphics.RRECT)u=s.x-d/2,a=s.y-d/2,f=s.width+d,l=s.height+d,e=u<e?u:e,n=u+f>n?u+f:n,r=a<r?a:r,i=a+l>i?a+l:i;else if(p===t.Graphics.CIRC)u=s.x,a=s.y,f=s.radius+d/2,l=s.radius+d/2,e=u-f<e?u-f:e,n=u+f>n?u+f:n,r=a-l<r?a-l:r,i=a+l>i?a+l:i;else if(p===t.Graphics.ELIP)u=s.x,a=s.y,f=s.width+d/2,l=s.height+d/2,e=u-f<e?u-f:e,n=u+f>n?u+f:n,r=a-l<r?a-l:r,i=a+l>i?a+l:i;else{o=s.points;for(var v=0;v<o.length;v+=2)u=o[v],a=o[v+1],e=u-d<e?u-d:e,n=u+d>n?u+d:n,r=a-d<r?a-d:r,i=a+d>i?a+d:i}}}else e=0,n=0,r=0,i=0;var m=this.boundsPadding,g=this._bounds;g.x=e-m,g.width=n-e+m*2,g.y=r-m,g.height=i-r+m*2},t.Graphics.prototype._generateCachedSprite=function(){var e=this.getLocalBounds();if(!this._cachedSprite){var n=new t.CanvasBuffer(e.width,e.height),r=t.Texture.fromCanvas(n.canvas);this._cachedSprite=new t.Sprite(r),this._cachedSprite.buffer=n,this._cachedSprite.worldTransform=this.worldTransform}else this._cachedSprite.buffer.resize(e.width,e.height);this._cachedSprite.anchor.x=-(e.x/e.width),this._cachedSprite.anchor.y=-(e.y/e.height),this._cachedSprite.buffer.context.translate(-e.x,-e.y),this.worldAlpha=1,t.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},t.Graphics.prototype.updateCachedSpriteTexture=function(){var e=this._cachedSprite,t=e.texture,n=e.buffer.canvas;t.baseTexture.width=n.width,t.baseTexture.height=n.height,t.crop.width=t.frame.width=n.width,t.crop.height=t.frame.height=n.height,e._width=n.width,e._height=n.height,t.baseTexture.dirty()},t.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},t.Graphics.prototype.drawShape=function(e){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var n=new t.GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,e);return this.graphicsData.push(n),n.type===t.Graphics.POLY&&(n.shape.closed=this.filling,this.currentPath=n),this.dirty=!0,n},t.GraphicsData=function(e,t,n,r,i,s,o){this.lineWidth=e,this.lineColor=t,this.lineAlpha=n,this.fillColor=r,this.fillAlpha=i,this.fill=s,this.shape=o,this.type=o.type},t.Graphics.POLY=0,t.Graphics.RECT=1,t.Graphics.CIRC=2,t.Graphics.ELIP=3,t.Graphics.RREC=4,t.Polygon.prototype.type=t.Graphics.POLY,t.Rectangle.prototype.type=t.Graphics.RECT,t.Circle.prototype.type=t.Graphics.CIRC,t.Ellipse.prototype.type=t.Graphics.ELIP,t.Strip=function(e){t.DisplayObjectContainer.call(this),this.texture=e,this.uvs=new t.Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new t.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new t.Float32Array([1,1,1,1]),this.indices=new t.Uint16Array([0,1,2,3]),this.dirty=!0,this.padding=0},t.Strip.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Strip.prototype.constructor=t.Strip,t.Strip.prototype._renderWebGL=function(e){if(!this.visible||this.alpha<=0)return;e.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(e),e.shaderManager.setShader(e.shaderManager.stripShader),this._renderStrip(e),e.spriteBatch.start()},t.Strip.prototype._initWebGL=function(e){var t=e.gl;this._vertexBuffer=t.createBuffer(),this._indexBuffer=t.createBuffer(),this._uvBuffer=t.createBuffer(),this._colorBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.verticies,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,this._colorBuffer),t.bufferData(t.ARRAY_BUFFER,this.colors,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)},t.Strip.prototype._renderStrip=function(e){var t=e.gl,n=e.projection,r=e.offset,i=e.shaderManager.stripShader;t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.uniformMatrix3fv(i.translationMatrix,!1,this.worldTransform.toArray(!0)),t.uniform2f(i.projectionVector,n.x,-n.y),t.uniform2f(i.offsetVector,-r.x,-r.y),t.uniform1f(i.alpha,this.worldAlpha),this.dirty?(this.dirty=!1,t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferData(t.ARRAY_BUFFER,this.verticies,t.STATIC_DRAW),t.vertexAttribPointer(i.aVertexPosition,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer),t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW),t.vertexAttribPointer(i.aTextureCoord,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),this.texture.baseTexture._dirty[t.id]?e.renderer.updateTexture(this.texture.baseTexture):t.bindTexture(t.TEXTURE_2D,this.texture.baseTexture._glTextures[t.id]),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)):(t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.bufferSubData(t.ARRAY_BUFFER,0,this.verticies),t.vertexAttribPointer(i.aVertexPosition,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer),t.vertexAttribPointer(i.aTextureCoord,2,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),this.texture.baseTexture._dirty[t.id]?e.renderer.updateTexture(this.texture.baseTexture):t.bindTexture(t.TEXTURE_2D,this.texture.baseTexture._glTextures[t.id]),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),t.drawElements(t.TRIANGLE_STRIP,this.indices.length,t.UNSIGNED_SHORT,0)},t.Strip.prototype._renderCanvas=function(e){var t=e.context,n=this.worldTransform;e.roundPixels?t.setTransform(n.a,n.b,n.c,n.d,n.tx|0,n.ty|0):t.setTransform(n.a,n.b,n.c,n.d,n.tx,n.ty);var r=this,i=r.verticies,s=r.uvs,o=i.length/2;this.count++;for(var u=0;u<o-2;u++){var a=u*2,f=i[a],l=i[a+2],c=i[a+4],h=i[a+1],p=i[a+3],d=i[a+5];if(this.padding>0){var v=(f+l+c)/3,m=(h+p+d)/3,g=f-v,y=h-m,b=Math.sqrt(g*g+y*y);f=v+g/b*(b+3),h=m+y/b*(b+3),g=l-v,y=p-m,b=Math.sqrt(g*g+y*y),l=v+g/b*(b+3),p=m+y/b*(b+3),g=c-v,y=d-m,b=Math.sqrt(g*g+y*y),c=v+g/b*(b+3),d=m+y/b*(b+3)}var w=s[a]*r.texture.width,E=s[a+2]*r.texture.width,S=s[a+4]*r.texture.width,x=s[a+1]*r.texture.height,T=s[a+3]*r.texture.height,N=s[a+5]*r.texture.height;t.save(),t.beginPath(),t.moveTo(f,h),t.lineTo(l,p),t.lineTo(c,d),t.closePath(),t.clip();var C=w*T+x*S+E*N-T*S-x*E-w*N,k=f*T+x*c+l*N-T*c-x*l-f*N,L=w*l+f*S+E*c-l*S-f*E-w*c,A=w*T*c+x*l*S+f*E*N-f*T*S-x*E*c-w*l*N,O=h*T+x*d+p*N-T*d-x*p-h*N,M=w*p+h*S+E*d-p*S-h*E-w*d,_=w*T*d+x*p*S+h*E*N-h*T*S-x*E*d-w*p*N;t.transform(k/C,O/C,L/C,M/C,A/C,_/C),t.drawImage(r.texture.baseTexture.source,0,0),t.restore()}},t.Strip.prototype.renderStripFlat=function(e){var t=this.context,n=e.verticies,r=n.length/2;this.count++,t.beginPath();for(var i=1;i<r-2;i++){var s=i*2,o=n[s],u=n[s+2],a=n[s+4],f=n[s+1],l=n[s+3],c=n[s+5];t.moveTo(o,f),t.lineTo(u,l),t.lineTo(a,c)}t.fillStyle="#FF0000",t.fill(),t.closePath()},t.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},t.Rope=function(e,n){t.Strip.call(this,e),this.points=n,this.verticies=new t.Float32Array(n.length*4),this.uvs=new t.Float32Array(n.length*4),this.colors=new t.Float32Array(n.length*2),this.indices=new t.Uint16Array(n.length*2),this.refresh()},t.Rope.prototype=Object.create(t.Strip.prototype),t.Rope.prototype.constructor=t.Rope,t.Rope.prototype.refresh=function(){var e=this.points;if(e.length<1)return;var t=this.uvs,n=e[0],r=this.indices,i=this.colors;this.count-=.2,t[0]=0,t[1]=0,t[2]=0,t[3]=1,i[0]=1,i[1]=1,r[0]=0,r[1]=1;var s=e.length,o,u,a;for(var f=1;f<s;f++)o=e[f],u=f*4,a=f/(s-1),f%2?(t[u]=a,t[u+1]=0,t[u+2]=a,t[u+3]=1):(t[u]=a,t[u+1]=0,t[u+2]=a,t[u+3]=1),u=f*2,i[u]=1,i[u+1]=1,u=f*2,r[u]=u,r[u+1]=u+1,n=o},t.Rope.prototype.updateTransform=function(){var e=this.points;if(e.length<1)return;var n=e[0],r,i={x:0,y:0};this.count-=.2;var s=this.verticies,o=e.length,u,a,f,l,c;for(var h=0;h<o;h++)u=e[h],a=h*4,h<e.length-1?r=e[h+1]:r=u,i.y=-(r.x-n.x),i.x=r.y-n.y,f=(1-h/(o-1))*10,f>1&&(f=1),l=Math.sqrt(i.x*i.x+i.y*i.y),c=this.texture.height/2,i.x/=l,i.y/=l,i.x*=c,i.y*=c,s[a]=u.x+i.x,s[a+1]=u.y+i.y,s[a+2]=u.x-i.x,s[a+3]=u.y-i.y,n=u;t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.Rope.prototype.setTexture=function(e){this.texture=e},t.TilingSprite=function(e,n,r){t.Sprite.call(this,e),this._width=n||100,this._height=r||100,this.tileScale=new t.Point(1,1),this.tileScaleOffset=new t.Point(1,1),this.tilePosition=new t.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=t.blendModes.NORMAL},t.TilingSprite.prototype=Object.create(t.Sprite.prototype),t.TilingSprite.prototype.constructor=t.TilingSprite,Object.defineProperty(t.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e}}),Object.defineProperty(t.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e}}),t.TilingSprite.prototype.setTexture=function(e){if(this.texture===e)return;this.texture=e,this.refreshTexture=!0,this.cachedTint=16777215},t.TilingSprite.prototype._renderWebGL=function(e){if(this.visible===!1||this.alpha===0)return;var n,r;this._mask&&(e.spriteBatch.stop(),e.maskManager.pushMask(this.mask,e),e.spriteBatch.start()),this._filters&&(e.spriteBatch.flush(),e.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(t.updateWebGLTexture(this.tilingTexture.baseTexture,e.gl),this.tilingTexture.needsUpdate=!1)):e.spriteBatch.renderTilingSprite(this);for(n=0,r=this.children.length;n<r;n++)this.children[n]._renderWebGL(e);e.spriteBatch.stop(),this._filters&&e.filterManager.popFilter(),this._mask&&e.maskManager.popMask(this._mask,e),e.spriteBatch.start()},t.TilingSprite.prototype._renderCanvas=function(e){if(this.visible===!1||this.alpha===0)return;var n=e.context;this._mask&&e.maskManager.pushMask(this._mask,n),n.globalAlpha=this.worldAlpha;var r=this.worldTransform,i,s,o=e.resolution;n.setTransform(r.a*o,r.c*o,r.b*o,r.d*o,r.tx*o,r.ty*o);if(!this.__tilePattern||this.refreshTexture){this.generateTilingTexture(!1);if(!this.tilingTexture)return;this.__tilePattern=n.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==e.currentBlendMode&&(e.currentBlendMode=this.blendMode,n.globalCompositeOperation=t.blendModesCanvas[e.currentBlendMode]);var u=this.tilePosition,a=this.tileScale;u.x%=this.tilingTexture.baseTexture.width,u.y%=this.tilingTexture.baseTexture.height,n.scale(a.x,a.y),n.translate(u.x+this.anchor.x*-this._width,u.y+this.anchor.y*-this._height),n.fillStyle=this.__tilePattern,n.fillRect(-u.x,-u.y,this._width/a.x,this._height/a.y),n.scale(1/a.x,1/a.y),n.translate(-u.x+this.anchor.x*this._width,-u.y+this.anchor.y*this._height),this._mask&&e.maskManager.popMask(e.context);for(i=0,s=this.children.length;i<s;i++)this.children[i]._renderCanvas(e)},t.TilingSprite.prototype.getBounds=function(){var e=this._width,t=this._height,n=e*(1-this.anchor.x),r=e*-this.anchor.x,i=t*(1-this.anchor.y),s=t*-this.anchor.y,o=this.worldTransform,u=o.a,a=o.c,f=o.b,l=o.d,c=o.tx,h=o.ty,p=u*r+f*s+c,d=l*s+a*r+h,v=u*n+f*s+c,m=l*s+a*n+h,g=u*n+f*i+c,y=l*i+a*n+h,b=u*r+f*i+c,w=l*i+a*r+h,E=-Infinity,S=-Infinity,x=Infinity,T=Infinity;x=p<x?p:x,x=v<x?v:x,x=g<x?g:x,x=b<x?b:x,T=d<T?d:T,T=m<T?m:T,T=y<T?y:T,T=w<T?w:T,E=p>E?p:E,E=v>E?v:E,E=g>E?g:E,E=b>E?b:E,S=d>S?d:S,S=m>S?m:S,S=y>S?y:S,S=w>S?w:S;var N=this._bounds;return N.x=x,N.width=E-x,N.y=T,N.height=S-T,this._currentBounds=N,N},t.TilingSprite.prototype.onTextureUpdate=function(){},t.TilingSprite.prototype.generateTilingTexture=function(e){if(!this.texture.baseTexture.hasLoaded)return;var n=this.originalTexture||this.texture,r=n.frame,i,s,o=r.width!==n.baseTexture.width||r.height!==n.baseTexture.height,u=!1;if(!e)o&&(i=r.width,s=r.height,u=!0);else{i=t.getNextPowerOfTwo(r.width),s=t.getNextPowerOfTwo(r.height);if(r.width!==i||r.height!==s)u=!0}if(u){var a;this.tilingTexture&&this.tilingTexture.isTiling?(a=this.tilingTexture.canvasBuffer,a.resize(i,s),this.tilingTexture.baseTexture.width=i,this.tilingTexture.baseTexture.height=s,this.tilingTexture.needsUpdate=!0):(a=new t.CanvasBuffer(i,s),this.tilingTexture=t.Texture.fromCanvas(a.canvas),this.tilingTexture.canvasBuffer=a,this.tilingTexture.isTiling=!0),a.context.drawImage(n.baseTexture.source,n.crop.x,n.crop.y,n.crop.width,n.crop.height,0,0,i,s),this.tileScaleOffset.x=r.width/i,this.tileScaleOffset.y=r.height/s}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=n;this.refreshTexture=!1,this.originalTexture=this.texture,this.texture=this.tilingTexture,this.tilingTexture.baseTexture._powerOf2=!0};var n={};n.BoneData=function(e,t){this.name=e,this.parent=t},n.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},n.SlotData=function(e,t){this.name=e,this.boneData=t},n.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},n.Bone=function(e,t){this.data=e,this.parent=t,this.setToSetupPose()},n.Bone.yDown=!1,n.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(e,t){var r=this.parent;r!=null?(this.worldX=this.x*r.m00+this.y*r.m01+r.worldX,this.worldY=this.x*r.m10+this.y*r.m11+r.worldY,this.worldScaleX=r.worldScaleX*this.scaleX,this.worldScaleY=r.worldScaleY*this.scaleY,this.worldRotation=r.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var i=this.worldRotation*Math.PI/180,s=Math.cos(i),o=Math.sin(i);this.m00=s*this.worldScaleX,this.m10=o*this.worldScaleX,this.m01=-o*this.worldScaleY,this.m11=s*this.worldScaleY,e&&(this.m00=-this.m00,this.m01=-this.m01),t&&(this.m10=-this.m10,this.m11=-this.m11),n.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var e=this.data;this.x=e.x,this.y=e.y,this.rotation=e.rotation,this.scaleX=e.scaleX,this.scaleY=e.scaleY}},n.Slot=function(e,t,n){this.data=e,this.skeleton=t,this.bone=n,this.setToSetupPose()},n.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(e){this.attachment=e,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(e){this._attachmentTime=this.skeleton.time-e},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var e=this.data;this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a;var t=this.skeleton.data.slots;for(var n=0,r=t.length;n<r;n++)if(t[n]==e){this.setAttachment(e.attachmentName?this.skeleton.getAttachmentBySlotIndex(n,e.attachmentName):null);break}}},n.Skin=function(e){this.name=e,this.attachments={}},n.Skin.prototype={addAttachment:function(e,t,n){this.attachments[e+":"+t]=n},getAttachment:function(e,t){return this.attachments[e+":"+t]},_attachAll:function(e,t){for(var n in t.attachments){var r=n.indexOf(":"),i=parseInt(n.substring(0,r),10),s=n.substring(r+1),o=e.slots[i];if(o.attachment&&o.attachment.name==s){var u=this.getAttachment(i,s);u&&o.setAttachment(u)}}}},n.Animation=function(e,t,n){this.name=e,this.timelines=t,this.duration=n},n.Animation.prototype={apply:function(e,t,n){n&&this.duration&&(t%=this.duration);var r=this.timelines;for(var i=0,s=r.length;i<s;i++)r[i].apply(e,t,1)},mix:function(e,t,n,r){n&&this.duration&&(t%=this.duration);var i=this.timelines;for(var s=0,o=i.length;s<o;s++)i[s].apply(e,t,r)}},n.binarySearch=function(e,t,n){var r=0,i=Math.floor(e.length/n)-2;if(!i)return n;var s=i>>>1;for(;;){e[(s+1)*n]<=t?r=s+1:i=s;if(r==i)return(r+1)*n;s=r+i>>>1}},n.linearSearch=function(e,t,n){for(var r=0,i=e.length-n;r<=i;r+=n)if(e[r]>t)return r;return-1},n.Curves=function(e){this.curves=[],this.curves.length=(e-1)*6},n.Curves.prototype={setLinear:function(e){this.curves[e*6]=0},setStepped:function(e){this.curves[e*6]=-1},setCurve:function(e,t,n,r,i){var s=.1,o=s*s,u=o*s,a=3*s,f=3*o,l=6*o,c=6*u,h=-t*2+r,p=-n*2+i,d=(t-r)*3+1,v=(n-i)*3+1,m=e*6,g=this.curves;g[m]=t*a+h*f+d*u,g[m+1]=n*a+p*f+v*u,g[m+2]=h*l+d*c,g[m+3]=p*l+v*c,g[m+4]=d*c,g[m+5]=v*c},getCurvePercent:function(e,t){t=t<0?0:t>1?1:t;var n=e*6,r=this.curves,i=r[n];if(!i)return t;if(i==-1)return 0;var s=r[n+1],o=r[n+2],u=r[n+3],a=r[n+4],f=r[n+5],l=i,c=s,h=8;for(;;){if(l>=t){var p=l-i,d=c-s;return d+(c-d)*(t-p)/(l-p)}if(!h)break;h--,i+=o,s+=u,o+=a,u+=f,l+=i,c+=s}return c+(1-c)*(t-l)/(1-l)}},n.RotateTimeline=function(e){this.curves=new n.Curves(e),this.frames=[],this.frames.length=e*2},n.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t,n){e*=2,this.frames[e]=t,this.frames[e+1]=n},apply:function(e,t,r){var i=this.frames,s;if(t<i[0])return;var o=e.bones[this.boneIndex];if(t>=i[i.length-2]){s=o.data.rotation+i[i.length-1]-o.rotation;while(s>180)s-=360;while(s<-180)s+=360;o.rotation+=s*r;return}var u=n.binarySearch(i,t,2),a=i[u-1],f=i[u],l=1-(t-f)/(i[u-2]-f);l=this.curves.getCurvePercent(u/2-1,l),s=i[u+1]-a;while(s>180)s-=360;while(s<-180)s+=360;s=o.data.rotation+(a+s*l)-o.rotation;while(s>180)s-=360;while(s<-180)s+=360;o.rotation+=s*r}},n.TranslateTimeline=function(e){this.curves=new n.Curves(e),this.frames=[],this.frames.length=e*3},n.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3,this.frames[e]=t,this.frames[e+1]=n,this.frames[e+2]=r},apply:function(e,t,r){var i=this.frames;if(t<i[0])return;var s=e.bones[this.boneIndex];if(t>=i[i.length-3]){s.x+=(s.data.x+i[i.length-2]-s.x)*r,s.y+=(s.data.y+i[i.length-1]-s.y)*r;return}var o=n.binarySearch(i,t,3),u=i[o-2],a=i[o-1],f=i[o],l=1-(t-f)/(i[o+ -3]-f);l=this.curves.getCurvePercent(o/3-1,l),s.x+=(s.data.x+u+(i[o+1]-u)*l-s.x)*r,s.y+=(s.data.y+a+(i[o+2]-a)*l-s.y)*r}},n.ScaleTimeline=function(e){this.curves=new n.Curves(e),this.frames=[],this.frames.length=e*3},n.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3,this.frames[e]=t,this.frames[e+1]=n,this.frames[e+2]=r},apply:function(e,t,r){var i=this.frames;if(t<i[0])return;var s=e.bones[this.boneIndex];if(t>=i[i.length-3]){s.scaleX+=(s.data.scaleX-1+i[i.length-2]-s.scaleX)*r,s.scaleY+=(s.data.scaleY-1+i[i.length-1]-s.scaleY)*r;return}var o=n.binarySearch(i,t,3),u=i[o-2],a=i[o-1],f=i[o],l=1-(t-f)/(i[o+ -3]-f);l=this.curves.getCurvePercent(o/3-1,l),s.scaleX+=(s.data.scaleX-1+u+(i[o+1]-u)*l-s.scaleX)*r,s.scaleY+=(s.data.scaleY-1+a+(i[o+2]-a)*l-s.scaleY)*r}},n.ColorTimeline=function(e){this.curves=new n.Curves(e),this.frames=[],this.frames.length=e*5},n.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(e,t,n,r,i,s){e*=5,this.frames[e]=t,this.frames[e+1]=n,this.frames[e+2]=r,this.frames[e+3]=i,this.frames[e+4]=s},apply:function(e,t,r){var i=this.frames;if(t<i[0])return;var s=e.slots[this.slotIndex];if(t>=i[i.length-5]){var o=i.length-1;s.r=i[o-3],s.g=i[o-2],s.b=i[o-1],s.a=i[o];return}var u=n.binarySearch(i,t,5),a=i[u-4],f=i[u-3],l=i[u-2],c=i[u-1],h=i[u],p=1-(t-h)/(i[u-5]-h);p=this.curves.getCurvePercent(u/5-1,p);var d=a+(i[u+1]-a)*p,v=f+(i[u+2]-f)*p,m=l+(i[u+3]-l)*p,g=c+(i[u+4]-c)*p;r<1?(s.r+=(d-s.r)*r,s.g+=(v-s.g)*r,s.b+=(m-s.b)*r,s.a+=(g-s.a)*r):(s.r=d,s.g=v,s.b=m,s.a=g)}},n.AttachmentTimeline=function(e){this.curves=new n.Curves(e),this.frames=[],this.frames.length=e,this.attachmentNames=[],this.attachmentNames.length=e},n.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(e,t,n){this.frames[e]=t,this.attachmentNames[e]=n},apply:function(e,t,r){var i=this.frames;if(t<i[0])return;var s;t>=i[i.length-1]?s=i.length-1:s=n.binarySearch(i,t,1)-1;var o=this.attachmentNames[s];e.slots[this.slotIndex].setAttachment(o?e.getAttachmentBySlotIndex(this.slotIndex,o):null)}},n.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},n.SkeletonData.prototype={defaultSkin:null,findBone:function(e){var t=this.bones;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null},findBoneIndex:function(e){var t=this.bones;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return n;return-1},findSlot:function(e){var t=this.slots;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return slot[n];return null},findSlotIndex:function(e){var t=this.slots;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return n;return-1},findSkin:function(e){var t=this.skins;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null},findAnimation:function(e){var t=this.animations;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null}},n.Skeleton=function(e){this.data=e,this.bones=[];for(var t=0,r=e.bones.length;t<r;t++){var i=e.bones[t],s=i.parent?this.bones[e.bones.indexOf(i.parent)]:null;this.bones.push(new n.Bone(i,s))}this.slots=[],this.drawOrder=[];for(t=0,r=e.slots.length;t<r;t++){var o=e.slots[t],u=this.bones[e.bones.indexOf(o.boneData)],a=new n.Slot(o,this,u);this.slots.push(a),this.drawOrder.push(a)}},n.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){var e=this.flipX,t=this.flipY,n=this.bones;for(var r=0,i=n.length;r<i;r++)n[r].updateWorldTransform(e,t)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){var e=this.bones;for(var t=0,n=e.length;t<n;t++)e[t].setToSetupPose()},setSlotsToSetupPose:function(){var e=this.slots;for(var t=0,n=e.length;t<n;t++)e[t].setToSetupPose(t)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(e){var t=this.bones;for(var n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return t[n];return null},findBoneIndex:function(e){var t=this.bones;for(var n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return n;return-1},findSlot:function(e){var t=this.slots;for(var n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return t[n];return null},findSlotIndex:function(e){var t=this.slots;for(var n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return n;return-1},setSkinByName:function(e){var t=this.data.findSkin(e);if(!t)throw"Skin not found: "+e;this.setSkin(t)},setSkin:function(e){this.skin&&e&&e._attachAll(this,this.skin),this.skin=e},getAttachmentBySlotName:function(e,t){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(e),t)},getAttachmentBySlotIndex:function(e,t){if(this.skin){var n=this.skin.getAttachment(e,t);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(e,t):null},setAttachment:function(e,t){var n=this.slots;for(var r=0,i=n.size;r<i;r++){var s=n[r];if(s.data.name==e){var o=null;if(t){o=this.getAttachment(r,t);if(o==null)throw"Attachment not found: "+t+", for slot: "+e}s.setAttachment(o);return}}throw"Slot not found: "+e},update:function(e){time+=e}},n.AttachmentType={region:0},n.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},n.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(e,t,n,r,i){var s=this.uvs;i?(s[2]=e,s[3]=r,s[4]=e,s[5]=t,s[6]=n,s[7]=t,s[0]=n,s[1]=r):(s[0]=e,s[1]=r,s[2]=e,s[3]=t,s[4]=n,s[5]=t,s[6]=n,s[7]=r)},updateOffset:function(){var e=this.width/this.regionOriginalWidth*this.scaleX,t=this.height/this.regionOriginalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.regionOffsetX*e,r=-this.height/2*this.scaleY+this.regionOffsetY*t,i=n+this.regionWidth*e,s=r+this.regionHeight*t,o=this.rotation*Math.PI/180,u=Math.cos(o),a=Math.sin(o),f=n*u+this.x,l=n*a,c=r*u+this.y,h=r*a,p=i*u+this.x,d=i*a,v=s*u+this.y,m=s*a,g=this.offset;g[0]=f-h,g[1]=c+l,g[2]=f-m,g[3]=v+l,g[4]=p-m,g[5]=v+d,g[6]=p-h,g[7]=c+d},computeVertices:function(e,t,n,r){e+=n.worldX,t+=n.worldY;var i=n.m00,s=n.m01,o=n.m10,u=n.m11,a=this.offset;r[0]=a[0]*i+a[1]*s+e,r[1]=a[0]*o+a[1]*u+t,r[2]=a[2]*i+a[3]*s+e,r[3]=a[2]*o+a[3]*u+t,r[4]=a[4]*i+a[5]*s+e,r[5]=a[4]*o+a[5]*u+t,r[6]=a[6]*i+a[7]*s+e,r[7]=a[6]*o+a[7]*u+t}},n.AnimationStateData=function(e){this.skeletonData=e,this.animationToMixTime={}},n.AnimationStateData.prototype={defaultMix:0,setMixByName:function(e,t,n){var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;var i=this.skeletonData.findAnimation(t);if(!i)throw"Animation not found: "+t;this.setMix(r,i,n)},setMix:function(e,t,n){this.animationToMixTime[e.name+":"+t.name]=n},getMix:function(e,t){var n=this.animationToMixTime[e.name+":"+t.name];return n?n:this.defaultMix}},n.AnimationState=function(e){this.data=e,this.queue=[]},n.AnimationState.prototype={animationSpeed:1,current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(e){this.currentTime+=e*this.animationSpeed,this.previousTime+=e,this.mixTime+=e;if(this.queue.length>0){var t=this.queue[0];this.currentTime>=t.delay&&(this._setAnimation(t.animation,t.loop),this.queue.shift())}},apply:function(e){if(!this.current)return;if(this.previous){this.previous.apply(e,this.previousTime,this.previousLoop);var t=this.mixTime/this.mixDuration;t>=1&&(t=1,this.previous=null),this.current.mix(e,this.currentTime,this.currentLoop,t)}else this.current.apply(e,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(e,t){this.previous=null,e&&this.current&&(this.mixDuration=this.data.getMix(this.current,e),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=e,this.currentLoop=t,this.currentTime=0},setAnimationByName:function(e,t){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;this.setAnimation(n,t)},setAnimation:function(e,t){this.queue.length=0,this._setAnimation(e,t)},addAnimationByName:function(e,t,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.addAnimation(r,t,n)},addAnimation:function(e,t,n){var r={};r.animation=e,r.loop=t;if(!n||n<=0){var i=this.queue.length?this.queue[this.queue.length-1].animation:this.current;i!=null?n=i.duration-this.data.getMix(i,e)+(n||0):n=0}r.delay=n,this.queue.push(r)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},n.SkeletonJson=function(e){this.attachmentLoader=e},n.SkeletonJson.prototype={scale:1,readSkeletonData:function(e){var t=new n.SkeletonData,r,i=e.bones;for(var s=0,o=i.length;s<o;s++){var u=i[s],a=null;if(u.parent){a=t.findBone(u.parent);if(!a)throw"Parent bone not found: "+u.parent}r=new n.BoneData(u.name,a),r.length=(u.length||0)*this.scale,r.x=(u.x||0)*this.scale,r.y=(u.y||0)*this.scale,r.rotation=u.rotation||0,r.scaleX=u.scaleX||1,r.scaleY=u.scaleY||1,t.bones.push(r)}var f=e.slots;for(s=0,o=f.length;s<o;s++){var l=f[s];r=t.findBone(l.bone);if(!r)throw"Slot bone not found: "+l.bone;var c=new n.SlotData(l.name,r),h=l.color;h&&(c.r=n.SkeletonJson.toColor(h,0),c.g=n.SkeletonJson.toColor(h,1),c.b=n.SkeletonJson.toColor(h,2),c.a=n.SkeletonJson.toColor(h,3)),c.attachmentName=l.attachment,t.slots.push(c)}var p=e.skins;for(var d in p){if(!p.hasOwnProperty(d))continue;var v=p[d],m=new n.Skin(d);for(var g in v){if(!v.hasOwnProperty(g))continue;var y=t.findSlotIndex(g),b=v[g];for(var w in b){if(!b.hasOwnProperty(w))continue;var E=this.readAttachment(m,w,b[w]);E!=null&&m.addAttachment(y,w,E)}}t.skins.push(m),m.name=="default"&&(t.defaultSkin=m)}var S=e.animations;for(var x in S){if(!S.hasOwnProperty(x))continue;this.readAnimation(x,S[x],t)}return t},readAttachment:function(e,t,r){t=r.name||t;var i=n.AttachmentType[r.type||"region"];if(i==n.AttachmentType.region){var s=new n.RegionAttachment;return s.x=(r.x||0)*this.scale,s.y=(r.y||0)*this.scale,s.scaleX=r.scaleX||1,s.scaleY=r.scaleY||1,s.rotation=r.rotation||0,s.width=(r.width||32)*this.scale,s.height=(r.height||32)*this.scale,s.updateOffset(),s.rendererObject={},s.rendererObject.name=t,s.rendererObject.scale={},s.rendererObject.scale.x=s.scaleX,s.rendererObject.scale.y=s.scaleY,s.rendererObject.rotation=-s.rotation*Math.PI/180,s}throw"Unknown attachment type: "+i},readAnimation:function(e,t,r){var i=[],s=0,o,u,a,f,l,c,h,p=t.bones;for(var d in p){if(!p.hasOwnProperty(d))continue;var v=r.findBoneIndex(d);if(v==-1)throw"Bone not found: "+d;var m=p[d];for(a in m){if(!m.hasOwnProperty(a))continue;l=m[a];if(a=="rotate"){u=new n.RotateTimeline(l.length),u.boneIndex=v,o=0;for(c=0,h=l.length;c<h;c++)f=l[c],u.setFrame(o,f.time,f.angle),n.SkeletonJson.readCurve(u,o,f),o++;i.push(u),s=Math.max(s,u.frames[u.getFrameCount()*2-2])}else{if(a!="translate"&&a!="scale")throw"Invalid timeline type for a bone: "+a+" ("+d+")";var g=1;a=="scale"?u=new n.ScaleTimeline(l.length):(u=new n.TranslateTimeline(l.length),g=this.scale),u.boneIndex=v,o=0;for(c=0,h=l.length;c<h;c++){f=l[c];var y=(f.x||0)*g,b=(f.y||0)*g;u.setFrame(o,f.time,y,b),n.SkeletonJson.readCurve(u,o,f),o++}i.push(u),s=Math.max(s,u.frames[u.getFrameCount()*3-3])}}}var w=t.slots;for(var E in w){if(!w.hasOwnProperty(E))continue;var S=w[E],x=r.findSlotIndex(E);for(a in S){if(!S.hasOwnProperty(a))continue;l=S[a];if(a=="color"){u=new n.ColorTimeline(l.length),u.slotIndex=x,o=0;for(c=0,h=l.length;c<h;c++){f=l[c];var T=f.color,N=n.SkeletonJson.toColor(T,0),C=n.SkeletonJson.toColor(T,1),k=n.SkeletonJson.toColor(T,2),L=n.SkeletonJson.toColor(T,3);u.setFrame(o,f.time,N,C,k,L),n.SkeletonJson.readCurve(u,o,f),o++}i.push(u),s=Math.max(s,u.frames[u.getFrameCount()*5-5])}else{if(a!="attachment")throw"Invalid timeline type for a slot: "+a+" ("+E+")";u=new n.AttachmentTimeline(l.length),u.slotIndex=x,o=0;for(c=0,h=l.length;c<h;c++)f=l[c],u.setFrame(o++,f.time,f.name);i.push(u),s=Math.max(s,u.frames[u.getFrameCount()-1])}}}r.animations.push(new n.Animation(e,i,s))}},n.SkeletonJson.readCurve=function(e,t,n){var r=n.curve;if(!r)return;r=="stepped"?e.curves.setStepped(t):r instanceof Array&&e.curves.setCurve(t,r[0],r[1],r[2],r[3])},n.SkeletonJson.toColor=function(e,t){if(e.length!=8)throw"Color hexidecimal length must be 8, recieved: "+e;return parseInt(e.substr(t*2,2),16)/255},n.Atlas=function(e,t){this.textureLoader=t,this.pages=[],this.regions=[];var r=new n.AtlasReader(e),i=[];i.length=4;var s=null;for(;;){var o=r.readLine();if(o==null)break;o=r.trim(o);if(!o.length)s=null;else if(!s){s=new n.AtlasPage,s.name=o,s.format=n.Atlas.Format[r.readValue()],r.readTuple(i),s.minFilter=n.Atlas.TextureFilter[i[0]],s.magFilter=n.Atlas.TextureFilter[i[1]];var u=r.readValue();s.uWrap=n.Atlas.TextureWrap.clampToEdge,s.vWrap=n.Atlas.TextureWrap.clampToEdge,u=="x"?s.uWrap=n.Atlas.TextureWrap.repeat:u=="y"?s.vWrap=n.Atlas.TextureWrap.repeat:u=="xy"&&(s.uWrap=s.vWrap=n.Atlas.TextureWrap.repeat),t.load(s,o),this.pages.push(s)}else{var a=new n.AtlasRegion;a.name=o,a.page=s,a.rotate=r.readValue()=="true",r.readTuple(i);var f=parseInt(i[0],10),l=parseInt(i[1],10);r.readTuple(i);var c=parseInt(i[0],10),h=parseInt(i[1],10);a.u=f/s.width,a.v=l/s.height,a.rotate?(a.u2=(f+h)/s.width,a.v2=(l+c)/s.height):(a.u2=(f+c)/s.width,a.v2=(l+h)/s.height),a.x=f,a.y=l,a.width=Math.abs(c),a.height=Math.abs(h),r.readTuple(i)==4&&(a.splits=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10),parseInt(i[3],10)],r.readTuple(i)==4&&(a.pads=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10),parseInt(i[3],10)],r.readTuple(i))),a.originalWidth=parseInt(i[0],10),a.originalHeight=parseInt(i[1],10),r.readTuple(i),a.offsetX=parseInt(i[0],10),a.offsetY=parseInt(i[1],10),a.index=parseInt(r.readValue(),10),this.regions.push(a)}}},n.Atlas.prototype={findRegion:function(e){var t=this.regions;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null},dispose:function(){var e=this.pages;for(var t=0,n=e.length;t<n;t++)this.textureLoader.unload(e[t].rendererObject)},updateUVs:function(e){var t=this.regions;for(var n=0,r=t.length;n<r;n++){var i=t[n];if(i.page!=e)continue;i.u=i.x/e.width,i.v=i.y/e.height,i.rotate?(i.u2=(i.x+i.height)/e.width,i.v2=(i.y+i.width)/e.height):(i.u2=(i.x+i.width)/e.width,i.v2=(i.y+i.height)/e.height)}}},n.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},n.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},n.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},n.AtlasPage=function(){},n.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},n.AtlasRegion=function(){},n.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},n.AtlasReader=function(e){this.lines=e.split(/\r\n|\r|\n/)},n.AtlasReader.prototype={index:0,trim:function(e){return e.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var e=this.readLine(),t=e.indexOf(":");if(t==-1)throw"Invalid line: "+e;return this.trim(e.substring(t+1))},readTuple:function(e){var t=this.readLine(),n=t.indexOf(":");if(n==-1)throw"Invalid line: "+t;var r=0,i=n+1;for(;r<3;r++){var s=t.indexOf(",",i);if(s==-1){if(!r)throw"Invalid line: "+t;break}e[r]=this.trim(t.substr(i,s-i)),i=s+1}return e[r]=this.trim(t.substring(i)),r+1}},n.AtlasAttachmentLoader=function(e){this.atlas=e},n.AtlasAttachmentLoader.prototype={newAttachment:function(e,t,r){switch(t){case n.AttachmentType.region:var i=this.atlas.findRegion(r);if(!i)throw"Region not found in atlas: "+r+" ("+t+")";var s=new n.RegionAttachment(r);return s.rendererObject=i,s.setUVs(i.u,i.v,i.u2,i.v2,i.rotate),s.regionOffsetX=i.offsetX,s.regionOffsetY=i.offsetY,s.regionWidth=i.width,s.regionHeight=i.height,s.regionOriginalWidth=i.originalWidth,s.regionOriginalHeight=i.originalHeight,s}throw"Unknown attachment type: "+t}},n.Bone.yDown=!0,t.AnimCache={},t.Spine=function(e){t.DisplayObjectContainer.call(this),this.spineData=t.AnimCache[e];if(!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+e);this.skeleton=new n.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new n.AnimationStateData(this.spineData),this.state=new n.AnimationState(this.stateData),this.slotContainers=[];for(var r=0,i=this.skeleton.drawOrder.length;r<i;r++){var s=this.skeleton.drawOrder[r],o=s.attachment,u=new t.DisplayObjectContainer;this.slotContainers.push(u),this.addChild(u);if(!(o instanceof n.RegionAttachment))continue;var a=o.rendererObject.name,f=this.createSprite(s,o.rendererObject);s.currentSprite=f,s.currentSpriteName=a,u.addChild(f)}},t.Spine.prototype=Object.create(t.DisplayObjectContainer.prototype),t.Spine.prototype.constructor=t.Spine,t.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var e=(Date.now()-this.lastTime)*.001;this.lastTime=Date.now(),this.state.update(e),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();var r=this.skeleton.drawOrder;for(var i=0,s=r.length;i<s;i++){var o=r[i],u=o.attachment,a=this.slotContainers[i];if(!(u instanceof n.RegionAttachment)){a.visible=!1;continue}if(u.rendererObject)if(!o.currentSpriteName||o.currentSpriteName!=u.name){var f=u.rendererObject.name;o.currentSprite!==undefined&&(o.currentSprite.visible=!1),o.sprites=o.sprites||{};if(o.sprites[f]!==undefined)o.sprites[f].visible=!0;else{var l=this.createSprite(o,u.rendererObject);a.addChild(l)}o.currentSprite=o.sprites[f],o.currentSpriteName=f}a.visible=!0;var c=o.bone;a.position.x=c.worldX+u.x*c.m00+u.y*c.m01,a.position.y=c.worldY+u.x*c.m10+u.y*c.m11,a.scale.x=c.worldScaleX,a.scale.y=c.worldScaleY,a.rotation=-(o.bone.worldRotation*Math.PI/180),a.alpha=o.a,o.currentSprite.tint=t.rgb2hex([o.r,o.g,o.b])}t.DisplayObjectContainer.prototype.updateTransform.call(this)},t.Spine.prototype.createSprite=function(e,n){var r=t.TextureCache[n.name]?n.name:n.name+".png",i=new t.Sprite(t.Texture.fromFrame(r));return i.scale=n.scale,i.rotation=n.rotation,i.anchor.x=i.anchor.y=.5,e.sprites=e.sprites||{},e.sprites[n.name]=i,i},t.BaseTextureCache={},t.BaseTextureCacheIdGenerator=0,t.BaseTexture=function(e,n){this.resolution=1,this.width=100,this.height=100,this.scaleMode=n||t.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=e,this._UID=t._UID++,this.premultipliedAlpha=!0,this._glTextures=[],this._dirty=[!0,!0,!0,!0];if(!e)return;if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.naturalWidth||this.source.width,this.height=this.source.naturalHeight||this.source.height,this.dirty();else{var r=this;this.source.onload=function(){r.hasLoaded=!0,r.width=r.source.naturalWidth||r.source.width,r.height=r.source.naturalHeight||r.source.height,r.dirty(),r.dispatchEvent({type:"loaded",content:r})},this.source.onerror=function(){r.dispatchEvent({type:"error",content:r})}}this.imageUrl=null,this._powerOf2=!1},t.BaseTexture.prototype.constructor=t.BaseTexture,t.EventTarget.mixin(t.BaseTexture.prototype),t.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete t.BaseTextureCache[this.imageUrl],delete t.TextureCache[this.imageUrl],this.imageUrl=null,this.source.src=""):this.source&&this.source._pixiId&&delete t.BaseTextureCache[this.source._pixiId],this.source=null;for(var e=this._glTextures.length-1;e>=0;e--){var n=this._glTextures[e],r=t.glContexts[e];r&&n&&r.deleteTexture(n)}this._glTextures.length=0},t.BaseTexture.prototype.updateSourceImage=function(e){this.hasLoaded=!1,this.source.src=null,this.source.src=e},t.BaseTexture.prototype.dirty=function(){for(var e=0;e<this._glTextures.length;e++)this._dirty[e]=!0},t.BaseTexture.fromImage=function(e,n,r){var i=t.BaseTextureCache[e];n===undefined&&e.indexOf("data:")===-1&&(n=!0);if(!i){var s=new Image;n&&(s.crossOrigin=""),s.src=e,i=new t.BaseTexture(s,r),i.imageUrl=e,t.BaseTextureCache[e]=i,e.indexOf(t.RETINA_PREFIX+".")!==-1&&(i.resolution=2)}return i},t.BaseTexture.fromCanvas=function(e,n){e._pixiId||(e._pixiId="canvas_"+t.TextureCacheIdGenerator++);var r=t.BaseTextureCache[e._pixiId];return r||(r=new t.BaseTexture(e,n),t.BaseTextureCache[e._pixiId]=r),r},t.TextureCache={},t.FrameCache={},t.TextureCacheIdGenerator=0,t.Texture=function(e,n,r,i){this.noFrame=!1,n||(this.noFrame=!0,n=new t.Rectangle(0,0,1,1)),e instanceof t.Texture&&(e=e.baseTexture),this.baseTexture=e,this.frame=n,this.trim=i,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=r||new t.Rectangle(0,0,1,1),e.hasLoaded?(this.noFrame&&(n=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(n)):e.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))},t.Texture.prototype.constructor=t.Texture,t.EventTarget.mixin(t.Texture.prototype),t.Texture.prototype.onBaseTextureLoaded=function(){var e=this.baseTexture;e.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new t.Rectangle(0,0,e.width,e.height)),this.setFrame(this.frame),this.dispatchEvent({type:"update",content:this})},t.Texture.prototype.destroy=function(e){e&&this.baseTexture.destroy(),this.valid=!1},t.Texture.prototype.setFrame=function(e){this.noFrame=!1,this.frame=e,this.width=e.width,this.height=e.height,this.crop.x=e.x,this.crop.y=e.y,this.crop.width=e.width,this.crop.height=e.height;if(!this.trim&&(e.x+e.width>this.baseTexture.width||e.y+e.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=e&&e.width&&e.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&this._updateUvs()},t.Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new t.TextureUvs);var e=this.crop,n=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=e.x/n,this._uvs.y0=e.y/r,this._uvs.x1=(e.x+e.width)/n,this._uvs.y1=e.y/r,this._uvs.x2=(e.x+e.width)/n,this._uvs.y2=(e.y+e.height)/r,this._uvs.x3=e.x/n,this._uvs.y3=(e.y+e.height)/r},t.Texture.fromImage=function(e,n,r){var i=t.TextureCache[e];return i||(i=new t.Texture(t.BaseTexture.fromImage(e,n,r)),t.TextureCache[e]=i),i},t.Texture.fromFrame=function(e){var n=t.TextureCache[e];if(!n)throw new Error('The frameId "'+e+'" does not exist in the texture cache ');return n},t.Texture.fromCanvas=function(e,n){var r=t.BaseTexture.fromCanvas(e,n);return new t.Texture(r)},t.Texture.addTextureToCache=function(e,n){t.TextureCache[n]=e},t.Texture.removeTextureFromCache=function(e){var n=t.TextureCache[e];return delete t.TextureCache[e],delete t.BaseTextureCache[e],n},t.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},t.RenderTexture=function(e,n,r,i,s){this.width=e||100,this.height=n||100,this.resolution=s||1,this.frame=new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.crop=new t.Rectangle(0,0,this.width*this.resolution,this.height*this.resolution),this.baseTexture=new t.BaseTexture,this.baseTexture.width=this.width*this.resolution,this.baseTexture.height=this.height*this.resolution,this.baseTexture._glTextures=[],this.baseTexture.resolution=this.resolution,this.baseTexture.scaleMode=i||t.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,t.Texture.call(this,this.baseTexture,new t.Rectangle(0,0,this.width,this.height)),this.renderer=r||t.defaultRenderer;if(this.renderer.type===t.WEBGL_RENDERER){var o=this.renderer.gl;this.baseTexture._dirty[o.id]=!1,this.textureBuffer=new t.FilterTexture(o,this.width*this.resolution,this.height*this.resolution,this.baseTexture.scaleMode),this.baseTexture._glTextures[o.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new t.Point(this.width*.5,-this.height*.5)}else this.render=this.renderCanvas,this.textureBuffer=new t.CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()},t.RenderTexture.prototype=Object.create(t.Texture.prototype),t.RenderTexture.prototype.constructor=t.RenderTexture,t.RenderTexture.prototype.resize=function(e,n,r){if(e===this.width&&n===this.height)return;this.valid=e>0&&n>0,this.width=this.frame.width=this.crop.width=e,this.height=this.frame.height=this.crop.height=n,r&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===t.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2);if(!this.valid)return;this.textureBuffer.resize(this.width*this.resolution,this.height*this.resolution)},t.RenderTexture.prototype.clear=function(){if(!this.valid)return;this.renderer.type===t.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear()},t.RenderTexture.prototype.renderWebGL=function(e,t,n){if(!this.valid)return;var r=e.worldTransform;r.identity(),r.translate(0,this.projection.y*2),t&&r.append(t),r.scale(1,-1),e.worldAlpha=1;var i=e.children;for(var s=0,o=i.length;s<o;s++)i[s].updateTransform();var u=this.renderer.gl;u.viewport(0,0,this.width*this.resolution,this.height*this.resolution),u.bindFramebuffer(u.FRAMEBUFFER,this.textureBuffer.frameBuffer),n&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(e,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0},t.RenderTexture.prototype.renderCanvas=function(e,t,n){if(!this.valid)return;var r=e.worldTransform;r.identity(),t&&r.append(t);var i=e.children;for(var s=0,o=i.length;s<o;s++)i[s].updateTransform();n&&this.textureBuffer.clear();var u=this.textureBuffer.context,a=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(e,u),this.renderer.resolution=a},t.RenderTexture.prototype.getImage=function(){var e=new Image;return e.src=this.getBase64(),e},t.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},t.RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===t.WEBGL_RENDERER){var e=this.renderer.gl,n=this.textureBuffer.width,r=this.textureBuffer.height,i=new Uint8Array(4*n*r);e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),e.readPixels(0,0,n,r,e.RGBA,e.UNSIGNED_BYTE,i),e.bindFramebuffer(e.FRAMEBUFFER,null);var s=new t.CanvasBuffer(n,r),o=s.context.getImageData(0,0,n,r),u=o.data;for(var a=0;a<i.length;a+=4){var f=i[a+3];u[a]=i[a]*f,u[a+1]=i[a+1]*f,u[a+2]=i[a+2]*f,u[a+3]=f}return s.context.putImageData(o,0,0),s.canvas}return this.textureBuffer.canvas},t.RenderTexture.tempMatrix=new t.Matrix,t.AssetLoader=function(e,n){this.assetURLs=e,this.crossorigin=n,this.loadersByType={jpg:t.ImageLoader,jpeg:t.ImageLoader,png:t.ImageLoader,gif:t.ImageLoader,webp:t.ImageLoader,json:t.JsonLoader,atlas:t.AtlasLoader,anim:t.SpineLoader,xml:t.BitmapFontLoader,fnt:t.BitmapFontLoader}},t.EventTarget.mixin(t.AssetLoader.prototype),t.AssetLoader.prototype.constructor=t.AssetLoader,t.AssetLoader.prototype._getDataType=function(e){var t="data:",n=e.slice(0,t.length).toLowerCase();if(n===t){var r=e.slice(t.length),i=r.indexOf(",");if(i===-1)return null;var s=r.slice(0,i).split(";")[0];return!s||s.toLowerCase()==="text/plain"?"txt":s.split("/").pop().toLowerCase()}return null},t.AssetLoader.prototype.load=function(){function t(t){e.onAssetLoaded(t.data.content)}var e=this;this.loadCount=this.assetURLs.length;for(var n=0;n<this.assetURLs.length;n++){var r=this.assetURLs[n],i=this._getDataType(r);i||(i=r.split("?").shift().split(".").pop().toLowerCase());var s=this.loadersByType[i];if(!s)throw new Error(i+" is an unsupported file type");var o=new s(r,this.crossorigin);o.on("loaded",t),o.load()}},t.AssetLoader.prototype.onAssetLoaded=function(e){this.loadCount--,this.emit("onProgress",{content:this,loader:e}),this.onProgress&&this.onProgress(e),this.loadCount||(this.emit("onComplete",{content:this}),this.onComplete&&this.onComplete())},t.JsonLoader=function(e,t){this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.loaded=!1},t.JsonLoader.prototype.constructor=t.JsonLoader,t.EventTarget.mixin(t.JsonLoader.prototype),t.JsonLoader.prototype.load=function(){window.XDomainRequest&&this.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=this.onError.bind(this),this.ajaxRequest.ontimeout=this.onError.bind(this),this.ajaxRequest.onprogress=function(){}):window.XMLHttpRequest?this.ajaxRequest=new window.XMLHttpRequest:this.ajaxRequest=new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onload=this.onJSONLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()},t.JsonLoader.prototype.onJSONLoaded=function(){if(!this.ajaxRequest.responseText){this.onError();return}this.json=JSON.parse(this.ajaxRequest.responseText);if(this.json.frames){var e=this.baseUrl+this.json.meta.image,r=new t.ImageLoader(e,this.crossorigin),i=this.json.frames;this.texture=r.texture.baseTexture,r.addEventListener("loaded",this.onLoaded.bind(this));for(var s in i){var o=i[s].frame;if(o){var u=new t.Rectangle(o.x,o.y,o.w,o.h),a=u.clone(),f=null;if(i[s].trimmed){var l=i[s].sourceSize,c=i[s].spriteSourceSize;f=new t.Rectangle(c.x,c.y,l.w,l.h)}t.TextureCache[s]=new t.Texture(this.texture,u,a,f)}}r.load()}else if(this.json.bones){var h=new n.SkeletonJson,p=h.readSkeletonData(this.json);t.AnimCache[this.url]=p,this.onLoaded()}else this.onLoaded()},t.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},t.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},t.AtlasLoader=function(e,t){this.url=e,this.baseUrl=e.replace(/[^\/]*$/,""),this.crossorigin=t,this.loaded=!1},t.AtlasLoader.constructor=t.AtlasLoader,t.EventTarget.mixin(t.AtlasLoader.prototype),t.AtlasLoader.prototype.load=function(){this.ajaxRequest=new t.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},t.AtlasLoader.prototype.onAtlasLoaded=function(){if(this.ajaxRequest.readyState===4)if(this.ajaxRequest.status===200||window.location.href.indexOf("http")===-1){this.atlas={meta:{image:[]},frames:[]};var e=this.ajaxRequest.responseText.split(/\r?\n/),n=-3,r=0,i=null,s=!1,o=0,u=0,a=this.onLoaded.bind(this);for(o=0;o<e.length;o++){e[o]=e[o].replace(/^\s+|\s+$/g,""),e[o]===""&&(s=o+1);if(e[o].length>0){if(s===o)this.atlas.meta.image.push(e[o]),r=this.atlas.meta.image.length-1,this.atlas.frames.push({}),n=-3;else if(n>0)if(n%7===1)i!=null&&(this.atlas.frames[r][i.name]=i),i={name:e[o],frame:{}};else{var f=e[o].split(" ");if(n%7===3)i.frame.x=Number(f[1].replace(",","")),i.frame.y=Number(f[2]);else if(n%7===4)i.frame.w=Number(f[1].replace(",","")),i.frame.h=Number(f[2]);else if(n%7===5){var l={x:0,y:0,w:Number(f[1].replace(",","")),h:Number(f[2])};l.w>i.frame.w||l.h>i.frame.h?(i.trimmed=!0,i.realSize=l):i.trimmed=!1}}n++}}i!=null&&(this.atlas.frames[r][i.name]=i);if(this.atlas.meta.image.length>0){this.images=[];for(u=0;u<this.atlas.meta.image.length;u++){var c=this.baseUrl+this.atlas.meta.image[u],h=this.atlas.frames[u];this.images.push(new t.ImageLoader(c,this.crossorigin));for(o in h){var p=h[o].frame;p&&(t.TextureCache[o]=new t.Texture(this.images[u].texture.baseTexture,{x:p.x,y:p.y,width:p.w,height:p.h}),h[o].trimmed&&(t.TextureCache[o].realSize=h[o].realSize,t.TextureCache[o].trim.x=0,t.TextureCache[o].trim.y=0))}}this.currentImageId=0;for(u=0;u<this.images.length;u++)this.images[u].on("loaded",a);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},t.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.emit("loaded",{content:this}))},t.AtlasLoader.prototype.onError=function(){this.emit("error",{content:this})},t.SpriteSheetLoader=function(e,t){this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},t.SpriteSheetLoader.prototype.constructor=t.SpriteSheetLoader,t.EventTarget.mixin(t.SpriteSheetLoader.prototype),t.SpriteSheetLoader.prototype.load=function(){var e=this,n=new t.JsonLoader(this.url,this.crossorigin);n.on("loaded",function(t){e.json=t.data.content.json,e.onLoaded()}),n.load()},t.SpriteSheetLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},t.ImageLoader=function(e,n){this.texture=t.Texture.fromImage(e,n),this.frames=[]},t.ImageLoader.prototype.constructor=t.ImageLoader,t.EventTarget.mixin(t.ImageLoader.prototype),t.ImageLoader.prototype.load=function(){this.texture.baseTexture.hasLoaded?this.onLoaded():this.texture.baseTexture.on("loaded",this.onLoaded.bind(this))},t.ImageLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},t.ImageLoader.prototype.loadFramedSpriteSheet=function(e,n,r){this.frames=[];var i=Math.floor(this.texture.width/e),s=Math.floor(this.texture.height/n),o=0;for(var u=0;u<s;u++)for(var a=0;a<i;a++,o++){var f=new t.Texture(this.texture.baseTexture,{x:a*e,y:u*n,width:e,height:n});this.frames.push(f),r&&(t.TextureCache[r+"-"+o]=f)}this.load()},t.BitmapFontLoader=function(e,t){this.url=e,this.crossorigin=t,this.baseUrl=e.replace(/[^\/]*$/,""),this.texture=null},t.BitmapFontLoader.prototype.constructor=t.BitmapFontLoader,t.EventTarget.mixin(t.BitmapFontLoader.prototype),t.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new t.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onXMLLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},t.BitmapFontLoader.prototype.onXMLLoaded=function(){if(this.ajaxRequest.readyState===4)if(this.ajaxRequest.status===200||window.location.protocol.indexOf("http")===-1){var e=this.ajaxRequest.responseXML;if(!e||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if(typeof window.DOMParser=="function"){var n=new DOMParser;e=n.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var r=document.createElement("div");r.innerHTML=this.ajaxRequest.responseText,e=r}var i=this.baseUrl+e.getElementsByTagName("page")[0].getAttribute("file"),s=new t.ImageLoader(i,this.crossorigin);this.texture=s.texture.baseTexture;var o={},u=e.getElementsByTagName("info")[0],a=e.getElementsByTagName("common")[0];o.font=u.getAttribute("face"),o.size=parseInt(u.getAttribute("size"),10),o.lineHeight=parseInt(a.getAttribute("lineHeight"),10),o.chars={};var f=e.getElementsByTagName("char");for(var l=0;l<f.length;l++){var c=parseInt(f[l].getAttribute("id"),10),h=new t.Rectangle(parseInt(f[l].getAttribute("x"),10),parseInt(f[l].getAttribute("y"),10),parseInt(f[l].getAttribute("width"),10),parseInt(f[l].getAttribute("height"),10));o.chars[c]={xOffset:parseInt(f[l].getAttribute("xoffset"),10),yOffset:parseInt(f[l].getAttribute("yoffset"),10),xAdvance:parseInt(f[l].getAttribute("xadvance"),10),kerning:{},texture:t.TextureCache[c]=new t.Texture(this.texture,h)}}var p=e.getElementsByTagName("kerning");for(l=0;l<p.length;l++){var d=parseInt(p[l].getAttribute("first"),10),v=parseInt(p[l].getAttribute("second"),10),m=parseInt(p[l].getAttribute("amount"),10);o.chars[v].kerning[d]=m}t.BitmapText.fonts[o.font]=o,s.addEventListener("loaded",this.onLoaded.bind(this)),s.load()}},t.BitmapFontLoader.prototype.onLoaded=function(){this.emit("loaded",{content:this})},t.SpineLoader=function(e,t){this.url=e,this.crossorigin=t,this.loaded=!1},t.SpineLoader.prototype.constructor=t.SpineLoader,t.EventTarget.mixin(t.SpineLoader.prototype),t.SpineLoader.prototype.load=function(){var e=this,n=new t.JsonLoader(this.url,this.crossorigin);n.on("loaded",function(t){e.json=t.data.content.json,e.onLoaded()}),n.load()},t.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.emit("loaded",{content:this})},t.AbstractFilter=function(e,t){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=t||{},this.fragmentSrc=e||[]},t.AbstractFilter.prototype.constructor=t.AbstractFilter,t.AbstractFilter.prototype.syncUniforms=function(){for(var e=0,t=this.shaders.length;e<t;e++)this.shaders[e].dirty=!0},t.AlphaMaskFilter=function(e){t.AbstractFilter.call(this),this.passes=[this],e.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:e},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},e.baseTexture.hasLoaded?(this.uniforms.mask.value.x=e.width,this.uniforms.mask.value.y=e.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),e.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},t.AlphaMaskFilter.prototype=Object.create(t.AbstractFilter.prototype),t.AlphaMaskFilter.prototype.constructor=t.AlphaMaskFilter,t.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(t.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(e){this.uniforms.mask.value=e}}),t.ColorMatrixFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},t.ColorMatrixFilter.prototype=Object.create(t.AbstractFilter.prototype),t.ColorMatrixFilter.prototype.constructor=t.ColorMatrixFilter,Object.defineProperty(t.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(e){this.uniforms.matrix.value=e}}),t.GrayFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},t.GrayFilter.prototype=Object.create(t.AbstractFilter.prototype),t.GrayFilter.prototype.constructor=t.GrayFilter,Object.defineProperty(t.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(e){this.uniforms.gray.value=e}}),t.DisplacementFilter=function(e){t.AbstractFilter.call(this),this.passes=[this],e.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:e},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},e.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=e.width,this.uniforms.mapDimensions.value.y=e.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),e.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},t.DisplacementFilter.prototype=Object.create(t.AbstractFilter.prototype),t.DisplacementFilter.prototype.constructor=t.DisplacementFilter,t.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(t.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(e){this.uniforms.displacementMap.value=e}}),Object.defineProperty(t.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(e){this.uniforms.scale.value=e}}),Object.defineProperty(t.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(e){this.uniforms.offset.value=e}}),t.PixelateFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},t.PixelateFilter.prototype=Object.create(t.AbstractFilter.prototype),t.PixelateFilter.prototype.constructor=t.PixelateFilter,Object.defineProperty(t.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(e){this.dirty=!0,this.uniforms.pixelSize.value=e}}),t.BlurXFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},t.BlurXFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurXFilter.prototype.constructor=t.BlurXFilter,Object.defineProperty(t.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(e){this.dirty=!0,this.uniforms.blur.value=1/7e3*e}}),t.BlurYFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},t.BlurYFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurYFilter.prototype.constructor=t.BlurYFilter,Object.defineProperty(t.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(e){this.uniforms.blur.value=1/7e3*e}}),t.BlurFilter=function(){this.blurXFilter=new t.BlurXFilter,this.blurYFilter=new t.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},t.BlurFilter.prototype=Object.create(t.AbstractFilter.prototype),t.BlurFilter.prototype.constructor=t.BlurFilter,Object.defineProperty(t.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=this.blurYFilter.blur=e}}),Object.defineProperty(t.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e}}),Object.defineProperty(t.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e}}),t.InvertFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},t.InvertFilter.prototype=Object.create(t.AbstractFilter.prototype),t.InvertFilter.prototype.constructor=t.InvertFilter,Object.defineProperty(t.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(e){this.uniforms.invert.value=e}}),t.SepiaFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},t.SepiaFilter.prototype=Object.create(t.AbstractFilter.prototype),t.SepiaFilter.prototype.constructor=t.SepiaFilter,Object.defineProperty(t.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(e){this.uniforms.sepia.value=e}}),t.TwistFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},t.TwistFilter.prototype=Object.create(t.AbstractFilter.prototype),t.TwistFilter.prototype.constructor=t.TwistFilter,Object.defineProperty(t.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(e){this.dirty=!0,this.uniforms.offset.value=e}}),Object.defineProperty(t.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(e){this.dirty=!0,this.uniforms.radius.value=e}}),Object.defineProperty(t.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(e){this.dirty=!0,this.uniforms.angle.value=e}}),t.ColorStepFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},t.ColorStepFilter.prototype=Object.create(t.AbstractFilter.prototype),t.ColorStepFilter.prototype.constructor=t.ColorStepFilter,Object.defineProperty(t.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(e){this.uniforms.step.value=e}}),t.DotScreenFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},t.DotScreenFilter.prototype=Object.create(t.AbstractFilter.prototype),t.DotScreenFilter.prototype.constructor=t.DotScreenFilter,Object.defineProperty(t.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(e){this.dirty=!0,this.uniforms.scale.value=e}}),Object.defineProperty(t.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(e){this.dirty=!0,this.uniforms.angle.value=e}}),t.CrossHatchFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},t.CrossHatchFilter.prototype=Object.create(t.AbstractFilter.prototype),t.CrossHatchFilter.prototype.constructor=t.CrossHatchFilter,Object.defineProperty(t.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(e){this.uniforms.blur.value=1/7e3*e}}),t.RGBSplitFilter=function(){t.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},t.RGBSplitFilter.prototype=Object.create(t.AbstractFilter.prototype),t.RGBSplitFilter.prototype.constructor=t.RGBSplitFilter,Object.defineProperty(t.RGBSplitFilter.prototype,"red",{get:function(){return this.uniforms.red.value},set:function(e){this.uniforms.red.value=e}}),Object.defineProperty(t.RGBSplitFilter.prototype,"green",{get:function(){return this.uniforms.green.value},set:function(e){this.uniforms.green.value=e}}),Object.defineProperty(t.RGBSplitFilter.prototype,"blue",{get:function(){return this.uniforms.blue.value},set:function(e){this.uniforms.blue.value=e}}),typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=t),exports.PIXI=t):typeof define!="undefined"&&define.amd?define(t):e.PIXI=t}.call(this),function(e){"use strict";window.cloudkid=window.cloudkid||{};var t={},n=t.DEG_TO_RADS=Math.PI/180;t.rotatePoint=function(e,t){if(!e)return;e*=n;var r=Math.sin(e),i=Math.cos(e),s=t.x*i-t.y*r,o=t.x*r+t.y*i;t.x=s,t.y=o},t.combineRGBComponents=function(e,t,n){return e<<16|t<<8|n},t.normalize=function(e){var n=1/t.length(e);e.x*=n,e.y*=n},t.scaleBy=function(e,t){e.x*=t,e.y*=t},t.length=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},t.hexToRGB=function(e,t){t?t.length=0:t=[],e.charAt(0)=="#"?e=e.substr(1):e.indexOf("0x")===0&&(e=e.substr(2));var n;return e.length==8&&(n=e.substr(0,2),e=e.substr(2)),t.push(parseInt(e.substr(0,2),16)),t.push(parseInt(e.substr(2,2),16)),t.push(parseInt(e.substr(4,2),16)),n&&t.push(parseInt(n,16)),t},t.generateEase=function(e){var t=e.length,n=1/t,r=function(r){var i,s,o=t*r|0;return i=(r-o*n)*t,s=e[o]||e[t-1],s.s+i*(2*(1-i)*(s.cp-s.s)+i*(s.e-s.s))};return r},t.getBlendMode=function(e){if(!e)return PIXI.blendModes.NORMAL;e=e.toUpperCase();while(e.indexOf(" ")>=0)e=e.replace(" ","_");return PIXI.blendModes[e]||PIXI.blendModes.NORMAL},cloudkid.ParticleUtils=t,Array.prototype.shuffle||Object.defineProperty(Array.prototype,"shuffle",{enumerable:!1,writable:!1,value:function(){for(var e,t,n=this.length;n;e=Math.floor(Math.random()*n),t=this[--n],this[n]=this[e],this[e]=t);return this}}),Array.prototype.random||Object.defineProperty(Array.prototype,"random",{enumerable:!1,writable:!1,value:function(){return this[Math.floor(Math.random()*this.length)]}})}(),function(e,t){"use strict";var n=e.ParticleUtils,r=function(e){var t=e.particleImages[0]instanceof PIXI.Texture?[e.particleImages[0]]:e.particleImages[0];PIXI.MovieClip.call(this,t),this.emitter=e,this.anchor.x=this.anchor.y=.5,this.velocity=new PIXI.Point,this.maxLife=0,this.age=0,this.ease=null,this.extraData=null,this.startAlpha=0,this.endAlpha=0,this.startSpeed=0,this.endSpeed=0,this.acceleration=null,this.startScale=0,this.endScale=0,this.startColor=null,this._sR=0,this._sG=0,this._sB=0,this.endColor=null,this._eR=0,this._eG=0,this._eB=0,this._doAlpha=!1,this._doScale=!1,this._doSpeed=!1,this._doColor=!1,this._doNormalMovement=!1,this._oneOverLife=0},i=r.prototype=Object.create(PIXI.MovieClip.prototype);i.init=i.Particle_init=function(){this.age=0,this.velocity.x=this.startSpeed,this.velocity.y=0,n.rotatePoint(this.rotation,this.velocity),this.rotation*=n.DEG_TO_RADS,this.rotationSpeed*=n.DEG_TO_RADS,this.alpha=this.startAlpha,this.scale.x=this.scale.y=this.startScale,this.startColor&&(this._sR=this.startColor[0],this._sG=this.startColor[1],this._sB=this.startColor[2],this.endColor&&(this._eR=this.endColor[0],this._eG=this.endColor[1],this._eB=this.endColor[2])),this._doAlpha=this.startAlpha!=this.endAlpha,this._doSpeed=this.startSpeed!=this.endSpeed,this._doScale=this.startScale!=this.endScale,this._doColor=!!this.endColor,this._doNormalMovement=this._doSpeed||this.startSpeed!==0||this.acceleration,this._oneOverLife=1/this.maxLife,this.tint=n.combineRGBComponents(this._sR,this._sG,this._sB)},i.applyArt=function(e){this.setTexture(e)},i.update=i.Particle_update=function(e){this.age+=e;if(this.age>=this.maxLife)return this.kill(),-1;var t=this.age*this._oneOverLife;this.ease&&(this.ease.length==4?t=this.ease(t,0,1,1):t=this.ease(t)),this._doAlpha&&(this.alpha=(this.endAlpha-this.startAlpha)*t+this.startAlpha);if(this._doScale){var r=(this.endScale-this.startScale)*t+this.startScale;this.scale.x=this.scale.y=r}if(this._doNormalMovement){if(this._doSpeed){var i=(this.endSpeed-this.startSpeed)*t+this.startSpeed;n.normalize(this.velocity),n.scaleBy(this.velocity,i)}else this.acceleration&&(this.velocity.x+=this.acceleration.x*e,this.velocity.y+=this.acceleration.y*e);this.position.x+=this.velocity.x*e,this.position.y+=this.velocity.y*e}if(this._doColor){var s=(this._eR-this._sR)*t+this._sR,o=(this._eG-this._sG)*t+this._sG,u=(this._eB-this._sB)*t+this._sB;this.tint=n.combineRGBComponents(s,o,u)}return this.rotationSpeed!==0?this.rotation+=this.rotationSpeed*e:this.acceleration&&(this.rotation=Math.atan2(this.velocity.y,this.velocity.x)),t},i.kill=function(){this.emitter.recycle(this)},i.destroy=function(){this.emitter=null,this.velocity=null,this.startColor=this.endColor=null,this.ease=null},e.Particle=r}(cloudkid),function(cloudkid,undefined){"use strict";var ParticleUtils=cloudkid.ParticleUtils,Particle=cloudkid.Particle,PathParticle=function(e){Particle.call(this,e),this.path=null,this.initialRotation=0,this.initialPosition=new PIXI.Point,this.movement=0},s=Particle.prototype,p=PathParticle.prototype=Object.create(s),helperPoint=new PIXI.Point;p.init=function(){this.initialRotation=this.rotation,this.Particle_init();if(this.extraData&&this.extraData.path){var e=this.emitter._sharedExtraData;if(e.path!==undefined)this.path=e.path;else try{this.path=e.path=parsePath(this.extraData.path)}catch(t){console.error("PathParticle: error in parsing path expression"),this.path=e.path=null}}else console.error("PathParticle requires a path string in extraData!"),this.path=null;this._doNormalMovement=!this.path,this.movement=0,this.initialPosition.x=this.position.x,this.initialPosition.y=this.position.y};var MATH_FUNCS=["pow","sqrt","abs","floor","round","ceil","E","PI","sin","cos","tan","asin","acos","atan","atan2","log"],WHITELISTER="[01234567890\\.\\*\\-\\+\\/\\(\\)x ,]";for(var index=MATH_FUNCS.length-1;index>=0;--index)WHITELISTER+="|"+MATH_FUNCS[index];WHITELISTER=new RegExp(WHITELISTER,"g");var parsePath=function(pathString){var rtn,matches=pathString.match(WHITELISTER);for(var i=matches.length-1;i>=0;--i)MATH_FUNCS.indexOf(matches[i])>=0&&(matches[i]="Math."+matches[i]);return pathString=matches.join(""),eval("rtn = function(x){ return "+pathString+"; };"),rtn};p.update=function(e){var t=this.Particle_update(e);if(t>=0&&this.path){var n=(this.endSpeed-this.startSpeed)*t+this.startSpeed;this.movement+=n*e,helperPoint.x=this.movement,helperPoint.y=this.path(this.movement),ParticleUtils.rotatePoint(this.initialRotation,helperPoint),this.position.x=this.initialPosition.x+helperPoint.x,this.position.y=this.initialPosition.y+helperPoint.y}},p.destroy=function(){s.destroy.call(this)},cloudkid.PathParticle=PathParticle}(cloudkid),function(e,t){"use strict";var n=e.ParticleUtils,r=e.Particle,i=function(e){r.call(this,e),this._helperTextures=[]},s=r.prototype,o=i.prototype=Object.create(s);o.init=function(){this.Particle_init();if(this.extraData){this.extraData.fps?this.fps=this.extraData.fps:this.fps=60;var e=this.extraData.animationSpeed||1;e=="matchLife"?(this.loop=!1,this.hasOwnProperty("_duration")?this.animationSpeed=this._duration/this.maxLife:this.animationSpeed=this.textures.length/this.maxLife/60):(this.loop=!0,this.animationSpeed=e)}else this.loop=!0,this.animationSpeed=1;this.play()},o.applyArt=function(e){Array.isArray(e)?this.textures=e:(this._helperTextures[0]=e,this.textures=this._helperTextures),this.gotoAndStop(0)},o.update=function(e){this.Particle_update(e)>=0&&this._duration&&this.updateAnim(e)},o.destroy=function(){s.destroy.call(this)},e.AnimatedParticle=i}(cloudkid),function(e,t){"use strict";var n=e.ParticleUtils,r=e.Particle,i=function(e,t,n){this._particleConstructor=r,this.particleImages=null,this.startAlpha=1,this.endAlpha=1,this.startSpeed=0,this.endSpeed=0,this.acceleration=null,this.startScale=1,this.endScale=1,this.minimumScaleMultiplier=1,this.startColor=null,this.endColor=null,this.minLifetime=0,this.maxLifetime=0,this.minStartRotation=0,this.maxStartRotation=0,this.minRotationSpeed=0,this.maxRotationSpeed=0,this.particleBlendMode=0,this.customEase=null,this.extraData=null,this.frequency=0,this.maxParticles=1e3,this.emitterLifetime=-1,this.spawnPos=null,this.spawnType=null,this._spawnFunc=null,this.spawnRect=null,this.spawnCircle=null,this.particlesPerWave=1,this.particleSpacing=0,this.angleStart=0,this.rotation=0,this.ownerPos=null,this._prevEmitterPos=null,this._prevPosIsValid=!1,this._posChanged=!1,this.parent=e,this.addAtBack=!1,this._emit=!1,this._spawnTimer=0,this._emitterLife=-1,this._activeParticles=[],this._pool=[],this._sharedExtraData=null,t&&n&&this.init(t,n)},s=i.prototype={},o=new PIXI.Point;Object.defineProperty(s,"particleConstructor",{get:function(){return this._particleConstructor},set:function(e){e!=this._particleConstructor&&(this._particleConstructor=e,this.cleanup(),this._activeParticles.length&&(this._activeParticles.length=0),this._pool.length&&(this._pool.length=0))}}),s.init=function(e,t){if(!e||!t)return;this.cleanup(),this.particleImages=e instanceof PIXI.Texture?[e]:e;if(this.particleImages.length>1)for(var r=this.particleImages.length-1;r>0;--r)if(this.particleImages[r].baseTexture!=this.particleImages[r-1].baseTexture){console.warn("PixiParticles: using particle textures from different images may hinder performance in WebGL");break}t.alpha?(this.startAlpha=t.alpha.start,this.endAlpha=t.alpha.end):this.startAlpha=this.endAlpha=1,t.speed?(this.startSpeed=t.speed.start,this.endSpeed=t.speed.end):this.startSpeed=this.endSpeed=0;var i=t.acceleration;i&&(i.x||i.y)?(this.endSpeed=this.startSpeed,this.acceleration=new PIXI.Point(i.x,i.y)):this.acceleration=null,t.scale?(this.startScale=t.scale.start,this.endScale=t.scale.end,this.minimumScaleMultiplier=t.scale.minimumScaleMultiplier||1):this.startScale=this.endScale=this.minimumScaleMultiplier=1,t.color&&(this.startColor=n.hexToRGB(t.color.start),t.color.start!=t.color.end?this.endColor=n.hexToRGB(t.color.end):this.endColor=null),t.startRotation?(this.minStartRotation=t.startRotation.min,this.maxStartRotation=t.startRotation.max):this.minStartRotation=this.maxStartRotation=0,t.rotationSpeed?(this.minRotationSpeed=t.rotationSpeed.min,this.maxRotationSpeed=t.rotationSpeed.max):this.minRotationSpeed=this.maxRotationSpeed=0,this.minLifetime=t.lifetime.min,this.maxLifetime=t.lifetime.max,this.particleBlendMode=n.getBlendMode(t.blendMode),t.ease?this.customEase=typeof t.ease=="function"?t.ease:n.generateEase(t.ease):this.customEase=null,this.extraData=t.extraData||null,this._sharedExtraData={},this.spawnRect=this.spawnCircle=null,this.particlesPerWave=1,this.particleSpacing=0,this.angleStart=0;var s;switch(t.spawnType){case"rect":this.spawnType="rect",this._spawnFunc=this._spawnRect;var o=t.spawnRect;this.spawnRect=new PIXI.Rectangle(o.x,o.y,o.w,o.h);break;case"circle":this.spawnType="circle",this._spawnFunc=this._spawnCircle,s=t.spawnCircle,this.spawnCircle=new PIXI.Circle(s.x,s.y,s.r);break;case"ring":this.spawnType="ring",this._spawnFunc=this._spawnRing,s=t.spawnCircle,this.spawnCircle=new PIXI.Circle(s.x,s.y,s.r),this.spawnCircle.minRadius=s.minR;break;case"burst":this.spawnType="burst",this._spawnFunc=this._spawnBurst,this.particlesPerWave=t.particlesPerWave,this.particleSpacing=t.particleSpacing,this.angleStart=t.angleStart?t.angleStart:0;break;case"point":this.spawnType="point",this._spawnFunc=this._spawnPoint;break;default:this.spawnType="point",this._spawnFunc=this._spawnPoint}this.frequency=t.frequency,this.emitterLifetime=t.emitterLifetime||-1,this.maxParticles=t.maxParticles>0?t.maxParticles:1e3,this.addAtBack=!!t.addAtBack,this.rotation=0,this.ownerPos=new PIXI.Point,this.spawnPos=new PIXI.Point(t.pos.x,t.pos.y),this._prevEmitterPos=this.spawnPos.clone(),this._prevPosIsValid=!1,this._spawnTimer=0,this.emit=!0},s.recycle=function(e){var t=this._activeParticles.indexOf(e);t<this._activeParticles.length-1&&(this._activeParticles[t]=this._activeParticles[this._activeParticles.length-1]),this._activeParticles.pop(),this._pool.push(e),e.parent&&e.parent.removeChild(e)},s.rotate=function(e){if(this.rotation==e)return;var t=e-this.rotation;this.rotation=e,n.rotatePoint(t,this.spawnPos),this._posChanged=!0},s.updateSpawnPos=function(e,t){this._posChanged=!0,this.spawnPos.x=e,this.spawnPos.y=t},s.updateOwnerPos=function(e,t){this._posChanged=!0,this.ownerPos.x=e,this.ownerPos.y=t},s.resetPositionTracking=function(){this._prevPosIsValid=!1},Object.defineProperty(s,"emit",{get:function(){return this._emit},set:function(e){this._emit=!!e,this._emitterLife=this.emitterLifetime}}),s.update=function(e){var t,n=this._activeParticles;for(t=n.length-1;t>=0;--t)n[t].update(e);var r,i;this._prevPosIsValid&&(r=this._prevEmitterPos.x,i=this._prevEmitterPos.y);var s=this.ownerPos.x+this.spawnPos.x,o=this.ownerPos.y+this.spawnPos.y;if(this.emit){this._spawnTimer-=e;while(this._spawnTimer<=0){if(this._emitterLife>0){this._emitterLife-=this.frequency;if(this._emitterLife<=0){this._spawnTimer=0,this._emitterLife=0,this.emit=!1;break}}if(this._activeParticles.length>=this.maxParticles){this._spawnTimer+=this.frequency;continue}var u;this.minLifetime==this.maxLifetime?u=this.minLifetime:u=Math.random()*(this.maxLifetime-this.minLifetime)+this.minLifetime;if(-this._spawnTimer<u){var a,f;if(this._prevPosIsValid&&this._posChanged){var l=1+this._spawnTimer/e;a=(s-r)*l+r,f=(o-i)*l+i}else a=s,f=o;t=0;for(var c=Math.min(this.particlesPerWave,this.maxParticles-this._activeParticles.length);t<c;++t){var h=this._pool.length?this._pool.pop():new this.particleConstructor(this);this.particleImages.length>1?h.applyArt(this.particleImages.random()):h.applyArt(this.particleImages[0]),h.startAlpha=this.startAlpha,h.endAlpha=this.endAlpha,h.startSpeed=this.startSpeed,h.endSpeed=this.endSpeed,h.acceleration=this.acceleration;if(this.minimumScaleMultiplier!=1){var p=Math.random()*(1-this.minimumScaleMultiplier)+this.minimumScaleMultiplier;h.startScale=this.startScale*p,h.endScale=this.endScale*p}else h.startScale=this.startScale,h.endScale=this.endScale;h.startColor=this.startColor,h.endColor=this.endColor,this.minRotationSpeed==this.maxRotationSpeed?h.rotationSpeed=this.minRotationSpeed:h.rotationSpeed=Math.random()*(this.maxRotationSpeed-this.minRotationSpeed)+this.minRotationSpeed,h.maxLife=u,h.blendMode=this.particleBlendMode,h.ease=this.customEase,h.extraData=this.extraData,this._spawnFunc(h,a,f,t),h.init(),h.update(-this._spawnTimer),this.addAtBack?this.parent.addChildAt(h,0):this.parent.addChild(h),n.push(h)}}this._spawnTimer+=this.frequency}}this._posChanged&&(this._prevEmitterPos.x=s,this._prevEmitterPos.y=o,this._prevPosIsValid=!0,this._posChanged=!1)},s._spawnPoint=function(e,t,n,r){this.minStartRotation==this.maxStartRotation?e.rotation=this.minStartRotation+this.rotation:e.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,e.position.x=t,e.position.y=n},s._spawnRect=function(e,t,r,i){this.minStartRotation==this.maxStartRotation?e.rotation=this.minStartRotation+this.rotation:e.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,o.x=Math.random()*this.spawnRect.width+this.spawnRect.x,o.y=Math.random()*this.spawnRect.height+this.spawnRect.y,this.rotation!==0&&n.rotatePoint(this.rotation,o),e.position.x=t+o.x,e.position.y=r+o.y},s._spawnCircle=function(e,t,r,i){this.minStartRotation==this.maxStartRotation?e.rotation=this.minStartRotation+this.rotation:e.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,o.x=Math.random()*this.spawnCircle.radius,o.y=0,n.rotatePoint(Math.random()*360,o),o.x+=this.spawnCircle.x,o.y+=this.spawnCircle.y,this.rotation!==0&&n.rotatePoint(this.rotation,o),e.position.x=t+o.x,e.position.y=r+o.y},s._spawnRing=function(e,t,r,i){var s=this.spawnCircle;this.minStartRotation==this.maxStartRotation?e.rotation=this.minStartRotation+this.rotation:e.rotation=Math.random()*(this.maxStartRotation-this.minStartRotation)+this.minStartRotation+this.rotation,s.minRadius==s.radius?o.x=Math.random()*(s.radius-s.minRadius)+s.minRadius:o.x=s.radius,o.y=0;var u=Math.random()*360;e.rotation+=u,n.rotatePoint(u,o),o.x+=this.spawnCircle.x,o.y+=this.spawnCircle.y,this.rotation!==0&&n.rotatePoint(this.rotation,o),e.position.x=t+o.x,e.position.y=r+o.y},s._spawnBurst=function(e,t,n,r){this.particleSpacing===0?e.rotation=Math.random()*360:e.rotation=this.angleStart+this.particleSpacing*r+this.rotation,e.position.x=t,e.position.y=n},s.cleanup=function(){for(var e=this._activeParticles.length-1;e>=0;--e)this.recycle(this._activeParticles[e])},s.destroy=function(){this.cleanup();for(var e=this._pool.length-1;e>=0;--e)this._pool[e].destroy();this._pool=null,this._activeParticles=null,this.parent=null,this.particleImages=null,this.spawnPos=null,this.ownerPos=null,this.startColor=null,this.endColor=null,this.customEase=null},e.Emitter=i}(cloudkid),tagpro.particleDefinitions={tagproSparks:{alpha:{start:.75,end:0},scale:{start:0,end:.25,minimumScaleMultiplier:1},color:{start:"#83FF7A",end:"#00BB00"},speed:{start:30,end:30},acceleration:{x:0,y:0},startRotation:{min:0,max:360},rotationSpeed:{min:0,max:0},lifetime:{min:.1,max:.9},blendMode:"normal",frequency:.01,emitterLifetime:-1,maxParticles:50,pos:{x:20,y:20},addAtBack:!0,spawnType:"point",spawnCircle:{x:0,y:0,r:0}},explosion:{alpha:{start:.74,end:0},scale:{start:5,end:1,minimumScaleMultiplier:.1},color:{start:"#ffdfa0",end:"#100f0c"},speed:{start:1e3,end:0},acceleration:{x:0,y:0},startRotation:{min:0,max:360},rotationSpeed:{min:0,max:200},lifetime:{min:.25,max:.5},blendMode:"normal",ease:[{s:0,cp:.329,e:.548},{s:.548,cp:.767,e:.876},{s:.876,cp:.985,e:1}],frequency:.001,emitterLifetime:.1,maxParticles:50,pos:{x:0,y:0},addAtBack:!1,spawnType:"point"},playerEmitter:{alpha:{start:.85,end:0},scale:{start:.01,end:.2,minimumScaleMultiplier:1},color:{start:"#fff191",end:"#ff622c"},speed:{start:20,end:20},acceleration:{x:0,y:0},startRotation:{min:0,max:360},rotationSpeed:{min:50,max:50},lifetime:{min:.1,max:.75},blendMode:"normal",frequency:.001,emitterLifetime:-1,maxParticles:50,pos:{x:20,y:20},addAtBack:!1,spawnType:"circle",spawnCircle:{x:0,y:0,r:10}},death:{alpha:{start:.15,end:0},scale:{start:1.5,end:0},speed:{start:300,end:100},startRotation:{min:0,max:0},rotationSpeed:{min:0,max:0},lifetime:{min:.4,max:.4},frequency:.08,emitterLifetime:.17,maxParticles:50,pos:{x:0,y:0},addAtBack:!1,spawnType:"burst",particlesPerWave:16,particleSpacing:22.5,angleStart:0},rollingBomb:{alpha:{start:.45,end:0},scale:{start:.1,end:1.5,minimumScaleMultiplier:1},color:{start:"#85888d",end:"#100f0c"},speed:{start:1,end:50},acceleration:{x:0,y:0},startRotation:{min:0,max:360},rotationSpeed:{min:0,max:0},lifetime:{min:.5,max:2},blendMode:"normal",frequency:.001,emitterLifetime:-1,maxParticles:10,pos:{x:0,y:0},addAtBack:!1,spawnType:"circle",spawnCircle:{x:20,y:20,r:30}},gravityWell:{alpha:{start:0,end:1},scale:{start:.5,end:.15,minimumScaleMultiplier:1},color:{start:"#000000",end:"#000000"},speed:{start:1,end:500},acceleration:{x:0,y:0},startRotation:{min:180,max:180},rotationSpeed:{min:90,max:180},lifetime:{min:.9,max:1},blendMode:"normal",frequency:.025,emitterLifetime:-1,maxParticles:40,pos:{x:0,y:0},addAtBack:!1,spawnType:"ring",spawnCircle:{x:0,y:0,r:240,minR:240}}},function(){typeof window.performance=="undefined"&&(window.performance={});if(!window.performance.now){var e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e}}}(),console.image=function(e,t){function r(e,t){return{string:"+",style:"font-size: 1px; padding: "+Math.floor(t/2)+"px "+Math.floor(e/2)+"px; line-height: "+t+"px;"}}t=t||1;var n=new Image;n.onload=function(){var n=r(this.width*t,this.height*t);console.log("%c"+n.string,n.style+"background: url("+e+"); background-size: "+this.width*t+"px "+this.height*t+"px; color: transparent;")},n.src=e},tagpro.ready(createRenderer);var Box2D={};(function(e,t){function n(){}!Object.defineProperty&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function&&(Object.defineProperty=function(e,t,n){n.get instanceof Function&&e.__defineGetter__(t,n.get),n.set instanceof Function&&e.__defineSetter__(t,n.set)}),e.inherit=function(e,t){var r=e;n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=r},e.generateCallback=function(t,n){return function(){n.apply(t,arguments)}},e.NVector=function(n){n===t&&(n=0);var r=new Array(n||0);for(var i=0;i<n;++i)r[i]=0;return r},e.is=function(n,r){return n===null?!1:r instanceof Function&&n instanceof r?!0:n.constructor.__implements!=t&&n.constructor.__implements[r]?!0:!1},e.parseUInt=function(e){return Math.abs(parseInt(e))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;typeof Box2D=="undefined"&&(Box2D={}),typeof Box2D.Collision=="undefined"&&(Box2D.Collision={}),typeof Box2D.Collision.Shapes=="undefined"&&(Box2D.Collision.Shapes={}),typeof Box2D.Common=="undefined"&&(Box2D.Common={}),typeof Box2D.Common.Math=="undefined"&&(Box2D.Common.Math={}),typeof Box2D.Dynamics=="undefined"&&(Box2D.Dynamics={}),typeof Box2D.Dynamics.Contacts=="undefined"&&(Box2D.Dynamics.Contacts={}),typeof Box2D.Dynamics.Controllers=="undefined"&&(Box2D.Dynamics.Controllers={}),typeof Box2D.Dynamics.Joints=="undefined"&&(Box2D.Dynamics.Joints={}),function(){function e(){e.b2AABB.apply(this,arguments)}function t(){t.b2Bound.apply(this,arguments)}function n(){n.b2BoundValues.apply(this,arguments),this.constructor===n&&this.b2BoundValues.apply(this,arguments)}function r(){r.b2Collision.apply(this,arguments)}function i(){i.b2ContactID.apply(this,arguments),this.constructor===i&&this.b2ContactID.apply(this,arguments)}function s(){s.b2ContactPoint.apply(this,arguments)}function o(){o.b2Distance.apply(this,arguments)}function u(){u.b2DistanceInput.apply(this,arguments)}function a(){a.b2DistanceOutput.apply(this,arguments)}function f(){f.b2DistanceProxy.apply(this,arguments)}function l(){l.b2DynamicTree.apply(this,arguments),this.constructor===l&&this.b2DynamicTree.apply(this,arguments)}function c(){c.b2DynamicTreeBroadPhase.apply(this,arguments)}function h(){h.b2DynamicTreeNode.apply(this,arguments)}function p(){p.b2DynamicTreePair.apply(this,arguments)}function d(){d.b2Manifold.apply(this,arguments),this.constructor===d&&this.b2Manifold.apply(this,arguments)}function v(){v.b2ManifoldPoint.apply(this,arguments),this.constructor===v&&this.b2ManifoldPoint.apply(this,arguments)}function m(){m.b2Point.apply(this,arguments)}function g(){g.b2RayCastInput.apply(this,arguments),this.constructor===g&&this.b2RayCastInput.apply(this,arguments)}function y(){y.b2RayCastOutput.apply(this,arguments)}function b(){b.b2Segment.apply(this,arguments)}function w(){w.b2SeparationFunction.apply(this,arguments)}function E(){E.b2Simplex.apply(this,arguments),this.constructor===E&&this.b2Simplex.apply(this,arguments)}function S(){S.b2SimplexCache.apply(this,arguments)}function x(){x.b2SimplexVertex.apply(this,arguments)}function T(){T.b2TimeOfImpact.apply(this,arguments)}function N(){N.b2TOIInput.apply(this,arguments)}function C(){C.b2WorldManifold.apply(this,arguments),this.constructor===C&&this.b2WorldManifold.apply(this,arguments)}function k(){k.ClipVertex.apply(this,arguments)}function L(){L.Features.apply(this,arguments)}function A(){A.b2CircleShape.apply(this,arguments),this.constructor===A&&this.b2CircleShape.apply(this,arguments)}function O(){O.b2EdgeChainDef.apply(this,arguments),this.constructor===O&&this.b2EdgeChainDef.apply(this,arguments)}function M(){M.b2EdgeShape.apply(this,arguments),this.constructor===M&&this.b2EdgeShape.apply(this,arguments)}function _(){_.b2MassData.apply(this,arguments)}function D(){D.b2PolygonShape.apply(this,arguments),this.constructor===D&&this.b2PolygonShape.apply(this,arguments)}function P(){P.b2Shape.apply(this,arguments),this.constructor===P&&this.b2Shape.apply(this,arguments)}function H(){H.b2Color.apply(this,arguments),this.constructor===H&&this.b2Color.apply(this,arguments)}function B(){B.b2Settings.apply(this,arguments)}function j(){j.b2Mat22.apply(this,arguments),this.constructor===j&&this.b2Mat22.apply(this,arguments)}function F(){F.b2Mat33.apply(this,arguments),this.constructor===F&&this.b2Mat33.apply(this,arguments)}function I(){I.b2Math.apply(this,arguments)}function q(){q.b2Sweep.apply(this,arguments)}function R(){R.b2Transform.apply(this,arguments),this.constructor===R&&this.b2Transform.apply(this,arguments)}function U(){U.b2Vec2.apply(this,arguments),this.constructor===U&&this.b2Vec2.apply(this,arguments)}function z(){z.b2Vec3.apply(this,arguments),this.constructor===z&&this.b2Vec3.apply(this,arguments)}function W(){W.b2Body.apply(this,arguments),this.constructor===W&&this.b2Body.apply(this,arguments)}function X(){X.b2BodyDef.apply(this,arguments),this.constructor===X&&this.b2BodyDef.apply(this,arguments)}function V(){V.b2ContactFilter.apply(this,arguments)}function $(){$.b2ContactImpulse.apply(this,arguments)}function J(){J.b2ContactListener.apply(this,arguments)}function K(){K.b2ContactManager.apply(this,arguments),this.constructor===K&&this.b2ContactManager.apply(this,arguments)}function Q(){Q.b2DebugDraw.apply(this,arguments),this.constructor===Q&&this.b2DebugDraw.apply(this,arguments)}function G(){G.b2DestructionListener.apply(this,arguments)}function Y(){Y.b2FilterData.apply(this,arguments)}function Z(){Z.b2Fixture.apply(this,arguments),this.constructor===Z&&this.b2Fixture.apply(this,arguments)}function et(){et.b2FixtureDef.apply(this,arguments),this.constructor===et&&this.b2FixtureDef.apply(this,arguments)}function tt(){tt.b2Island.apply(this,arguments),this.constructor===tt&&this.b2Island.apply(this,arguments)}function nt(){nt.b2TimeStep.apply(this,arguments)}function rt(){rt.b2World.apply(this,arguments),this.constructor===rt&&this.b2World.apply(this,arguments)}function it(){it.b2CircleContact.apply(this,arguments)}function st(){st.b2Contact.apply(this,arguments),this.constructor===st&&this.b2Contact.apply(this,arguments)}function ot(){ot.b2ContactConstraint.apply(this,arguments),this.constructor===ot&&this.b2ContactConstraint.apply(this,arguments)}function ut(){ut.b2ContactConstraintPoint.apply(this,arguments)}function at(){at.b2ContactEdge.apply(this,arguments)}function ft(){ft.b2ContactFactory.apply(this,arguments),this.constructor===ft&&this.b2ContactFactory.apply(this,arguments)}function lt(){lt.b2ContactRegister.apply(this,arguments)}function ct(){ct.b2ContactResult.apply(this,arguments)}function ht(){ht.b2ContactSolver.apply(this,arguments),this.constructor===ht&&this.b2ContactSolver.apply(this,arguments)}function pt(){pt.b2EdgeAndCircleContact.apply(this,arguments)}function dt(){dt.b2NullContact.apply(this,arguments),this.constructor===dt&&this.b2NullContact.apply(this,arguments)}function vt(){vt.b2PolyAndCircleContact.apply(this,arguments)}function mt(){mt.b2PolyAndEdgeContact.apply(this,arguments)}function gt(){gt.b2PolygonContact.apply(this,arguments)}function yt(){yt.b2PositionSolverManifold.apply(this,arguments),this.constructor===yt&&this.b2PositionSolverManifold.apply(this,arguments)}function bt(){bt.b2BuoyancyController.apply(this,arguments)}function wt(){wt.b2ConstantAccelController.apply(this,arguments)}function Et(){Et.b2ConstantForceController.apply(this,arguments)}function St(){St.b2Controller.apply(this,arguments)}function xt(){xt.b2ControllerEdge.apply(this,arguments)}function Tt(){Tt.b2GravityController.apply(this,arguments)}function Nt(){Nt.b2TensorDampingController.apply(this,arguments)}function Ct(){Ct.b2DistanceJoint.apply(this,arguments),this.constructor===Ct&&this.b2DistanceJoint.apply(this,arguments)}function kt(){kt.b2DistanceJointDef.apply(this,arguments),this.constructor===kt&&this.b2DistanceJointDef.apply(this,arguments)}function Lt(){Lt.b2FrictionJoint.apply(this,arguments),this.constructor===Lt&&this.b2FrictionJoint.apply(this,arguments)}function At(){At.b2FrictionJointDef.apply(this,arguments),this.constructor===At&&this.b2FrictionJointDef.apply(this,arguments)}function Ot(){Ot.b2GearJoint.apply(this,arguments),this.constructor===Ot&&this.b2GearJoint.apply(this,arguments)}function Mt(){Mt.b2GearJointDef.apply(this,arguments),this.constructor===Mt&&this.b2GearJointDef.apply(this,arguments)}function _t(){_t.b2Jacobian.apply(this,arguments)}function Dt(){Dt.b2Joint.apply(this,arguments),this.constructor===Dt&&this.b2Joint.apply(this,arguments)}function Pt(){Pt.b2JointDef.apply(this,arguments),this.constructor===Pt&&this.b2JointDef.apply(this,arguments)}function Ht(){Ht.b2JointEdge.apply(this,arguments)}function Bt(){Bt.b2LineJoint.apply(this,arguments),this.constructor===Bt&&this.b2LineJoint.apply(this,arguments)}function jt(){jt.b2LineJointDef.apply(this,arguments),this.constructor===jt&&this.b2LineJointDef.apply(this,arguments)}function Ft(){Ft.b2MouseJoint.apply(this,arguments),this.constructor===Ft&&this.b2MouseJoint.apply(this,arguments)}function It(){It.b2MouseJointDef.apply(this,arguments),this.constructor===It&&this.b2MouseJointDef.apply(this,arguments)}function qt(){qt.b2PrismaticJoint.apply(this,arguments),this.constructor===qt&&this.b2PrismaticJoint.apply(this,arguments)}function Rt(){Rt.b2PrismaticJointDef.apply(this,arguments),this.constructor===Rt&&this.b2PrismaticJointDef.apply(this,arguments)}function Ut(){Ut.b2PulleyJoint.apply(this,arguments),this.constructor===Ut&&this.b2PulleyJoint.apply(this,arguments)}function zt(){zt.b2PulleyJointDef.apply(this,arguments),this.constructor===zt&&this.b2PulleyJointDef.apply(this,arguments)}function Wt(){Wt.b2RevoluteJoint.apply(this,arguments),this.constructor===Wt&&this.b2RevoluteJoint.apply(this,arguments)}function Xt(){Xt.b2RevoluteJointDef.apply(this,arguments),this.constructor===Xt&&this.b2RevoluteJointDef.apply(this,arguments)}function Vt(){Vt.b2WeldJoint.apply(this,arguments),this.constructor===Vt&&this.b2WeldJoint.apply(this,arguments)}function $t(){$t.b2WeldJointDef.apply(this,arguments),this.constructor===$t&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase",Box2D.Collision.b2AABB=e,Box2D.Collision.b2Bound=t,Box2D.Collision.b2BoundValues=n,Box2D.Collision.b2Collision=r,Box2D.Collision.b2ContactID=i,Box2D.Collision.b2ContactPoint=s,Box2D.Collision.b2Distance=o,Box2D.Collision.b2DistanceInput=u,Box2D.Collision.b2DistanceOutput=a,Box2D.Collision.b2DistanceProxy=f,Box2D.Collision.b2DynamicTree=l,Box2D.Collision.b2DynamicTreeBroadPhase=c,Box2D.Collision.b2DynamicTreeNode=h,Box2D.Collision.b2DynamicTreePair=p,Box2D.Collision.b2Manifold=d,Box2D.Collision.b2ManifoldPoint=v,Box2D.Collision.b2Point=m,Box2D.Collision.b2RayCastInput=g,Box2D.Collision.b2RayCastOutput=y,Box2D.Collision.b2Segment=b,Box2D.Collision.b2SeparationFunction=w,Box2D.Collision.b2Simplex=E,Box2D.Collision.b2SimplexCache=S,Box2D.Collision.b2SimplexVertex=x,Box2D.Collision.b2TimeOfImpact=T,Box2D.Collision.b2TOIInput=N,Box2D.Collision.b2WorldManifold=C,Box2D.Collision.ClipVertex=k,Box2D.Collision.Features=L,Box2D.Collision.Shapes.b2CircleShape=A,Box2D.Collision.Shapes.b2EdgeChainDef=O,Box2D.Collision.Shapes.b2EdgeShape=M,Box2D.Collision.Shapes.b2MassData=_,Box2D.Collision.Shapes.b2PolygonShape=D,Box2D.Collision.Shapes.b2Shape=P,Box2D.Common.b2internal="Box2D.Common.b2internal",Box2D.Common.b2Color=H,Box2D.Common.b2Settings=B,Box2D.Common.Math.b2Mat22=j,Box2D.Common.Math.b2Mat33=F,Box2D.Common.Math.b2Math=I,Box2D.Common.Math.b2Sweep=q,Box2D.Common.Math.b2Transform=R,Box2D.Common.Math.b2Vec2=U,Box2D.Common.Math.b2Vec3=z,Box2D.Dynamics.b2Body=W,Box2D.Dynamics.b2BodyDef=X,Box2D.Dynamics.b2ContactFilter=V,Box2D.Dynamics.b2ContactImpulse=$,Box2D.Dynamics.b2ContactListener=J,Box2D.Dynamics.b2ContactManager=K,Box2D.Dynamics.b2DebugDraw=Q,Box2D.Dynamics.b2DestructionListener=G,Box2D.Dynamics.b2FilterData=Y,Box2D.Dynamics.b2Fixture=Z,Box2D.Dynamics.b2FixtureDef=et,Box2D.Dynamics.b2Island=tt,Box2D.Dynamics.b2TimeStep=nt,Box2D.Dynamics.b2World=rt,Box2D.Dynamics.Contacts.b2CircleContact=it,Box2D.Dynamics.Contacts.b2Contact=st,Box2D.Dynamics.Contacts.b2ContactConstraint=ot,Box2D.Dynamics.Contacts.b2ContactConstraintPoint=ut,Box2D.Dynamics.Contacts.b2ContactEdge=at,Box2D.Dynamics.Contacts.b2ContactFactory=ft,Box2D.Dynamics.Contacts.b2ContactRegister=lt,Box2D.Dynamics.Contacts.b2ContactResult=ct,Box2D.Dynamics.Contacts.b2ContactSolver=ht,Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=pt,Box2D.Dynamics.Contacts.b2NullContact=dt,Box2D.Dynamics.Contacts.b2PolyAndCircleContact=vt,Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=mt,Box2D.Dynamics.Contacts.b2PolygonContact=gt,Box2D.Dynamics.Contacts.b2PositionSolverManifold=yt,Box2D.Dynamics.Controllers.b2BuoyancyController=bt,Box2D.Dynamics.Controllers.b2ConstantAccelController=wt,Box2D.Dynamics.Controllers.b2ConstantForceController=Et,Box2D.Dynamics.Controllers.b2Controller=St,Box2D.Dynamics.Controllers.b2ControllerEdge=xt,Box2D.Dynamics.Controllers.b2GravityController=Tt,Box2D.Dynamics.Controllers.b2TensorDampingController=Nt,Box2D.Dynamics.Joints.b2DistanceJoint=Ct,Box2D.Dynamics.Joints.b2DistanceJointDef=kt,Box2D.Dynamics.Joints.b2FrictionJoint=Lt,Box2D.Dynamics.Joints.b2FrictionJointDef=At,Box2D.Dynamics.Joints.b2GearJoint=Ot,Box2D.Dynamics.Joints.b2GearJointDef=Mt,Box2D.Dynamics.Joints.b2Jacobian=_t,Box2D.Dynamics.Joints.b2Joint=Dt,Box2D.Dynamics.Joints.b2JointDef=Pt,Box2D.Dynamics.Joints.b2JointEdge=Ht,Box2D.Dynamics.Joints.b2LineJoint=Bt,Box2D.Dynamics.Joints.b2LineJointDef=jt,Box2D.Dynamics.Joints.b2MouseJoint=Ft,Box2D.Dynamics.Joints.b2MouseJointDef=It,Box2D.Dynamics.Joints.b2PrismaticJoint=qt,Box2D.Dynamics.Joints.b2PrismaticJointDef=Rt,Box2D.Dynamics.Joints.b2PulleyJoint=Ut,Box2D.Dynamics.Joints.b2PulleyJointDef=zt,Box2D.Dynamics.Joints.b2RevoluteJoint=Wt,Box2D.Dynamics.Joints.b2RevoluteJointDef=Xt,Box2D.Dynamics.Joints.b2WeldJoint=Vt,Box2D.Dynamics.Joints.b2WeldJointDef=$t}(),Box2D.postDefs=[],function(){var e=Box2D.Collision.Shapes.b2CircleShape,t=Box2D.Collision.Shapes.b2EdgeChainDef,n=Box2D.Collision.Shapes.b2EdgeShape,r=Box2D.Collision.Shapes.b2MassData,i=Box2D.Collision.Shapes.b2PolygonShape,s=Box2D.Collision.Shapes.b2Shape,o=Box2D.Common.b2Color,u=Box2D.Common.b2internal,a=Box2D.Common.b2Settings,f=Box2D.Common.Math.b2Mat22,l=Box2D.Common.Math.b2Mat33,c=Box2D.Common.Math.b2Math,h=Box2D.Common.Math.b2Sweep,p=Box2D.Common.Math.b2Transform,d=Box2D.Common.Math.b2Vec2,v=Box2D.Common.Math.b2Vec3,m=Box2D.Collision.b2AABB,g=Box2D.Collision.b2Bound,y=Box2D.Collision.b2BoundValues,b=Box2D.Collision.b2Collision,w=Box2D.Collision.b2ContactID,E=Box2D.Collision.b2ContactPoint,S=Box2D.Collision.b2Distance,x=Box2D.Collision.b2DistanceInput,T=Box2D.Collision.b2DistanceOutput,N=Box2D.Collision.b2DistanceProxy,C=Box2D.Collision.b2DynamicTree,k=Box2D.Collision.b2DynamicTreeBroadPhase,L=Box2D.Collision.b2DynamicTreeNode,A=Box2D.Collision.b2DynamicTreePair,O=Box2D.Collision.b2Manifold,M=Box2D.Collision.b2ManifoldPoint,_=Box2D.Collision.b2Point,D=Box2D.Collision.b2RayCastInput,P=Box2D.Collision.b2RayCastOutput,H=Box2D.Collision.b2Segment,B=Box2D.Collision.b2SeparationFunction,j=Box2D.Collision.b2Simplex,F=Box2D.Collision.b2SimplexCache,I=Box2D.Collision.b2SimplexVertex,q=Box2D.Collision.b2TimeOfImpact,R=Box2D.Collision.b2TOIInput,U=Box2D.Collision.b2WorldManifold,z=Box2D.Collision.ClipVertex,W=Box2D.Collision.Features,X=Box2D.Collision.IBroadPhase;m.b2AABB=function(){this.lowerBound=new d,this.upperBound=new d},m.prototype.IsValid=function(){var e=this.upperBound.x-this.lowerBound.x,t=this.upperBound.y-this.lowerBound.y,n=e>=0&&t>=0;return n=n&&this.lowerBound.IsValid()&&this.upperBound.IsValid(),n},m.prototype.GetCenter=function(){return new d((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},m.prototype.GetExtents=function(){return new d((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},m.prototype.Contains=function(e){var t=!0;return t=t&&this.lowerBound.x<=e.lowerBound.x,t=t&&this.lowerBound.y<=e.lowerBound.y,t=t&&e.upperBound.x<=this.upperBound.x,t=t&&e.upperBound.y<=this.upperBound.y,t},m.prototype.RayCast=function(e,t){var n=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=t.p1.x,s=t.p1.y,o=t.p2.x-t.p1.x,u=t.p2.y-t.p1.y,a=Math.abs(o),f=Math.abs(u),l=e.normal,c=0,h=0,p=0,d=0,v=0;if(a<Number.MIN_VALUE){if(i<this.lowerBound.x||this.upperBound.x<i)return!1}else{c=1/o,h=(this.lowerBound.x-i)*c,p=(this.upperBound.x-i)*c,v=-1,h>p&&(d=h,h=p,p=d,v=1),h>n&&(l.x=v,l.y=0,n=h),r=Math.min(r,p);if(n>r)return!1}if(f<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{c=1/u,h=(this.lowerBound.y-s)*c,p=(this.upperBound.y-s)*c,v=-1,h>p&&(d=h,h=p,p=d,v=1),h>n&&(l.y=v,l.x=0,n=h),r=Math.min(r,p);if(n>r)return!1}return e.fraction=n,!0},m.prototype.TestOverlap=function(e){var t=e.lowerBound.x-this.upperBound.x,n=e.lowerBound.y-this.upperBound.y,r=this.lowerBound.x-e.upperBound.x,i=this.lowerBound.y-e.upperBound.y;return t>0||n>0?!1:r>0||i>0?!1:!0},m.Combine=function(e,t){var n=new m;return n.Combine(e,t),n},m.prototype.Combine=function(e,t){this.lowerBound.x=Math.min(e.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(e.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(e.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(e.upperBound.y,t.upperBound.y)},g.b2Bound=function(){},g.prototype.IsLower=function(){return(this.value&1)==0},g.prototype.IsUpper=function(){return(this.value&1)==1},g.prototype.Swap=function(e){var t=this.value,n=this.proxy,r=this.stabbingCount;this.value=e.value,this.proxy=e.proxy,this.stabbingCount=e.stabbingCount,e.value=t,e.proxy=n,e.stabbingCount=r},y.b2BoundValues=function(){},y.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number,this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=new Vector_a2j_Number,this.upperValues[0]=0,this.upperValues[1]=0},b.b2Collision=function(){},b.ClipSegmentToLine=function(e,t,n,r){r===undefined&&(r=0);var i,s=0;i=t[0];var o=i.v;i=t[1];var u=i.v,a=n.x*o.x+n.y*o.y-r,f=n.x*u.x+n.y*u.y-r;a<=0&&e[s++].Set(t[0]),f<=0&&e[s++].Set(t[1]);if(a*f<0){var l=a/(a-f);i=e[s];var c=i.v;c.x=o.x+l*(u.x-o.x),c.y=o.y+l*(u.y-o.y),i=e[s];var h;a>0?(h=t[0],i.id=h.id):(h=t[1],i.id=h.id),++s}return s},b.EdgeSeparation=function(e,t,n,r,i){n===undefined&&(n=0);var s=parseInt(e.m_vertexCount),o=e.m_vertices,u=e.m_normals,a=parseInt(r.m_vertexCount),f=r.m_vertices,l,c;l=t.R,c=u[n];var h=l.col1.x*c.x+l.col2.x*c.y,p=l.col1.y*c.x+l.col2.y*c.y;l=i.R;var d=l.col1.x*h+l.col1.y*p,v=l.col2.x*h+l.col2.y*p,m=0,g=Number.MAX_VALUE;for(var y=0;y<a;++y){c=f[y];var b=c.x*d+c.y*v;b<g&&(g=b,m=y)}c=o[n],l=t.R;var w=t.position.x+(l.col1.x*c.x+l.col2.x*c.y),E=t.position.y+(l.col1.y*c.x+l.col2.y*c.y);c=f[m],l=i.R;var S=i.position.x+(l.col1.x*c.x+l.col2.x*c.y),x=i.position.y+(l.col1.y*c.x+l.col2.y*c.y);S-=w,x-=E;var T=S*h+x*p;return T},b.FindMaxSeparation=function(e,t,n,r,i){var s=parseInt(t.m_vertexCount),o=t.m_normals,u,a;a=i.R,u=r.m_centroid;var f=i.position.x+(a.col1.x*u.x+a.col2.x*u.y),l=i.position.y+(a.col1.y*u.x+a.col2.y*u.y);a=n.R,u=t.m_centroid,f-=n.position.x+(a.col1.x*u.x+a.col2.x*u.y),l-=n.position.y+(a.col1.y*u.x+a.col2.y*u.y);var c=f*n.R.col1.x+l*n.R.col1.y,h=f*n.R.col2.x+l*n.R.col2.y,p=0,d=-Number.MAX_VALUE;for(var v=0;v<s;++v){u=o[v];var m=u.x*c+u.y*h;m>d&&(d=m,p=v)}var g=b.EdgeSeparation(t,n,p,r,i),y=parseInt(p-1>=0?p-1:s-1),w=b.EdgeSeparation(t,n,y,r,i),E=parseInt(p+1<s?p+1:0),S=b.EdgeSeparation(t,n,E,r,i),x=0,T=0,N=0;if(w>g&&w>S)N=-1,x=y,T=w;else{if(!(S>g))return e[0]=p,g;N=1,x=E,T=S}for(;;){N==-1?p=x-1>=0?x-1:s-1:p=x+1<s?x+1:0,g=b.EdgeSeparation(t,n,p,r,i);if(!(g>T))break;x=p,T=g}return e[0]=x,T},b.FindIncidentEdge=function(e,t,n,r,i,s){r===undefined&&(r=0);var o=parseInt(t.m_vertexCount),u=t.m_normals,a=parseInt(i.m_vertexCount),f=i.m_vertices,l=i.m_normals,c,h;c=n.R,h=u[r];var p=c.col1.x*h.x+c.col2.x*h.y,d=c.col1.y*h.x+c.col2.y*h.y;c=s.R;var v=c.col1.x*p+c.col1.y*d;d=c.col2.x*p+c.col2.y*d,p=v;var m=0,g=Number.MAX_VALUE;for(var y=0;y<a;++y){h=l[y];var b=p*h.x+d*h.y;b<g&&(g=b,m=y)}var w,E=parseInt(m),S=parseInt(E+1<a?E+1:0);w=e[0],h=f[E],c=s.R,w.v.x=s.position.x+(c.col1.x*h.x+c.col2.x*h.y),w.v.y=s.position.y+(c.col1.y*h.x+c.col2.y*h.y),w.id.features.referenceEdge=r,w.id.features.incidentEdge=E,w.id.features.incidentVertex=0,w=e[1],h=f[S],c=s.R,w.v.x=s.position.x+(c.col1.x*h.x+c.col2.x*h.y),w.v.y=s.position.y+(c.col1.y*h.x+c.col2.y*h.y),w.id.features.referenceEdge=r,w.id.features.incidentEdge=S,w.id.features.incidentVertex=1},b.MakeClipPointVector=function(){var e=new Vector(2);return e[0]=new z,e[1]=new z,e},b.CollidePolygons=function(e,t,n,r,i){var s;e.m_pointCount=0;var o=t.m_radius+r.m_radius,u=0;b.s_edgeAO[0]=u;var f=b.FindMaxSeparation(b.s_edgeAO,t,n,r,i);u=b.s_edgeAO[0];if(f>o)return;var l=0;b.s_edgeBO[0]=l;var c=b.FindMaxSeparation(b.s_edgeBO,r,i,t,n);l=b.s_edgeBO[0];if(c>o)return;var h,p,d,v,m=0,g=0,y=.98,w=.001,E;c>y*f+w?(h=r,p=t,d=i,v=n,m=l,e.m_type=O.e_faceB,g=1):(h=t,p=r,d=n,v=i,m=u,e.m_type=O.e_faceA,g=0);var S=b.s_incidentEdge;b.FindIncidentEdge(S,h,d,m,p,v);var x=parseInt(h.m_vertexCount),T=h.m_vertices,N=T[m],C;m+1<x?C=T[parseInt(m+1)]:C=T[0];var k=b.s_localTangent;k.Set(C.x-N.x,C.y-N.y),k.Normalize();var L=b.s_localNormal;L.x=k.y,L.y=-k.x;var A=b.s_planePoint;A.Set(.5*(N.x+C.x),.5*(N.y+C.y));var M=b.s_tangent;E=d.R,M.x=E.col1.x*k.x+E.col2.x*k.y,M.y=E.col1.y*k.x+E.col2.y*k.y;var _=b.s_tangent2;_.x=-M.x,_.y=-M.y;var D=b.s_normal;D.x=M.y,D.y=-M.x;var P=b.s_v11,H=b.s_v12;P.x=d.position.x+(E.col1.x*N.x+E.col2.x*N.y),P.y=d.position.y+(E.col1.y*N.x+E.col2.y*N.y),H.x=d.position.x+(E.col1.x*C.x+E.col2.x*C.y),H.y=d.position.y+(E.col1.y*C.x+E.col2.y*C.y);var B=D.x*P.x+D.y*P.y,j=-M.x*P.x-M.y*P.y+o,F=M.x*H.x+M.y*H.y+o,I=b.s_clipPoints1,q=b.s_clipPoints2,R=0;R=b.ClipSegmentToLine(I,S,_,j);if(R<2)return;R=b.ClipSegmentToLine(q,I,M,F);if(R<2)return;e.m_localPlaneNormal.SetV(L),e.m_localPoint.SetV(A);var U=0;for(var z=0;z<a.b2_maxManifoldPoints;++z){s=q[z];var W=D.x*s.v.x+D.y*s.v.y-B;if(W<=o){var X=e.m_points[U];E=v.R;var V=s.v.x-v.position.x,$=s.v.y-v.position.y;X.m_localPoint.x=V*E.col1.x+$*E.col1.y,X.m_localPoint.y=V*E.col2.x+$*E.col2.y,X.m_id.Set(s.id),X.m_id.features.flip=g,++U}}e.m_pointCount=U},b.CollideCircles=function(e,t,n,r,i){e.m_pointCount=0;var s,o;s=n.R,o=t.m_p;var u=n.position.x+(s.col1.x*o.x+s.col2.x*o.y),a=n.position.y+(s.col1.y*o.x+s.col2.y*o.y);s=i.R,o=r.m_p;var f=i.position.x+(s.col1.x*o.x+s.col2.x*o.y),l=i.position.y+(s.col1.y*o.x+s.col2.y*o.y),c=f-u,h=l-a,p=c*c+h*h,d=t.m_radius+r.m_radius;if(p>d*d)return;e.m_type=O.e_circles,e.m_localPoint.SetV(t.m_p),e.m_localPlaneNormal.SetZero(),e.m_pointCount=1,e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0},b.CollidePolygonAndCircle=function(e,t,n,r,i){e.m_pointCount=0;var s,o=0,u=0,a=0,f=0,l,c;c=i.R,l=r.m_p;var h=i.position.x+(c.col1.x*l.x+c.col2.x*l.y),p=i.position.y+(c.col1.y*l.x+c.col2.y*l.y);o=h-n.position.x,u=p-n.position.y,c=n.R;var d=o*c.col1.x+u*c.col1.y,v=o*c.col2.x+u*c.col2.y,m=0,g=0,y=-Number.MAX_VALUE,b=t.m_radius+r.m_radius,w=parseInt(t.m_vertexCount),E=t.m_vertices,S=t.m_normals;for(var x=0;x<w;++x){l=E[x],o=d-l.x,u=v-l.y,l=S[x];var T=l.x*o+l.y*u;if(T>b)return;T>y&&(y=T,g=x)}var N=parseInt(g),C=parseInt(N+1<w?N+1:0),k=E[N],L=E[C];if(y<Number.MIN_VALUE){e.m_pointCount=1,e.m_type=O.e_faceA,e.m_localPlaneNormal.SetV(S[g]),e.m_localPoint.x=.5*(k.x+L.x),e.m_localPoint.y=.5*(k.y+L.y),e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0;return}var A=(d-k.x)*(L.x-k.x)+(v-k.y)*(L.y-k.y),M=(d-L.x)*(k.x-L.x)+(v-L.y)*(k.y-L.y);if(A<=0){if((d-k.x)*(d-k.x)+(v-k.y)*(v-k.y)>b*b)return;e.m_pointCount=1,e.m_type=O.e_faceA,e.m_localPlaneNormal.x=d-k.x,e.m_localPlaneNormal.y=v-k.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(k),e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0}else if(M<=0){if((d-L.x)*(d-L.x)+(v-L.y)*(v-L.y)>b*b)return;e.m_pointCount=1,e.m_type=O.e_faceA,e.m_localPlaneNormal.x=d-L.x,e.m_localPlaneNormal.y=v-L.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(L),e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0}else{var _=.5*(k.x+L.x),D=.5*(k.y+L.y);y=(d-_)*S[N].x+(v-D)*S[N].y;if(y>b)return;e.m_pointCount=1,e.m_type=O.e_faceA,e.m_localPlaneNormal.x=S[N].x,e.m_localPlaneNormal.y=S[N].y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.Set(_,D),e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0}},b.TestOverlap=function(e,t){var n=t.lowerBound,r=e.upperBound,i=n.x-r.x,s=n.y-r.y;n=e.lowerBound,r=t.upperBound;var o=n.x-r.x,u=n.y-r.y;return i>0||s>0?!1:o>0||u>0?!1:!0},Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=b.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints1=b.MakeClipPointVector(),Box2D.Collision.b2Collision.s_clipPoints2=b.MakeClipPointVector(),Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_edgeBO=new Vector_a2j_Number(1),Box2D.Collision.b2Collision.s_localTangent=new d,Box2D.Collision.b2Collision.s_localNormal=new d,Box2D.Collision.b2Collision.s_planePoint=new d,Box2D.Collision.b2Collision.s_normal=new d,Box2D.Collision.b2Collision.s_tangent=new d,Box2D.Collision.b2Collision.s_tangent2=new d,Box2D.Collision.b2Collision.s_v11=new d,Box2D.Collision.b2Collision.s_v12=new d,Box2D.Collision.b2Collision.b2CollidePolyTempVec=new d,Box2D.Collision.b2Collision.b2_nullFeature=255}),w.b2ContactID=function(){this.features=new W},w.prototype.b2ContactID=function(){this.features._m_id=this},w.prototype.Set=function(e){this.key=e._key},w.prototype.Copy=function(){var e=new w;return e.key=this.key,e},Object.defineProperty(w.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}}),Object.defineProperty(w.prototype,"key",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._key=e,this.features._referenceEdge=this._key&255,this.features._incidentEdge=(this._key&65280)>>8&255,this.features._incidentVertex=(this._key&16711680)>>16&255,this.features._flip=(this._key&4278190080)>>24&255}}),E.b2ContactPoint=function(){this.position=new d,this.velocity=new d,this.normal=new d,this.id=new w},S.b2Distance=function(){},S.Distance=function(e,t,n){++S.b2_gjkCalls;var r=n.proxyA,i=n.proxyB,s=n.transformA,o=n.transformB,u=S.s_simplex;u.ReadCache(t,r,s,i,o);var f=u.m_vertices,l=20,h=S.s_saveA,p=S.s_saveB,v=0,m=u.GetClosestPoint(),g=m.LengthSquared(),y=g,b=0,w,E=0;while(E<l){v=u.m_count;for(b=0;b<v;b++)h[b]=f[b].indexA,p[b]=f[b].indexB;switch(u.m_count){case 1:break;case 2:u.Solve2();break;case 3:u.Solve3();break;default:a.b2Assert(!1)}if(u.m_count==3)break;w=u.GetClosestPoint(),y=w.LengthSquared(),y>g,g=y;var x=u.GetSearchDirection();if(x.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;var T=f[u.m_count];T.indexA=r.GetSupport(c.MulTMV(s.R,x.GetNegative())),T.wA=c.MulX(s,r.GetVertex(T.indexA)),T.indexB=i.GetSupport(c.MulTMV(o.R,x)),T.wB=c.MulX(o,i.GetVertex(T.indexB)),T.w=c.SubtractVV(T.wB,T.wA),++E,++S.b2_gjkIters;var N=!1;for(b=0;b<v;b++)if(T.indexA==h[b]&&T.indexB==p[b]){N=!0;break}if(N)break;++u.m_count}S.b2_gjkMaxIters=c.Max(S.b2_gjkMaxIters,E),u.GetWitnessPoints(e.pointA,e.pointB),e.distance=c.SubtractVV(e.pointA,e.pointB).Length(),e.iterations=E,u.WriteCache(t);if(n.useRadii){var C=r.m_radius,k=i.m_radius;if(e.distance>C+k&&e.distance>Number.MIN_VALUE){e.distance-=C+k;var L=c.SubtractVV(e.pointB,e.pointA);L.Normalize(),e.pointA.x+=C*L.x,e.pointA.y+=C*L.y,e.pointB.x-=k*L.x,e.pointB.y-=k*L.y}else w=new d,w.x=.5*(e.pointA.x+e.pointB.x),w.y=.5*(e.pointA.y+e.pointB.y),e.pointA.x=e.pointB.x=w.x,e.pointA.y=e.pointB.y=w.y,e.distance=0}},Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new j,Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3),Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)}),x.b2DistanceInput=function(){},T.b2DistanceOutput=function(){this.pointA=new d,this.pointB=new d},N.b2DistanceProxy=function(){},N.prototype.Set=function(t){switch(t.GetType()){case s.e_circleShape:var n=t instanceof e?t:null;this.m_vertices=new Vector(1,!0),this.m_vertices[0]=n.m_p,this.m_count=1,this.m_radius=n.m_radius;break;case s.e_polygonShape:var r=t instanceof i?t:null;this.m_vertices=r.m_vertices,this.m_count=r.m_vertexCount,this.m_radius=r.m_radius;break;default:a.b2Assert(!1)}},N.prototype.GetSupport=function(e){var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},N.prototype.GetSupportVertex=function(e){var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},N.prototype.GetVertexCount=function(){return this.m_count},N.prototype.GetVertex=function(e){return e===undefined&&(e=0),a.b2Assert(0<=e&&e<this.m_count),this.m_vertices[e]},C.b2DynamicTree=function(){},C.prototype.b2DynamicTree=function(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0},C.prototype.CreateProxy=function(e,t){var n=this.AllocateNode(),r=a.b2_aabbExtension,i=a.b2_aabbExtension;return n.aabb.lowerBound.x=e.lowerBound.x-r,n.aabb.lowerBound.y=e.lowerBound.y-i,n.aabb.upperBound.x=e.upperBound.x+r,n.aabb.upperBound.y=e.upperBound.y+i,n.userData=t,this.InsertLeaf(n),n},C.prototype.DestroyProxy=function(e){this.RemoveLeaf(e),this.FreeNode(e)},C.prototype.MoveProxy=function(e,t,n){a.b2Assert(e.IsLeaf());if(e.aabb.Contains(t))return!1;this.RemoveLeaf(e);var r=a.b2_aabbExtension+a.b2_aabbMultiplier*(n.x>0?n.x:-n.x),i=a.b2_aabbExtension+a.b2_aabbMultiplier*(n.y>0?n.y:-n.y);return e.aabb.lowerBound.x=t.lowerBound.x-r,e.aabb.lowerBound.y=t.lowerBound.y-i,e.aabb.upperBound.x=t.upperBound.x+r,e.aabb.upperBound.y=t.upperBound.y+i,this.InsertLeaf(e),!0},C.prototype.Rebalance=function(e){e===undefined&&(e=0);if(this.m_root==null)return;for(var t=0;t<e;t++){var n=this.m_root,r=0;while(n.IsLeaf()==0)n=this.m_path>>r&1?n.child2:n.child1,r=r+1&31;++this.m_path,this.RemoveLeaf(n),this.InsertLeaf(n)}},C.prototype.GetFatAABB=function(e){return e.aabb},C.prototype.GetUserData=function(e){return e.userData},C.prototype.Query=function(e,t){if(this.m_root==null)return;var n=new Vector,r=0;n[r++]=this.m_root;while(r>0){var i=n[--r];if(i.aabb.TestOverlap(t))if(i.IsLeaf()){var s=e(i);if(!s)return}else n[r++]=i.child1,n[r++]=i.child2}},C.prototype.RayCast=function(e,t){if(this.m_root==null)return;var n=t.p1,r=t.p2,i=c.SubtractVV(n,r);i.Normalize();var s=c.CrossFV(1,i),o=c.AbsV(s),u=t.maxFraction,a=new m,f=0,l=0;f=n.x+u*(r.x-n.x),l=n.y+u*(r.y-n.y),a.lowerBound.x=Math.min(n.x,f),a.lowerBound.y=Math.min(n.y,l),a.upperBound.x=Math.max(n.x,f),a.upperBound.y=Math.max(n.y,l);var h=new Vector,p=0;h[p++]=this.m_root;while(p>0){var d=h[--p];if(d.aabb.TestOverlap(a)==0)continue;var v=d.aabb.GetCenter(),g=d.aabb.GetExtents(),y=Math.abs(s.x*(n.x-v.x)+s.y*(n.y-v.y))-o.x*g.x-o.y*g.y;if(y>0)continue;if(d.IsLeaf()){var b=new D;b.p1=t.p1,b.p2=t.p2,b.maxFraction=t.maxFraction,u=e(b,d);if(u==0)return;u>0&&(f=n.x+u*(r.x-n.x),l=n.y+u*(r.y-n.y),a.lowerBound.x=Math.min(n.x,f),a.lowerBound.y=Math.min(n.y,l),a.upperBound.x=Math.max(n.x,f),a.upperBound.y=Math.max(n.y,l))}else h[p++]=d.child1,h[p++]=d.child2}},C.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e}return new L},C.prototype.FreeNode=function(e){e.parent=this.m_freeList,this.m_freeList=e},C.prototype.InsertLeaf=function(e){++this.m_insertionCount;if(this.m_root==null){this.m_root=e,this.m_root.parent=null;return}var t=e.aabb.GetCenter(),n=this.m_root;if(n.IsLeaf()==0)do{var r=n.child1,i=n.child2,s=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-t.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-t.y),o=Math.abs((i.aabb.lowerBound.x+i.aabb.upperBound.x)/2-t.x)+Math.abs((i.aabb.lowerBound.y+i.aabb.upperBound.y)/2-t.y);s<o?n=r:n=i}while(n.IsLeaf()==0);var u=n.parent,a=this.AllocateNode();a.parent=u,a.userData=null,a.aabb.Combine(e.aabb,n.aabb);if(u){n.parent.child1==n?u.child1=a:u.child2=a,a.child1=n,a.child2=e,n.parent=a,e.parent=a;do{if(u.aabb.Contains(a.aabb))break;u.aabb.Combine(u.child1.aabb,u.child2.aabb),a=u,u=u.parent}while(u)}else a.child1=n,a.child2=e,n.parent=a,e.parent=a,this.m_root=a},C.prototype.RemoveLeaf=function(e){if(e==this.m_root){this.m_root=null;return}var t=e.parent,n=t.parent,r;t.child1==e?r=t.child2:r=t.child1;if(n){n.child1==t?n.child1=r:n.child2=r,r.parent=n,this.FreeNode(t);while(n){var i=n.aabb;n.aabb=m.Combine(n.child1.aabb,n.child2.aabb);if(i.Contains(n.aabb))break;n=n.parent}}else this.m_root=r,r.parent=null,this.FreeNode(t)},k.b2DynamicTreeBroadPhase=function(){this.m_tree=new C,this.m_moveBuffer=new Vector,this.m_pairBuffer=new Vector,this.m_pairCount=0},k.prototype.CreateProxy=function(e,t){var n=this.m_tree.CreateProxy(e,t);return++this.m_proxyCount,this.BufferMove(n),n},k.prototype.DestroyProxy=function(e){this.UnBufferMove(e),--this.m_proxyCount,this.m_tree.DestroyProxy(e)},k.prototype.MoveProxy=function(e,t,n){var r=this.m_tree.MoveProxy(e,t,n);r&&this.BufferMove(e)},k.prototype.TestOverlap=function(e,t){var n=this.m_tree.GetFatAABB(e),r=this.m_tree.GetFatAABB(t);return n.TestOverlap(r)},k.prototype.GetUserData=function(e){return this.m_tree.GetUserData(e)},k.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)},k.prototype.GetProxyCount=function(){return this.m_proxyCount},k.prototype.UpdatePairs=function(e){var t=this;t.m_pairCount=0;var n=0,r;for(n=0;n<t.m_moveBuffer.length;++n){r=t.m_moveBuffer[n];function i(e){if(e==r)return!0;t.m_pairCount==t.m_pairBuffer.length&&(t.m_pairBuffer[t.m_pairCount]=new A);var n=t.m_pairBuffer[t.m_pairCount];return n.proxyA=e<r?e:r,n.proxyB=e>=r?e:r,++t.m_pairCount,!0}var s=t.m_tree.GetFatAABB(r);t.m_tree.Query(i,s)}t.m_moveBuffer.length=0;for(var n=0;n<t.m_pairCount;){var o=t.m_pairBuffer[n],u=t.m_tree.GetUserData(o.proxyA),a=t.m_tree.GetUserData(o.proxyB);e(u,a),++n;while(n<t.m_pairCount){var f=t.m_pairBuffer[n];if(f.proxyA!=o.proxyA||f.proxyB!=o.proxyB)break;++n}}},k.prototype.Query=function(e,t){this.m_tree.Query(e,t)},k.prototype.RayCast=function(e,t){this.m_tree.RayCast(e,t)},k.prototype.Validate=function(){},k.prototype.Rebalance=function(e){e===undefined&&(e=0),this.m_tree.Rebalance(e)},k.prototype.BufferMove=function(e){this.m_moveBuffer[this.m_moveBuffer.length]=e},k.prototype.UnBufferMove=function(e){var t=parseInt(this.m_moveBuffer.indexOf(e));this.m_moveBuffer.splice(t,1)},k.prototype.ComparePairs=function(e,t){return 0},k.__implements={},k.__implements[X]=!0,L.b2DynamicTreeNode=function(){this.aabb=new m},L.prototype.IsLeaf=function(){return this.child1==null},A.b2DynamicTreePair=function(){},O.b2Manifold=function(){this.m_pointCount=0},O.prototype.b2Manifold=function(){this.m_points=new Vector(a.b2_maxManifoldPoints);for(var e=0;e<a.b2_maxManifoldPoints;e++)this.m_points[e]=new M;this.m_localPlaneNormal=new d,this.m_localPoint=new d},O.prototype.Reset=function(){for(var e=0;e<a.b2_maxManifoldPoints;e++)(this.m_points[e]instanceof M?this.m_points[e]:null).Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_type=0,this.m_pointCount=0},O.prototype.Set=function(e){this.m_pointCount=e.m_pointCount;for(var t=0;t<a.b2_maxManifoldPoints;t++)(this.m_points[t]instanceof M?this.m_points[t]:null).Set(e.m_points[t]);this.m_localPlaneNormal.SetV(e.m_localPlaneNormal),this.m_localPoint.SetV(e.m_localPoint),this.m_type=e.m_type},O.prototype.Copy=function(){var e=new O;return e.Set(this),e},Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1,Box2D.Collision.b2Manifold.e_faceA=2,Box2D.Collision.b2Manifold.e_faceB=4}),M.b2ManifoldPoint=function(){this.m_localPoint=new d,this.m_id=new w},M.prototype.b2ManifoldPoint=function(){this.Reset()},M.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_normalImpulse=0,this.m_tangentImpulse=0,this.m_id.key=0},M.prototype.Set=function(e){this.m_localPoint.SetV(e.m_localPoint),this.m_normalImpulse=e.m_normalImpulse,this.m_tangentImpulse=e.m_tangentImpulse,this.m_id.Set(e.m_id)},_.b2Point=function(){this.p=new d},_.prototype.Support=function(e,t,n){return t===undefined&&(t=0),n===undefined&&(n=0),this.p},_.prototype.GetFirstVertex=function(e){return this.p},D.b2RayCastInput=function(){this.p1=new d,this.p2=new d},D.prototype.b2RayCastInput=function(e,t,n){e===undefined&&(e=null),t===undefined&&(t=null),n===undefined&&(n=1),e&&this.p1.SetV(e),t&&this.p2.SetV(t),this.maxFraction=n},P.b2RayCastOutput=function(){this.normal=new d},H.b2Segment=function(){this.p1=new d,this.p2=new d},H.prototype.TestSegment=function(e,t,n,r){r===undefined&&(r=0);var i=n.p1,s=n.p2.x-i.x,o=n.p2.y-i.y,u=this.p2.x-this.p1.x,a=this.p2.y-this.p1.y,f=a,l=-u,c=100*Number.MIN_VALUE,h=-(s*f+o*l);if(h>c){var p=i.x-this.p1.x,d=i.y-this.p1.y,v=p*f+d*l;if(0<=v&&v<=r*h){var m=-s*d+o*p;if(-c*h<=m&&m<=h*(1+c)){v/=h;var g=Math.sqrt(f*f+l*l);return f/=g,l/=g,e[0]=v,t.Set(f,l),!0}}}return!1},H.prototype.Extend=function(e){this.ExtendForward(e),this.ExtendBackward(e)},H.prototype.ExtendForward=function(e){var t=this.p2.x-this.p1.x,n=this.p2.y-this.p1.y,r=Math.min(t>0?(e.upperBound.x-this.p1.x)/t:t<0?(e.lowerBound.x-this.p1.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p1.y)/n:n<0?(e.lowerBound.y-this.p1.y)/n:Number.POSITIVE_INFINITY);this.p2.x=this.p1.x+t*r,this.p2.y=this.p1.y+n*r},H.prototype.ExtendBackward=function(e){var t=-this.p2.x+this.p1.x,n=-this.p2.y+this.p1.y,r=Math.min(t>0?(e.upperBound.x-this.p2.x)/t:t<0?(e.lowerBound.x-this.p2.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p2.y)/n:n<0?(e.lowerBound.y-this.p2.y)/n:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+t*r,this.p1.y=this.p2.y+n*r},B.b2SeparationFunction=function(){this.m_localPoint=new d,this.m_axis=new d},B.prototype.Initialize=function(e,t,n,r,i){this.m_proxyA=t,this.m_proxyB=r;var s=parseInt(e.count);a.b2Assert(0<s&&s<3);var o,u,f,l,h,p,v=0,m=0,g=0,y=0,b=0,w=0,E,S,x=0,T=0;if(s==1)this.m_type=B.e_points,o=this.m_proxyA.GetVertex(e.indexA[0]),l=this.m_proxyB.GetVertex(e.indexB[0]),S=o,E=n.R,v=n.position.x+(E.col1.x*S.x+E.col2.x*S.y),m=n.position.y+(E.col1.y*S.x+E.col2.y*S.y),S=l,E=i.R,g=i.position.x+(E.col1.x*S.x+E.col2.x*S.y),y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y),this.m_axis.x=g-v,this.m_axis.y=y-m,this.m_axis.Normalize();else if(e.indexB[0]==e.indexB[1])this.m_type=B.e_faceA,u=this.m_proxyA.GetVertex(e.indexA[0]),f=this.m_proxyA.GetVertex(e.indexA[1]),l=this.m_proxyB.GetVertex(e.indexB[0]),this.m_localPoint.x=.5*(u.x+f.x),this.m_localPoint.y=.5*(u.y+f.y),this.m_axis=c.CrossVF(c.SubtractVV(f,u),1),this.m_axis.Normalize(),S=this.m_axis,E=n.R,b=E.col1.x*S.x+E.col2.x*S.y,w=E.col1.y*S.x+E.col2.y*S.y,S=this.m_localPoint,E=n.R,v=n.position.x+(E.col1.x*S.x+E.col2.x*S.y),m=n.position.y+(E.col1.y*S.x+E.col2.y*S.y),S=l,E=i.R,g=i.position.x+(E.col1.x*S.x+E.col2.x*S.y),y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y),x=(g-v)*b+(y-m)*w,x<0&&this.m_axis.NegativeSelf();else if(e.indexA[0]==e.indexA[0])this.m_type=B.e_faceB,h=this.m_proxyB.GetVertex(e.indexB[0]),p=this.m_proxyB.GetVertex(e.indexB[1]),o=this.m_proxyA.GetVertex(e.indexA[0]),this.m_localPoint.x=.5*(h.x+p.x),this.m_localPoint.y=.5*(h.y+p.y),this.m_axis=c.CrossVF(c.SubtractVV(p,h),1),this.m_axis.Normalize(),S=this.m_axis,E=i.R,b=E.col1.x*S.x+E.col2.x*S.y,w=E.col1.y*S.x+E.col2.y*S.y,S=this.m_localPoint,E=i.R,g=i.position.x+(E.col1.x*S.x+E.col2.x*S.y),y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y),S=o,E=n.R,v=n.position.x+(E.col1.x*S.x+E.col2.x*S.y),m=n.position.y+(E.col1.y*S.x+E.col2.y*S.y),x=(v-g)*b+(m-y)*w,x<0&&this.m_axis.NegativeSelf();else{u=this.m_proxyA.GetVertex(e.indexA[0]),f=this.m_proxyA.GetVertex(e.indexA[1]),h=this.m_proxyB.GetVertex(e.indexB[0]),p=this.m_proxyB.GetVertex(e.indexB[1]);var N=c.MulX(n,o),C=c.MulMV(n.R,c.SubtractVV(f,u)),k=c.MulX(i,l),L=c.MulMV(i.R,c.SubtractVV(p,h)),A=C.x*C.x+C.y*C.y,O=L.x*L.x+L.y*L.y,M=c.SubtractVV(L,C),_=C.x*M.x+C.y*M.y,D=L.x*M.x+L.y*M.y,P=C.x*L.x+C.y*L.y,H=A*O-P*P;x=0,H!=0&&(x=c.Clamp((P*D-_*O)/H,0,1));var j=(P*x+D)/O;j<0&&(j=0,x=c.Clamp((P-_)/A,0,1)),o=new d,o.x=u.x+x*(f.x-u.x),o.y=u.y+x*(f.y-u.y),l=new d,l.x=h.x+x*(p.x-h.x),l.y=h.y+x*(p.y-h.y),x==0||x==1?(this.m_type=B.e_faceB,this.m_axis=c.CrossVF(c.SubtractVV(p,h),1),this.m_axis.Normalize(),this.m_localPoint=l,S=this.m_axis,E=i.R,b=E.col1.x*S.x+E.col2.x*S.y,w=E.col1.y*S.x+E.col2.y*S.y,S=this.m_localPoint,E=i.R,g=i.position.x+(E.col1.x*S.x+E.col2.x*S.y),y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y),S=o,E=n.R,v=n.position.x+(E.col1.x*S.x+E.col2.x*S.y),m=n.position.y+(E.col1.y*S.x+E.col2.y*S.y),T=(v-g)*b+(m-y)*w,x<0&&this.m_axis.NegativeSelf()):(this.m_type=B.e_faceA,this.m_axis=c.CrossVF(c.SubtractVV(f,u),1),this.m_localPoint=o,S=this.m_axis,E=n.R,b=E.col1.x*S.x+E.col2.x*S.y,w=E.col1.y*S.x+E.col2.y*S.y,S=this.m_localPoint,E=n.R,v=n.position.x+(E.col1.x*S.x+E.col2.x*S.y),m=n.position.y+(E.col1.y*S.x+E.col2.y*S.y),S=l,E=i.R,g=i.position.x+(E.col1.x*S.x+E.col2.x*S.y),y=i.position.y+(E.col1.y*S.x+E.col2.y*S.y),T=(g-v)*b+(y-m)*w,x<0&&this.m_axis.NegativeSelf())}},B.prototype.Evaluate=function(e,t){var n,r,i,s,o,u,f=0,l;switch(this.m_type){case B.e_points:return n=c.MulTMV(e.R,this.m_axis),r=c.MulTMV(t.R,this.m_axis.GetNegative()),i=this.m_proxyA.GetSupportVertex(n),s=this.m_proxyB.GetSupportVertex(r),o=c.MulX(e,i),u=c.MulX(t,s),f=(u.x-o.x)*this.m_axis.x+(u.y-o.y)*this.m_axis.y,f;case B.e_faceA:return l=c.MulMV(e.R,this.m_axis),o=c.MulX(e,this.m_localPoint),r=c.MulTMV(t.R,l.GetNegative()),s=this.m_proxyB.GetSupportVertex(r),u=c.MulX(t,s),f=(u.x-o.x)*l.x+(u.y-o.y)*l.y,f;case B.e_faceB:return l=c.MulMV(t.R,this.m_axis),u=c.MulX(t,this.m_localPoint),n=c.MulTMV(e.R,l.GetNegative()),i=this.m_proxyA.GetSupportVertex(n),o=c.MulX(e,i),f=(o.x-u.x)*l.x+(o.y-u.y)*l.y,f;default:return a.b2Assert(!1),0}},Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1,Box2D.Collision.b2SeparationFunction.e_faceA=2,Box2D.Collision.b2SeparationFunction.e_faceB=4}),j.b2Simplex=function(){this.m_v1=new I,this.m_v2=new I,this.m_v3=new I,this.m_vertices=new Vector(3)},j.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},j.prototype.ReadCache=function(e,t,n,r,i){a.b2Assert(0<=e.count&&e.count<=3);var s,o;this.m_count=e.count;var u=this.m_vertices;for(var f=0;f<this.m_count;f++){var l=u[f];l.indexA=e.indexA[f],l.indexB=e.indexB[f],s=t.GetVertex(l.indexA),o=r.GetVertex(l.indexB),l.wA=c.MulX(n,s),l.wB=c.MulX(i,o),l.w=c.SubtractVV(l.wB,l.wA),l.a=0}if(this.m_count>1){var h=e.metric,p=this.GetMetric();if(p<.5*h||2*h<p||p<Number.MIN_VALUE)this.m_count=0}this.m_count==0&&(l=u[0],l.indexA=0,l.indexB=0,s=t.GetVertex(0),o=r.GetVertex(0),l.wA=c.MulX(n,s),l.wB=c.MulX(i,o),l.w=c.SubtractVV(l.wB,l.wA),this.m_count=1)},j.prototype.WriteCache=function(e){e.metric=this.GetMetric(),e.count=Box2D.parseUInt(this.m_count);var t=this.m_vertices;for(var n=0;n<this.m_count;n++)e.indexA[n]=Box2D.parseUInt(t[n].indexA),e.indexB[n]=Box2D.parseUInt(t[n].indexB)},j.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var e=c.SubtractVV(this.m_v2.w,this.m_v1.w),t=c.CrossVV(e,this.m_v1.w.GetNegative());return t>0?c.CrossFV(1,e):c.CrossVF(e,1);default:return a.b2Assert(!1),new d}},j.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return a.b2Assert(!1),new d;case 1:return this.m_v1.w;case 2:return new d(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return a.b2Assert(!1),new d}},j.prototype.GetWitnessPoints=function(e,t){switch(this.m_count){case 0:a.b2Assert(!1);break;case 1:e.SetV(this.m_v1.wA),t.SetV(this.m_v1.wB);break;case 2:e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,t.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:a.b2Assert(!1)}},j.prototype.GetMetric=function(){switch(this.m_count){case 0:return a.b2Assert(!1),0;case 1:return 0;case 2:return c.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return c.CrossVV(c.SubtractVV(this.m_v2.w,this.m_v1.w),c.SubtractVV(this.m_v3.w,this.m_v1.w));default:return a.b2Assert(!1),0}},j.prototype.Solve2=function(){var e=this.m_v1.w,t=this.m_v2.w,n=c.SubtractVV(t,e),r=-(e.x*n.x+e.y*n.y);if(r<=0){this.m_v1.a=1,this.m_count=1;return}var i=t.x*n.x+t.y*n.y;if(i<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2);return}var s=1/(i+r);this.m_v1.a=i*s,this.m_v2.a=r*s,this.m_count=2},j.prototype.Solve3=function(){var e=this.m_v1.w,t=this.m_v2.w,n=this.m_v3.w,r=c.SubtractVV(t,e),i=c.Dot(e,r),s=c.Dot(t,r),o=s,u=-i,a=c.SubtractVV(n,e),f=c.Dot(e,a),l=c.Dot(n,a),h=l,p=-f,d=c.SubtractVV(n,t),v=c.Dot(t,d),m=c.Dot(n,d),g=m,y=-v,b=c.CrossVV(r,a),w=b*c.CrossVV(t,n),E=b*c.CrossVV(n,e),S=b*c.CrossVV(e,t);if(u<=0&&p<=0){this.m_v1.a=1,this.m_count=1;return}if(o>0&&u>0&&S<=0){var x=1/(o+u);this.m_v1.a=o*x,this.m_v2.a=u*x,this.m_count=2;return}if(h>0&&p>0&&E<=0){var T=1/(h+p);this.m_v1.a=h*T,this.m_v3.a=p*T,this.m_count=2,this.m_v2.Set(this.m_v3);return}if(o<=0&&y<=0){this.m_v2.a=1,this.m_count=1,this.m_v1.Set(this.m_v2);return}if(h<=0&&g<=0){this.m_v3.a=1,this.m_count=1,this.m_v1.Set(this.m_v3);return}if(g>0&&y>0&&w<=0){var N=1/(g+y);this.m_v2.a=g*N,this.m_v3.a=y*N,this.m_count=2,this.m_v1.Set(this.m_v3);return}var C=1/(w+E+S);this.m_v1.a=w*C,this.m_v2.a=E*C,this.m_v3.a=S*C,this.m_count=3},F.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3),this.indexB=new Vector_a2j_Number(3)},I.b2SimplexVertex=function(){},I.prototype.Set=function(e){this.wA.SetV(e.wA),this.wB.SetV(e.wB),this.w.SetV(e.w),this.a=e.a,this.indexA=e.indexA,this.indexB=e.indexB},q.b2TimeOfImpact=function(){},q.TimeOfImpact=function(e){++q.b2_toiCalls;var t=e.proxyA,n=e.proxyB,r=e.sweepA,i=e.sweepB;a.b2Assert(r.t0==i.t0),a.b2Assert(1-r.t0>Number.MIN_VALUE);var s=t.m_radius+n.m_radius,o=e.tolerance,u=0,f=1e3,l=0,h=0;q.s_cache.count=0,q.s_distanceInput.useRadii=!1;for(;;){r.GetTransform(q.s_xfA,u),i.GetTransform(q.s_xfB,u),q.s_distanceInput.proxyA=t,q.s_distanceInput.proxyB=n,q.s_distanceInput.transformA=q.s_xfA,q.s_distanceInput.transformB=q.s_xfB,S.Distance(q.s_distanceOutput,q.s_cache,q.s_distanceInput);if(q.s_distanceOutput.distance<=0){u=1;break}q.s_fcn.Initialize(q.s_cache,t,q.s_xfA,n,q.s_xfB);var p=q.s_fcn.Evaluate(q.s_xfA,q.s_xfB);if(p<=0){u=1;break}l==0&&(p>s?h=c.Max(s-o,.75*s):h=c.Max(p-o,.02*s));if(p-h<.5*o){if(l==0){u=1;break}break}var d=u,v=u,m=1,g=p;r.GetTransform(q.s_xfA,m),i.GetTransform(q.s_xfB,m);var y=q.s_fcn.Evaluate(q.s_xfA,q.s_xfB);if(y>=h){u=1;break}var b=0;for(;;){var w=0;b&1?w=v+(h-g)*(m-v)/(y-g):w=.5*(v+m),r.GetTransform(q.s_xfA,w),i.GetTransform(q.s_xfB,w);var E=q.s_fcn.Evaluate(q.s_xfA,q.s_xfB);if(c.Abs(E-h)<.025*o){d=w;break}E>h?(v=w,g=E):(m=w,y=E),++b,++q.b2_toiRootIters;if(b==50)break}q.b2_toiMaxRootIters=c.Max(q.b2_toiMaxRootIters,b);if(d<(1+100*Number.MIN_VALUE)*u)break;u=d,l++,++q.b2_toiIters;if(l==f)break}return q.b2_toiMaxIters=c.Max(q.b2_toiMaxIters,l),u},Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0,Box2D.Collision.b2TimeOfImpact.b2_toiIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0,Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0,Box2D.Collision.b2TimeOfImpact.s_cache=new F,Box2D.Collision.b2TimeOfImpact.s_distanceInput=new x,Box2D.Collision.b2TimeOfImpact.s_xfA=new p,Box2D.Collision.b2TimeOfImpact.s_xfB=new p,Box2D.Collision.b2TimeOfImpact.s_fcn=new B,Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new T}),R.b2TOIInput=function(){this.proxyA=new N,this.proxyB=new N,this.sweepA=new h,this.sweepB=new h},U.b2WorldManifold=function(){this.m_normal=new d},U.prototype.b2WorldManifold=function(){this.m_points=new Vector(a.b2_maxManifoldPoints);for(var e=0;e<a.b2_maxManifoldPoints;e++)this.m_points[e]=new d},U.prototype.Initialize=function(e,t,n,r,i){n===undefined&&(n=0),i===undefined&&(i=0);if(e.m_pointCount==0)return;var s=0,o,u,a=0,f=0,l=0,c=0,h=0,p=0;switch(e.m_type){case O.e_circles:u=t.R,o=e.m_localPoint;var d=t.position.x+u.col1.x*o.x+u.col2.x*o.y,v=t.position.y+u.col1.y*o.x+u.col2.y*o.y;u=r.R,o=e.m_points[0].m_localPoint;var m=r.position.x+u.col1.x*o.x+u.col2.x*o.y,g=r.position.y+u.col1.y*o.x+u.col2.y*o.y,y=m-d,b=g-v,w=y*y+b*b;if(w>Number.MIN_VALUE*Number.MIN_VALUE){var E=Math.sqrt(w);this.m_normal.x=y/E,this.m_normal.y=b/E}else this.m_normal.x=1,this.m_normal.y=0;var S=d+n*this.m_normal.x,x=v+n*this.m_normal.y,T=m-i*this.m_normal.x,N=g-i*this.m_normal.y;this.m_points[0].x=.5*(S+T),this.m_points[0].y=.5*(x+N);break;case O.e_faceA:u=t.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=t.R,o=e.m_localPoint,l=t.position.x+u.col1.x*o.x+u.col2.x*o.y,c=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=a,this.m_normal.y=f;for(s=0;s<e.m_pointCount;s++)u=r.R,o=e.m_points[s].m_localPoint,h=r.position.x+u.col1.x*o.x+u.col2.x*o.y,p=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(n-(h-l)*a-(p-c)*f-i)*a,this.m_points[s].y=p+.5*(n-(h-l)*a-(p-c)*f-i)*f;break;case O.e_faceB:u=r.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_localPoint,l=r.position.x+u.col1.x*o.x+u.col2.x*o.y,c=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=-a,this.m_normal.y=-f;for(s=0;s<e.m_pointCount;s++)u=t.R,o=e.m_points[s].m_localPoint,h=t.position.x+u.col1.x*o.x+u.col2.x*o.y,p=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(i-(h-l)*a-(p-c)*f-n)*a,this.m_points[s].y=p+.5*(i-(h-l)*a-(p-c)*f-n)*f}},z.ClipVertex=function(){this.v=new d,this.id=new w},z.prototype.Set=function(e){this.v.SetV(e.v),this.id.Set(e.id)},W.Features=function(){},Object.defineProperty(W.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}}),Object.defineProperty(W.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._referenceEdge=e,this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}}),Object.defineProperty(W.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}}),Object.defineProperty(W.prototype,"incidentEdge",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._incidentEdge=e,this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}}),Object.defineProperty(W.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}}),Object.defineProperty(W.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._incidentVertex=e,this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}}),Object.defineProperty(W.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}}),Object.defineProperty(W.prototype,"flip",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._flip=e,this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})}(),function(){var e=Box2D.Common.b2Color,t=Box2D.Common.b2internal,n=Box2D.Common.b2Settings,r=Box2D.Collision.Shapes.b2CircleShape,i=Box2D.Collision.Shapes.b2EdgeChainDef,s=Box2D.Collision.Shapes.b2EdgeShape,o=Box2D.Collision.Shapes.b2MassData,u=Box2D.Collision.Shapes.b2PolygonShape,a=Box2D.Collision.Shapes.b2Shape,f=Box2D.Common.Math.b2Mat22,l=Box2D.Common.Math.b2Mat33,c=Box2D.Common.Math.b2Math,h=Box2D.Common.Math.b2Sweep,p=Box2D.Common.Math.b2Transform,d=Box2D.Common.Math.b2Vec2,v=Box2D.Common.Math.b2Vec3,m=Box2D.Dynamics.b2Body,g=Box2D.Dynamics.b2BodyDef,y=Box2D.Dynamics.b2ContactFilter,b=Box2D.Dynamics.b2ContactImpulse,w=Box2D.Dynamics.b2ContactListener,E=Box2D.Dynamics.b2ContactManager,S=Box2D.Dynamics.b2DebugDraw,x=Box2D.Dynamics.b2DestructionListener,T=Box2D.Dynamics.b2FilterData,N=Box2D.Dynamics.b2Fixture,C=Box2D.Dynamics.b2FixtureDef,k=Box2D.Dynamics.b2Island,L=Box2D.Dynamics.b2TimeStep,A=Box2D.Dynamics.b2World,O=Box2D.Collision.b2AABB,M=Box2D.Collision.b2Bound,_=Box2D.Collision.b2BoundValues,D=Box2D.Collision.b2Collision,P=Box2D.Collision.b2ContactID,H=Box2D.Collision.b2ContactPoint,B=Box2D.Collision.b2Distance,j=Box2D.Collision.b2DistanceInput,F=Box2D.Collision.b2DistanceOutput,I=Box2D.Collision.b2DistanceProxy,q=Box2D.Collision.b2DynamicTree,R=Box2D.Collision.b2DynamicTreeBroadPhase,U=Box2D.Collision.b2DynamicTreeNode,z=Box2D.Collision.b2DynamicTreePair,W=Box2D.Collision.b2Manifold,X=Box2D.Collision.b2ManifoldPoint,V=Box2D.Collision.b2Point,$=Box2D.Collision.b2RayCastInput,J=Box2D.Collision.b2RayCastOutput,K=Box2D.Collision.b2Segment,Q=Box2D.Collision.b2SeparationFunction,G=Box2D.Collision.b2Simplex,Y=Box2D.Collision.b2SimplexCache,Z=Box2D.Collision.b2SimplexVertex,et=Box2D.Collision.b2TimeOfImpact,tt=Box2D.Collision.b2TOIInput,nt=Box2D.Collision.b2WorldManifold,rt=Box2D.Collision.ClipVertex,it=Box2D.Collision.Features,st=Box2D.Collision.IBroadPhase;Box2D.inherit(r,Box2D.Collision.Shapes.b2Shape),r.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,r.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.m_p=new d},r.prototype.Copy=function(){var e=new r;return e.Set(this),e},r.prototype.Set=function(e){this.__super.Set.call(this,e);if(Box2D.is(e,r)){var t=e instanceof r?e:null;this.m_p.SetV(t.m_p)}},r.prototype.TestPoint=function(e,t){var n=e.R,r=e.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y),i=e.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y);return r=t.x-r,i=t.y-i,r*r+i*i<=this.m_radius*this.m_radius},r.prototype.RayCast=function(e,t,n){var r=n.R,i=n.position.x+(r.col1.x*this.m_p.x+r.col2.x*this.m_p.y),s=n.position.y+(r.col1.y*this.m_p.x+r.col2.y*this.m_p.y),o=t.p1.x-i,u=t.p1.y-s,a=o*o+u*u-this.m_radius*this.m_radius,f=t.p2.x-t.p1.x,l=t.p2.y-t.p1.y,c=o*f+u*l,h=f*f+l*l,p=c*c-h*a;if(p<0||h<Number.MIN_VALUE)return!1;var d=-(c+Math.sqrt(p));return 0<=d&&d<=t.maxFraction*h?(d/=h,e.fraction=d,e.normal.x=o+d*f,e.normal.y=u+d*l,e.normal.Normalize(),!0):!1},r.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y),i=t.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y);e.lowerBound.Set(r-this.m_radius,i-this.m_radius),e.upperBound.Set(r+this.m_radius,i+this.m_radius)},r.prototype.ComputeMass=function(e,t){t===undefined&&(t=0),e.mass=t*n.b2_pi*this.m_radius*this.m_radius,e.center.SetV(this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},r.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0);var i=c.MulX(n,this.m_p),s=-(c.Dot(e,i)-t);if(s<-this.m_radius+Number.MIN_VALUE)return 0;if(s>this.m_radius)return r.SetV(i),Math.PI*this.m_radius*this.m_radius;var o=this.m_radius*this.m_radius,u=s*s,a=o*(Math.asin(s/this.m_radius)+Math.PI/2)+s*Math.sqrt(o-u),f=-2/3*Math.pow(o-u,1.5)/a;return r.x=i.x+e.x*f,r.y=i.y+e.y*f,a},r.prototype.GetLocalPosition=function(){return this.m_p},r.prototype.SetLocalPosition=function(e){this.m_p.SetV(e)},r.prototype.GetRadius=function(){return this.m_radius},r.prototype.SetRadius=function(e){e===undefined&&(e=0),this.m_radius=e},r.prototype.b2CircleShape=function(e){e===undefined&&(e=0),this.__super.b2Shape.call(this),this.m_type=a.e_circleShape,this.m_radius=e},i.b2EdgeChainDef=function(){},i.prototype.b2EdgeChainDef=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},Box2D.inherit(s,Box2D.Collision.Shapes.b2Shape),s.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,s.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments),this.s_supportVec=new d,this.m_v1=new d,this.m_v2=new d,this.m_coreV1=new d,this.m_coreV2=new d,this.m_normal=new d,this.m_direction=new d,this.m_cornerDir1=new d,this.m_cornerDir2=new d},s.prototype.TestPoint=function(e,t){return!1},s.prototype.RayCast=function(e,t,n){var r,i=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y;r=n.R;var o=n.position.x+(r.col1.x*this.m_v1.x+r.col2.x*this.m_v1.y),u=n.position.y+(r.col1.y*this.m_v1.x+r.col2.y*this.m_v1.y),a=n.position.y+(r.col1.y*this.m_v2.x+r.col2.y*this.m_v2.y)-u,f=-(n.position.x+(r.col1.x*this.m_v2.x+r.col2.x*this.m_v2.y)-o),l=100*Number.MIN_VALUE,c=-(i*a+s*f);if(c>l){var h=t.p1.x-o,p=t.p1.y-u,d=h*a+p*f;if(0<=d&&d<=t.maxFraction*c){var v=-i*p+s*h;if(-l*c<=v&&v<=c*(1+l)){d/=c,e.fraction=d;var m=Math.sqrt(a*a+f*f);return e.normal.x=a/m,e.normal.y=f/m,!0}}}return!1},s.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y),i=t.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y),s=t.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y),o=t.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y);r<s?(e.lowerBound.x=r,e.upperBound.x=s):(e.lowerBound.x=s,e.upperBound.x=r),i<o?(e.lowerBound.y=i,e.upperBound.y=o):(e.lowerBound.y=o,e.upperBound.y=i)},s.prototype.ComputeMass=function(e,t){t===undefined&&(t=0),e.mass=0,e.center.SetV(this.m_v1),e.I=0},s.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0);var i=new d(e.x*t,e.y*t),s=c.MulX(n,this.m_v1),o=c.MulX(n,this.m_v2),u=c.Dot(e,s)-t,a=c.Dot(e,o)-t;if(u>0){if(a>0)return 0;s.x=-a/(u-a)*s.x+u/(u-a)*o.x,s.y=-a/(u-a)*s.y+u/(u-a)*o.y}else a>0&&(o.x=-a/(u-a)*s.x+u/(u-a)*o.x,o.y=-a/(u-a)*s.y+u/(u-a)*o.y);return r.x=(i.x+s.x+o.x)/3,r.y=(i.y+s.y+o.y)/3,.5*((s.x-i.x)*(o.y-i.y)-(s.y-i.y)*(o.x-i.x))},s.prototype.GetLength=function(){return this.m_length},s.prototype.GetVertex1=function(){return this.m_v1},s.prototype.GetVertex2=function(){return this.m_v2},s.prototype.GetCoreVertex1=function(){return this.m_coreV1},s.prototype.GetCoreVertex2=function(){return this.m_coreV2},s.prototype.GetNormalVector=function(){return this.m_normal},s.prototype.GetDirectionVector=function(){return this.m_direction},s.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},s.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},s.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},s.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},s.prototype.GetFirstVertex=function(e){var t=e.R;return new d(e.position.x+(t.col1.x*this.m_coreV1.x+t.col2.x*this.m_coreV1.y),e.position.y+(t.col1.y*this.m_coreV1.x+t.col2.y*this.m_coreV1.y))},s.prototype.GetNextEdge=function(){return this.m_nextEdge},s.prototype.GetPrevEdge=function(){return this.m_prevEdge},s.prototype.Support=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=e.R,i=e.position.x+(r.col1.x*this.m_coreV1.x+r.col2.x*this.m_coreV1.y),s=e.position.y+(r.col1.y*this.m_coreV1.x+r.col2.y*this.m_coreV1.y),o=e.position.x+(r.col1.x*this.m_coreV2.x+r.col2.x*this.m_coreV2.y),u=e.position.y+(r.col1.y*this.m_coreV2.x+r.col2.y*this.m_coreV2.y);return i*t+s*n>o*t+u*n?(this.s_supportVec.x=i,this.s_supportVec.y=s):(this.s_supportVec.x=o,this.s_supportVec.y=u),this.s_supportVec},s.prototype.b2EdgeShape=function(e,t){this.__super.b2Shape.call(this),this.m_type=a.e_edgeShape,this.m_prevEdge=null,this.m_nextEdge=null,this.m_v1=e,this.m_v2=t,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-n.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-n.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-n.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-n.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},s.prototype.SetPrevEdge=function(e,t,n,r){this.m_prevEdge=e,this.m_coreV1=t,this.m_cornerDir1=n,this.m_cornerConvex1=r},s.prototype.SetNextEdge=function(e,t,n,r){this.m_nextEdge=e,this.m_coreV2=t,this.m_cornerDir2=n,this.m_cornerConvex2=r},o.b2MassData=function(){this.mass=0,this.center=new d(0,0),this.I=0},Box2D.inherit(u,Box2D.Collision.Shapes.b2Shape),u.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype,u.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)},u.prototype.Copy=function(){var e=new u;return e.Set(this),e},u.prototype.Set=function(e){this.__super.Set.call(this,e);if(Box2D.is(e,u)){var t=e instanceof u?e:null;this.m_centroid.SetV(t.m_centroid),this.m_vertexCount=t.m_vertexCount,this.Reserve(this.m_vertexCount);for(var n=0;n<this.m_vertexCount;n++)this.m_vertices[n].SetV(t.m_vertices[n]),this.m_normals[n].SetV(t.m_normals[n])}},u.prototype.SetAsArray=function(e,t){t===undefined&&(t=0);var n=new Vector,r=0,i;for(r=0;r<e.length;++r)i=e[r],n.push(i);this.SetAsVector(n,t)},u.AsArray=function(e,t){t===undefined&&(t=0);var n=new u;return n.SetAsArray(e,t),n},u.prototype.SetAsVector=function(e,t){t===undefined&&(t=0),t==0&&(t=e.length),n.b2Assert(2<=t),this.m_vertexCount=t,this.Reserve(t);var r=0;for(r=0;r<this.m_vertexCount;r++)this.m_vertices[r].SetV(e[r]);for(r=0;r<this.m_vertexCount;++r){var i=parseInt(r),s=parseInt(r+1<this.m_vertexCount?r+1:0),o=c.SubtractVV(this.m_vertices[s],this.m_vertices[i]);n.b2Assert(o.LengthSquared()>Number.MIN_VALUE),this.m_normals[r].SetV(c.CrossVF(o,1)),this.m_normals[r].Normalize()}this.m_centroid=u.ComputeCentroid(this.m_vertices,this.m_vertexCount)},u.AsVector=function(e,t){t===undefined&&(t=0);var n=new u;return n.SetAsVector(e,t),n},u.prototype.SetAsBox=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},u.AsBox=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0);var n=new u;return n.SetAsBox(e,t),n},u.prototype.SetAsOrientedBox=function(e,t,n,r){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=null),r===undefined&&(r=0),this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=n;var i=new p;i.position=n,i.R.Set(r);for(var s=0;s<this.m_vertexCount;++s)this.m_vertices[s]=c.MulX(i,this.m_vertices[s]),this.m_normals[s]=c.MulMV(i.R,this.m_normals[s])},u.AsOrientedBox=function(e,t,n,r){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=null),r===undefined&&(r=0);var i=new u;return i.SetAsOrientedBox(e,t,n,r),i},u.prototype.SetAsEdge=function(e,t){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(e),this.m_vertices[1].SetV(t),this.m_centroid.x=.5*(e.x+t.x),this.m_centroid.y=.5*(e.y+t.y),this.m_normals[0]=c.CrossVF(c.SubtractVV(t,e),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},u.AsEdge=function(e,t){var n=new u;return n.SetAsEdge(e,t),n},u.prototype.TestPoint=function(e,t){var n,r=e.R,i=t.x-e.position.x,s=t.y-e.position.y,o=i*r.col1.x+s*r.col1.y,u=i*r.col2.x+s*r.col2.y;for(var a=0;a<this.m_vertexCount;++a){n=this.m_vertices[a],i=o-n.x,s=u-n.y,n=this.m_normals[a];var f=n.x*i+n.y*s;if(f>0)return!1}return!0},u.prototype.RayCast=function(e,t,n){var r=0,i=t.maxFraction,s=0,o=0,u,a;s=t.p1.x-n.position.x,o=t.p1.y-n.position.y,u=n.R;var f=s*u.col1.x+o*u.col1.y,l=s*u.col2.x+o*u.col2.y;s=t.p2.x-n.position.x,o=t.p2.y-n.position.y,u=n.R;var c=s*u.col1.x+o*u.col1.y,h=s*u.col2.x+o*u.col2.y,p=c-f,d=h-l,v=parseInt(-1);for(var m=0;m<this.m_vertexCount;++m){a=this.m_vertices[m],s=a.x-f,o=a.y-l,a=this.m_normals[m];var g=a.x*s+a.y*o,y=a.x*p+a.y*d;if(y==0){if(g<0)return!1}else y<0&&g<r*y?(r=g/y,v=m):y>0&&g<i*y&&(i=g/y);if(i<r-Number.MIN_VALUE)return!1}return v>=0?(e.fraction=r,u=n.R,a=this.m_normals[v],e.normal.x=u.col1.x*a.x+u.col2.x*a.y,e.normal.y=u.col1.y*a.x+u.col2.y*a.y,!0):!1},u.prototype.ComputeAABB=function(e,t){var n=t.R,r=this.m_vertices[0],i=t.position.x+(n.col1.x*r.x+n.col2.x*r.y),s=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),o=i,u=s;for(var a=1;a<this.m_vertexCount;++a){r=this.m_vertices[a];var f=t.position.x+(n.col1.x*r.x+n.col2.x*r.y),l=t.position.y+(n.col1.y*r.x+n.col2.y*r.y);i=i<f?i:f,s=s<l?s:l,o=o>f?o:f,u=u>l?u:l}e.lowerBound.x=i-this.m_radius,e.lowerBound.y=s-this.m_radius,e.upperBound.x=o+this.m_radius,e.upperBound.y=u+this.m_radius},u.prototype.ComputeMass=function(e,t){t===undefined&&(t=0);if(this.m_vertexCount==2){e.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),e.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),e.mass=0,e.I=0;return}var n=0,r=0,i=0,s=0,o=0,u=0,a=1/3;for(var f=0;f<this.m_vertexCount;++f){var l=this.m_vertices[f],c=f+1<this.m_vertexCount?this.m_vertices[parseInt(f+1)]:this.m_vertices[0],h=l.x-o,p=l.y-u,d=c.x-o,v=c.y-u,m=h*v-p*d,g=.5*m;i+=g,n+=g*a*(o+l.x+c.x),r+=g*a*(u+l.y+c.y);var y=o,b=u,w=h,E=p,S=d,x=v,T=a*(.25*(w*w+S*w+S*S)+(y*w+y*S))+.5*y*y,N=a*(.25*(E*E+x*E+x*x)+(b*E+b*x))+.5*b*b;s+=m*(T+N)}e.mass=t*i,n*=1/i,r*=1/i,e.center.Set(n,r),e.I=t*s},u.prototype.ComputeSubmergedArea=function(e,t,n,r){t===undefined&&(t=0);var i=c.MulTMV(n.R,e),s=t-c.Dot(e,n.position),u=new Vector_a2j_Number,a=0,f=parseInt(-1),l=parseInt(-1),h=!1,p=0;for(p=0;p<this.m_vertexCount;++p){u[p]=c.Dot(i,this.m_vertices[p])-s;var v=u[p]<-Number.MIN_VALUE;p>0&&(v?h||(f=p-1,a++):h&&(l=p-1,a++)),h=v}switch(a){case 0:if(h){var m=new o;return this.ComputeMass(m,1),r.SetV(c.MulX(n,m.center)),m.mass}return 0;case 1:f==-1?f=this.m_vertexCount-1:l=this.m_vertexCount-1}var g=parseInt((f+1)%this.m_vertexCount),y=parseInt((l+1)%this.m_vertexCount),b=(0-u[f])/(u[g]-u[f]),w=(0-u[l])/(u[y]-u[l]),E=new d(this.m_vertices[f].x*(1-b)+this.m_vertices[g].x*b,this.m_vertices[f].y*(1-b)+this.m_vertices[g].y*b),S=new d(this.m_vertices[l].x*(1-w)+this.m_vertices[y].x*w,this.m_vertices[l].y*(1-w)+this.m_vertices[y].y*w),x=0,T=new d,N=this.m_vertices[g],C;p=g;while(p!=y){p=(p+1)%this.m_vertexCount,p==y?C=S:C=this.m_vertices[p];var k=.5*((N.x-E.x)*(C.y-E.y)-(N.y-E.y)*(C.x-E.x));x+=k,T.x+=k*(E.x+N.x+C.x)/3,T.y+=k*(E.y+N.y+C.y)/3,N=C}return T.Multiply(1/x),r.SetV(c.MulX(n,T)),x},u.prototype.GetVertexCount=function(){return this.m_vertexCount},u.prototype.GetVertices=function(){return this.m_vertices},u.prototype.GetNormals=function(){return this.m_normals},u.prototype.GetSupport=function(e){var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},u.prototype.GetSupportVertex=function(e){var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y;for(var r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},u.prototype.Validate=function(){return!1},u.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this),this.m_type=a.e_polygonShape,this.m_centroid=new d,this.m_vertices=new Vector,this.m_normals=new Vector},u.prototype.Reserve=function(e){e===undefined&&(e=0);for(var t=parseInt(this.m_vertices.length);t<e;t++)this.m_vertices[t]=new d,this.m_normals[t]=new d},u.ComputeCentroid=function(e,t){t===undefined&&(t=0);var n=new d,r=0,i=0,s=0,o=1/3;for(var u=0;u<t;++u){var a=e[u],f=u+1<t?e[parseInt(u+1)]:e[0],l=a.x-i,c=a.y-s,h=f.x-i,p=f.y-s,v=l*p-c*h,m=.5*v;r+=m,n.x+=m*o*(i+a.x+f.x),n.y+=m*o*(s+a.y+f.y)}return n.x*=1/r,n.y*=1/r,n},u.ComputeOBB=function(e,t,n){n===undefined&&(n=0);var r=0,i=new Vector(n+1);for(r=0;r<n;++r)i[r]=t[r];i[n]=i[0];var s=Number.MAX_VALUE;for(r=1;r<=n;++r){var o=i[parseInt(r-1)],u=i[r].x-o.x,a=i[r].y-o.y,f=Math.sqrt(u*u+a*a);u/=f,a/=f;var l=-a,c=u,h=Number.MAX_VALUE,p=Number.MAX_VALUE,d=-Number.MAX_VALUE,v=-Number.MAX_VALUE;for(var m=0;m<n;++m){var g=i[m].x-o.x,y=i[m].y-o.y,b=u*g+a*y,w=l*g+c*y;b<h&&(h=b),w<p&&(p=w),b>d&&(d=b),w>v&&(v=w)}var E=(d-h)*(v-p);if(E<.95*s){s=E,e.R.col1.x=u,e.R.col1.y=a,e.R.col2.x=l,e.R.col2.y=c;var S=.5*(h+d),x=.5*(p+v),T=e.R;e.center.x=o.x+(T.col1.x*S+T.col2.x*x),e.center.y=o.y+(T.col1.y*S+T.col2.y*x),e.extents.x=.5*(d-h),e.extents.y=.5*(v-p)}}},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new f}),a.b2Shape=function(){},a.prototype.Copy=function(){return null},a.prototype.Set=function(e){this.m_radius=e.m_radius},a.prototype.GetType=function(){return this.m_type},a.prototype.TestPoint=function(e,t){return!1},a.prototype.RayCast=function(e,t,n){return!1},a.prototype.ComputeAABB=function(e,t){},a.prototype.ComputeMass=function(e,t){t===undefined&&(t=0)},a.prototype.ComputeSubmergedArea=function(e,t,n,r){return t===undefined&&(t=0),0},a.TestOverlap=function(e,t,n,r){var i=new j;i.proxyA=new I,i.proxyA.Set(e),i.proxyB=new I,i.proxyB.Set(n),i.transformA=t,i.transformB=r,i.useRadii=!0;var s=new Y;s.count=0;var o=new F;return B.Distance(o,s,i),o.distance<10*Number.MIN_VALUE},a.prototype.b2Shape=function(){this.m_type=a.e_unknownShape,this.m_radius=n.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=parseInt(-1),Box2D.Collision.Shapes.b2Shape.e_circleShape=0,Box2D.Collision.Shapes.b2Shape.e_polygonShape=1,Box2D.Collision.Shapes.b2Shape.e_edgeShape=2,Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3,Box2D.Collision.Shapes.b2Shape.e_hitCollide=1,Box2D.Collision.Shapes.b2Shape.e_missCollide=0,Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=parseInt(-1)})}(),function(){var e=Box2D.Common.b2Color,t=Box2D.Common.b2internal,n=Box2D.Common.b2Settings,r=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,s=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,u=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,f=Box2D.Common.Math.b2Vec3;e.b2Color=function(){this._r=0,this._g=0,this._b=0},e.prototype.b2Color=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this._r=Box2D.parseUInt(255*s.Clamp(e,0,1)),this._g=Box2D.parseUInt(255*s.Clamp(t,0,1)),this._b=Box2D.parseUInt(255*s.Clamp(n,0,1))},e.prototype.Set=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this._r=Box2D.parseUInt(255*s.Clamp(e,0,1)),this._g=Box2D.parseUInt(255*s.Clamp(t,0,1)),this._b=Box2D.parseUInt(255*s.Clamp(n,0,1))},Object.defineProperty(e.prototype,"r",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._r=Box2D.parseUInt(255*s.Clamp(e,0,1))}}),Object.defineProperty(e.prototype,"g",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._g=Box2D.parseUInt(255*s.Clamp(e,0,1))}}),Object.defineProperty(e.prototype,"b",{enumerable:!1,configurable:!0,set:function(e){e===undefined&&(e=0),this._b=Box2D.parseUInt(255*s.Clamp(e,0,1))}}),Object.defineProperty(e.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}}),n.b2Settings=function(){},n.b2MixFriction=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),Math.sqrt(e*t)},n.b2MixRestitution=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e>t?e:t},n.b2Assert=function(e){if(!e)throw"Assertion Failed"},Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha",Box2D.Common.b2Settings.USHRT_MAX=65535,Box2D.Common.b2Settings.b2_pi=Math.PI,Box2D.Common.b2Settings.b2_maxManifoldPoints=2,Box2D.Common.b2Settings.b2_aabbExtension=.1,Box2D.Common.b2Settings.b2_aabbMultiplier=2,Box2D.Common.b2Settings.b2_polygonRadius=2*n.b2_linearSlop,Box2D.Common.b2Settings.b2_linearSlop=.005,Box2D.Common.b2Settings.b2_angularSlop=2/180*n.b2_pi,Box2D.Common.b2Settings.b2_toiSlop=8*n.b2_linearSlop,Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32,Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32,Box2D.Common.b2Settings.b2_velocityThreshold=1,Box2D.Common.b2Settings.b2_maxLinearCorrection=.2,Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*n.b2_pi,Box2D.Common.b2Settings.b2_maxTranslation=2,Box2D.Common.b2Settings.b2_maxTranslationSquared=n.b2_maxTranslation*n.b2_maxTranslation,Box2D.Common.b2Settings.b2_maxRotation=.5*n.b2_pi,Box2D.Common.b2Settings.b2_maxRotationSquared=n.b2_maxRotation*n.b2_maxRotation,Box2D.Common.b2Settings.b2_contactBaumgarte=.2,Box2D.Common.b2Settings.b2_timeToSleep=.5,Box2D.Common.b2Settings.b2_linearSleepTolerance=.01,Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*n.b2_pi})}(),function(){var e=Box2D.Collision.b2AABB,t=Box2D.Common.b2Color,n=Box2D.Common.b2internal,r=Box2D.Common.b2Settings,i=Box2D.Common.Math.b2Mat22,s=Box2D.Common.Math.b2Mat33,o=Box2D.Common.Math.b2Math,u=Box2D.Common.Math.b2Sweep,a=Box2D.Common.Math.b2Transform,f=Box2D.Common.Math.b2Vec2,l=Box2D.Common.Math.b2Vec3;i.b2Mat22=function(){this.col1=new f,this.col2=new f},i.prototype.b2Mat22=function(){this.SetIdentity()},i.FromAngle=function(e){e===undefined&&(e=0);var t=new i;return t.Set(e),t},i.FromVV=function(e,t){var n=new i;return n.SetVV(e,t),n},i.prototype.Set=function(e){e===undefined&&(e=0);var t=Math.cos(e),n=Math.sin(e);this.col1.x=t,this.col2.x=-n,this.col1.y=n,this.col2.y=t},i.prototype.SetVV=function(e,t){this.col1.SetV(e),this.col2.SetV(t)},i.prototype.Copy=function(){var e=new i;return e.SetM(this),e},i.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2)},i.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y},i.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},i.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},i.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},i.prototype.GetInverse=function(e){var t=this.col1.x,n=this.col2.x,r=this.col1.y,i=this.col2.y,s=t*i-n*r;return s!=0&&(s=1/s),e.col1.x=s*i,e.col2.x=-s*n,e.col1.y=-s*r,e.col2.y=s*t,e},i.prototype.Solve=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},i.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},s.b2Mat33=function(){this.col1=new l,this.col2=new l,this.col3=new l},s.prototype.b2Mat33=function(e,t,n){e===undefined&&(e=null),t===undefined&&(t=null),n===undefined&&(n=null),!e&&!t&&!n?(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero()):(this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n))},s.prototype.SetVVV=function(e,t,n){this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n)},s.prototype.Copy=function(){return new s(this.col1,this.col2,this.col3)},s.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2),this.col3.SetV(e.col3)},s.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col1.z+=e.col1.z,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y,this.col2.z+=e.col2.z,this.col3.x+=e.col3.x,this.col3.y+=e.col3.y,this.col3.z+=e.col3.z},s.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},s.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},s.prototype.Solve22=function(e,t,n){t===undefined&&(t=0),n===undefined&&(n=0);var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},s.prototype.Solve33=function(e,t,n,r){t===undefined&&(t=0),n===undefined&&(n=0),r===undefined&&(r=0);var i=this.col1.x,s=this.col1.y,o=this.col1.z,u=this.col2.x,a=this.col2.y,f=this.col2.z,l=this.col3.x,c=this.col3.y,h=this.col3.z,p=i*(a*h-f*c)+s*(f*l-u*h)+o*(u*c-a*l);return p!=0&&(p=1/p),e.x=p*(t*(a*h-f*c)+n*(f*l-u*h)+r*(u*c-a*l)),e.y=p*(i*(n*h-r*c)+s*(r*l-t*h)+o*(t*c-n*l)),e.z=p*(i*(a*r-f*n)+s*(f*t-u*r)+o*(u*n-a*t)),e},o.b2Math=function(){},o.IsValid=function(e){return e===undefined&&(e=0),isFinite(e)},o.Dot=function(e,t){return e.x*t.x+e.y*t.y},o.CrossVV=function(e,t){return e.x*t.y-e.y*t.x},o.CrossVF=function(e,t){t===undefined&&(t=0);var n=new f(t*e.y,-t*e.x);return n},o.CrossFV=function(e,t){e===undefined&&(e=0);var n=new f(-e*t.y,e*t.x);return n},o.MulMV=function(e,t){var n=new f(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y);return n},o.MulTMV=function(e,t){var n=new f(o.Dot(t,e.col1),o.Dot(t,e.col2));return n},o.MulX=function(e,t){var n=o.MulMV(e.R,t);return n.x+=e.position.x,n.y+=e.position.y,n},o.MulXT=function(e,t){var n=o.SubtractVV(t,e.position),r=n.x*e.R.col1.x+n.y*e.R.col1.y;return n.y=n.x*e.R.col2.x+n.y*e.R.col2.y,n.x=r,n},o.AddVV=function(e,t){var n=new f(e.x+t.x,e.y+t.y);return n},o.SubtractVV=function(e,t){var n=new f(e.x-t.x,e.y-t.y);return n},o.Distance=function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},o.DistanceSquared=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r},o.MulFV=function(e,t){e===undefined&&(e=0);var n=new f(e*t.x,e*t.y);return n},o.AddMM=function(e,t){var n=i.FromVV(o.AddVV(e.col1,t.col1),o.AddVV(e.col2,t.col2));return n},o.MulMM=function(e,t){var n=i.FromVV(o.MulMV(e,t.col1),o.MulMV(e,t.col2));return n},o.MulTMM=function(e,t){var n=new f(o.Dot(e.col1,t.col1),o.Dot(e.col2,t.col1)),r=new f(o.Dot(e.col1,t.col2),o.Dot(e.col2,t.col2)),s=i.FromVV(n,r);return s},o.Abs=function(e){return e===undefined&&(e=0),e>0?e:-e},o.AbsV=function(e){var t=new f(o.Abs(e.x),o.Abs(e.y));return t},o.AbsM=function(e){var t=i.FromVV(o.AbsV(e.col1),o.AbsV(e.col2));return t},o.Min=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e<t?e:t},o.MinV=function(e,t){var n=new f(o.Min(e.x,t.x),o.Min(e.y,t.y));return n},o.Max=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),e>t?e:t},o.MaxV=function(e,t){var n=new f(o.Max(e.x,t.x),o.Max(e.y,t.y));return n},o.Clamp=function(e,t,n){return e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),e<t?t:e>n?n:e},o.ClampV=function(e,t,n){return o.MaxV(t,o.MinV(e,n))},o.Swap=function(e,t){var n=e[0];e[0]=t[0],t[0]=n},o.Random=function(){return Math.random()*2-1},o.RandomRange=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0);var n=Math.random();return n=(t-e)*n+e,n},o.NextPowerOfTwo=function(e){return e===undefined&&(e=0),e|=e>>1&2147483647,e|=e>>2&1073741823,e|=e>>4&268435455,e|=e>>8&16777215,e|=e>>16&65535,e+1},o.IsPowerOfTwo=function(e){e===undefined&&(e=0);var t=e>0&&(e&e-1)==0;return t},Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new f(0,0),Box2D.Common.Math.b2Math.b2Mat22_identity=i.FromVV(new f(1,0),new f(0,1)),Box2D.Common.Math.b2Math.b2Transform_identity=new a(o.b2Vec2_zero,o.b2Mat22_identity)}),u.b2Sweep=function(){this.localCenter=new f,this.c0=new f,this.c=new f},u.prototype.Set=function(e){this.localCenter.SetV(e.localCenter),this.c0.SetV(e.c0),this.c.SetV(e.c),this.a0=e.a0,this.a=e.a,this.t0=e.t0},u.prototype.Copy=function(){var e=new u;return e.localCenter.SetV(this.localCenter),e.c0.SetV(this.c0),e.c.SetV(this.c),e.a0=this.a0,e.a=this.a,e.t0=this.t0,e},u.prototype.GetTransform=function(e,t){t===undefined&&(t=0),e.position.x=(1-t)*this.c0.x+t*this.c.x,e.position.y=(1-t)*this.c0.y+t*this.c.y;var n=(1-t)*this.a0+t*this.a;e.R.Set(n);var r=e.R;e.position.x-=r.col1.x*this.localCenter.x+r.col2.x*this.localCenter.y,e.position.y-=r.col1.y*this.localCenter.x+r.col2.y*this.localCenter.y},u.prototype.Advance=function(e){e===undefined&&(e=0);if(this.t0<e&&1-this.t0>Number.MIN_VALUE){var t=(e-this.t0)/(1-this.t0);this.c0.x=(1-t)*this.c0.x+t*this.c.x,this.c0.y=(1-t)*this.c0.y+t*this.c.y,this.a0=(1-t)*this.a0+t*this.a,this.t0=e}},a.b2Transform=function(){this.position=new f,this.R=new i},a.prototype.b2Transform=function(e,t){e===undefined&&(e=null),t===undefined&&(t=null),e&&(this.position.SetV(e),this.R.SetM(t))},a.prototype.Initialize=function(e,t){this.position.SetV(e),this.R.SetM(t)},a.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},a.prototype.Set=function(e){this.position.SetV(e.position),this.R.SetM(e.R)},a.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},f.b2Vec2=function(){},f.prototype.b2Vec2=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.x=e,this.y=t},f.prototype.SetZero=function(){this.x=0,this.y=0},f.prototype.Set=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.x=e,this.y=t},f.prototype.SetV=function(e){this.x=e.x,this.y=e.y},f.prototype.GetNegative=function(){return new f(-this.x,-this.y)},f.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},f.Make=function(e,t){return e===undefined&&(e=0),t===undefined&&(t=0),new f(e,t)},f.prototype.Copy=function(){return new f(this.x,this.y)},f.prototype.Add=function(e){this.x+=e.x,this.y+=e.y},f.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y},f.prototype.Multiply=function(e){e===undefined&&(e=0),this.x*=e,this.y*=e},f.prototype.MulM=function(e){var t=this.x;this.x=e.col1.x*t+e.col2.x*this.y,this.y=e.col1.y*t+e.col2.y*this.y},f.prototype.MulTM=function(e){var t=o.Dot(this,e.col1);this.y=o.Dot(this,e.col2),this.x=t},f.prototype.CrossVF=function(e){e===undefined&&(e=0);var t=this.x;this.x=e*this.y,this.y=-e*t},f.prototype.CrossFV=function(e){e===undefined&&(e=0);var t=this.x;this.x=-e*this.y,this.y=e*t},f.prototype.MinV=function(e){this.x=this.x<e.x?this.x:e.x,this.y=this.y<e.y?this.y:e.y},f.prototype.MaxV=function(e){this.x=this.x>e.x?this.x:e.x,this.y=this.y>e.y?this.y:e.y},f.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},f.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},f.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},f.prototype.Normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);if(e<Number.MIN_VALUE)return 0;var t=1/e;return this.x*=t,this.y*=t,e},f.prototype.IsValid=function(){return o.IsValid(this.x)&&o.IsValid(this.y)},l.b2Vec3=function(){},l.prototype.b2Vec3=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.x=e,this.y=t,this.z=n},l.prototype.SetZero=function(){this.x=this.y=this.z=0},l.prototype.Set=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.x=e,this.y=t,this.z=n},l.prototype.SetV=function(e){this.x=e.x,this.y=e.y,this.z=e.z},l.prototype.GetNegative=function(){return new l(-this.x,-this.y,-this.z)},l.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},l.prototype.Copy=function(){return new l(this.x,this.y,this.z)},l.prototype.Add=function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},l.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},l.prototype.Multiply=function(e){e===undefined&&(e=0),this.x*=e,this.y*=e,this.z*=e}}(),function(){var e=Box2D.Dynamics.Controllers.b2ControllerEdge,t=Box2D.Common.Math.b2Mat22,n=Box2D.Common.Math.b2Mat33,r=Box2D.Common.Math.b2Math,i=Box2D.Common.Math.b2Sweep,s=Box2D.Common.Math.b2Transform,o=Box2D.Common.Math.b2Vec2,u=Box2D.Common.Math.b2Vec3,a=Box2D.Common.b2Color,f=Box2D.Common.b2internal,l=Box2D.Common.b2Settings,c=Box2D.Collision.b2AABB,h=Box2D.Collision.b2Bound,p=Box2D.Collision.b2BoundValues,d=Box2D.Collision.b2Collision,v=Box2D.Collision.b2ContactID,m=Box2D.Collision.b2ContactPoint,g=Box2D.Collision.b2Distance,y=Box2D.Collision.b2DistanceInput,b=Box2D.Collision.b2DistanceOutput,w=Box2D.Collision.b2DistanceProxy,E=Box2D.Collision.b2DynamicTree,S=Box2D.Collision.b2DynamicTreeBroadPhase,x=Box2D.Collision.b2DynamicTreeNode,T=Box2D.Collision.b2DynamicTreePair,N=Box2D.Collision.b2Manifold,C=Box2D.Collision.b2ManifoldPoint,k=Box2D.Collision.b2Point,L=Box2D.Collision.b2RayCastInput,A=Box2D.Collision.b2RayCastOutput,O=Box2D.Collision.b2Segment,M=Box2D.Collision.b2SeparationFunction,_=Box2D.Collision.b2Simplex,D=Box2D.Collision.b2SimplexCache,P=Box2D.Collision.b2SimplexVertex,H=Box2D.Collision.b2TimeOfImpact,B=Box2D.Collision.b2TOIInput,j=Box2D.Collision.b2WorldManifold,F=Box2D.Collision.ClipVertex,I=Box2D.Collision.Features,q=Box2D.Collision.IBroadPhase,R=Box2D.Collision.Shapes.b2CircleShape,U=Box2D.Collision.Shapes.b2EdgeChainDef,z=Box2D.Collision.Shapes.b2EdgeShape,W=Box2D.Collision.Shapes.b2MassData,X=Box2D.Collision.Shapes.b2PolygonShape,V=Box2D.Collision.Shapes.b2Shape,$=Box2D.Dynamics.b2Body,J=Box2D.Dynamics.b2BodyDef,K=Box2D.Dynamics.b2ContactFilter,Q=Box2D.Dynamics.b2ContactImpulse,G=Box2D.Dynamics.b2ContactListener,Y=Box2D.Dynamics.b2ContactManager,Z=Box2D.Dynamics.b2DebugDraw,et=Box2D.Dynamics.b2DestructionListener,tt=Box2D.Dynamics.b2FilterData,nt=Box2D.Dynamics.b2Fixture,rt=Box2D.Dynamics.b2FixtureDef,it=Box2D.Dynamics.b2Island,st=Box2D.Dynamics.b2TimeStep,ot=Box2D.Dynamics.b2World,ut=Box2D.Dynamics.Contacts.b2CircleContact,at=Box2D.Dynamics.Contacts.b2Contact,ft=Box2D.Dynamics.Contacts.b2ContactConstraint,lt=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,ct=Box2D.Dynamics.Contacts.b2ContactEdge,ht=Box2D.Dynamics.Contacts.b2ContactFactory,pt=Box2D.Dynamics.Contacts.b2ContactRegister,dt=Box2D.Dynamics.Contacts.b2ContactResult,vt=Box2D.Dynamics.Contacts.b2ContactSolver,mt=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,gt=Box2D.Dynamics.Contacts.b2NullContact,yt=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,bt=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,wt=Box2D.Dynamics.Contacts.b2PolygonContact,Et=Box2D.Dynamics.Contacts.b2PositionSolverManifold,St=Box2D.Dynamics.Controllers.b2Controller,xt=Box2D.Dynamics.Joints.b2DistanceJoint,Tt=Box2D.Dynamics.Joints.b2DistanceJointDef,Nt=Box2D.Dynamics.Joints.b2FrictionJoint,Ct=Box2D.Dynamics.Joints.b2FrictionJointDef,kt=Box2D.Dynamics.Joints.b2GearJoint,Lt=Box2D.Dynamics.Joints.b2GearJointDef,At=Box2D.Dynamics.Joints.b2Jacobian,Ot=Box2D.Dynamics.Joints.b2Joint,Mt=Box2D.Dynamics.Joints.b2JointDef,_t=Box2D.Dynamics.Joints.b2JointEdge,Dt=Box2D.Dynamics.Joints.b2LineJoint,Pt=Box2D.Dynamics.Joints.b2LineJointDef,Ht=Box2D.Dynamics.Joints.b2MouseJoint,Bt=Box2D.Dynamics.Joints.b2MouseJointDef,jt=Box2D.Dynamics.Joints.b2PrismaticJoint,Ft=Box2D.Dynamics.Joints.b2PrismaticJointDef,It=Box2D.Dynamics.Joints.b2PulleyJoint,qt=Box2D.Dynamics.Joints.b2PulleyJointDef,Rt=Box2D.Dynamics.Joints.b2RevoluteJoint,Ut=Box2D.Dynamics.Joints.b2RevoluteJointDef,zt=Box2D.Dynamics.Joints.b2WeldJoint,Wt=Box2D.Dynamics.Joints.b2WeldJointDef;$.b2Body=function(){this.m_xf=new s,this.m_sweep=new i,this.m_linearVelocity=new o,this.m_force=new o},$.prototype.connectEdges=function(e,t,n){n===undefined&&(n=0);var i=Math.atan2(t.GetDirectionVector().y,t.GetDirectionVector().x),s=Math.tan((i-n)*.5),o=r.MulFV(s,t.GetDirectionVector());o=r.SubtractVV(o,t.GetNormalVector()),o=r.MulFV(l.b2_toiSlop,o),o=r.AddVV(o,t.GetVertex1());var u=r.AddVV(e.GetDirectionVector(),t.GetDirectionVector());u.Normalize();var a=r.Dot(e.GetDirectionVector(),t.GetNormalVector())>0;return e.SetNextEdge(t,o,u,a),t.SetPrevEdge(e,o,u,a),i},$.prototype.CreateFixture=function(e){if(this.m_world.IsLocked()==1)return null;var t=new nt;t.Create(this,this.m_xf,e);if(this.m_flags&$.e_activeFlag){var n=this.m_world.m_contactManager.m_broadPhase;t.CreateProxy(n,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,++this.m_fixtureCount,t.m_body=this,t.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=ot.e_newFixture,t},$.prototype.CreateFixture2=function(e,t){t===undefined&&(t=0);var n=new rt;return n.shape=e,n.density=t,this.CreateFixture(n)},$.prototype.DestroyFixture=function(e){if(this.m_world.IsLocked()==1)return;var t=this.m_fixtureList,n=null,r=!1;while(t!=null){if(t==e){n?n.m_next=e.m_next:this.m_fixtureList=e.m_next,r=!0;break}n=t,t=t.m_next}var i=this.m_contactList;while(i){var s=i.contact;i=i.next;var o=s.GetFixtureA(),u=s.GetFixtureB();(e==o||e==u)&&this.m_world.m_contactManager.Destroy(s)}if(this.m_flags&$.e_activeFlag){var a=this.m_world.m_contactManager.m_broadPhase;e.DestroyProxy(a)}e.Destroy(),e.m_body=null,e.m_next=null,--this.m_fixtureCount,this.ResetMassData()},$.prototype.SetPositionAndAngle=function(e,t){t===undefined&&(t=0);var n;if(this.m_world.IsLocked()==1)return;this.m_xf.R.Set(t),this.m_xf.position.SetV(e);var r=this.m_xf.R,i=this.m_sweep.localCenter;this.m_sweep.c.x=r.col1.x*i.x+r.col2.x*i.y,this.m_sweep.c.y=r.col1.y*i.x+r.col2.y*i.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=t;var s=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(s,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()},$.prototype.SetTransform=function(e){this.SetPositionAndAngle(e.position,e.GetAngle())},$.prototype.GetTransform=function(){return this.m_xf},$.prototype.GetPosition=function(){return this.m_xf.position},$.prototype.SetPosition=function(e){this.SetPositionAndAngle(e,this.GetAngle())},$.prototype.GetAngle=function(){return this.m_sweep.a},$.prototype.SetAngle=function(e){e===undefined&&(e=0),this.SetPositionAndAngle(this.GetPosition(),e)},$.prototype.GetWorldCenter=function(){return this.m_sweep.c},$.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},$.prototype.SetLinearVelocity=function(e){if(this.m_type==$.b2_staticBody)return;this.m_linearVelocity.SetV(e)},$.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},$.prototype.SetAngularVelocity=function(e){e===undefined&&(e=0);if(this.m_type==$.b2_staticBody)return;this.m_angularVelocity=e},$.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},$.prototype.GetDefinition=function(){var e=new J;return e.type=this.GetType(),e.allowSleep=(this.m_flags&$.e_allowSleepFlag)==$.e_allowSleepFlag,e.angle=this.GetAngle(),e.angularDamping=this.m_angularDamping,e.angularVelocity=this.m_angularVelocity,e.fixedRotation=(this.m_flags&$.e_fixedRotationFlag)==$.e_fixedRotationFlag,e.bullet=(this.m_flags&$.e_bulletFlag)==$.e_bulletFlag,e.awake=(this.m_flags&$.e_awakeFlag)==$.e_awakeFlag,e.linearDamping=this.m_linearDamping,e.linearVelocity.SetV(this.GetLinearVelocity()),e.position=this.GetPosition(),e.userData=this.GetUserData(),e},$.prototype.ApplyForce=function(e,t){if(this.m_type!=$.b2_dynamicBody)return;this.IsAwake()==0&&this.SetAwake(!0),this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x},$.prototype.ApplyTorque=function(e){e===undefined&&(e=0);if(this.m_type!=$.b2_dynamicBody)return;this.IsAwake()==0&&this.SetAwake(!0),this.m_torque+=e},$.prototype.ApplyImpulse=function(e,t){if(this.m_type!=$.b2_dynamicBody)return;this.IsAwake()==0&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x)},$.prototype.Split=function(e){var t=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),i=this.GetWorldCenter(),s=this,o=this.m_world.CreateBody(this.GetDefinition()),u;for(var a=s.m_fixtureList;a;)if(e(a)){var f=a.m_next;u?u.m_next=f:s.m_fixtureList=f,s.m_fixtureCount--,a.m_next=o.m_fixtureList,o.m_fixtureList=a,o.m_fixtureCount++,a.m_body=o,a=f}else u=a,a=a.m_next;s.ResetMassData(),o.ResetMassData();var l=s.GetWorldCenter(),c=o.GetWorldCenter(),h=r.AddVV(t,r.CrossFV(n,r.SubtractVV(l,i))),p=r.AddVV(t,r.CrossFV(n,r.SubtractVV(c,i)));return s.SetLinearVelocity(h),o.SetLinearVelocity(p),s.SetAngularVelocity(n),o.SetAngularVelocity(n),s.SynchronizeFixtures(),o.SynchronizeFixtures(),o},$.prototype.Merge=function(e){var t;for(t=e.m_fixtureList;t;){var n=t.m_next;e.m_fixtureCount--,t.m_next=this.m_fixtureList,this.m_fixtureList=t,this.m_fixtureCount++,t.m_body=i,t=n}r.m_fixtureCount=0;var r=this,i=e,s=r.GetWorldCenter(),o=i.GetWorldCenter(),u=r.GetLinearVelocity().Copy(),a=i.GetLinearVelocity().Copy(),f=r.GetAngularVelocity(),l=i.GetAngularVelocity();r.ResetMassData(),this.SynchronizeFixtures()},$.prototype.GetMass=function(){return this.m_mass},$.prototype.GetInertia=function(){return this.m_I},$.prototype.GetMassData=function(e){e.mass=this.m_mass,e.I=this.m_I,e.center.SetV(this.m_sweep.localCenter)},$.prototype.SetMassData=function(e){l.b2Assert(this.m_world.IsLocked()==0);if(this.m_world.IsLocked()==1)return;if(this.m_type!=$.b2_dynamicBody)return;this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&(this.m_flags&$.e_fixedRotationFlag)==0&&(this.m_I=e.I-this.m_mass*(e.center.x*e.center.x+e.center.y*e.center.y),this.m_invI=1/this.m_I);var t=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e.center),this.m_sweep.c0.SetV(r.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-t.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-t.x)},$.prototype.ResetMassData=function(){this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero();if(this.m_type==$.b2_staticBody||this.m_type==$.b2_kinematicBody)return;var e=o.Make(0,0);for(var t=this.m_fixtureList;t;t=t.m_next){if(t.m_density==0)continue;var n=t.GetMassData();this.m_mass+=n.mass,e.x+=n.center.x*n.mass,e.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&(this.m_flags&$.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(e.x*e.x+e.y*e.y),this.m_I*=this.m_inertiaScale,l.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var i=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e),this.m_sweep.c0.SetV(r.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-i.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-i.x)},$.prototype.GetWorldPoint=function(e){var t=this.m_xf.R,n=new o(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return n.x+=this.m_xf.position.x,n.y+=this.m_xf.position.y,n},$.prototype.GetWorldVector=function(e){return r.MulMV(this.m_xf.R,e)},$.prototype.GetLocalPoint=function(e){return r.MulXT(this.m_xf,e)},$.prototype.GetLocalVector=function(e){return r.MulTMV(this.m_xf.R,e)},$.prototype.GetLinearVelocityFromWorldPoint=function(e){return new o(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},$.prototype.GetLinearVelocityFromLocalPoint=function(e){var t=this.m_xf.R,n=new o(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y);return n.x+=this.m_xf.position.x,n.y+=this.m_xf.position.y,new o(this.m_linearVelocity.x-this.m_angularVelocity*(n.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(n.x-this.m_sweep.c.x))},$.prototype.GetLinearDamping=function(){return this.m_linearDamping},$.prototype.SetLinearDamping=function(e){e===undefined&&(e=0),this.m_linearDamping=e},$.prototype.GetAngularDamping=function(){return this.m_angularDamping},$.prototype.SetAngularDamping=function(e){e===undefined&&(e=0),this.m_angularDamping=e},$.prototype.SetType=function(e){e===undefined&&(e=0);if(this.m_type==e)return;this.m_type=e,this.ResetMassData(),this.m_type==$.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var t=this.m_contactList;t;t=t.next)t.contact.FlagForFiltering()},$.prototype.GetType=function(){return this.m_type},$.prototype.SetBullet=function(e){e?this.m_flags|=$.e_bulletFlag:this.m_flags&=~$.e_bulletFlag},$.prototype.IsBullet=function(){return(this.m_flags&$.e_bulletFlag)==$.e_bulletFlag},$.prototype.SetSleepingAllowed=function(e){e?this.m_flags|=$.e_allowSleepFlag:(this.m_flags&=~$.e_allowSleepFlag,this.SetAwake(!0))},$.prototype.SetAwake=function(e){e?(this.m_flags|=$.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~$.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},$.prototype.IsAwake=function(){return(this.m_flags&$.e_awakeFlag)==$.e_awakeFlag},$.prototype.SetFixedRotation=function(e){e?this.m_flags|=$.e_fixedRotationFlag:this.m_flags&=~$.e_fixedRotationFlag,this.ResetMassData()},$.prototype.IsFixedRotation=function(){return(this.m_flags&$.e_fixedRotationFlag)==$.e_fixedRotationFlag},$.prototype.SetActive=function(e){if(e==this.IsActive())return;var t,n;if(e){this.m_flags|=$.e_activeFlag,t=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next)n.CreateProxy(t,this.m_xf)}else{this.m_flags&=~$.e_activeFlag,t=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next)n.DestroyProxy(t);var r=this.m_contactList;while(r){var i=r;r=r.next,this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null}},$.prototype.IsActive=function(){return(this.m_flags&$.e_activeFlag)==$.e_activeFlag},$.prototype.IsSleepingAllowed=function(){return(this.m_flags&$.e_allowSleepFlag)==$.e_allowSleepFlag},$.prototype.GetFixtureList=function(){return this.m_fixtureList},$.prototype.GetJointList=function(){return this.m_jointList},$.prototype.GetControllerList=function(){return this.m_controllerList},$.prototype.GetContactList=function(){return this.m_contactList},$.prototype.GetNext=function(){return this.m_next},$.prototype.GetUserData=function(){return this.m_userData},$.prototype.SetUserData=function(e){this.m_userData=e},$.prototype.GetWorld=function(){return this.m_world},$.prototype.b2Body=function(e,t){this.m_flags=0,e.bullet&&(this.m_flags|=$.e_bulletFlag),e.fixedRotation&&(this.m_flags|=$.e_fixedRotationFlag),e.allowSleep&&(this.m_flags|=$.e_allowSleepFlag),e.awake&&(this.m_flags|=$.e_awakeFlag),e.active&&(this.m_flags|=$.e_activeFlag),this.m_world=t,this.m_xf.position.SetV(e.position),this.m_xf.R.Set(e.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=e.angle;var n=this.m_xf.R,r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_jointList=null,this.m_controllerList=null,this.m_contactList=null,this.m_controllerCount=0,this.m_prev=null,this.m_next=null,this.m_linearVelocity.SetV(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_force.Set(0,0),this.m_torque=0,this.m_sleepTime=0,this.m_type=e.type,this.m_type==$.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_inertiaScale=e.inertiaScale,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0},$.prototype.SynchronizeFixtures=function(){var e=$.s_xf1;e.R.Set(this.m_sweep.a0);var t=e.R,n=this.m_sweep.localCenter;e.position.x=this.m_sweep.c0.x-(t.col1.x*n.x+t.col2.x*n.y),e.position.y=this.m_sweep.c0.y-(t.col1.y*n.x+t.col2.y*n.y);var r,i=this.m_world.m_contactManager.m_broadPhase;for(r=this.m_fixtureList;r;r=r.m_next)r.Synchronize(i,e,this.m_xf)},$.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var e=this.m_xf.R,t=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(e.col1.x*t.x+e.col2.x*t.y),this.m_xf.position.y=this.m_sweep.c.y-(e.col1.y*t.x+e.col2.y*t.y)},$.prototype.ShouldCollide=function(e){if(this.m_type!=$.b2_dynamicBody&&e.m_type!=$.b2_dynamicBody)return!1;for(var t=this.m_jointList;t;t=t.next)if(t.other==e&&t.joint.m_collideConnected==0)return!1;return!0},$.prototype.Advance=function(e){e===undefined&&(e=0),this.m_sweep.Advance(e),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new s,Box2D.Dynamics.b2Body.e_islandFlag=1,Box2D.Dynamics.b2Body.e_awakeFlag=2,Box2D.Dynamics.b2Body.e_allowSleepFlag=4,Box2D.Dynamics.b2Body.e_bulletFlag=8,Box2D.Dynamics.b2Body.e_fixedRotationFlag=16,Box2D.Dynamics.b2Body.e_activeFlag=32,Box2D.Dynamics.b2Body.b2_staticBody=0,Box2D.Dynamics.b2Body.b2_kinematicBody=1,Box2D.Dynamics.b2Body.b2_dynamicBody=2}),J.b2BodyDef=function(){this.position=new o,this.linearVelocity=new o},J.prototype.b2BodyDef=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.type=$.b2_staticBody,this.active=!0,this.inertiaScale=1},K.b2ContactFilter=function(){},K.prototype.ShouldCollide=function(e,t){var n=e.GetFilterData(),r=t.GetFilterData();if(n.groupIndex==r.groupIndex&&n.groupIndex!=0)return n.groupIndex>0;var i=(n.maskBits&r.categoryBits)!=0&&(n.categoryBits&r.maskBits)!=0;return i},K.prototype.RayCollide=function(e,t){return e?this.ShouldCollide(e instanceof nt?e:null,t):!0},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new K}),Q.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(l.b2_maxManifoldPoints),this.tangentImpulses=new Vector_a2j_Number(l.b2_maxManifoldPoints)},G.b2ContactListener=function(){},G.prototype.BeginContact=function(e){},G.prototype.EndContact=function(e){},G.prototype.PreSolve=function(e,t){},G.prototype.PostSolve=function(e,t){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new G}),Y.b2ContactManager=function(){},Y.prototype.b2ContactManager=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=K.b2_defaultFilter,this.m_contactListener=G.b2_defaultListener,this.m_contactFactory=new ht(this.m_allocator),this.m_broadPhase=new S},Y.prototype.AddPair=function(e,t){var n=e instanceof nt?e:null,r=t instanceof nt?t:null,i=n.GetBody(),s=r.GetBody();if(i==s)return;var o=s.GetContactList();while(o){if(o.other==i){var u=o.contact.GetFixtureA(),a=o.contact.GetFixtureB();if(u==n&&a==r)return;if(u==r&&a==n)return}o=o.next}if(s.ShouldCollide(i)==0)return;if(this.m_contactFilter.ShouldCollide(n,r)==0)return;var f=this.m_contactFactory.Create(n,r);n=f.GetFixtureA(),r=f.GetFixtureB(),i=n.m_body,s=r.m_body,f.m_prev=null,f.m_next=this.m_world.m_contactList,this.m_world.m_contactList!=null&&(this.m_world.m_contactList.m_prev=f),this.m_world.m_contactList=f,f.m_nodeA.contact=f,f.m_nodeA.other=s,f.m_nodeA.prev=null,f.m_nodeA.next=i.m_contactList,i.m_contactList!=null&&(i.m_contactList.prev=f.m_nodeA),i.m_contactList=f.m_nodeA,f.m_nodeB.contact=f,f.m_nodeB.other=i,f.m_nodeB.prev=null,f.m_nodeB.next=s.m_contactList,s.m_contactList!=null&&(s.m_contactList.prev=f.m_nodeB),s.m_contactList=f.m_nodeB,++this.m_world.m_contactCount;return},Y.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))},Y.prototype.Destroy=function(e){var t=e.GetFixtureA(),n=e.GetFixtureB(),r=t.GetBody(),i=n.GetBody();e.IsTouching()&&this.m_contactListener.EndContact(e),e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_world.m_contactList&&(this.m_world.m_contactList=e.m_next),e.m_nodeA.prev&&(e.m_nodeA.prev.next=e.m_nodeA.next),e.m_nodeA.next&&(e.m_nodeA.next.prev=e.m_nodeA.prev),e.m_nodeA==r.m_contactList&&(r.m_contactList=e.m_nodeA.next),e.m_nodeB.prev&&(e.m_nodeB.prev.next=e.m_nodeB.next),e.m_nodeB.next&&(e.m_nodeB.next.prev=e.m_nodeB.prev),e.m_nodeB==i.m_contactList&&(i.m_contactList=e.m_nodeB.next),this.m_contactFactory.Destroy(e),--this.m_contactCount},Y.prototype.Collide=function(){var e=this.m_world.m_contactList;while(e){var t=e.GetFixtureA(),n=e.GetFixtureB(),r=t.GetBody(),i=n.GetBody();if(r.IsAwake()==0&&i.IsAwake()==0){e=e.GetNext();continue}if(e.m_flags&at.e_filterFlag){if(i.ShouldCollide(r)==0){var s=e;e=s.GetNext(),this.Destroy(s);continue}if(this.m_contactFilter.ShouldCollide(t,n)==0){s=e,e=s.GetNext(),this.Destroy(s);continue}e.m_flags&=~at.e_filterFlag}var o=t.m_proxy,u=n.m_proxy,a=this.m_broadPhase.TestOverlap(o,u);if(a==0){s=e,e=s.GetNext(),this.Destroy(s);continue}e.Update(this.m_contactListener),e=e.GetNext()}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new m}),Z.b2DebugDraw=function(){},Z.prototype.b2DebugDraw=function(){},Z.prototype.SetFlags=function(e){e===undefined&&(e=0)},Z.prototype.GetFlags=function(){},Z.prototype.AppendFlags=function(e){e===undefined&&(e=0)},Z.prototype.ClearFlags=function(e){e===undefined&&(e=0)},Z.prototype.SetSprite=function(e){},Z.prototype.GetSprite=function(){},Z.prototype.SetDrawScale=function(e){e===undefined&&(e=0)},Z.prototype.GetDrawScale=function(){},Z.prototype.SetLineThickness=function(e){e===undefined&&(e=0)},Z.prototype.GetLineThickness=function(){},Z.prototype.SetAlpha=function(e){e===undefined&&(e=0)},Z.prototype.GetAlpha=function(){},Z.prototype.SetFillAlpha=function(e){e===undefined&&(e=0)},Z.prototype.GetFillAlpha=function(){},Z.prototype.SetXFormScale=function(e){e===undefined&&(e=0)},Z.prototype.GetXFormScale=function(){},Z.prototype.DrawPolygon=function(e,t,n){t===undefined&&(t=0)},Z.prototype.DrawSolidPolygon=function(e,t,n){t===undefined&&(t=0)},Z.prototype.DrawCircle=function(e,t,n){t===undefined&&(t=0)},Z.prototype.DrawSolidCircle=function(e,t,n,r){t===undefined&&(t=0)},Z.prototype.DrawSegment=function(e,t,n){},Z.prototype.DrawTransform=function(e){},Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1,Box2D.Dynamics.b2DebugDraw.e_jointBit=2,Box2D.Dynamics.b2DebugDraw.e_aabbBit=4,Box2D.Dynamics.b2DebugDraw.e_pairBit=8,Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16,Box2D.Dynamics.b2DebugDraw.e_controllerBit=32}),et.b2DestructionListener=function(){},et.prototype.SayGoodbyeJoint=function(e){},et.prototype.SayGoodbyeFixture=function(e){},tt.b2FilterData=function(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},tt.prototype.Copy=function(){var e=new tt;return e.categoryBits=this.categoryBits,e.maskBits=this.maskBits,e.groupIndex=this.groupIndex,e},nt.b2Fixture=function(){this.m_filter=new tt},nt.prototype.GetType=function(){return this.m_shape.GetType()},nt.prototype.GetShape=function(){return this.m_shape},nt.prototype.SetSensor=function(e){if(this.m_isSensor==e)return;this.m_isSensor=e;if(this.m_body==null)return;var t=this.m_body.GetContactList();while(t){var n=t.contact,r=n.GetFixtureA(),i=n.GetFixtureB();(r==this||i==this)&&n.SetSensor(r.IsSensor()||i.IsSensor()),t=t.next}},nt.prototype.IsSensor=function(){return this.m_isSensor},nt.prototype.SetFilterData=function(e){this.m_filter=e.Copy();if(this.m_body)return;var t=this.m_body.GetContactList();while(t){var n=t.contact,r=n.GetFixtureA(),i=n.GetFixtureB();(r==this||i==this)&&n.FlagForFiltering(),t=t.next}},nt.prototype.GetFilterData=function(){return this.m_filter.Copy()},nt.prototype.GetBody=function(){return this.m_body},nt.prototype.GetNext=function(){return this.m_next},nt.prototype.GetUserData=function(){return this.m_userData},nt.prototype.SetUserData=function(e){this.m_userData=e},nt.prototype.TestPoint=function(e){return this.m_shape.TestPoint(this.m_body.GetTransform(),e)},nt.prototype.RayCast=function(e,t){return this.m_shape.RayCast(e,t,this.m_body.GetTransform())},nt.prototype.GetMassData=function(e){return e===undefined&&(e=null),e==null&&(e=new W),this.m_shape.ComputeMass(e,this.m_density),e},nt.prototype.SetDensity=function(e){e===undefined&&(e=0),this.m_density=e},nt.prototype.GetDensity=function(){return this.m_density},nt.prototype.GetFriction=function(){return this.m_friction},nt.prototype.SetFriction=function(e){e===undefined&&(e=0),this.m_friction=e},nt.prototype.GetRestitution=function(){return this.m_restitution},nt.prototype.SetRestitution=function(e){e===undefined&&(e=0),this.m_restitution=e},nt.prototype.GetAABB=function(){return this.m_aabb},nt.prototype.b2Fixture=function(){this.m_aabb=new c,this.m_userData=null,this.m_body=null,this.m_next=null,this.m_shape=null,this.m_density=0,this.m_friction=0,this.m_restitution=0},nt.prototype.Create=function(e,t,n){this.m_userData=n.userData,this.m_friction=n.friction,this.m_restitution=n.restitution,this.m_body=e,this.m_next=null,this.m_filter=n.filter.Copy(),this.m_isSensor=n.isSensor,this.m_shape=n.shape.Copy(),this.m_density=n.density},nt.prototype.Destroy=function(){this.m_shape=null},nt.prototype.CreateProxy=function(e,t){this.m_shape.ComputeAABB(this.m_aabb,t),this.m_proxy=e.CreateProxy(this.m_aabb,this)},nt.prototype.DestroyProxy=function(e){if(this.m_proxy==null)return;e.DestroyProxy(this.m_proxy),this.m_proxy=null},nt.prototype.Synchronize=function(e,t,n){if(!this.m_proxy)return;var i=new c,s=new c;this.m_shape.ComputeAABB(i,t),this.m_shape.ComputeAABB(s,n),this.m_aabb.Combine(i,s);var o=r.SubtractVV(n.position,t.position);e.MoveProxy(this.m_proxy,this.m_aabb,o)},rt.b2FixtureDef=function(){this.filter=new tt},rt.prototype.b2FixtureDef=function(){this.shape=null,this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},it.b2Island=function(){},it.prototype.b2Island=function(){this.m_bodies=new Vector,this.m_contacts=new Vector,this.m_joints=new Vector},it.prototype.Initialize=function(e,t,n,r,i,s){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0);var o=0;this.m_bodyCapacity=e,this.m_contactCapacity=t,this.m_jointCapacity=n,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=r,this.m_listener=i,this.m_contactSolver=s;for(o=this.m_bodies.length;o<e;o++)this.m_bodies[o]=null;for(o=this.m_contacts.length;o<t;o++)this.m_contacts[o]=null;for(o=this.m_joints.length;o<n;o++)this.m_joints[o]=null},it.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},it.prototype.Solve=function(e,t,n){var i=0,s=0,o,u;for(i=0;i<this.m_bodyCount;++i){o=this.m_bodies[i];if(o.GetType()!=$.b2_dynamicBody)continue;o.m_linearVelocity.x+=e.dt*(t.x+o.m_invMass*o.m_force.x),o.m_linearVelocity.y+=e.dt*(t.y+o.m_invMass*o.m_force.y),o.m_angularVelocity+=e.dt*o.m_invI*o.m_torque,o.m_linearVelocity.Multiply(r.Clamp(1-e.dt*o.m_linearDamping,0,1)),o.m_angularVelocity*=r.Clamp(1-e.dt*o.m_angularDamping,0,1)}this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var a=this.m_contactSolver;a.InitVelocityConstraints(e);for(i=0;i<this.m_jointCount;++i)u=this.m_joints[i],u.InitVelocityConstraints(e);for(i=0;i<e.velocityIterations;++i){for(s=0;s<this.m_jointCount;++s)u=this.m_joints[s],u.SolveVelocityConstraints(e);a.SolveVelocityConstraints()}for(i=0;i<this.m_jointCount;++i)u=this.m_joints[i],u.FinalizeVelocityConstraints();a.FinalizeVelocityConstraints();for(i=0;i<this.m_bodyCount;++i){o=this.m_bodies[i];if(o.GetType()==$.b2_staticBody)continue;var f=e.dt*o.m_linearVelocity.x,c=e.dt*o.m_linearVelocity.y;f*f+c*c>l.b2_maxTranslationSquared&&(o.m_linearVelocity.Normalize(),o.m_linearVelocity.x*=l.b2_maxTranslation*e.inv_dt,o.m_linearVelocity.y*=l.b2_maxTranslation*e.inv_dt);var h=e.dt*o.m_angularVelocity;h*h>l.b2_maxRotationSquared&&(o.m_angularVelocity<0?o.m_angularVelocity=-l.b2_maxRotation*e.inv_dt:o.m_angularVelocity=l.b2_maxRotation*e.inv_dt),o.m_sweep.c0.SetV(o.m_sweep.c),o.m_sweep.a0=o.m_sweep.a,o.m_sweep.c.x+=e.dt*o.m_linearVelocity.x,o.m_sweep.c.y+=e.dt*o.m_linearVelocity.y,o.m_sweep.a+=e.dt*o.m_angularVelocity,o.SynchronizeTransform()}for(i=0;i<e.positionIterations;++i){var p=a.SolvePositionConstraints(l.b2_contactBaumgarte),d=!0;for(s=0;s<this.m_jointCount;++s){u=this.m_joints[s];var v=u.SolvePositionConstraints(l.b2_contactBaumgarte);d=d&&v}if(p&&d)break}this.Report(a.m_constraints);if(n){var m=Number.MAX_VALUE,g=l.b2_linearSleepTolerance*l.b2_linearSleepTolerance,y=l.b2_angularSleepTolerance*l.b2_angularSleepTolerance;for(i=0;i<this.m_bodyCount;++i){o=this.m_bodies[i];if(o.GetType()==$.b2_staticBody)continue;(o.m_flags&$.e_allowSleepFlag)==0&&(o.m_sleepTime=0,m=0),(o.m_flags&$.e_allowSleepFlag)==0||o.m_angularVelocity*o.m_angularVelocity>y||r.Dot(o.m_linearVelocity,o.m_linearVelocity)>g?(o.m_sleepTime=0,m=0):(o.m_sleepTime+=e.dt,m=r.Min(m,o.m_sleepTime))}if(m>=l.b2_timeToSleep)for(i=0;i<this.m_bodyCount;++i)o=this.m_bodies[i],o.SetAwake(!1)}},it.prototype.SolveTOI=function(e){var t=0,n=0;this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var r=this.m_contactSolver;for(t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(e);for(t=0;t<e.velocityIterations;++t){r.SolveVelocityConstraints();for(n=0;n<this.m_jointCount;++n)this.m_joints[n].SolveVelocityConstraints(e)}for(t=0;t<this.m_bodyCount;++t){var i=this.m_bodies[t];if(i.GetType()==$.b2_staticBody)continue;var s=e.dt*i.m_linearVelocity.x,o=e.dt*i.m_linearVelocity.y;s*s+o*o>l.b2_maxTranslationSquared&&(i.m_linearVelocity.Normalize(),i.m_linearVelocity.x*=l.b2_maxTranslation*e.inv_dt,i.m_linearVelocity.y*=l.b2_maxTranslation*e.inv_dt);var u=e.dt*i.m_angularVelocity;u*u>l.b2_maxRotationSquared&&(i.m_angularVelocity<0?i.m_angularVelocity=-l.b2_maxRotation*e.inv_dt:i.m_angularVelocity=l.b2_maxRotation*e.inv_dt),i.m_sweep.c0.SetV(i.m_sweep.c),i.m_sweep.a0=i.m_sweep.a,i.m_sweep.c.x+=e.dt*i.m_linearVelocity.x,i.m_sweep.c.y+=e.dt*i.m_linearVelocity.y,i.m_sweep.a+=e.dt*i.m_angularVelocity,i.SynchronizeTransform()}var a=.75;for(t=0;t<e.positionIterations;++t){var f=r.SolvePositionConstraints(a),c=!0;for(n=0;n<this.m_jointCount;++n){var h=this.m_joints[n].SolvePositionConstraints(l.b2_contactBaumgarte);c=c&&h}if(f&&c)break}this.Report(r.m_constraints)},it.prototype.Report=function(e){if(this.m_listener==null)return;for(var t=0;t<this.m_contactCount;++t){var n=this.m_contacts[t],r=e[t];for(var i=0;i<r.pointCount;++i)it.s_impulse.normalImpulses[i]=r.points[i].normalImpulse,it.s_impulse.tangentImpulses[i]=r.points[i].tangentImpulse;this.m_listener.PostSolve(n,it.s_impulse)}},it.prototype.AddBody=function(e){e.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=e},it.prototype.AddContact=function(e){this.m_contacts[this.m_contactCount++]=e},it.prototype.AddJoint=function(e){this.m_joints[this.m_jointCount++]=e},Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new Q}),st.b2TimeStep=function(){},st.prototype.Set=function(e){this.dt=e.dt,this.inv_dt=e.inv_dt,this.positionIterations=e.positionIterations,this.velocityIterations=e.velocityIterations,this.warmStarting=e.warmStarting},ot.b2World=function(){this.s_stack=new Vector,this.m_contactManager=new Y,this.m_contactSolver=new vt,this.m_island=new it},ot.prototype.b2World=function(e,t){this.m_destructionListener=null,this.m_debugDraw=null,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_controllerList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_controllerCount=0,ot.m_warmStarting=!0,ot.m_continuousPhysics=!0,this.m_allowSleep=t,this.m_gravity=e,this.m_inv_dt0=0,this.m_contactManager.m_world=this;var n=new J;this.m_groundBody=this.CreateBody(n)},ot.prototype.SetDestructionListener=function(e){this.m_destructionListener=e},ot.prototype.SetContactFilter=function(e){this.m_contactManager.m_contactFilter=e},ot.prototype.SetContactListener=function(e){this.m_contactManager.m_contactListener=e},ot.prototype.SetDebugDraw=function(e){this.m_debugDraw=e},ot.prototype.SetBroadPhase=function(e){var t=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=e;for(var n=this.m_bodyList;n;n=n.m_next)for(var r=n.m_fixtureList;r;r=r.m_next)r.m_proxy=e.CreateProxy(t.GetFatAABB(r.m_proxy),r)},ot.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},ot.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},ot.prototype.CreateBody=function(e){if(this.IsLocked()==1)return null;var t=new $(e,this);return t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount,t},ot.prototype.DestroyBody=function(e){if(this.IsLocked()==1)return;var t=e.m_jointList;while(t){var n=t;t=t.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(n.joint),this.DestroyJoint(n.joint)}var r=e.m_controllerList;while(r){var i=r;r=r.nextController,i.controller.RemoveBody(e)}var s=e.m_contactList;while(s){var o=s;s=s.next,this.m_contactManager.Destroy(o.contact)}e.m_contactList=null;var u=e.m_fixtureList;while(u){var a=u;u=u.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(a),a.DestroyProxy(this.m_contactManager.m_broadPhase),a.Destroy()}e.m_fixtureList=null,e.m_fixtureCount=0,e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_bodyList&&(this.m_bodyList=e.m_next),--this.m_bodyCount},ot.prototype.CreateJoint=function(e){var t=Ot.Create(e,null);t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB;var n=e.bodyA,r=e.bodyB;if(e.collideConnected==0){var i=r.GetContactList();while(i)i.other==n&&i.contact.FlagForFiltering(),i=i.next}return t},ot.prototype.DestroyJoint=function(e){var t=e.m_collideConnected;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_jointList&&(this.m_jointList=e.m_next);var n=e.m_bodyA,r=e.m_bodyB;n.SetAwake(!0),r.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA==n.m_jointList&&(n.m_jointList=e.m_edgeA.next),e.m_edgeA.prev=null,e.m_edgeA.next=null,e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB==r.m_jointList&&(r.m_jointList=e.m_edgeB.next),e.m_edgeB.prev=null,e.m_edgeB.next=null,Ot.Destroy(e,null),--this.m_jointCount;if(t==0){var i=r.GetContactList();while(i)i.other==n&&i.contact.FlagForFiltering(),i=i.next}},ot.prototype.AddController=function(e){return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList=e,e.m_world=this,this.m_controllerCount++,e},ot.prototype.RemoveController=function(e){e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),this.m_controllerList==e&&(this.m_controllerList=e.m_next),this.m_controllerCount--},ot.prototype.CreateController=function(e){if(e.m_world!=this)throw new Error("Controller can only be a member of one world");return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=e),this.m_controllerList=e,++this.m_controllerCount,e.m_world=this,e},ot.prototype.DestroyController=function(e){e.Clear(),e.m_next&&(e.m_next.m_prev=e.m_prev),e.m_prev&&(e.m_prev.m_next=e.m_next),e==this.m_controllerList&&(this.m_controllerList=e.m_next),--this.m_controllerCount},ot.prototype.SetWarmStarting=function(e){ot.m_warmStarting=e},ot.prototype.SetContinuousPhysics=function(e){ot.m_continuousPhysics=e},ot.prototype.GetBodyCount=function(){return this.m_bodyCount},ot.prototype.GetJointCount=function(){return this.m_jointCount},ot.prototype.GetContactCount=function(){return this.m_contactCount},ot.prototype.SetGravity=function(e){this.m_gravity=e},ot.prototype.GetGravity=function(){return this.m_gravity},ot.prototype.GetGroundBody=function(){return this.m_groundBody},ot.prototype.Step=function(e,t,n){e===undefined&&(e=0),t===undefined&&(t=0),n===undefined&&(n=0),this.m_flags&ot.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~ot.e_newFixture),this.m_flags|=ot.e_locked;var r=ot.s_timestep2;r.dt=e,r.velocityIterations=t,r.positionIterations=n,e>0?r.inv_dt=1/e:r.inv_dt=0,r.dtRatio=this.m_inv_dt0*e,r.warmStarting=ot.m_warmStarting,this.m_contactManager.Collide(),r.dt>0&&this.Solve(r),ot.m_continuousPhysics&&r.dt>0&&this.SolveTOI(r),r.dt>0&&(this.m_inv_dt0=r.inv_dt),this.m_flags&=~ot.e_locked},ot.prototype.ClearForces=function(){for(var e=this.m_bodyList;e;e=e.m_next)e.m_force.SetZero(),e.m_torque=0},ot.prototype.DrawDebugData=function(){if(this.m_debugDraw==null)return;this.m_debugDraw.m_sprite.graphics.clear();var e=this.m_debugDraw.GetFlags(),t=0,n,r,i,s,u,f=new o,l=new o,h=new o,p,d=new c,v=new c,m=[new o,new o,new o,new o],g=new a(0,0,0);if(e&Z.e_shapeBit)for(n=this.m_bodyList;n;n=n.m_next){p=n.m_xf;for(r=n.GetFixtureList();r;r=r.m_next)i=r.GetShape(),n.IsActive()==0?(g.Set(.5,.5,.3),this.DrawShape(i,p,g)):n.GetType()==$.b2_staticBody?(g.Set(.5,.9,.5),this.DrawShape(i,p,g)):n.GetType()==$.b2_kinematicBody?(g.Set(.5,.5,.9),this.DrawShape(i,p,g)):n.IsAwake()==0?(g.Set(.6,.6,.6),this.DrawShape(i,p,g)):(g.Set(.9,.7,.7),this.DrawShape(i,p,g))}if(e&Z.e_jointBit)for(s=this.m_jointList;s;s=s.m_next)this.DrawJoint(s);if(e&Z.e_controllerBit)for(var y=this.m_controllerList;y;y=y.m_next)y.Draw(this.m_debugDraw);if(e&Z.e_pairBit){g.Set(.3,.9,.9);for(var b=this.m_contactManager.m_contactList;b;b=b.GetNext()){var w=b.GetFixtureA(),E=b.GetFixtureB(),S=w.GetAABB().GetCenter(),x=E.GetAABB().GetCenter();this.m_debugDraw.DrawSegment(S,x,g)}}if(e&Z.e_aabbBit){u=this.m_contactManager.m_broadPhase,m=[new o,new o,new o,new o];for(n=this.m_bodyList;n;n=n.GetNext()){if(n.IsActive()==0)continue;for(r=n.GetFixtureList();r;r=r.GetNext()){var T=u.GetFatAABB(r.m_proxy);m[0].Set(T.lowerBound.x,T.lowerBound.y),m[1].Set(T.upperBound.x,T.lowerBound.y),m[2].Set(T.upperBound.x,T.upperBound.y),m[3].Set(T.lowerBound.x,T.upperBound.y),this.m_debugDraw.DrawPolygon(m,4,g)}}}if(e&Z.e_centerOfMassBit)for(n=this.m_bodyList;n;n=n.m_next)p=ot.s_xf,p.R=n.m_xf.R,p.position=n.GetWorldCenter(),this.m_debugDraw.DrawTransform(p)},ot.prototype.QueryAABB=function(e,t){function i(t){return e(r.GetUserData(t))}var n=this,r=n.m_contactManager.m_broadPhase;r.Query(i,t)},ot.prototype.QueryShape=function(e,t,n){function o(r){var s=i.GetUserData(r)instanceof nt?i.GetUserData(r):null;return V.TestOverlap(t,n,s.GetShape(),s.GetBody().GetTransform())?e(s):!0}var r=this;n===undefined&&(n=null),n==null&&(n=new s,n.SetIdentity());var i=r.m_contactManager.m_broadPhase,u=new c;t.ComputeAABB(u,n),i.Query(o,u)},ot.prototype.QueryPoint=function(e,t){function i(n){var i=r.GetUserData(n)instanceof nt?r.GetUserData(n):null;return i.TestPoint(t)?e(i):!0}var n=this,r=n.m_contactManager.m_broadPhase,s=new c;s.lowerBound.Set(t.x-l.b2_linearSlop,t.y-l.b2_linearSlop),s.upperBound.Set(t.x+l.b2_linearSlop,t.y+l.b2_linearSlop),r.Query(i,s)},ot.prototype.RayCast=function(e,t,n){function u(r,u){var a=i.GetUserData(u),f=a instanceof nt?a:null,l=f.RayCast(s,r);if(l){var c=s.fraction,h=new o((1-c)*t.x+c*n.x,(1-c)*t.y+c*n.y);return e(f,h,s.normal,c)}return r.maxFraction}var r=this,i=r.m_contactManager.m_broadPhase,s=new A,a=new L(t,n);i.RayCast(u,a)},ot.prototype.RayCastOne=function(e,t){function i(e,t,n,i){return i===undefined&&(i=0),r=e,i}var n=this,r;return n.RayCast(i,e,t),r},ot.prototype.RayCastAll=function(e,t){function i(e,t,n,i){return i===undefined&&(i=0),r[r.length]=e,1}var n=this,r=new Vector;return n.RayCast(i,e,t),r},ot.prototype.GetBodyList=function(){return this.m_bodyList},ot.prototype.GetJointList=function(){return this.m_jointList},ot.prototype.GetContactList=function(){return this.m_contactList},ot.prototype.IsLocked=function(){return(this.m_flags&ot.e_locked)>0},ot.prototype.Solve=function(e){var t;for(var n=this.m_controllerList;n;n=n.m_next)n.Step(e);var r=this.m_island;r.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~$.e_islandFlag;for(var i=this.m_contactList;i;i=i.m_next)i.m_flags&=~at.e_islandFlag;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;var o=parseInt(this.m_bodyCount),u=this.s_stack;for(var a=this.m_bodyList;a;a=a.m_next){if(a.m_flags&$.e_islandFlag)continue;if(a.IsAwake()==0||a.IsActive()==0)continue;if(a.GetType()==$.b2_staticBody)continue;r.Clear();var f=0;u[f++]=a,a.m_flags|=$.e_islandFlag;while(f>0){t=u[--f],r.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()==$.b2_staticBody)continue;var l;for(var c=t.m_contactList;c;c=c.next){if(c.contact.m_flags&at.e_islandFlag)continue;if(c.contact.IsSensor()==1||c.contact.IsEnabled()==0||c.contact.IsTouching()==0)continue;r.AddContact(c.contact),c.contact.m_flags|=at.e_islandFlag,l=c.other;if(l.m_flags&$.e_islandFlag)continue;u[f++]=l,l.m_flags|=$.e_islandFlag}for(var h=t.m_jointList;h;h=h.next){if(h.joint.m_islandFlag==1)continue;l=h.other;if(l.IsActive()==0)continue;r.AddJoint(h.joint),h.joint.m_islandFlag=!0;if(l.m_flags&$.e_islandFlag)continue;u[f++]=l,l.m_flags|=$.e_islandFlag}}r.Solve(e,this.m_gravity,this.m_allowSleep);for(var p=0;p<r.m_bodyCount;++p)t=r.m_bodies[p],t.GetType()==$.b2_staticBody&&(t.m_flags&=~$.e_islandFlag)}for(p=0;p<u.length;++p){if(!u[p])break;u[p]=null}for(t=this.m_bodyList;t;t=t.m_next){if(t.IsAwake()==0||t.IsActive()==0)continue;if(t.GetType()==$.b2_staticBody)continue;t.SynchronizeFixtures()}this.m_contactManager.FindNewContacts()},ot.prototype.SolveTOI=function(e){var t,n,r,i,s,o,u,a=this.m_island;a.Initialize(this.m_bodyCount,l.b2_maxTOIContactsPerIsland,l.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var f=ot.s_queue;for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~$.e_islandFlag,t.m_sweep.t0=0;var c;for(c=this.m_contactList;c;c=c.m_next)c.m_flags&=~(at.e_toiFlag|at.e_islandFlag);for(u=this.m_jointList;u;u=u.m_next)u.m_islandFlag=!1;for(;;){var h=null,p=1;for(c=this.m_contactList;c;c=c.m_next){if(c.IsSensor()==1||c.IsEnabled()==0||c.IsContinuous()==0)continue;var d=1;if(c.m_flags&at.e_toiFlag)d=c.m_toi;else{n=c.m_fixtureA,r=c.m_fixtureB,i=n.m_body,s=r.m_body;if(!(i.GetType()==$.b2_dynamicBody&&i.IsAwake()!=0||s.GetType()==$.b2_dynamicBody&&s.IsAwake()!=0))continue;var v=i.m_sweep.t0;i.m_sweep.t0<s.m_sweep.t0?(v=s.m_sweep.t0,i.m_sweep.Advance(v)):s.m_sweep.t0<i.m_sweep.t0&&(v=i.m_sweep.t0,s.m_sweep.Advance(v)),d=c.ComputeTOI(i.m_sweep,s.m_sweep),l.b2Assert(0<=d&&d<=1),d>0&&d<1&&(d=(1-d)*v+d,d>1&&(d=1)),c.m_toi=d,c.m_flags|=at.e_toiFlag}Number.MIN_VALUE<d&&d<p&&(h=c,p=d)}if(h==null||1-100*Number.MIN_VALUE<p)break;n=h.m_fixtureA,r=h.m_fixtureB,i=n.m_body,s=r.m_body,ot.s_backupA.Set(i.m_sweep),ot.s_backupB.Set(s.m_sweep),i.Advance(p),s.Advance(p),h.Update(this.m_contactManager.m_contactListener),h.m_flags&=~at.e_toiFlag;if(h.IsSensor()==1||h.IsEnabled()==0){i.m_sweep.Set(ot.s_backupA),s.m_sweep.Set(ot.s_backupB),i.SynchronizeTransform(),s.SynchronizeTransform();continue}if(h.IsTouching()==0)continue;var m=i;m.GetType()!=$.b2_dynamicBody&&(m=s),a.Clear();var g=0,y=0;f[g+y++]=m,m.m_flags|=$.e_islandFlag;while(y>0){t=f[g++],--y,a.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()!=$.b2_dynamicBody)continue;for(o=t.m_contactList;o;o=o.next){if(a.m_contactCount==a.m_contactCapacity)break;if(o.contact.m_flags&at.e_islandFlag)continue;if(o.contact.IsSensor()==1||o.contact.IsEnabled()==0||o.contact.IsTouching()==0)continue;a.AddContact(o.contact),o.contact.m_flags|=at.e_islandFlag;var b=o.other;if(b.m_flags&$.e_islandFlag)continue;b.GetType()!=$.b2_staticBody&&(b.Advance(p),b.SetAwake(!0)),f[g+y]=b,++y,b.m_flags|=$.e_islandFlag}for(var w=t.m_jointList;w;w=w.next){if(a.m_jointCount==a.m_jointCapacity)continue;if(w.joint.m_islandFlag==1)continue;b=w.other;if(b.IsActive()==0)continue;a.AddJoint(w.joint),w.joint.m_islandFlag=!0;if(b.m_flags&$.e_islandFlag)continue;b.GetType()!=$.b2_staticBody&&(b.Advance(p),b.SetAwake(!0)),f[g+y]=b,++y,b.m_flags|=$.e_islandFlag}}var E=ot.s_timestep;E.warmStarting=!1,E.dt=(1-p)*e.dt,E.inv_dt=1/E.dt,E.dtRatio=0,E.velocityIterations=e.velocityIterations,E.positionIterations=e.positionIterations,a.SolveTOI(E);var S=0;for(S=0;S<a.m_bodyCount;++S){t=a.m_bodies[S],t.m_flags&=~$.e_islandFlag;if(t.IsAwake()==0)continue;if(t.GetType()!=$.b2_dynamicBody)continue;t.SynchronizeFixtures();for(o=t.m_contactList;o;o=o.next)o.contact.m_flags&=~at.e_toiFlag}for(S=0;S<a.m_contactCount;++S)c=a.m_contacts[S],c.m_flags&=~(at.e_toiFlag|at.e_islandFlag);for(S=0;S<a.m_jointCount;++S)u=a.m_joints[S],u.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}},ot.prototype.DrawJoint=function(e){var t=e.GetBodyA(),n=e.GetBodyB(),r=t.m_xf,i=n.m_xf,s=r.position,o=i.position,u=e.GetAnchorA(),a=e.GetAnchorB(),f=ot.s_jointColor;switch(e.m_type){case Ot.e_distanceJoint:this.m_debugDraw.DrawSegment(u,a,f);break;case Ot.e_pulleyJoint:var l=e instanceof It?e:null,c=l.GetGroundAnchorA(),h=l.GetGroundAnchorB();this.m_debugDraw.DrawSegment(c,u,f),this.m_debugDraw.DrawSegment(h,a,f),this.m_debugDraw.DrawSegment(c,h,f);break;case Ot.e_mouseJoint:this.m_debugDraw.DrawSegment(u,a,f);break;default:t!=this.m_groundBody&&this.m_debugDraw.DrawSegment(s,u,f),this.m_debugDraw.DrawSegment(u,a,f),n!=this.m_groundBody&&this.m_debugDraw.DrawSegment(o,a,f)}},ot.prototype.DrawShape=function(e,t,n){switch(e.m_type){case V.e_circleShape:var i=e instanceof R?e:null,s=r.MulX(t,i.m_p),o=i.m_radius,u=t.R.col1;this.m_debugDraw.DrawSolidCircle(s,o,u,n);break;case V.e_polygonShape:var a=0,f=e instanceof X?e:null,l=parseInt(f.GetVertexCount()),c=f.GetVertices(),h=new Vector(l);for(a=0;a<l;++a)h[a]=r.MulX(t,c[a]);this.m_debugDraw.DrawSolidPolygon(h,l,n);break;case V.e_edgeShape:var p=e instanceof z?e:null;this.m_debugDraw.DrawSegment(r.MulX(t,p.GetVertex1()),r.MulX(t,p.GetVertex2()),n)}},Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new st,Box2D.Dynamics.b2World.s_xf=new s,Box2D.Dynamics.b2World.s_backupA=new i,Box2D.Dynamics.b2World.s_backupB=new i,Box2D.Dynamics.b2World.s_timestep=new st,Box2D.Dynamics.b2World.s_queue=new Vector,Box2D.Dynamics.b2World.s_jointColor=new a(.5,.8,.8),Box2D.Dynamics.b2World.e_newFixture=1,Box2D.Dynamics.b2World.e_locked=2})}(),function(){var e=Box2D.Collision.Shapes.b2CircleShape,t=Box2D.Collision.Shapes.b2EdgeChainDef,n=Box2D.Collision.Shapes.b2EdgeShape,r=Box2D.Collision.Shapes.b2MassData,i=Box2D.Collision.Shapes.b2PolygonShape,s=Box2D.Collision.Shapes.b2Shape,o=Box2D.Dynamics.Contacts.b2CircleContact,u=Box2D.Dynamics.Contacts.b2Contact,a=Box2D.Dynamics.Contacts.b2ContactConstraint,f=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,l=Box2D.Dynamics.Contacts.b2ContactEdge,c=Box2D.Dynamics.Contacts.b2ContactFactory,h=Box2D.Dynamics.Contacts.b2ContactRegister,p=Box2D.Dynamics.Contacts.b2ContactResult,d=Box2D.Dynamics.Contacts.b2ContactSolver,v=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,m=Box2D.Dynamics.Contacts.b2NullContact,g=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,y=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,b=Box2D.Dynamics.Contacts.b2PolygonContact,w=Box2D.Dynamics.Contacts.b2PositionSolverManifold,E=Box2D.Dynamics.b2Body,S=Box2D.Dynamics.b2BodyDef,x=Box2D.Dynamics.b2ContactFilter,T=Box2D.Dynamics.b2ContactImpulse,N=Box2D.Dynamics.b2ContactListener,C=Box2D.Dynamics.b2ContactManager,k=Box2D.Dynamics.b2DebugDraw,L=Box2D.Dynamics.b2DestructionListener,A=Box2D.Dynamics.b2FilterData,O=Box2D.Dynamics.b2Fixture,M=Box2D.Dynamics.b2FixtureDef,_=Box2D.Dynamics.b2Island,D=Box2D.Dynamics.b2TimeStep,P=Box2D.Dynamics.b2World,H=Box2D.Common.b2Color,B=Box2D.Common.b2internal,j=Box2D.Common.b2Settings,F=Box2D.Common.Math.b2Mat22,I=Box2D.Common.Math.b2Mat33,q=Box2D.Common.Math.b2Math,R=Box2D.Common.Math.b2Sweep,U=Box2D.Common.Math.b2Transform,z=Box2D.Common.Math.b2Vec2,W=Box2D.Common.Math.b2Vec3,X=Box2D.Collision.b2AABB,V=Box2D.Collision.b2Bound,$=Box2D.Collision.b2BoundValues,J=Box2D.Collision.b2Collision,K=Box2D.Collision.b2ContactID,Q=Box2D.Collision.b2ContactPoint,G=Box2D.Collision.b2Distance,Y=Box2D.Collision.b2DistanceInput,Z=Box2D.Collision.b2DistanceOutput,et=Box2D.Collision.b2DistanceProxy,tt=Box2D.Collision.b2DynamicTree,nt=Box2D.Collision.b2DynamicTreeBroadPhase,rt=Box2D.Collision.b2DynamicTreeNode,it=Box2D.Collision.b2DynamicTreePair,st=Box2D.Collision.b2Manifold,ot=Box2D.Collision.b2ManifoldPoint,ut=Box2D.Collision.b2Point,at=Box2D.Collision.b2RayCastInput,ft=Box2D.Collision.b2RayCastOutput,lt=Box2D.Collision.b2Segment,ct=Box2D.Collision.b2SeparationFunction,ht=Box2D.Collision.b2Simplex,pt=Box2D.Collision.b2SimplexCache,dt=Box2D.Collision.b2SimplexVertex,vt=Box2D.Collision.b2TimeOfImpact,mt=Box2D.Collision.b2TOIInput,gt=Box2D.Collision.b2WorldManifold,yt=Box2D.Collision.ClipVertex,bt=Box2D.Collision.Features,wt=Box2D.Collision.IBroadPhase;Box2D.inherit(o,Box2D.Dynamics.Contacts.b2Contact),o.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,o.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},o.Create=function(e){return new o},o.Destroy=function(e,t){},o.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},o.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody();J.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof e?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,n.m_xf)},u.b2Contact=function(){this.m_nodeA=new l,this.m_nodeB=new l,this.m_manifold=new st,this.m_oldManifold=new st},u.prototype.GetManifold=function(){return this.m_manifold},u.prototype.GetWorldManifold=function(e){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),i=this.m_fixtureB.GetShape();e.Initialize(this.m_manifold,t.GetTransform(),r.m_radius,n.GetTransform(),i.m_radius)},u.prototype.IsTouching=function(){return(this.m_flags&u.e_touchingFlag)==u.e_touchingFlag},u.prototype.IsContinuous=function(){return(this.m_flags&u.e_continuousFlag)==u.e_continuousFlag},u.prototype.SetSensor=function(e){e?this.m_flags|=u.e_sensorFlag:this.m_flags&=~u.e_sensorFlag},u.prototype.IsSensor=function(){return(this.m_flags&u.e_sensorFlag)==u.e_sensorFlag},u.prototype.SetEnabled=function(e){e?this.m_flags|=u.e_enabledFlag:this.m_flags&=~u.e_enabledFlag},u.prototype.IsEnabled=function(){return(this.m_flags&u.e_enabledFlag)==u.e_enabledFlag},u.prototype.GetNext=function(){return this.m_next},u.prototype.GetFixtureA=function(){return this.m_fixtureA},u.prototype.GetFixtureB=function(){return this.m_fixtureB},u.prototype.FlagForFiltering=function(){this.m_flags|=u.e_filterFlag},u.prototype.b2Contact=function(){},u.prototype.Reset=function(e,t){e===undefined&&(e=null),t===undefined&&(t=null),this.m_flags=u.e_enabledFlag;if(!e||!t){this.m_fixtureA=null,this.m_fixtureB=null;return}if(e.IsSensor()||t.IsSensor())this.m_flags|=u.e_sensorFlag;var n=e.GetBody(),r=t.GetBody();if(n.GetType()!=E.b2_dynamicBody||n.IsBullet()||r.GetType()!=E.b2_dynamicBody||r.IsBullet())this.m_flags|=u.e_continuousFlag;this.m_fixtureA=e,this.m_fixtureB=t,this.m_manifold.m_pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null},u.prototype.Update=function(e){var t=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=t,this.m_flags|=u.e_enabledFlag;var n=!1,r=(this.m_flags&u.e_touchingFlag)==u.e_touchingFlag,i=this.m_fixtureA.m_body,o=this.m_fixtureB.m_body,a=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&u.e_sensorFlag){if(a){var f=this.m_fixtureA.GetShape(),l=this.m_fixtureB.GetShape(),c=i.GetTransform(),h=o.GetTransform();n=s.TestOverlap(f,c,l,h)}this.m_manifold.m_pointCount=0}else{i.GetType()!=E.b2_dynamicBody||i.IsBullet()||o.GetType()!=E.b2_dynamicBody||o.IsBullet()?this.m_flags|=u.e_continuousFlag:this.m_flags&=~u.e_continuousFlag;if(a){this.Evaluate(),n=this.m_manifold.m_pointCount>0;for(var p=0;p<this.m_manifold.m_pointCount;++p){var d=this.m_manifold.m_points[p];d.m_normalImpulse=0,d.m_tangentImpulse=0;var v=d.m_id;for(var m=0;m<this.m_oldManifold.m_pointCount;++m){var g=this.m_oldManifold.m_points[m];if(g.m_id.key==v.key){d.m_normalImpulse=g.m_normalImpulse,d.m_tangentImpulse=g.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;n!=r&&(i.SetAwake(!0),o.SetAwake(!0))}n?this.m_flags|=u.e_touchingFlag:this.m_flags&=~u.e_touchingFlag,r==0&&n==1&&e.BeginContact(this),r==1&&n==0&&e.EndContact(this),(this.m_flags&u.e_sensorFlag)==0&&e.PreSolve(this,this.m_oldManifold)},u.prototype.Evaluate=function(){},u.prototype.ComputeTOI=function(e,t){return u.s_input.proxyA.Set(this.m_fixtureA.GetShape()),u.s_input.proxyB.Set(this.m_fixtureB.GetShape()),u.s_input.sweepA=e,u.s_input.sweepB=t,u.s_input.tolerance=j.b2_linearSlop,vt.TimeOfImpact(u.s_input)},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1,Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2,Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4,Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8,Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16,Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32,Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=64,Box2D.Dynamics.Contacts.b2Contact.s_input=new mt}),a.b2ContactConstraint=function(){this.localPlaneNormal=new z,this.localPoint=new z,this.normal=new z,this.normalMass=new F,this.K=new F},a.prototype.b2ContactConstraint=function(){this.points=new Vector(j.b2_maxManifoldPoints);for(var e=0;e<j.b2_maxManifoldPoints;e++)this.points[e]=new f},f.b2ContactConstraintPoint=function(){this.localPoint=new z,this.rA=new z,this.rB=new z},l.b2ContactEdge=function(){},c.b2ContactFactory=function(){},c.prototype.b2ContactFactory=function(e){this.m_allocator=e,this.InitializeRegisters()},c.prototype.AddType=function(e,t,n,r){n===undefined&&(n=0),r===undefined&&(r=0),this.m_registers[n][r].createFcn=e,this.m_registers[n][r].destroyFcn=t,this.m_registers[n][r].primary=!0,n!=r&&(this.m_registers[r][n].createFcn=e,this.m_registers[r][n].destroyFcn=t,this.m_registers[r][n].primary=!1)},c.prototype.InitializeRegisters=function(){this.m_registers=new Vector(s.e_shapeTypeCount);for(var e=0;e<s.e_shapeTypeCount;e++){this.m_registers[e]=new Vector(s.e_shapeTypeCount);for(var t=0;t<s.e_shapeTypeCount;t++)this.m_registers[e][t]=new h}this.AddType(o.Create,o.Destroy,s.e_circleShape,s.e_circleShape),this.AddType(g.Create,g.Destroy,s.e_polygonShape,s.e_circleShape),this.AddType(b.Create,b.Destroy,s.e_polygonShape,s.e_polygonShape),this.AddType(v.Create,v.Destroy,s.e_edgeShape,s.e_circleShape),this.AddType(y.Create,y.Destroy,s.e_polygonShape,s.e_edgeShape)},c.prototype.Create=function(e,t){var n=parseInt(e.GetType()),r=parseInt(t.GetType()),i=this.m_registers[n][r],s;if(i.pool)return s=i.pool,i.pool=s.m_next,i.poolCount--,s.Reset(e,t),s;var o=i.createFcn;return o!=null?i.primary?(s=o(this.m_allocator),s.Reset(e,t),s):(s=o(this.m_allocator),s.Reset(t,e),s):null},c.prototype.Destroy=function(e){e.m_manifold.m_pointCount>0&&(e.m_fixtureA.m_body.SetAwake(!0),e.m_fixtureB.m_body.SetAwake(!0));var t=parseInt(e.m_fixtureA.GetType()),n=parseInt(e.m_fixtureB.GetType()),r=this.m_registers[t][n];r.poolCount++,e.m_next=r.pool,r.pool=e;var i=r.destroyFcn;i(e,this.m_allocator)},h.b2ContactRegister=function(){},p.b2ContactResult=function(){this.position=new z,this.normal=new z,this.id=new K},d.b2ContactSolver=function(){this.m_step=new D,this.m_constraints=new Vector},d.prototype.b2ContactSolver=function(){},d.prototype.Initialize=function(e,t,n,r){n===undefined&&(n=0);var i;this.m_step.Set(e),this.m_allocator=r;var s=0,o,u;this.m_constraintCount=n;while(this.m_constraints.length<this.m_constraintCount)this.m_constraints[this.m_constraints.length]=new a;for(s=0;s<n;++s){i=t[s];var f=i.m_fixtureA,l=i.m_fixtureB,c=f.m_shape,h=l.m_shape,p=c.m_radius,v=h.m_radius,m=f.m_body,g=l.m_body,y=i.GetManifold(),b=j.b2MixFriction(f.GetFriction(),l.GetFriction()),w=j.b2MixRestitution(f.GetRestitution(),l.GetRestitution()),E=m.m_linearVelocity.x,S=m.m_linearVelocity.y,x=g.m_linearVelocity.x,T=g.m_linearVelocity.y,N=m.m_angularVelocity,C=g.m_angularVelocity;j.b2Assert(y.m_pointCount>0),d.s_worldManifold.Initialize(y,m.m_xf,p,g.m_xf,v);var k=d.s_worldManifold.m_normal.x,L=d.s_worldManifold.m_normal.y,A=this.m_constraints[s];A.bodyA=m,A.bodyB=g,A.manifold=y,A.normal.x=k,A.normal.y=L,A.pointCount=y.m_pointCount,A.friction=b,A.restitution=w,A.localPlaneNormal.x=y.m_localPlaneNormal.x,A.localPlaneNormal.y=y.m_localPlaneNormal.y,A.localPoint.x=y.m_localPoint.x,A.localPoint.y=y.m_localPoint.y,A.radius=p+v,A.type=y.m_type;for(var O=0;O<A.pointCount;++O){var M=y.m_points[O],_=A.points[O];_.normalImpulse=M.m_normalImpulse,_.tangentImpulse=M.m_tangentImpulse,_.localPoint.SetV(M.m_localPoint);var D=_.rA.x=d.s_worldManifold.m_points[O].x-m.m_sweep.c.x,P=_.rA.y=d.s_worldManifold.m_points[O].y-m.m_sweep.c.y,H=_.rB.x=d.s_worldManifold.m_points[O].x-g.m_sweep.c.x,B=_.rB.y=d.s_worldManifold.m_points[O].y-g.m_sweep.c.y,F=D*L-P*k,I=H*L-B*k;F*=F,I*=I;var q=m.m_invMass+g.m_invMass+m.m_invI*F+g.m_invI*I;_.normalMass=1/q;var R=m.m_mass*m.m_invMass+g.m_mass*g.m_invMass;R+=m.m_mass*m.m_invI*F+g.m_mass*g.m_invI*I,_.equalizedMass=1/R;var U=L,z=-k,W=D*z-P*U,X=H*z-B*U;W*=W,X*=X;var V=m.m_invMass+g.m_invMass+m.m_invI*W+g.m_invI*X;_.tangentMass=1/V,_.velocityBias=0;var $=x+ -C*B-E- -N*P,J=T+C*H-S-N*D,K=A.normal.x*$+A.normal.y*J;K<-j.b2_velocityThreshold&&(_.velocityBias+=-A.restitution*K)}if(A.pointCount==2){var Q=A.points[0],G=A.points[1],Y=m.m_invMass,Z=m.m_invI,et=g.m_invMass,tt=g.m_invI,nt=Q.rA.x*L-Q.rA.y*k,rt=Q.rB.x*L-Q.rB.y*k,it=G.rA.x*L-G.rA.y*k,st=G.rB.x*L-G.rB.y*k,ot=Y+et+Z*nt*nt+tt*rt*rt,ut=Y+et+Z*it*it+tt*st*st,at=Y+et+Z*nt*it+tt*rt*st,ft=100;ot*ot<ft*(ot*ut-at*at)?(A.K.col1.Set(ot,at),A.K.col2.Set(at,ut),A.K.GetInverse(A.normalMass)):A.pointCount=1}}},d.prototype.InitVelocityConstraints=function(e){var t,n,r;for(var i=0;i<this.m_constraintCount;++i){var s=this.m_constraints[i],o=s.bodyA,u=s.bodyB,a=o.m_invMass,f=o.m_invI,l=u.m_invMass,c=u.m_invI,h=s.normal.x,p=s.normal.y,d=p,v=-h,m=0,g=0,y=0;if(e.warmStarting){y=s.pointCount;for(g=0;g<y;++g){var b=s.points[g];b.normalImpulse*=e.dtRatio,b.tangentImpulse*=e.dtRatio;var w=b.normalImpulse*h+b.tangentImpulse*d,E=b.normalImpulse*p+b.tangentImpulse*v;o.m_angularVelocity-=f*(b.rA.x*E-b.rA.y*w),o.m_linearVelocity.x-=a*w,o.m_linearVelocity.y-=a*E,u.m_angularVelocity+=c*(b.rB.x*E-b.rB.y*w),u.m_linearVelocity.x+=l*w,u.m_linearVelocity.y+=l*E}}else{y=s.pointCount;for(g=0;g<y;++g){var S=s.points[g];S.normalImpulse=0,S.tangentImpulse=0}}}},d.prototype.SolveVelocityConstraints=function(){var e=0,t,n=0,r=0,i=0,s=0,o=0,u=0,a=0,f=0,l=0,c=0,h=0,p=0,d=0,v=0,m=0,g=0,y=0,b=0,w=0,E,S;for(var x=0;x<this.m_constraintCount;++x){var T=this.m_constraints[x],N=T.bodyA,C=T.bodyB,k=N.m_angularVelocity,L=C.m_angularVelocity,A=N.m_linearVelocity,O=C.m_linearVelocity,M=N.m_invMass,_=N.m_invI,D=C.m_invMass,P=C.m_invI,H=T.normal.x,B=T.normal.y,j=B,F=-H,I=T.friction,R=0;for(e=0;e<T.pointCount;e++)t=T.points[e],o=O.x-L*t.rB.y-A.x+k*t.rA.y,u=O.y+L*t.rB.x-A.y-k*t.rA.x,f=o*j+u*F,l=t.tangentMass*-f,c=I*t.normalImpulse,h=q.Clamp(t.tangentImpulse+l,-c,c),l=h-t.tangentImpulse,p=l*j,d=l*F,A.x-=M*p,A.y-=M*d,k-=_*(t.rA.x*d-t.rA.y*p),O.x+=D*p,O.y+=D*d,L+=P*(t.rB.x*d-t.rB.y*p),t.tangentImpulse=h;var U=parseInt(T.pointCount);if(T.pointCount==1)t=T.points[0],o=O.x+ -L*t.rB.y-A.x- -k*t.rA.y,u=O.y+L*t.rB.x-A.y-k*t.rA.x,a=o*H+u*B,l=-t.normalMass*(a-t.velocityBias),h=t.normalImpulse+l,h=h>0?h:0,l=h-t.normalImpulse,p=l*H,d=l*B,A.x-=M*p,A.y-=M*d,k-=_*(t.rA.x*d-t.rA.y*p),O.x+=D*p,O.y+=D*d,L+=P*(t.rB.x*d-t.rB.y*p),t.normalImpulse=h;else{var z=T.points[0],W=T.points[1],X=z.normalImpulse,V=W.normalImpulse,$=O.x-L*z.rB.y-A.x+k*z.rA.y,J=O.y+L*z.rB.x-A.y-k*z.rA.x,K=O.x-L*W.rB.y-A.x+k*W.rA.y,Q=O.y+L*W.rB.x-A.y-k*W.rA.x,G=$*H+J*B,Y=K*H+Q*B,Z=G-z.velocityBias,et=Y-W.velocityBias;E=T.K,Z-=E.col1.x*X+E.col2.x*V,et-=E.col1.y*X+E.col2.y*V;var tt=.001;for(;;){E=T.normalMass;var nt=-(E.col1.x*Z+E.col2.x*et),rt=-(E.col1.y*Z+E.col2.y*et);if(nt>=0&&rt>=0){v=nt-X,m=rt-V,g=v*H,y=v*B,b=m*H,w=m*B,A.x-=M*(g+b),A.y-=M*(y+w),k-=_*(z.rA.x*y-z.rA.y*g+W.rA.x*w-W.rA.y*b),O.x+=D*(g+b),O.y+=D*(y+w),L+=P*(z.rB.x*y-z.rB.y*g+W.rB.x*w-W.rB.y*b),z.normalImpulse=nt,W.normalImpulse=rt;break}nt=-z.normalMass*Z,rt=0,G=0,Y=T.K.col1.y*nt+et;if(nt>=0&&Y>=0){v=nt-X,m=rt-V,g=v*H,y=v*B,b=m*H,w=m*B,A.x-=M*(g+b),A.y-=M*(y+w),k-=_*(z.rA.x*y-z.rA.y*g+W.rA.x*w-W.rA.y*b),O.x+=D*(g+b),O.y+=D*(y+w),L+=P*(z.rB.x*y-z.rB.y*g+W.rB.x*w-W.rB.y*b),z.normalImpulse=nt,W.normalImpulse=rt;break}nt=0,rt=-W.normalMass*et,G=T.K.col2.x*rt+Z,Y=0;if(rt>=0&&G>=0){v=nt-X,m=rt-V,g=v*H,y=v*B,b=m*H,w=m*B,A.x-=M*(g+b),A.y-=M*(y+w),k-=_*(z.rA.x*y-z.rA.y*g+W.rA.x*w-W.rA.y*b),O.x+=D*(g+b),O.y+=D*(y+w),L+=P*(z.rB.x*y-z.rB.y*g+W.rB.x*w-W.rB.y*b),z.normalImpulse=nt,W.normalImpulse=rt;break}nt=0,rt=0,G=Z,Y=et;if(G>=0&&Y>=0){v=nt-X,m=rt-V,g=v*H,y=v*B,b=m*H,w=m*B,A.x-=M*(g+b),A.y-=M*(y+w),k-=_*(z.rA.x*y-z.rA.y*g+W.rA.x*w-W.rA.y*b),O.x+=D*(g+b),O.y+=D*(y+w),L+=P*(z.rB.x*y-z.rB.y*g+W.rB.x*w-W.rB.y*b),z.normalImpulse=nt,W.normalImpulse=rt;break}break}}N.m_angularVelocity=k,C.m_angularVelocity=L}},d.prototype.FinalizeVelocityConstraints=function(){for(var e=0;e<this.m_constraintCount;++e){var t=this.m_constraints[e],n=t.manifold;for(var r=0;r<t.pointCount;++r){var i=n.m_points[r],s=t.points[r];i.m_normalImpulse=s.normalImpulse,i.m_tangentImpulse=s.tangentImpulse}}},d.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t=0;for(var n=0;n<this.m_constraintCount;n++){var r=this.m_constraints[n],i=r.bodyA,s=r.bodyB,o=i.m_mass*i.m_invMass,u=i.m_mass*i.m_invI,a=s.m_mass*s.m_invMass,f=s.m_mass*s.m_invI;d.s_psm.Initialize(r);var l=d.s_psm.m_normal;for(var c=0;c<r.pointCount;c++){var h=r.points[c],p=d.s_psm.m_points[c],v=d.s_psm.m_separations[c],m=p.x-i.m_sweep.c.x,g=p.y-i.m_sweep.c.y,y=p.x-s.m_sweep.c.x,b=p.y-s.m_sweep.c.y;t=t<v?t:v;var w=q.Clamp(e*(v+j.b2_linearSlop),-j.b2_maxLinearCorrection,0),E=-h.equalizedMass*w,S=E*l.x,x=E*l.y;i.m_sweep.c.x-=o*S,i.m_sweep.c.y-=o*x,i.m_sweep.a-=u*(m*x-g*S),i.SynchronizeTransform(),s.m_sweep.c.x+=a*S,s.m_sweep.c.y+=a*x,s.m_sweep.a+=f*(y*x-b*S),s.SynchronizeTransform()}}return t>-1.5*j.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new gt,Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new w}),Box2D.inherit(v,Box2D.Dynamics.Contacts.b2Contact),v.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,v.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},v.Create=function(e){return new v},v.Destroy=function(e,t){},v.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},v.prototype.Evaluate=function(){var t=this.m_fixtureA.GetBody(),r=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,r.m_xf)},v.prototype.b2CollideEdgeAndCircle=function(e,t,n,r,i){},Box2D.inherit(m,Box2D.Dynamics.Contacts.b2Contact),m.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,m.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},m.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)},m.prototype.Evaluate=function(){},Box2D.inherit(g,Box2D.Dynamics.Contacts.b2Contact),g.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,g.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},g.Create=function(e){return new g},g.Destroy=function(e,t){},g.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t),j.b2Assert(e.GetType()==s.e_polygonShape),j.b2Assert(t.GetType()==s.e_circleShape)},g.prototype.Evaluate=function(){var t=this.m_fixtureA.m_body,n=this.m_fixtureB.m_body;J.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,t.m_xf,this.m_fixtureB.GetShape()instanceof e?this.m_fixtureB.GetShape():null,n.m_xf)},Box2D.inherit(y,Box2D.Dynamics.Contacts.b2Contact),y.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,y.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},y.Create=function(e){return new y},y.Destroy=function(e,t){},y.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t),j.b2Assert(e.GetType()==s.e_polygonShape),j.b2Assert(t.GetType()==s.e_edgeShape)},y.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof n?this.m_fixtureB.GetShape():null,t.m_xf)},y.prototype.b2CollidePolyAndEdge=function(e,t,n,r,i){},Box2D.inherit(b,Box2D.Dynamics.Contacts.b2Contact),b.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype,b.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)},b.Create=function(e){return new b},b.Destroy=function(e,t){},b.prototype.Reset=function(e,t){this.__super.Reset.call(this,e,t)},b.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();J.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof i?this.m_fixtureA.GetShape():null,e.m_xf,this.m_fixtureB.GetShape()instanceof i?this.m_fixtureB.GetShape():null,t.m_xf)},w.b2PositionSolverManifold=function(){},w.prototype.b2PositionSolverManifold=function(){this.m_normal=new z,this.m_separations=new Vector_a2j_Number(j.b2_maxManifoldPoints),this.m_points=new Vector(j.b2_maxManifoldPoints);for(var e=0;e<j.b2_maxManifoldPoints;e++)this.m_points[e]=new z},w.prototype.Initialize=function(e){j.b2Assert(e.pointCount>0);var t=0,n=0,r=0,i,s,o=0,u=0;switch(e.type){case st.e_circles:i=e.bodyA.m_xf.R,s=e.localPoint;var a=e.bodyA.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y),f=e.bodyA.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y);i=e.bodyB.m_xf.R,s=e.points[0].localPoint;var l=e.bodyB.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y),c=e.bodyB.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y),h=l-a,p=c-f,d=h*h+p*p;if(d>Number.MIN_VALUE*Number.MIN_VALUE){var v=Math.sqrt(d);this.m_normal.x=h/v,this.m_normal.y=p/v}else this.m_normal.x=1,this.m_normal.y=0;this.m_points[0].x=.5*(a+l),this.m_points[0].y=.5*(f+c),this.m_separations[0]=h*this.m_normal.x+p*this.m_normal.y-e.radius;break;case st.e_faceA:i=e.bodyA.m_xf.R,s=e.localPlaneNormal,this.m_normal.x=i.col1.x*s.x+i.col2.x*s.y,this.m_normal.y=i.col1.y*s.x+i.col2.y*s.y,i=e.bodyA.m_xf.R,s=e.localPoint,o=e.bodyA.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y),u=e.bodyA.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y),i=e.bodyB.m_xf.R;for(t=0;t<e.pointCount;++t)s=e.points[t].localPoint,n=e.bodyB.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y),r=e.bodyB.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y),this.m_separations[t]=(n-o)*this.m_normal.x+(r-u)*this.m_normal.y-e.radius,this.m_points[t].x=n,this.m_points[t].y=r;break;case st.e_faceB:i=e.bodyB.m_xf.R,s=e.localPlaneNormal,this.m_normal.x=i.col1.x*s.x+i.col2.x*s.y,this.m_normal.y=i.col1.y*s.x+i.col2.y*s.y,i=e.bodyB.m_xf.R,s=e.localPoint,o=e.bodyB.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y),u=e.bodyB.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y),i=e.bodyA.m_xf.R;for(t=0;t<e.pointCount;++t)s=e.points[t].localPoint,n=e.bodyA.m_xf.position.x+(i.col1.x*s.x+i.col2.x*s.y),r=e.bodyA.m_xf.position.y+(i.col1.y*s.x+i.col2.y*s.y),this.m_separations[t]=(n-o)*this.m_normal.x+(r-u)*this.m_normal.y-e.radius,this.m_points[t].Set(n,r);this.m_normal.x*=-1,this.m_normal.y*=-1}},Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new z,Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=new z})}(),function(){var e=Box2D.Dynamics.b2Body,t=Box2D.Dynamics.b2BodyDef,n=Box2D.Dynamics.b2ContactFilter,r=Box2D.Dynamics.b2ContactImpulse,i=Box2D.Dynamics.b2ContactListener,s=Box2D.Dynamics.b2ContactManager,o=Box2D.Dynamics.b2DebugDraw,u=Box2D.Dynamics.b2DestructionListener,a=Box2D.Dynamics.b2FilterData,f=Box2D.Dynamics.b2Fixture,l=Box2D.Dynamics.b2FixtureDef,c=Box2D.Dynamics.b2Island,h=Box2D.Dynamics.b2TimeStep,p=Box2D.Dynamics.b2World,d=Box2D.Common.Math.b2Mat22,v=Box2D.Common.Math.b2Mat33,m=Box2D.Common.Math.b2Math,g=Box2D.Common.Math.b2Sweep,y=Box2D.Common.Math.b2Transform,b=Box2D.Common.Math.b2Vec2,w=Box2D.Common.Math.b2Vec3,E=Box2D.Common.b2Color,S=Box2D.Common.b2internal,x=Box2D.Common.b2Settings,T=Box2D.Collision.Shapes.b2CircleShape,N=Box2D.Collision.Shapes.b2EdgeChainDef,C=Box2D.Collision.Shapes.b2EdgeShape,k=Box2D.Collision.Shapes.b2MassData,L=Box2D.Collision.Shapes.b2PolygonShape,A=Box2D.Collision.Shapes.b2Shape,O=Box2D.Dynamics.Controllers.b2BuoyancyController,M=Box2D.Dynamics.Controllers.b2ConstantAccelController,_=Box2D.Dynamics.Controllers.b2ConstantForceController,D=Box2D.Dynamics.Controllers.b2Controller,P=Box2D.Dynamics.Controllers.b2ControllerEdge,H=Box2D.Dynamics.Controllers.b2GravityController,B=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(O,Box2D.Dynamics.Controllers.b2Controller),O.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,O.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.normal=new b(0,-1),this.offset=0,this.density=0,this.velocity=new b(0,0),this.linearDrag=2,this.angularDrag=1,this.useDensity=!1,this.useWorldGravity=!0,this.gravity=null},O.prototype.Step=function(e){if(!this.m_bodyList)return;this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var t=this.m_bodyList;t;t=t.nextBody){var n=t.body;if(n.IsAwake()==0)continue;var r=new b,i=new b,s=0,o=0;for(var u=n.GetFixtureList();u;u=u.GetNext()){var a=new b,f=u.GetShape().ComputeSubmergedArea(this.normal,this.offset,n.GetTransform(),a);s+=f,r.x+=f*a.x,r.y+=f*a.y;var l=0;this.useDensity?l=1:l=1,o+=f*l,i.x+=f*a.x*l,i.y+=f*a.y*l}r.x/=s,r.y/=s,i.x/=o,i.y/=o;if(s<Number.MIN_VALUE)continue;var c=this.gravity.GetNegative();c.Multiply(this.density*s),n.ApplyForce(c,i);var h=n.GetLinearVelocityFromWorldPoint(r);h.Subtract(this.velocity),h.Multiply(-this.linearDrag*s),n.ApplyForce(h,r),n.ApplyTorque(-n.GetInertia()/n.GetMass()*s*n.GetAngularVelocity()*this.angularDrag)}},O.prototype.Draw=function(e){var t=1e3,n=new b,r=new b;n.x=this.normal.x*this.offset+this.normal.y*t,n.y=this.normal.y*this.offset-this.normal.x*t,r.x=this.normal.x*this.offset-this.normal.y*t,r.y=this.normal.y*this.offset+this.normal.x*t;var i=new E(0,0,1);e.DrawSegment(n,r,i)},Box2D.inherit(M,Box2D.Dynamics.Controllers.b2Controller),M.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,M.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.A=new b(0,0)},M.prototype.Step=function(e){var t=new b(this.A.x*e.dt,this.A.y*e.dt);for(var n=this.m_bodyList;n;n=n.nextBody){var r=n.body;if(!r.IsAwake())continue;r.SetLinearVelocity(new b(r.GetLinearVelocity().x+t.x,r.GetLinearVelocity().y+t.y))}},Box2D.inherit(_,Box2D.Dynamics.Controllers.b2Controller),_.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,_.b2ConstantForceController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.F=new b(0,0)},_.prototype.Step=function(e){for(var t=this.m_bodyList;t;t=t.nextBody){var n=t.body;if(!n.IsAwake())continue;n.ApplyForce(this.F,n.GetWorldCenter())}},D.b2Controller=function(){},D.prototype.Step=function(e){},D.prototype.Draw=function(e){},D.prototype.AddBody=function(e){var t=new P;t.controller=this,t.body=e,t.nextBody=this.m_bodyList,t.prevBody=null,this.m_bodyList=t,t.nextBody&&(t.nextBody.prevBody=t),this.m_bodyCount++,t.nextController=e.m_controllerList,t.prevController=null,e.m_controllerList=t,t.nextController&&(t.nextController.prevController=t),e.m_controllerCount++},D.prototype.RemoveBody=function(e){var t=e.m_controllerList;while(t&&t.controller!=this)t=t.nextController;t.prevBody&&(t.prevBody.nextBody=t.nextBody),t.nextBody&&(t.nextBody.prevBody=t.prevBody),t.nextController&&(t.nextController.prevController=t.prevController),t.prevController&&(t.prevController.nextController=t.nextController),this.m_bodyList==t&&(this.m_bodyList=t.nextBody),e.m_controllerList==t&&(e.m_controllerList=t.nextController),e.m_controllerCount--,this.m_bodyCount--},D.prototype.Clear=function(){while(this.m_bodyList)this.RemoveBody(this.m_bodyList.body)},D.prototype.GetNext=function(){return this.m_next},D.prototype.GetWorld=function(){return this.m_world},D.prototype.GetBodyList=function(){return this.m_bodyList},P.b2ControllerEdge=function(){},Box2D.inherit(H,Box2D.Dynamics.Controllers.b2Controller),H.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,H.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.G=1,this.invSqr=!0},H.prototype.Step=function(e){var t=null,n=null,r=null,i=0,s=null,o=null,u=null,a=0,f=0,l=0,c=null;if(this.invSqr)for(t=this.m_bodyList;t;t=t.nextBody){n=t.body,r=n.GetWorldCenter(),i=n.GetMass();for(s=this.m_bodyList;s!=t;s=s.nextBody){o=s.body,u=o.GetWorldCenter(),a=u.x-r.x,f=u.y-r.y,l=a*a+f*f;if(l<Number.MIN_VALUE)continue;c=new b(a,f),c.Multiply(this.G/l/Math.sqrt(l)*i*o.GetMass()),n.IsAwake()&&n.ApplyForce(c,r),c.Multiply(-1),o.IsAwake()&&o.ApplyForce(c,u)}}else for(t=this.m_bodyList;t;t=t.nextBody){n=t.body,r=n.GetWorldCenter(),i=n.GetMass();for(s=this.m_bodyList;s!=t;s=s.nextBody){o=s.body,u=o.GetWorldCenter(),a=u.x-r.x,f=u.y-r.y,l=a*a+f*f;if(l<Number.MIN_VALUE)continue;c=new b(a,f),c.Multiply(this.G/l*i*o.GetMass()),n.IsAwake()&&n.ApplyForce(c,r),c.Multiply(-1),o.IsAwake()&&o.ApplyForce(c,u)}}},Box2D.inherit(B,Box2D.Dynamics.Controllers.b2Controller),B.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype,B.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments),this.T=new d,this.maxTimestep=0},B.prototype.SetAxisAligned=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.T.col1.x=-e,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-t,e>0||t>0?this.maxTimestep=1/Math.max(e,t):this.maxTimestep=0},B.prototype.Step=function(e){var t=e.dt;if(t<=Number.MIN_VALUE)return;t>this.maxTimestep&&this.maxTimestep>0&&(t=this.maxTimestep);for(var n=this.m_bodyList;n;n=n.nextBody){var r=n.body;if(!r.IsAwake())continue;var i=r.GetWorldVector(m.MulMV(this.T,r.GetLocalVector(r.GetLinearVelocity())));r.SetLinearVelocity(new b(r.GetLinearVelocity().x+i.x*t,r.GetLinearVelocity().y+i.y*t))}}}(),function(){var e=Box2D.Common.b2Color,t=Box2D.Common.b2internal,n=Box2D.Common.b2Settings,r=Box2D.Common.Math.b2Mat22,i=Box2D.Common.Math.b2Mat33,s=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,u=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,f=Box2D.Common.Math.b2Vec3,l=Box2D.Dynamics.Joints.b2DistanceJoint,c=Box2D.Dynamics.Joints.b2DistanceJointDef,h=Box2D.Dynamics.Joints.b2FrictionJoint,p=Box2D.Dynamics.Joints.b2FrictionJointDef,d=Box2D.Dynamics.Joints.b2GearJoint,v=Box2D.Dynamics.Joints.b2GearJointDef,m=Box2D.Dynamics.Joints.b2Jacobian,g=Box2D.Dynamics.Joints.b2Joint,y=Box2D.Dynamics.Joints.b2JointDef,b=Box2D.Dynamics.Joints.b2JointEdge,w=Box2D.Dynamics.Joints.b2LineJoint,E=Box2D.Dynamics.Joints.b2LineJointDef,S=Box2D.Dynamics.Joints.b2MouseJoint,x=Box2D.Dynamics.Joints.b2MouseJointDef,T=Box2D.Dynamics.Joints.b2PrismaticJoint,N=Box2D.Dynamics.Joints.b2PrismaticJointDef,C=Box2D.Dynamics.Joints.b2PulleyJoint,k=Box2D.Dynamics.Joints.b2PulleyJointDef,L=Box2D.Dynamics.Joints.b2RevoluteJoint,A=Box2D.Dynamics.Joints.b2RevoluteJointDef,O=Box2D.Dynamics.Joints.b2WeldJoint,M=Box2D.Dynamics.Joints.b2WeldJointDef,_=Box2D.Dynamics.b2Body,D=Box2D.Dynamics.b2BodyDef,P=Box2D.Dynamics.b2ContactFilter,H=Box2D.Dynamics.b2ContactImpulse,B=Box2D.Dynamics.b2ContactListener,j=Box2D.Dynamics.b2ContactManager,F=Box2D.Dynamics.b2DebugDraw,I=Box2D.Dynamics.b2DestructionListener,q=Box2D.Dynamics.b2FilterData,R=Box2D.Dynamics.b2Fixture,U=Box2D.Dynamics.b2FixtureDef,z=Box2D.Dynamics.b2Island,W=Box2D.Dynamics.b2TimeStep,X=Box2D.Dynamics.b2World;Box2D.inherit(l,Box2D.Dynamics.Joints.b2Joint),l.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,l.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new a,this.m_localAnchor2=new a,this.m_u=new a},l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},l.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new a(e*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)},l.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),0},l.prototype.GetLength=function(){return this.m_length},l.prototype.SetLength=function(e){e===undefined&&(e=0),this.m_length=e},l.prototype.GetFrequency=function(){return this.m_frequencyHz},l.prototype.SetFrequency=function(e){e===undefined&&(e=0),this.m_frequencyHz=e},l.prototype.GetDampingRatio=function(){return this.m_dampingRatio},l.prototype.SetDampingRatio=function(e){e===undefined&&(e=0),this.m_dampingRatio=e},l.prototype.b2DistanceJoint=function(e){this.__super.b2Joint.call(this,e);var t,n=0,r=0;this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_length=e.length,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0},l.prototype.InitVelocityConstraints=function(e){var t,r=0,i=this.m_bodyA,s=this.m_bodyB;t=i.m_xf.R;var o=this.m_localAnchor1.x-i.m_sweep.localCenter.x,u=this.m_localAnchor1.y-i.m_sweep.localCenter.y;r=t.col1.x*o+t.col2.x*u,u=t.col1.y*o+t.col2.y*u,o=r,t=s.m_xf.R;var a=this.m_localAnchor2.x-s.m_sweep.localCenter.x,f=this.m_localAnchor2.y-s.m_sweep.localCenter.y;r=t.col1.x*a+t.col2.x*f,f=t.col1.y*a+t.col2.y*f,a=r,this.m_u.x=s.m_sweep.c.x+a-i.m_sweep.c.x-o,this.m_u.y=s.m_sweep.c.y+f-i.m_sweep.c.y-u;var l=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);l>n.b2_linearSlop?this.m_u.Multiply(1/l):this.m_u.SetZero();var c=o*this.m_u.y-u*this.m_u.x,h=a*this.m_u.y-f*this.m_u.x,p=i.m_invMass+i.m_invI*c*c+s.m_invMass+s.m_invI*h*h;this.m_mass=p!=0?1/p:0;if(this.m_frequencyHz>0){var d=l-this.m_length,v=2*Math.PI*this.m_frequencyHz,m=2*this.m_mass*this.m_dampingRatio*v,g=this.m_mass*v*v;this.m_gamma=e.dt*(m+e.dt*g),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=d*e.dt*g*this.m_gamma,this.m_mass=p+this.m_gamma,this.m_mass=this.m_mass!=0?1/this.m_mass:0}if(e.warmStarting){this.m_impulse*=e.dtRatio;var y=this.m_impulse*this.m_u.x,b=this.m_impulse*this.m_u.y;i.m_linearVelocity.x-=i.m_invMass*y,i.m_linearVelocity.y-=i.m_invMass*b,i.m_angularVelocity-=i.m_invI*(o*b-u*y),s.m_linearVelocity.x+=s.m_invMass*y,s.m_linearVelocity.y+=s.m_invMass*b,s.m_angularVelocity+=s.m_invI*(a*b-f*y)}else this.m_impulse=0},l.prototype.SolveVelocityConstraints=function(e){var t,n=this.m_bodyA,r=this.m_bodyB;t=n.m_xf.R;var i=this.m_localAnchor1.x-n.m_sweep.localCenter.x,s=this.m_localAnchor1.y-n.m_sweep.localCenter.y,o=t.col1.x*i+t.col2.x*s;s=t.col1.y*i+t.col2.y*s,i=o,t=r.m_xf.R;var u=this.m_localAnchor2.x-r.m_sweep.localCenter.x,a=this.m_localAnchor2.y-r.m_sweep.localCenter.y;o=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=o;var f=n.m_linearVelocity.x+ -n.m_angularVelocity*s,l=n.m_linearVelocity.y+n.m_angularVelocity*i,c=r.m_linearVelocity.x+ -r.m_angularVelocity*a,h=r.m_linearVelocity.y+r.m_angularVelocity*u,p=this.m_u.x*(c-f)+this.m_u.y*(h-l),d=-this.m_mass*(p+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=d;var v=d*this.m_u.x,m=d*this.m_u.y;n.m_linearVelocity.x-=n.m_invMass*v,n.m_linearVelocity.y-=n.m_invMass*m,n.m_angularVelocity-=n.m_invI*(i*m-s*v),r.m_linearVelocity.x+=r.m_invMass*v,r.m_linearVelocity.y+=r.m_invMass*m,r.m_angularVelocity+=r.m_invI*(u*m-a*v)},l.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t;if(this.m_frequencyHz>0)return!0;var r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var o=this.m_localAnchor1.x-r.m_sweep.localCenter.x,u=this.m_localAnchor1.y-r.m_sweep.localCenter.y,a=t.col1.x*o+t.col2.x*u;u=t.col1.y*o+t.col2.y*u,o=a,t=i.m_xf.R;var f=this.m_localAnchor2.x-i.m_sweep.localCenter.x,l=this.m_localAnchor2.y-i.m_sweep.localCenter.y;a=t.col1.x*f+t.col2.x*l,l=t.col1.y*f+t.col2.y*l,f=a;var c=i.m_sweep.c.x+f-r.m_sweep.c.x-o,h=i.m_sweep.c.y+l-r.m_sweep.c.y-u,p=Math.sqrt(c*c+h*h);c/=p,h/=p;var d=p-this.m_length;d=s.Clamp(d,-n.b2_maxLinearCorrection,n.b2_maxLinearCorrection);var v=-this.m_mass*d;this.m_u.Set(c,h);var m=v*this.m_u.x,g=v*this.m_u.y;return r.m_sweep.c.x-=r.m_invMass*m,r.m_sweep.c.y-=r.m_invMass*g,r.m_sweep.a-=r.m_invI*(o*g-u*m),i.m_sweep.c.x+=i.m_invMass*m,i.m_sweep.c.y+=i.m_invMass*g,i.m_sweep.a+=i.m_invI*(f*g-l*m),r.SynchronizeTransform(),i.SynchronizeTransform(),s.Abs(d)<n.b2_linearSlop},Box2D.inherit(c,Box2D.Dynamics.Joints.b2JointDef),c.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,c.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new a,this.localAnchorB=new a},c.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_distanceJoint,this.length=1,this.frequencyHz=0,this.dampingRatio=0},c.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(r));var i=r.x-n.x,s=r.y-n.y;this.length=Math.sqrt(i*i+s*s),this.frequencyHz=0,this.dampingRatio=0},Box2D.inherit(h,Box2D.Dynamics.Joints.b2Joint),h.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,h.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new a,this.m_localAnchorB=new a,this.m_linearMass=new r,this.m_linearImpulse=new a},h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},h.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new a(e*this.m_linearImpulse.x,e*this.m_linearImpulse.y)},h.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_angularImpulse},h.prototype.SetMaxForce=function(e){e===undefined&&(e=0),this.m_maxForce=e},h.prototype.GetMaxForce=function(){return this.m_maxForce},h.prototype.SetMaxTorque=function(e){e===undefined&&(e=0),this.m_maxTorque=e},h.prototype.GetMaxTorque=function(){return this.m_maxTorque},h.prototype.b2FrictionJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=e.maxForce,this.m_maxTorque=e.maxTorque},h.prototype.InitVelocityConstraints=function(e){var t,n=0,i=this.m_bodyA,s=this.m_bodyB;t=i.m_xf.R;var o=this.m_localAnchorA.x-i.m_sweep.localCenter.x,u=this.m_localAnchorA.y-i.m_sweep.localCenter.y;n=t.col1.x*o+t.col2.x*u,u=t.col1.y*o+t.col2.y*u,o=n,t=s.m_xf.R;var a=this.m_localAnchorB.x-s.m_sweep.localCenter.x,f=this.m_localAnchorB.y-s.m_sweep.localCenter.y;n=t.col1.x*a+t.col2.x*f,f=t.col1.y*a+t.col2.y*f,a=n;var l=i.m_invMass,c=s.m_invMass,h=i.m_invI,p=s.m_invI,d=new r;d.col1.x=l+c,d.col2.x=0,d.col1.y=0,d.col2.y=l+c,d.col1.x+=h*u*u,d.col2.x+=-h*o*u,d.col1.y+=-h*o*u,d.col2.y+=h*o*o,d.col1.x+=p*f*f,d.col2.x+=-p*a*f,d.col1.y+=-p*a*f,d.col2.y+=p*a*a,d.GetInverse(this.m_linearMass),this.m_angularMass=h+p,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass);if(e.warmStarting){this.m_linearImpulse.x*=e.dtRatio,this.m_linearImpulse.y*=e.dtRatio,this.m_angularImpulse*=e.dtRatio;var v=this.m_linearImpulse;i.m_linearVelocity.x-=l*v.x,i.m_linearVelocity.y-=l*v.y,i.m_angularVelocity-=h*(o*v.y-u*v.x+this.m_angularImpulse),s.m_linearVelocity.x+=c*v.x,s.m_linearVelocity.y+=c*v.y,s.m_angularVelocity+=p*(a*v.y-f*v.x+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0},h.prototype.SolveVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,i=this.m_bodyB,o=r.m_linearVelocity,u=r.m_angularVelocity,f=i.m_linearVelocity,l=i.m_angularVelocity,c=r.m_invMass,h=i.m_invMass,p=r.m_invI,d=i.m_invI;t=r.m_xf.R;var v=this.m_localAnchorA.x-r.m_sweep.localCenter.x,m=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*v+t.col2.x*m,m=t.col1.y*v+t.col2.y*m,v=n,t=i.m_xf.R;var g=this.m_localAnchorB.x-i.m_sweep.localCenter.x,y=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*g+t.col2.x*y,y=t.col1.y*g+t.col2.y*y,g=n;var b=0,w=l-u,E=-this.m_angularMass*w,S=this.m_angularImpulse;b=e.dt*this.m_maxTorque,this.m_angularImpulse=s.Clamp(this.m_angularImpulse+E,-b,b),E=this.m_angularImpulse-S,u-=p*E,l+=d*E;var x=f.x-l*y-o.x+u*m,T=f.y+l*g-o.y-u*v,N=s.MulMV(this.m_linearMass,new a(-x,-T)),C=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(N),b=e.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(b)),N=s.SubtractVV(this.m_linearImpulse,C),o.x-=c*N.x,o.y-=c*N.y,u-=p*(v*N.y-m*N.x),f.x+=h*N.x,f.y+=h*N.y,l+=d*(g*N.y-y*N.x),r.m_angularVelocity=u,i.m_angularVelocity=l},h.prototype.SolvePositionConstraints=function(e){return e===undefined&&(e=0),!0},Box2D.inherit(p,Box2D.Dynamics.Joints.b2JointDef),p.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,p.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new a,this.localAnchorB=new a},p.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_frictionJoint,this.maxForce=0,this.maxTorque=0},p.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n))},Box2D.inherit(d,Box2D.Dynamics.Joints.b2Joint),d.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,d.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new a,this.m_groundAnchor2=new a,this.m_localAnchor1=new a,this.m_localAnchor2=new a,this.m_J=new m},d.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},d.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},d.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new a(e*this.m_impulse*this.m_J.linearB.x,e*this.m_impulse*this.m_J.linearB.y)},d.prototype.GetReactionTorque=function(e){e===undefined&&(e=0);var t=this.m_bodyB.m_xf.R,n=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,r=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,i=t.col1.x*n+t.col2.x*r;r=t.col1.y*n+t.col2.y*r,n=i;var s=this.m_impulse*this.m_J.linearB.x,o=this.m_impulse*this.m_J.linearB.y;return e*(this.m_impulse*this.m_J.angularB-n*o+r*s)},d.prototype.GetRatio=function(){return this.m_ratio},d.prototype.SetRatio=function(e){e===undefined&&(e=0),this.m_ratio=e},d.prototype.b2GearJoint=function(e){this.__super.b2Joint.call(this,e);var t=parseInt(e.joint1.m_type),n=parseInt(e.joint2.m_type);this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null;var r=0,i=0;this.m_ground1=e.joint1.GetBodyA(),this.m_bodyA=e.joint1.GetBodyB(),t==g.e_revoluteJoint?(this.m_revolute1=e.joint1 instanceof L?e.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),r=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=e.joint1 instanceof T?e.joint1:null,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),r=this.m_prismatic1.GetJointTranslation()),this.m_ground2=e.joint2.GetBodyA(),this.m_bodyB=e.joint2.GetBodyB(),n==g.e_revoluteJoint?(this.m_revolute2=e.joint2 instanceof L?e.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),i=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=e.joint2 instanceof T?e.joint2:null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),i=this.m_prismatic2.GetJointTranslation()),this.m_ratio=e.ratio,this.m_constant=r+this.m_ratio*i,this.m_impulse=0},d.prototype.InitVelocityConstraints=function(e){var t=this.m_ground1,n=this.m_ground2,r=this.m_bodyA,i=this.m_bodyB,s=0,o=0,u=0,a=0,f,l,c=0,h=0,p=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,p+=r.m_invI):(f=t.m_xf.R,l=this.m_prismatic1.m_localXAxis1,s=f.col1.x*l.x+f.col2.x*l.y,o=f.col1.y*l.x+f.col2.y*l.y,f=r.m_xf.R,u=this.m_localAnchor1.x-r.m_sweep.localCenter.x,a=this.m_localAnchor1.y-r.m_sweep.localCenter.y,h=f.col1.x*u+f.col2.x*a,a=f.col1.y*u+f.col2.y*a,u=h,c=u*o-a*s,this.m_J.linearA.Set(-s,-o),this.m_J.angularA=-c,p+=r.m_invMass+r.m_invI*c*c),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,p+=this.m_ratio*this.m_ratio*i.m_invI):(f=n.m_xf.R,l=this.m_prismatic2.m_localXAxis1,s=f.col1.x*l.x+f.col2.x*l.y,o=f.col1.y*l.x+f.col2.y*l.y,f=i.m_xf.R,u=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y,h=f.col1.x*u+f.col2.x*a,a=f.col1.y*u+f.col2.y*a,u=h,c=u*o-a*s,this.m_J.linearB.Set(-this.m_ratio*s,-this.m_ratio*o),this.m_J.angularB=-this.m_ratio*c,p+=this.m_ratio*this.m_ratio*(i.m_invMass+i.m_invI*c*c)),this.m_mass=p>0?1/p:0,e.warmStarting?(r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearA.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearA.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularA,i.m_linearVelocity.x+=i.m_invMass*this.m_impulse*this.m_J.linearB.x,i.m_linearVelocity.y+=i.m_invMass*this.m_impulse*this.m_J.linearB.y,i.m_angularVelocity+=i.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},d.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=this.m_J.Compute(t.m_linearVelocity,t.m_angularVelocity,n.m_linearVelocity,n.m_angularVelocity),i=-this.m_mass*r;this.m_impulse+=i,t.m_linearVelocity.x+=t.m_invMass*i*this.m_J.linearA.x,t.m_linearVelocity.y+=t.m_invMass*i*this.m_J.linearA.y,t.m_angularVelocity+=t.m_invI*i*this.m_J.angularA,n.m_linearVelocity.x+=n.m_invMass*i*this.m_J.linearB.x,n.m_linearVelocity.y+=n.m_invMass*i*this.m_J.linearB.y,n.m_angularVelocity+=n.m_invI*i*this.m_J.angularB},d.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t=0,r=this.m_bodyA,i=this.m_bodyB,s=0,o=0;this.m_revolute1?s=this.m_revolute1.GetJointAngle():s=this.m_prismatic1.GetJointTranslation(),this.m_revolute2?o=this.m_revolute2.GetJointAngle():o=this.m_prismatic2.GetJointTranslation();var u=this.m_constant-(s+this.m_ratio*o),a=-this.m_mass*u;return r.m_sweep.c.x+=r.m_invMass*a*this.m_J.linearA.x,r.m_sweep.c.y+=r.m_invMass*a*this.m_J.linearA.y,r.m_sweep.a+=r.m_invI*a*this.m_J.angularA,i.m_sweep.c.x+=i.m_invMass*a*this.m_J.linearB.x,i.m_sweep.c.y+=i.m_invMass*a*this.m_J.linearB.y,i.m_sweep.a+=i.m_invI*a*this.m_J.angularB,r.SynchronizeTransform(),i.SynchronizeTransform(),t<n.b2_linearSlop},Box2D.inherit(v,Box2D.Dynamics.Joints.b2JointDef),v.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,v.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)},v.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},m.b2Jacobian=function(){this.linearA=new a,this.linearB=new a},m.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},m.prototype.Set=function(e,t,n,r){t===undefined&&(t=0),r===undefined&&(r=0),this.linearA.SetV(e),this.angularA=t,this.linearB.SetV(n),this.angularB=r},m.prototype.Compute=function(e,t,n,r){return t===undefined&&(t=0),r===undefined&&(r=0),this.linearA.x*e.x+this.linearA.y*e.y+this.angularA*t+(this.linearB.x*n.x+this.linearB.y*n.y)+this.angularB*r},g.b2Joint=function(){this.m_edgeA=new b,this.m_edgeB=new b,this.m_localCenterA=new a,this.m_localCenterB=new a},g.prototype.GetType=function(){return this.m_type},g.prototype.GetAnchorA=function(){return null},g.prototype.GetAnchorB=function(){return null},g.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),null},g.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),0},g.prototype.GetBodyA=function(){return this.m_bodyA},g.prototype.GetBodyB=function(){return this.m_bodyB},g.prototype.GetNext=function(){return this.m_next},g.prototype.GetUserData=function(){return this.m_userData},g.prototype.SetUserData=function(e){this.m_userData=e},g.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},g.Create=function(e,t){var n=null;switch(e.type){case g.e_distanceJoint:n=new l(e instanceof c?e:null);break;case g.e_mouseJoint:n=new S(e instanceof x?e:null);break;case g.e_prismaticJoint:n=new T(e instanceof N?e:null);break;case g.e_revoluteJoint:n=new L(e instanceof A?e:null);break;case g.e_pulleyJoint:n=new C(e instanceof k?e:null);break;case g.e_gearJoint:n=new d(e instanceof v?e:null);break;case g.e_lineJoint:n=new w(e instanceof E?e:null);break;case g.e_weldJoint:n=new O(e instanceof M?e:null);break;case g.e_frictionJoint:n=new h(e instanceof p?e:null);break;default:}return n},g.Destroy=function(e,t){},g.prototype.b2Joint=function(e){n.b2Assert(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_prev=null,this.m_next=null,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=e.collideConnected,this.m_islandFlag=!1,this.m_userData=e.userData},g.prototype.InitVelocityConstraints=function(e){},g.prototype.SolveVelocityConstraints=function(e){},g.prototype.FinalizeVelocityConstraints=function(){},g.prototype.SolvePositionConstraints=function(e){return e===undefined&&(e=0),!1},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=0,Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1,Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2,Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3,Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4,Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5,Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6,Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7,Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8,Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9,Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0,Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=1,Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2,Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3}),y.b2JointDef=function(){},y.prototype.b2JointDef=function(){this.type=g.e_unknownJoint,this.userData=null,this.bodyA=null,this.bodyB=null,this.collideConnected=!1},b.b2JointEdge=function(){},Box2D.inherit(w,Box2D.Dynamics.Joints.b2Joint),w.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,w.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new a,this.m_localAnchor2=new a,this.m_localXAxis1=new a,this.m_localYAxis1=new a,this.m_axis=new a,this.m_perp=new a,this.m_K=new r,this.m_impulse=new a},w.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},w.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},w.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new a(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},w.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.y},w.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n,r=e.GetWorldPoint(this.m_localAnchor1),i=t.GetWorldPoint(this.m_localAnchor2),s=i.x-r.x,o=i.y-r.y,u=e.GetWorldVector(this.m_localXAxis1),a=u.x*s+u.y*o;return a},w.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s;var a=e.m_sweep.c.x+r,f=e.m_sweep.c.y+i,l=t.m_sweep.c.x+o,c=t.m_sweep.c.y+u,h=l-a,p=c-f,d=e.GetWorldVector(this.m_localXAxis1),v=e.m_linearVelocity,m=t.m_linearVelocity,g=e.m_angularVelocity,y=t.m_angularVelocity,b=h*-g*d.y+p*g*d.x+(d.x*(m.x+ -y*u-v.x- -g*i)+d.y*(m.y+y*o-v.y-g*r));return b},w.prototype.IsLimitEnabled=function(){return this.m_enableLimit},w.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},w.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},w.prototype.GetUpperLimit=function(){return this.m_upperTranslation},w.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},w.prototype.IsMotorEnabled=function(){return this.m_enableMotor},w.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},w.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},w.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},w.prototype.SetMaxMotorForce=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},w.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},w.prototype.GetMotorForce=function(){return this.m_motorImpulse},w.prototype.b2LineJoint=function(e){this.__super.b2Joint.call(this,e);var t,n=0,r=0;this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=g.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},w.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,r=this.m_bodyB,i,o=0;this.m_localCenterA.SetV(t.GetLocalCenter()),this.m_localCenterB.SetV(r.GetLocalCenter());var u=t.GetTransform(),a=r.GetTransform();i=t.m_xf.R;var f=this.m_localAnchor1.x-this.m_localCenterA.x,l=this.m_localAnchor1.y-this.m_localCenterA.y;o=i.col1.x*f+i.col2.x*l,l=i.col1.y*f+i.col2.y*l,f=o,i=r.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y;o=i.col1.x*c+i.col2.x*h,h=i.col1.y*c+i.col2.y*h,c=o;var p=r.m_sweep.c.x+c-t.m_sweep.c.x-f,d=r.m_sweep.c.y+h-t.m_sweep.c.y-l;this.m_invMassA=t.m_invMass,this.m_invMassB=r.m_invMass,this.m_invIA=t.m_invI,this.m_invIB=r.m_invI,this.m_axis.SetV(s.MulMV(u.R,this.m_localXAxis1)),this.m_a1=(p+f)*this.m_axis.y-(d+l)*this.m_axis.x,this.m_a2=c*this.m_axis.y-h*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(s.MulMV(u.R,this.m_localYAxis1)),this.m_s1=(p+f)*this.m_perp.y-(d+l)*this.m_perp.x,this.m_s2=c*this.m_perp.y-h*this.m_perp.x;var v=this.m_invMassA,m=this.m_invMassB,y=this.m_invIA,b=this.m_invIB;this.m_K.col1.x=v+m+y*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,this.m_K.col1.y=y*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=v+m+y*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2;if(this.m_enableLimit){var w=this.m_axis.x*p+this.m_axis.y*d;s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*n.b2_linearSlop?this.m_limitState=g.e_equalLimits:w<=this.m_lowerTranslation?this.m_limitState!=g.e_atLowerLimit&&(this.m_limitState=g.e_atLowerLimit,this.m_impulse.y=0):w>=this.m_upperTranslation?this.m_limitState!=g.e_atUpperLimit&&(this.m_limitState=g.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=g.e_inactiveLimit,this.m_impulse.y=0)}else this.m_limitState=g.e_inactiveLimit;this.m_enableMotor==0&&(this.m_motorImpulse=0);if(e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var E=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,S=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,x=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,T=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2;t.m_linearVelocity.x-=this.m_invMassA*E,t.m_linearVelocity.y-=this.m_invMassA*S,t.m_angularVelocity-=this.m_invIA*x,r.m_linearVelocity.x+=this.m_invMassB*E,r.m_linearVelocity.y+=this.m_invMassB*S,r.m_angularVelocity+=this.m_invIB*T}else this.m_impulse.SetZero(),this.m_motorImpulse=0},w.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=t.m_linearVelocity,i=t.m_angularVelocity,o=n.m_linearVelocity,u=n.m_angularVelocity,f=0,l=0,c=0,h=0;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits){var p=this.m_axis.x*(o.x-r.x)+this.m_axis.y*(o.y-r.y)+this.m_a2*u-this.m_a1*i,d=this.m_motorMass*(this.m_motorSpeed-p),v=this.m_motorImpulse,m=e.dt*this.m_maxMotorForce;this.m_motorImpulse=s.Clamp(this.m_motorImpulse+d,-m,m),d=this.m_motorImpulse-v,f=d*this.m_axis.x,l=d*this.m_axis.y,c=d*this.m_a1,h=d*this.m_a2,r.x-=this.m_invMassA*f,r.y-=this.m_invMassA*l,i-=this.m_invIA*c,o.x+=this.m_invMassB*f,o.y+=this.m_invMassB*l,u+=this.m_invIB*h}var y=this.m_perp.x*(o.x-r.x)+this.m_perp.y*(o.y-r.y)+this.m_s2*u-this.m_s1*i;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){var b=this.m_axis.x*(o.x-r.x)+this.m_axis.y*(o.y-r.y)+this.m_a2*u-this.m_a1*i,w=this.m_impulse.Copy(),E=this.m_K.Solve(new a,-y,-b);this.m_impulse.Add(E),this.m_limitState==g.e_atLowerLimit?this.m_impulse.y=s.Max(this.m_impulse.y,0):this.m_limitState==g.e_atUpperLimit&&(this.m_impulse.y=s.Min(this.m_impulse.y,0));var S=-y-(this.m_impulse.y-w.y)*this.m_K.col2.x,x=0;this.m_K.col1.x!=0?x=S/this.m_K.col1.x+w.x:x=w.x,this.m_impulse.x=x,E.x=this.m_impulse.x-w.x,E.y=this.m_impulse.y-w.y,f=E.x*this.m_perp.x+E.y*this.m_axis.x,l=E.x*this.m_perp.y+E.y*this.m_axis.y,c=E.x*this.m_s1+E.y*this.m_a1,h=E.x*this.m_s2+E.y*this.m_a2,r.x-=this.m_invMassA*f,r.y-=this.m_invMassA*l,i-=this.m_invIA*c,o.x+=this.m_invMassB*f,o.y+=this.m_invMassB*l,u+=this.m_invIB*h}else{var T=0;this.m_K.col1.x!=0?T=-y/this.m_K.col1.x:T=0,this.m_impulse.x+=T,f=T*this.m_perp.x,l=T*this.m_perp.y,c=T*this.m_s1,h=T*this.m_s2,r.x-=this.m_invMassA*f,r.y-=this.m_invMassA*l,i-=this.m_invIA*c,o.x+=this.m_invMassB*f,o.y+=this.m_invMassB*l,u+=this.m_invIB*h}t.m_linearVelocity.SetV(r),t.m_angularVelocity=i,n.m_linearVelocity.SetV(o),n.m_angularVelocity=u},w.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t=0,i=0,o=this.m_bodyA,u=this.m_bodyB,f=o.m_sweep.c,l=o.m_sweep.a,c=u.m_sweep.c,h=u.m_sweep.a,p,d=0,v=0,m=0,g=0,y=0,b=0,w=0,E=!1,S=0,x=r.FromAngle(l),T=r.FromAngle(h);p=x;var N=this.m_localAnchor1.x-this.m_localCenterA.x,C=this.m_localAnchor1.y-this.m_localCenterA.y;d=p.col1.x*N+p.col2.x*C,C=p.col1.y*N+p.col2.y*C,N=d,p=T;var k=this.m_localAnchor2.x-this.m_localCenterB.x,L=this.m_localAnchor2.y-this.m_localCenterB.y;d=p.col1.x*k+p.col2.x*L,L=p.col1.y*k+p.col2.y*L,k=d;var A=c.x+k-f.x-N,O=c.y+L-f.y-C;if(this.m_enableLimit){this.m_axis=s.MulMV(x,this.m_localXAxis1),this.m_a1=(A+N)*this.m_axis.y-(O+C)*this.m_axis.x,this.m_a2=k*this.m_axis.y-L*this.m_axis.x;var M=this.m_axis.x*A+this.m_axis.y*O;s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*n.b2_linearSlop?(S=s.Clamp(M,-n.b2_maxLinearCorrection,n.b2_maxLinearCorrection),b=s.Abs(M),E=!0):M<=this.m_lowerTranslation?(S=s.Clamp(M-this.m_lowerTranslation+n.b2_linearSlop,-n.b2_maxLinearCorrection,0),b=this.m_lowerTranslation-M,E=!0):M>=this.m_upperTranslation&&(S=s.Clamp(M-this.m_upperTranslation+n.b2_linearSlop,0,n.b2_maxLinearCorrection),b=M-this.m_upperTranslation,E=!0)}this.m_perp=s.MulMV(x,this.m_localYAxis1),this.m_s1=(A+N)*this.m_perp.y-(O+C)*this.m_perp.x,this.m_s2=k*this.m_perp.y-L*this.m_perp.x;var _=new a,D=this.m_perp.x*A+this.m_perp.y*O;b=s.Max(b,s.Abs(D)),w=0;if(E)v=this.m_invMassA,m=this.m_invMassB,g=this.m_invIA,y=this.m_invIB,this.m_K.col1.x=v+m+g*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,this.m_K.col1.y=g*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=v+m+g*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2,this.m_K.Solve(_,-D,-S);else{v=this.m_invMassA,m=this.m_invMassB,g=this.m_invIA,y=this.m_invIB;var P=v+m+g*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,H=0;P!=0?H=-D/P:H=0,_.x=H,_.y=0}var B=_.x*this.m_perp.x+_.y*this.m_axis.x,j=_.x*this.m_perp.y+_.y*this.m_axis.y,F=_.x*this.m_s1+_.y*this.m_a1,I=_.x*this.m_s2+_.y*this.m_a2;return f.x-=this.m_invMassA*B,f.y-=this.m_invMassA*j,l-=this.m_invIA*F,c.x+=this.m_invMassB*B,c.y+=this.m_invMassB*j,h+=this.m_invIB*I,o.m_sweep.a=l,u.m_sweep.a=h,o.SynchronizeTransform(),u.SynchronizeTransform(),b<=n.b2_linearSlop&&w<=n.b2_angularSlop},Box2D.inherit(E,Box2D.Dynamics.Joints.b2JointDef),E.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,E.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new a,this.localAnchorB=new a,this.localAxisA=new a},E.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},E.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r)},Box2D.inherit(S,Box2D.Dynamics.Joints.b2Joint),S.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,S.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new r,this.K1=new r,this.K2=new r,this.m_localAnchor=new a,this.m_target=new a,this.m_impulse=new a,this.m_mass=new r,this.m_C=new a},S.prototype.GetAnchorA=function(){return this.m_target},S.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},S.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new a(e*this.m_impulse.x,e*this.m_impulse.y)},S.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),0},S.prototype.GetTarget=function(){return this.m_target},S.prototype.SetTarget=function(e){this.m_bodyB.IsAwake()==0&&this.m_bodyB.SetAwake(!0),this.m_target=e},S.prototype.GetMaxForce=function(){return this.m_maxForce},S.prototype.SetMaxForce=function(e){e===undefined&&(e=0),this.m_maxForce=e},S.prototype.GetFrequency=function(){return this.m_frequencyHz},S.prototype.SetFrequency=function(e){e===undefined&&(e=0),this.m_frequencyHz=e},S.prototype.GetDampingRatio=function(){return this.m_dampingRatio},S.prototype.SetDampingRatio=function(e){e===undefined&&(e=0),this.m_dampingRatio=e},S.prototype.b2MouseJoint=function(e){this.__super.b2Joint.call(this,e),this.m_target.SetV(e.target);var t=this.m_target.x-this.m_bodyB.m_xf.position.x,n=this.m_target.y-this.m_bodyB.m_xf.position.y,r=this.m_bodyB.m_xf.R;this.m_localAnchor.x=t*r.col1.x+n*r.col1.y,this.m_localAnchor.y=t*r.col2.x+n*r.col2.y,this.m_maxForce=e.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_beta=0,this.m_gamma=0},S.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyB,n=t.GetMass(),r=2*Math.PI*this.m_frequencyHz,i=2*n*this.m_dampingRatio*r,s=n*r*r;this.m_gamma=e.dt*(i+e.dt*s),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_beta=e.dt*s*this.m_gamma;var o;o=t.m_xf.R;var u=this.m_localAnchor.x-t.m_sweep.localCenter.x,a=this.m_localAnchor.y-t.m_sweep.localCenter.y,f=o.col1.x*u+o.col2.x*a;a=o.col1.y*u+o.col2.y*a,u=f;var l=t.m_invMass,c=t.m_invI;this.K1.col1.x=l,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=l,this.K2.col1.x=c*a*a,this.K2.col2.x=-c*u*a,this.K2.col1.y=-c*u*a,this.K2.col2.y=c*u*u,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=t.m_sweep.c.x+u-this.m_target.x,this.m_C.y=t.m_sweep.c.y+a-this.m_target.y,t.m_angularVelocity*=.98,this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,t.m_linearVelocity.x+=l*this.m_impulse.x,t.m_linearVelocity.y+=l*this.m_impulse.y,t.m_angularVelocity+=c*(u*this.m_impulse.y-a*this.m_impulse.x)},S.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyB,n,r=0,i=0;n=t.m_xf.R;var s=this.m_localAnchor.x-t.m_sweep.localCenter.x,o=this.m_localAnchor.y-t.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*o,o=n.col1.y*s+n.col2.y*o,s=r;var u=t.m_linearVelocity.x+ -t.m_angularVelocity*o,a=t.m_linearVelocity.y+t.m_angularVelocity*s;n=this.m_mass,r=u+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,i=a+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;var f=-(n.col1.x*r+n.col2.x*i),l=-(n.col1.y*r+n.col2.y*i),c=this.m_impulse.x,h=this.m_impulse.y;this.m_impulse.x+=f,this.m_impulse.y+=l;var p=e.dt*this.m_maxForce;this.m_impulse.LengthSquared()>p*p&&this.m_impulse.Multiply(p/this.m_impulse.Length()),f=this.m_impulse.x-c,l=this.m_impulse.y-h,t.m_linearVelocity.x+=t.m_invMass*f,t.m_linearVelocity.y+=t.m_invMass*l,t.m_angularVelocity+=t.m_invI*(s*l-o*f)},S.prototype.SolvePositionConstraints=function(e){return e===undefined&&(e=0),!0},Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef),x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,x.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.target=new a},x.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},Box2D.inherit(T,Box2D.Dynamics.Joints.b2Joint),T.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,T.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchor1=new a,this.m_localAnchor2=new a,this.m_localXAxis1=new a,this.m_localYAxis1=new a,this.m_axis=new a,this.m_perp=new a,this.m_K=new i,this.m_impulse=new f},T.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},T.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},T.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new a(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},T.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.y},T.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n,r=e.GetWorldPoint(this.m_localAnchor1),i=t.GetWorldPoint(this.m_localAnchor2),s=i.x-r.x,o=i.y-r.y,u=e.GetWorldVector(this.m_localXAxis1),a=u.x*s+u.y*o;return a},T.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s;var a=e.m_sweep.c.x+r,f=e.m_sweep.c.y+i,l=t.m_sweep.c.x+o,c=t.m_sweep.c.y+u,h=l-a,p=c-f,d=e.GetWorldVector(this.m_localXAxis1),v=e.m_linearVelocity,m=t.m_linearVelocity,g=e.m_angularVelocity,y=t.m_angularVelocity,b=h*-g*d.y+p*g*d.x+(d.x*(m.x+ -y*u-v.x- -g*i)+d.y*(m.y+y*o-v.y-g*r));return b},T.prototype.IsLimitEnabled=function(){return this.m_enableLimit},T.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},T.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},T.prototype.GetUpperLimit=function(){return this.m_upperTranslation},T.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},T.prototype.IsMotorEnabled=function(){return this.m_enableMotor},T.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},T.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},T.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},T.prototype.SetMaxMotorForce=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},T.prototype.GetMotorForce=function(){return this.m_motorImpulse},T.prototype.b2PrismaticJoint=function(e){this.__super.b2Joint.call(this,e);var t,n=0,r=0;this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=g.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},T.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,r=this.m_bodyB,i,o=0;this.m_localCenterA.SetV(t.GetLocalCenter()),this.m_localCenterB.SetV(r.GetLocalCenter());var u=t.GetTransform(),a=r.GetTransform();i=t.m_xf.R;var f=this.m_localAnchor1.x-this.m_localCenterA.x,l=this.m_localAnchor1.y-this.m_localCenterA.y;o=i.col1.x*f+i.col2.x*l,l=i.col1.y*f+i.col2.y*l,f=o,i=r.m_xf.R;var c=this.m_localAnchor2.x-this.m_localCenterB.x,h=this.m_localAnchor2.y-this.m_localCenterB.y;o=i.col1.x*c+i.col2.x*h,h=i.col1.y*c+i.col2.y*h,c=o;var p=r.m_sweep.c.x+c-t.m_sweep.c.x-f,d=r.m_sweep.c.y+h-t.m_sweep.c.y-l;this.m_invMassA=t.m_invMass,this.m_invMassB=r.m_invMass,this.m_invIA=t.m_invI,this.m_invIB=r.m_invI,this.m_axis.SetV(s.MulMV(u.R,this.m_localXAxis1)),this.m_a1=(p+f)*this.m_axis.y-(d+l)*this.m_axis.x,this.m_a2=c*this.m_axis.y-h*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(s.MulMV(u.R,this.m_localYAxis1)),this.m_s1=(p+f)*this.m_perp.y-(d+l)*this.m_perp.x,this.m_s2=c*this.m_perp.y-h*this.m_perp.x;var v=this.m_invMassA,m=this.m_invMassB,y=this.m_invIA,b=this.m_invIB;this.m_K.col1.x=v+m+y*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,this.m_K.col1.y=y*this.m_s1+b*this.m_s2,this.m_K.col1.z=y*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=y+b,this.m_K.col2.z=y*this.m_a1+b*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=v+m+y*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2;if(this.m_enableLimit){var w=this.m_axis.x*p+this.m_axis.y*d;s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*n.b2_linearSlop?this.m_limitState=g.e_equalLimits:w<=this.m_lowerTranslation?this.m_limitState!=g.e_atLowerLimit&&(this.m_limitState=g.e_atLowerLimit,this.m_impulse.z=0):w>=this.m_upperTranslation?this.m_limitState!=g.e_atUpperLimit&&(this.m_limitState=g.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=g.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=g.e_inactiveLimit;this.m_enableMotor==0&&(this.m_motorImpulse=0);if(e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var E=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,S=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,x=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,T=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;t.m_linearVelocity.x-=this.m_invMassA*E,t.m_linearVelocity.y-=this.m_invMassA*S,t.m_angularVelocity-=this.m_invIA*x,r.m_linearVelocity.x+=this.m_invMassB*E,r.m_linearVelocity.y+=this.m_invMassB*S,r.m_angularVelocity+=this.m_invIB*T}else this.m_impulse.SetZero(),this.m_motorImpulse=0},T.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=t.m_linearVelocity,i=t.m_angularVelocity,o=n.m_linearVelocity,u=n.m_angularVelocity,l=0,c=0,h=0,p=0;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits){var d=this.m_axis.x*(o.x-r.x)+this.m_axis.y*(o.y-r.y)+this.m_a2*u-this.m_a1*i,v=this.m_motorMass*(this.m_motorSpeed-d),m=this.m_motorImpulse,y=e.dt*this.m_maxMotorForce;this.m_motorImpulse=s.Clamp(this.m_motorImpulse+v,-y,y),v=this.m_motorImpulse-m,l=v*this.m_axis.x,c=v*this.m_axis.y,h=v*this.m_a1,p=v*this.m_a2,r.x-=this.m_invMassA*l,r.y-=this.m_invMassA*c,i-=this.m_invIA*h,o.x+=this.m_invMassB*l,o.y+=this.m_invMassB*c,u+=this.m_invIB*p}var b=this.m_perp.x*(o.x-r.x)+this.m_perp.y*(o.y-r.y)+this.m_s2*u-this.m_s1*i,w=u-i;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){var E=this.m_axis.x*(o.x-r.x)+this.m_axis.y*(o.y-r.y)+this.m_a2*u-this.m_a1*i,S=this.m_impulse.Copy(),x=this.m_K.Solve33(new f,-b,-w,-E);this.m_impulse.Add(x),this.m_limitState==g.e_atLowerLimit?this.m_impulse.z=s.Max(this.m_impulse.z,0):this.m_limitState==g.e_atUpperLimit&&(this.m_impulse.z=s.Min(this.m_impulse.z,0));var T=-b-(this.m_impulse.z-S.z)*this.m_K.col3.x,N=-w-(this.m_impulse.z-S.z)*this.m_K.col3.y,C=this.m_K.Solve22(new a,T,N);C.x+=S.x,C.y+=S.y,this.m_impulse.x=C.x,this.m_impulse.y=C.y,x.x=this.m_impulse.x-S.x,x.y=this.m_impulse.y-S.y,x.z=this.m_impulse.z-S.z,l=x.x*this.m_perp.x+x.z*this.m_axis.x,c=x.x*this.m_perp.y+x.z*this.m_axis.y,h=x.x*this.m_s1+x.y+x.z*this.m_a1,p=x.x*this.m_s2+x.y+x.z*this.m_a2,r.x-=this.m_invMassA*l,r.y-=this.m_invMassA*c,i-=this.m_invIA*h,o.x+=this.m_invMassB*l,o.y+=this.m_invMassB*c,u+=this.m_invIB*p}else{var k=this.m_K.Solve22(new a,-b,-w);this.m_impulse.x+=k.x,this.m_impulse.y+=k.y,l=k.x*this.m_perp.x,c=k.x*this.m_perp.y,h=k.x*this.m_s1+k.y,p=k.x*this.m_s2+k.y,r.x-=this.m_invMassA*l,r.y-=this.m_invMassA*c,i-=this.m_invIA*h,o.x+=this.m_invMassB*l,o.y+=this.m_invMassB*c,u+=this.m_invIB*p}t.m_linearVelocity.SetV(r),t.m_angularVelocity=i,n.m_linearVelocity.SetV(o),n.m_angularVelocity=u},T.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t=0,i=0,o=this.m_bodyA,u=this.m_bodyB,l=o.m_sweep.c,c=o.m_sweep.a,h=u.m_sweep.c,p=u.m_sweep.a,d,v=0,m=0,g=0,y=0,b=0,w=0,E=0,S=!1,x=0,T=r.FromAngle(c),N=r.FromAngle(p);d=T;var C=this.m_localAnchor1.x-this.m_localCenterA.x,k=this.m_localAnchor1.y-this.m_localCenterA.y;v=d.col1.x*C+d.col2.x*k,k=d.col1.y*C+d.col2.y*k,C=v,d=N;var L=this.m_localAnchor2.x-this.m_localCenterB.x,A=this.m_localAnchor2.y-this.m_localCenterB.y;v=d.col1.x*L+d.col2.x*A,A=d.col1.y*L+d.col2.y*A,L=v;var O=h.x+L-l.x-C,M=h.y+A-l.y-k;if(this.m_enableLimit){this.m_axis=s.MulMV(T,this.m_localXAxis1),this.m_a1=(O+C)*this.m_axis.y-(M+k)*this.m_axis.x,this.m_a2=L*this.m_axis.y-A*this.m_axis.x;var _=this.m_axis.x*O+this.m_axis.y*M;s.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*n.b2_linearSlop?(x=s.Clamp(_,-n.b2_maxLinearCorrection,n.b2_maxLinearCorrection),w=s.Abs(_),S=!0):_<=this.m_lowerTranslation?(x=s.Clamp(_-this.m_lowerTranslation+n.b2_linearSlop,-n.b2_maxLinearCorrection,0),w=this.m_lowerTranslation-_,S=!0):_>=this.m_upperTranslation&&(x=s.Clamp(_-this.m_upperTranslation+n.b2_linearSlop,0,n.b2_maxLinearCorrection),w=_-this.m_upperTranslation,S=!0)}this.m_perp=s.MulMV(T,this.m_localYAxis1),this.m_s1=(O+C)*this.m_perp.y-(M+k)*this.m_perp.x,this.m_s2=L*this.m_perp.y-A*this.m_perp.x;var D=new f,P=this.m_perp.x*O+this.m_perp.y*M,H=p-c-this.m_refAngle;w=s.Max(w,s.Abs(P)),E=s.Abs(H);if(S)m=this.m_invMassA,g=this.m_invMassB,y=this.m_invIA,b=this.m_invIB,this.m_K.col1.x=m+g+y*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,this.m_K.col1.y=y*this.m_s1+b*this.m_s2,this.m_K.col1.z=y*this.m_s1*this.m_a1+b*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=y+b,this.m_K.col2.z=y*this.m_a1+b*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=m+g+y*this.m_a1*this.m_a1+b*this.m_a2*this.m_a2,this.m_K.Solve33(D,-P,-H,-x);else{m=this.m_invMassA,g=this.m_invMassB,y=this.m_invIA,b=this.m_invIB;var B=m+g+y*this.m_s1*this.m_s1+b*this.m_s2*this.m_s2,j=y*this.m_s1+b*this.m_s2,F=y+b;this.m_K.col1.Set(B,j,0),this.m_K.col2.Set(j,F,0);var I=this.m_K.Solve22(new a,-P,-H);D.x=I.x,D.y=I.y,D.z=0}var q=D.x*this.m_perp.x+D.z*this.m_axis.x,R=D.x*this.m_perp.y+D.z*this.m_axis.y,U=D.x*this.m_s1+D.y+D.z*this.m_a1,z=D.x*this.m_s2+D.y+D.z*this.m_a2;return l.x-=this.m_invMassA*q,l.y-=this.m_invMassA*R,c-=this.m_invIA*U,h.x+=this.m_invMassB*q,h.y+=this.m_invMassB*R,p+=this.m_invIB*z,o.m_sweep.a=c,u.m_sweep.a=p,o.SynchronizeTransform(),u.SynchronizeTransform(),w<=n.b2_linearSlop&&E<=n.b2_angularSlop},Box2D.inherit(N,Box2D.Dynamics.Joints.b2JointDef),N.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,N.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new a,this.localAnchorB=new a,this.localAxisA=new a},N.prototype.b2PrismaticJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.lowerTranslation=0,this.upperTranslation=0,this.enableMotor=!1,this.maxMotorForce=0,this.motorSpeed=0},N.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(C,Box2D.Dynamics.Joints.b2Joint),C.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,C.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_groundAnchor1=new a,this.m_groundAnchor2=new a,this.m_localAnchor1=new a,this.m_localAnchor2=new a,this.m_u1=new a,this.m_u2=new a},C.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},C.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},C.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new a(e*this.m_impulse*this.m_u2.x,e*this.m_impulse*this.m_u2.y)},C.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),0},C.prototype.GetGroundAnchorA=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor1),e},C.prototype.GetGroundAnchorB=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor2),e},C.prototype.GetLength1=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),t=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,n=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,r=e.x-t,i=e.y-n;return Math.sqrt(r*r+i*i)},C.prototype.GetLength2=function(){var e=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),t=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,n=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,r=e.x-t,i=e.y-n;return Math.sqrt(r*r+i*i)},C.prototype.GetRatio=function(){return this.m_ratio},C.prototype.b2PulleyJoint=function(e){this.__super.b2Joint.call(this,e);var t,n=0,r=0;this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=e.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=e.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=e.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=e.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_ratio=e.ratio,this.m_constant=e.lengthA+this.m_ratio*e.lengthB,this.m_maxLength1=s.Min(e.maxLengthA,this.m_constant-this.m_ratio*C.b2_minPulleyLength),this.m_maxLength2=s.Min(e.maxLengthB,(this.m_constant-C.b2_minPulleyLength)/this.m_ratio),this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},C.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,r=this.m_bodyB,i;i=t.m_xf.R;var s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,u=i.col1.x*s+i.col2.x*o;o=i.col1.y*s+i.col2.y*o,s=u,i=r.m_xf.R;var a=this.m_localAnchor2.x-r.m_sweep.localCenter.x,f=this.m_localAnchor2.y-r.m_sweep.localCenter.y;u=i.col1.x*a+i.col2.x*f,f=i.col1.y*a+i.col2.y*f,a=u;var l=t.m_sweep.c.x+s,c=t.m_sweep.c.y+o,h=r.m_sweep.c.x+a,p=r.m_sweep.c.y+f,d=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,v=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,m=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,y=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(l-d,c-v),this.m_u2.Set(h-m,p-y);var b=this.m_u1.Length(),w=this.m_u2.Length();b>n.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero(),w>n.b2_linearSlop?this.m_u2.Multiply(1/w):this.m_u2.SetZero();var E=this.m_constant-b-this.m_ratio*w;E>0?(this.m_state=g.e_inactiveLimit,this.m_impulse=0):this.m_state=g.e_atUpperLimit,b<this.m_maxLength1?(this.m_limitState1=g.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=g.e_atUpperLimit,w<this.m_maxLength2?(this.m_limitState2=g.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=g.e_atUpperLimit;var S=s*this.m_u1.y-o*this.m_u1.x,x=a*this.m_u2.y-f*this.m_u2.x;this.m_limitMass1=t.m_invMass+t.m_invI*S*S,this.m_limitMass2=r.m_invMass+r.m_invI*x*x,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass;if(e.warmStarting){this.m_impulse*=e.dtRatio,this.m_limitImpulse1*=e.dtRatio,this.m_limitImpulse2*=e.dtRatio;var T=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,N=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,C=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,k=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y;t.m_linearVelocity.x+=t.m_invMass*T,t.m_linearVelocity.y+=t.m_invMass*N,t.m_angularVelocity+=t.m_invI*(s*N-o*T),r.m_linearVelocity.x+=r.m_invMass*C,r.m_linearVelocity.y+=r.m_invMass*k,r.m_angularVelocity+=r.m_invI*(a*k-f*C)}else this.m_impulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},C.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r;r=t.m_xf.R;var i=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,u=r.col1.x*i+r.col2.x*o;o=r.col1.y*i+r.col2.y*o,i=u,r=n.m_xf.R;var a=this.m_localAnchor2.x-n.m_sweep.localCenter.x,f=this.m_localAnchor2.y-n.m_sweep.localCenter.y;u=r.col1.x*a+r.col2.x*f,f=r.col1.y*a+r.col2.y*f,a=u;var l=0,c=0,h=0,p=0,d=0,v=0,m=0,y=0,b=0,w=0,E=0;this.m_state==g.e_atUpperLimit&&(l=t.m_linearVelocity.x+ -t.m_angularVelocity*o,c=t.m_linearVelocity.y+t.m_angularVelocity*i,h=n.m_linearVelocity.x+ -n.m_angularVelocity*f,p=n.m_linearVelocity.y+n.m_angularVelocity*a,b=-(this.m_u1.x*l+this.m_u1.y*c)-this.m_ratio*(this.m_u2.x*h+this.m_u2.y*p),w=this.m_pulleyMass*-b,E=this.m_impulse,this.m_impulse=s.Max(0,this.m_impulse+w),w=this.m_impulse-E,d=-w*this.m_u1.x,v=-w*this.m_u1.y,m=-this.m_ratio*w*this.m_u2.x,y=-this.m_ratio*w*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*d,t.m_linearVelocity.y+=t.m_invMass*v,t.m_angularVelocity+=t.m_invI*(i*v-o*d),n.m_linearVelocity.x+=n.m_invMass*m,n.m_linearVelocity.y+=n.m_invMass*y,n.m_angularVelocity+=n.m_invI*(a*y-f*m)),this.m_limitState1==g.e_atUpperLimit&&(l=t.m_linearVelocity.x+ -t.m_angularVelocity*o,c=t.m_linearVelocity.y+t.m_angularVelocity*i,b=-(this.m_u1.x*l+this.m_u1.y*c),w=-this.m_limitMass1*b,E=this.m_limitImpulse1,this.m_limitImpulse1=s.Max(0,this.m_limitImpulse1+w),w=this.m_limitImpulse1-E,d=-w*this.m_u1.x,v=-w*this.m_u1.y,t.m_linearVelocity.x+=t.m_invMass*d,t.m_linearVelocity.y+=t.m_invMass*v,t.m_angularVelocity+=t.m_invI*(i*v-o*d)),this.m_limitState2==g.e_atUpperLimit&&(h=n.m_linearVelocity.x+ -n.m_angularVelocity*f,p=n.m_linearVelocity.y+n.m_angularVelocity*a,b=-(this.m_u2.x*h+this.m_u2.y*p),w=-this.m_limitMass2*b,E=this.m_limitImpulse2,this.m_limitImpulse2=s.Max(0,this.m_limitImpulse2+w),w=this.m_limitImpulse2-E,m=-w*this.m_u2.x,y=-w*this.m_u2.y,n.m_linearVelocity.x+=n.m_invMass*m,n.m_linearVelocity.y+=n.m_invMass*y,n.m_angularVelocity+=n.m_invI*(a*y-f*m))},C.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t=this.m_bodyA,r=this.m_bodyB,i,o=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,u=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,a=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,f=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,l=0,c=0,h=0,p=0,d=0,v=0,m=0,y=0,b=0,w=0,E=0,S=0,x=0,T=0,N=0,C=0;return this.m_state==g.e_atUpperLimit&&(i=t.m_xf.R,l=this.m_localAnchor1.x-t.m_sweep.localCenter.x,c=this.m_localAnchor1.y-t.m_sweep.localCenter.y,N=i.col1.x*l+i.col2.x*c,c=i.col1.y*l+i.col2.y*c,l=N,i=r.m_xf.R,h=this.m_localAnchor2.x-r.m_sweep.localCenter.x,p=this.m_localAnchor2.y-r.m_sweep.localCenter.y,N=i.col1.x*h+i.col2.x*p,p=i.col1.y*h+i.col2.y*p,h=N,d=t.m_sweep.c.x+l,v=t.m_sweep.c.y+c,m=r.m_sweep.c.x+h,y=r.m_sweep.c.y+p,this.m_u1.Set(d-o,v-u),this.m_u2.Set(m-a,y-f),b=this.m_u1.Length(),w=this.m_u2.Length(),b>n.b2_linearSlop?this.m_u1.Multiply(1/b):this.m_u1.SetZero(),w>n.b2_linearSlop?this.m_u2.Multiply(1/w):this.m_u2.SetZero(),E=this.m_constant-b-this.m_ratio*w,C=s.Max(C,-E),E=s.Clamp(E+n.b2_linearSlop,-n.b2_maxLinearCorrection,0),S=-this.m_pulleyMass*E,d=-S*this.m_u1.x,v=-S*this.m_u1.y,m=-this.m_ratio*S*this.m_u2.x,y=-this.m_ratio*S*this.m_u2.y,t.m_sweep.c.x+=t.m_invMass*d,t.m_sweep.c.y+=t.m_invMass*v,t.m_sweep.a+=t.m_invI*(l*v-c*d),r.m_sweep.c.x+=r.m_invMass*m,r.m_sweep.c.y+=r.m_invMass*y,r.m_sweep.a+=r.m_invI*(h*y-p*m),t.SynchronizeTransform(),r.SynchronizeTransform()),this.m_limitState1==g.e_atUpperLimit&&(i=t.m_xf.R,l=this.m_localAnchor1.x-t.m_sweep.localCenter.x,c=this.m_localAnchor1.y-t.m_sweep.localCenter.y,N=i.col1.x*l+i.col2.x*c,c=i.col1.y*l+i.col2.y*c,l=N,d=t.m_sweep.c.x+l,v=t.m_sweep.c.y+c,this.m_u1.Set(d-o,v-u),b=this.m_u1.Length(),b>n.b2_linearSlop?(this.m_u1.x*=1/b,this.m_u1.y*=1/b):this.m_u1.SetZero(),E=this.m_maxLength1-b,C=s.Max(C,-E),E=s.Clamp(E+n.b2_linearSlop,-n.b2_maxLinearCorrection,0),S=-this.m_limitMass1*E,d=-S*this.m_u1.x,v=-S*this.m_u1.y,t.m_sweep.c.x+=t.m_invMass*d,t.m_sweep.c.y+=t.m_invMass*v,t.m_sweep.a+=t.m_invI*(l*v-c*d),t.SynchronizeTransform()),this.m_limitState2==g.e_atUpperLimit&&(i=r.m_xf.R,h=this.m_localAnchor2.x-r.m_sweep.localCenter.x,p=this.m_localAnchor2.y-r.m_sweep.localCenter.y,N=i.col1.x*h+i.col2.x*p,p=i.col1.y*h+i.col2.y*p,h=N,m=r.m_sweep.c.x+h,y=r.m_sweep.c.y+p,this.m_u2.Set(m-a,y-f),w=this.m_u2.Length(),w>n.b2_linearSlop?(this.m_u2.x*=1/w,this.m_u2.y*=1/w):this.m_u2.SetZero(),E=this.m_maxLength2-w,C=s.Max(C,-E),E=s.Clamp(E+n.b2_linearSlop,-n.b2_maxLinearCorrection,0),S=-this.m_limitMass2*E,m=-S*this.m_u2.x,y=-S*this.m_u2.y,r.m_sweep.c.x+=r.m_invMass*m,r.m_sweep.c.y+=r.m_invMass*y,r.m_sweep.a+=r.m_invI*(h*y-p*m),r.SynchronizeTransform()),C<n.b2_linearSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2}),Box2D.inherit(k,Box2D.Dynamics.Joints.b2JointDef),k.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,k.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.groundAnchorA=new a,this.groundAnchorB=new a,this.localAnchorA=new a,this.localAnchorB=new a},k.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.lengthA=0,this.maxLengthA=0,this.lengthB=0,this.maxLengthB=0,this.ratio=1,this.collideConnected=!0},k.prototype.Initialize=function(e,t,n,r,i,s,o){o===undefined&&(o=0),this.bodyA=e,this.bodyB=t,this.groundAnchorA.SetV(n),this.groundAnchorB.SetV(r),this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(s);var u=i.x-n.x,a=i.y-n.y;this.lengthA=Math.sqrt(u*u+a*a);var f=s.x-r.x,l=s.y-r.y;this.lengthB=Math.sqrt(f*f+l*l),this.ratio=o;var c=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=c-this.ratio*C.b2_minPulleyLength,this.maxLengthB=(c-C.b2_minPulleyLength)/this.ratio},Box2D.inherit(L,Box2D.Dynamics.Joints.b2Joint),L.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,L.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.K=new r,this.K1=new r,this.K2=new r,this.K3=new r,this.impulse3=new f,this.impulse2=new a,this.reduced=new a,this.m_localAnchor1=new a,this.m_localAnchor2=new a,this.m_impulse=new f,this.m_mass=new i},L.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},L.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},L.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new a(e*this.m_impulse.x,e*this.m_impulse.y)},L.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.z},L.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},L.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},L.prototype.IsLimitEnabled=function(){return this.m_enableLimit},L.prototype.EnableLimit=function(e){this.m_enableLimit=e},L.prototype.GetLowerLimit=function(){return this.m_lowerAngle},L.prototype.GetUpperLimit=function(){return this.m_upperAngle},L.prototype.SetLimits=function(e,t){e===undefined&&(e=0),t===undefined&&(t=0),this.m_lowerAngle=e,this.m_upperAngle=t},L.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},L.prototype.EnableMotor=function(e){this.m_enableMotor=e},L.prototype.SetMotorSpeed=function(e){e===undefined&&(e=0),this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},L.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},L.prototype.SetMaxMotorTorque=function(e){e===undefined&&(e=0),this.m_maxMotorTorque=e},L.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},L.prototype.b2RevoluteJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=e.lowerAngle,this.m_upperAngle=e.upperAngle,this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=g.e_inactiveLimit},L.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,r=this.m_bodyB,i,o=0;this.m_enableMotor||this.m_enableLimit,i=t.m_xf.R;var u=this.m_localAnchor1.x-t.m_sweep.localCenter.x,a=this.m_localAnchor1.y-t.m_sweep.localCenter.y;o=i.col1.x*u+i.col2.x*a,a=i.col1.y*u+i.col2.y*a,u=o,i=r.m_xf.R;var f=this.m_localAnchor2.x-r.m_sweep.localCenter.x,l=this.m_localAnchor2.y-r.m_sweep.localCenter.y;o=i.col1.x*f+i.col2.x*l,l=i.col1.y*f+i.col2.y*l,f=o;var c=t.m_invMass,h=r.m_invMass,p=t.m_invI,d=r.m_invI;this.m_mass.col1.x=c+h+a*a*p+l*l*d,this.m_mass.col2.x=-a*u*p-l*f*d,this.m_mass.col3.x=-a*p-l*d,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=c+h+u*u*p+f*f*d,this.m_mass.col3.y=u*p+f*d,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=p+d,this.m_motorMass=1/(p+d),this.m_enableMotor==0&&(this.m_motorImpulse=0);if(this.m_enableLimit){var v=r.m_sweep.a-t.m_sweep.a-this.m_referenceAngle;s.Abs(this.m_upperAngle-this.m_lowerAngle)<2*n.b2_angularSlop?this.m_limitState=g.e_equalLimits:v<=this.m_lowerAngle?(this.m_limitState!=g.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=g.e_atLowerLimit):v>=this.m_upperAngle?(this.m_limitState!=g.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=g.e_atUpperLimit):(this.m_limitState=g.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=g.e_inactiveLimit;if(e.warmStarting){this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio;var m=this.m_impulse.x,y=this.m_impulse.y;t.m_linearVelocity.x-=c*m,t.m_linearVelocity.y-=c*y,t.m_angularVelocity-=p*(u*y-a*m+this.m_motorImpulse+this.m_impulse.z),r.m_linearVelocity.x+=h*m,r.m_linearVelocity.y+=h*y,r.m_angularVelocity+=d*(f*y-l*m+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0},L.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r,i=0,o=0,u=0,a=0,f=0,l=0,c=t.m_linearVelocity,h=t.m_angularVelocity,p=n.m_linearVelocity,d=n.m_angularVelocity,v=t.m_invMass,m=n.m_invMass,y=t.m_invI,b=n.m_invI;if(this.m_enableMotor&&this.m_limitState!=g.e_equalLimits){var w=d-h-this.m_motorSpeed,E=this.m_motorMass*-w,S=this.m_motorImpulse,x=e.dt*this.m_maxMotorTorque;this.m_motorImpulse=s.Clamp(this.m_motorImpulse+E,-x,x),E=this.m_motorImpulse-S,h-=y*E,d+=b*E}if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){r=t.m_xf.R,u=this.m_localAnchor1.x-t.m_sweep.localCenter.x,a=this.m_localAnchor1.y-t.m_sweep.localCenter.y,i=r.col1.x*u+r.col2.x*a,a=r.col1.y*u+r.col2.y*a,u=i,r=n.m_xf.R,f=this.m_localAnchor2.x-n.m_sweep.localCenter.x,l=this.m_localAnchor2.y-n.m_sweep.localCenter.y,i=r.col1.x*f+r.col2.x*l,l=r.col1.y*f+r.col2.y*l,f=i;var T=p.x+ -d*l-c.x- -h*a,N=p.y+d*f-c.y-h*u,C=d-h;this.m_mass.Solve33(this.impulse3,-T,-N,-C),this.m_limitState==g.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==g.e_atLowerLimit?(o=this.m_impulse.z+this.impulse3.z,o<0&&(this.m_mass.Solve22(this.reduced,-T,-N),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==g.e_atUpperLimit&&(o=this.m_impulse.z+this.impulse3.z,o>0&&(this.m_mass.Solve22(this.reduced,-T,-N),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),c.x-=v*this.impulse3.x,c.y-=v*this.impulse3.y,h-=y*(u*this.impulse3.y-a*this.impulse3.x+this.impulse3.z),p.x+=m*this.impulse3.x,p.y+=m*this.impulse3.y,d+=b*(f*this.impulse3.y-l*this.impulse3.x+this.impulse3.z)}else{r=t.m_xf.R,u=this.m_localAnchor1.x-t.m_sweep.localCenter.x,a=this.m_localAnchor1.y-t.m_sweep.localCenter.y,i=r.col1.x*u+r.col2.x*a,a=r.col1.y*u+r.col2.y*a,u=i,r=n.m_xf.R,f=this.m_localAnchor2.x-n.m_sweep.localCenter.x,l=this.m_localAnchor2.y-n.m_sweep.localCenter.y,i=r.col1.x*f+r.col2.x*l,l=r.col1.y*f+r.col2.y*l,f=i;var k=p.x+ -d*l-c.x- -h*a,L=p.y+d*f-c.y-h*u;this.m_mass.Solve22(this.impulse2,-k,-L),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,c.x-=v*this.impulse2.x,c.y-=v*this.impulse2.y,h-=y*(u*this.impulse2.y-a*this.impulse2.x),p.x+=m*this.impulse2.x,p.y+=m*this.impulse2.y,d+=b*(f*this.impulse2.y-l*this.impulse2.x)}t.m_linearVelocity.SetV(c),t.m_angularVelocity=h,n.m_linearVelocity.SetV(p),n.m_angularVelocity=d},L.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t=0,r=0,i,o=this.m_bodyA,u=this.m_bodyB,a=0,f=0,l=0,c=0,h=0;if(this.m_enableLimit&&this.m_limitState!=g.e_inactiveLimit){var p=u.m_sweep.a-o.m_sweep.a-this.m_referenceAngle,d=0;this.m_limitState==g.e_equalLimits?(r=s.Clamp(p-this.m_lowerAngle,-n.b2_maxAngularCorrection,n.b2_maxAngularCorrection),d=-this.m_motorMass*r,a=s.Abs(r)):this.m_limitState==g.e_atLowerLimit?(r=p-this.m_lowerAngle,a=-r,r=s.Clamp(r+n.b2_angularSlop,-n.b2_maxAngularCorrection,0),d=-this.m_motorMass*r):this.m_limitState==g.e_atUpperLimit&&(r=p-this.m_upperAngle,a=r,r=s.Clamp(r-n.b2_angularSlop,0,n.b2_maxAngularCorrection),d=-this.m_motorMass*r),o.m_sweep.a-=o.m_invI*d,u.m_sweep.a+=u.m_invI*d,o.SynchronizeTransform(),u.SynchronizeTransform()}i=o.m_xf.R;var v=this.m_localAnchor1.x-o.m_sweep.localCenter.x,m=this.m_localAnchor1.y-o.m_sweep.localCenter.y;l=i.col1.x*v+i.col2.x*m,m=i.col1.y*v+i.col2.y*m,v=l,i=u.m_xf.R;var y=this.m_localAnchor2.x-u.m_sweep.localCenter.x,b=this.m_localAnchor2.y-u.m_sweep.localCenter.y;l=i.col1.x*y+i.col2.x*b,b=i.col1.y*y+i.col2.y*b,y=l;var w=u.m_sweep.c.x+y-o.m_sweep.c.x-v,E=u.m_sweep.c.y+b-o.m_sweep.c.y-m,S=w*w+E*E,x=Math.sqrt(S);f=x;var T=o.m_invMass,N=u.m_invMass,C=o.m_invI,k=u.m_invI,A=10*n.b2_linearSlop;if(S>A*A){var O=w/x,M=E/x,_=T+N,D=1/_;c=D*-w,h=D*-E;var P=.5;o.m_sweep.c.x-=P*T*c,o.m_sweep.c.y-=P*T*h,u.m_sweep.c.x+=P*N*c,u.m_sweep.c.y+=P*N*h,w=u.m_sweep.c.x+y-o.m_sweep.c.x-v,E=u.m_sweep.c.y+b-o.m_sweep.c.y-m}return this.K1.col1.x=T+N,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=T+N,this.K2.col1.x=C*m*m,this.K2.col2.x=-C*v*m,this.K2.col1.y=-C*v*m,this.K2.col2.y=C*v*v,this.K3.col1.x=k*b*b,this.K3.col2.x=-k*y*b,this.K3.col1.y=-k*y*b,this.K3.col2.y=k*y*y,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(L.tImpulse,-w,-E),c=L.tImpulse.x,h=L.tImpulse.y,o.m_sweep.c.x-=o.m_invMass*c,o.m_sweep.c.y-=o.m_invMass*h,o.m_sweep.a-=o.m_invI*(v*h-m*c),u.m_sweep.c.x+=u.m_invMass*c,u.m_sweep.c.y+=u.m_invMass*h,u.m_sweep.a+=u.m_invI*(y*h-b*c),o.SynchronizeTransform(),u.SynchronizeTransform(),f<=n.b2_linearSlop&&a<=n.b2_angularSlop},Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new a}),Box2D.inherit(A,Box2D.Dynamics.Joints.b2JointDef),A.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,A.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new a,this.localAnchorB=new a},A.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.referenceAngle=0,this.lowerAngle=0,this.upperAngle=0,this.maxMotorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},A.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},Box2D.inherit(O,Box2D.Dynamics.Joints.b2Joint),O.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype,O.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments),this.m_localAnchorA=new a,this.m_localAnchorB=new a,this.m_impulse=new f,this.m_mass=new i},O.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},O.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},O.prototype.GetReactionForce=function(e){return e===undefined&&(e=0),new a(e*this.m_impulse.x,e*this.m_impulse.y)},O.prototype.GetReactionTorque=function(e){return e===undefined&&(e=0),e*this.m_impulse.z},O.prototype.b2WeldJoint=function(e){this.__super.b2Joint.call(this,e),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new i},O.prototype.InitVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x,o=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n,t=i.m_xf.R;var u=this.m_localAnchorB.x-i.m_sweep.localCenter.x,a=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n;var f=r.m_invMass,l=i.m_invMass,c=r.m_invI,h=i.m_invI;this.m_mass.col1.x=f+l+o*o*c+a*a*h,this.m_mass.col2.x=-o*s*c-a*u*h,this.m_mass.col3.x=-o*c-a*h,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=f+l+s*s*c+u*u*h,this.m_mass.col3.y=s*c+u*h,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=c+h,e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_impulse.z*=e.dtRatio,r.m_linearVelocity.x-=f*this.m_impulse.x,r.m_linearVelocity.y-=f*this.m_impulse.y,r.m_angularVelocity-=c*(s*this.m_impulse.y-o*this.m_impulse.x+this.m_impulse.z),i.m_linearVelocity.x+=l*this.m_impulse.x,i.m_linearVelocity.y+=l*this.m_impulse.y,i.m_angularVelocity+=h*(u*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},O.prototype.SolveVelocityConstraints=function(e){var t,n=0,r=this.m_bodyA,i=this.m_bodyB,s=r.m_linearVelocity,o=r.m_angularVelocity,u=i.m_linearVelocity,a=i.m_angularVelocity,l=r.m_invMass,c=i.m_invMass,h=r.m_invI,p=i.m_invI;t=r.m_xf.R;var d=this.m_localAnchorA.x-r.m_sweep.localCenter.x,v=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*d+t.col2.x*v,v=t.col1.y*d+t.col2.y*v,d=n,t=i.m_xf.R;var m=this.m_localAnchorB.x-i.m_sweep.localCenter.x,g=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*m+t.col2.x*g,g=t.col1.y*m+t.col2.y*g,m=n;var y=u.x-a*g-s.x+o*v,b=u.y+a*m-s.y-o*d,w=a-o,E=new f;this.m_mass.Solve33(E,-y,-b,-w),this.m_impulse.Add(E),s.x-=l*E.x,s.y-=l*E.y,o-=h*(d*E.y-v*E.x+E.z),u.x+=c*E.x,u.y+=c*E.y,a+=p*(m*E.y-g*E.x+E.z),r.m_angularVelocity=o,i.m_angularVelocity=a},O.prototype.SolvePositionConstraints=function(e){e===undefined&&(e=0);var t,r=0,i=this.m_bodyA,o=this.m_bodyB;t=i.m_xf.R;var u=this.m_localAnchorA.x-i.m_sweep.localCenter.x,a=this.m_localAnchorA.y-i.m_sweep.localCenter.y;r=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=r,t=o.m_xf.R;var l=this.m_localAnchorB.x-o.m_sweep.localCenter.x,c=this.m_localAnchorB.y-o.m_sweep.localCenter.y;r=t.col1.x*l+t.col2.x*c,c=t.col1.y*l+t.col2.y*c,l=r;var h=i.m_invMass,p=o.m_invMass,d=i.m_invI,v=o.m_invI,m=o.m_sweep.c.x+l-i.m_sweep.c.x-u,g=o.m_sweep.c.y+c-i.m_sweep.c.y-a,y=o.m_sweep.a-i.m_sweep.a-this.m_referenceAngle,b=10*n.b2_linearSlop,w=Math.sqrt(m*m+g*g),E=s.Abs(y);w>b&&(d*=1,v*=1),this.m_mass.col1.x=h+p+a*a*d+c*c*v,this.m_mass.col2.x=-a*u*d-c*l*v,this.m_mass.col3.x=-a*d-c*v,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=h+p+u*u*d+l*l*v,this.m_mass.col3.y=u*d+l*v,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=d+v;var S=new f;return this.m_mass.Solve33(S,-m,-g,-y),i.m_sweep.c.x-=h*S.x,i.m_sweep.c.y-=h*S.y,i.m_sweep.a-=d*(u*S.y-a*S.x+S.z),o.m_sweep.c.x+=p*S.x,o.m_sweep.c.y+=p*S.y,o.m_sweep.a+=v*(l*S.y-c*S.x+S.z),i.SynchronizeTransform(),o.SynchronizeTransform(),w<=n.b2_linearSlop&&E<=n.b2_angularSlop},Box2D.inherit(M,Box2D.Dynamics.Joints.b2JointDef),M.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype,M.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments),this.localAnchorA=new a,this.localAnchorB=new a},M.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this),this.type=g.e_weldJoint,this.referenceAngle=0},M.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}(),function(){var e=Box2D.Dynamics.b2DebugDraw;e.b2DebugDraw=function(){this.m_drawScale=1,this.m_lineThickness=1,this.m_alpha=1,this.m_fillAlpha=1,this.m_xformScale=1;var e=this;this.m_sprite={graphics:{clear:function(){e.m_ctx.clearRect(0,0,e.m_ctx.canvas.width,e.m_ctx.canvas.height)}}}},e.prototype._color=function(e,t){return"rgba("+((e&16711680)>>16)+","+((e&65280)>>8)+","+(e&255)+","+t+")"},e.prototype.b2DebugDraw=function(){this.m_drawFlags=0},e.prototype.SetFlags=function(e){e===undefined&&(e=0),this.m_drawFlags=e},e.prototype.GetFlags=function(){return this.m_drawFlags},e.prototype.AppendFlags=function(e){e===undefined&&(e=0),this.m_drawFlags|=e},e.prototype.ClearFlags=function(e){e===undefined&&(e=0),this.m_drawFlags&=~e},e.prototype.SetSprite=function(e){this.m_ctx=e},e.prototype.GetSprite=function(){return this.m_ctx},e.prototype.SetDrawScale=function(e){e===undefined&&(e=0),this.m_drawScale=e},e.prototype.GetDrawScale=function(){return this.m_drawScale},e.prototype.SetLineThickness=function(e){e===undefined&&(e=0),this.m_lineThickness=e,this.m_ctx.strokeWidth=e},e.prototype.GetLineThickness=function(){return this.m_lineThickness},e.prototype.SetAlpha=function(e){e===undefined&&(e=0),this.m_alpha=e},e.prototype.GetAlpha=function(){return this.m_alpha},e.prototype.SetFillAlpha=function(e){e===undefined&&(e=0),this.m_fillAlpha=e},e.prototype.GetFillAlpha=function(){return this.m_fillAlpha},e.prototype.SetXFormScale=function(e){e===undefined&&(e=0),this.m_xformScale=e},e.prototype.GetXFormScale=function(){return this.m_xformScale},e.prototype.DrawPolygon=function(e,t,n){if(!t)return;var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.moveTo(e[0].x*i,e[0].y*i);for(var s=1;s<t;s++)r.lineTo(e[s].x*i,e[s].y*i);r.lineTo(e[0].x*i,e[0].y*i),r.closePath(),r.stroke()},e.prototype.DrawSolidPolygon=function(e,t,n){if(!t)return;var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.fillStyle=this._color(n.color,this.m_fillAlpha),r.moveTo(e[0].x*i,e[0].y*i);for(var s=1;s<t;s++)r.lineTo(e[s].x*i,e[s].y*i);r.lineTo(e[0].x*i,e[0].y*i),r.closePath(),r.fill(),r.stroke()},e.prototype.DrawCircle=function(e,t,n){if(!t)return;var r=this.m_ctx,i=this.m_drawScale;r.beginPath(),r.strokeStyle=this._color(n.color,this.m_alpha),r.arc(e.x*i,e.y*i,t*i,0,Math.PI*2,!0),r.closePath(),r.stroke()},e.prototype.DrawSolidCircle=function(e,t,n,r){if(!t)return;var i=this.m_ctx,s=this.m_drawScale,o=e.x*s,u=e.y*s;i.moveTo(0,0),i.beginPath(),i.strokeStyle=this._color(r.color,this.m_alpha),i.fillStyle=this._color(r.color,this.m_fillAlpha),i.arc(o,u,t*s,0,Math.PI*2,!0),i.moveTo(o,u),i.lineTo((e.x+n.x*t)*s,(e.y+n.y*t)*s),i.closePath(),i.fill(),i.stroke()},e.prototype.DrawSegment=function(e,t,n){var r=this.m_ctx,i=this.m_drawScale;r.strokeStyle=this._color(n.color,this.m_alpha),r.beginPath(),r.moveTo(e.x*i,e.y*i),r.lineTo(t.x*i,t.y*i),r.closePath(),r.stroke()},e.prototype.DrawTransform=function(e){var t=this.m_ctx,n=this.m_drawScale;t.beginPath(),t.strokeStyle=this._color(16711680,this.m_alpha),t.moveTo(e.position.x*n,e.position.y*n),t.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*n,(e.position.y+this.m_xformScale*e.R.col1.y)*n),t.strokeStyle=this._color(65280,this.m_alpha),t.moveTo(e.position.x*n,e.position.y*n),t.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*n,(e.position.y+this.m_xformScale*e.R.col2.y)*n),t.closePath(),t.stroke()}}();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs,tagpro.ready(function(){tagpro.world=new function(){function s(e){if(!tagpro.map){setTimeout(function(){s(e)},0);return}e()}function c(e){if(e.rx==undefined||e.ry==undefined||e.lx==undefined||e.ly==undefined||e.a==undefined)return;e.sync=null;var r=new Box2D.Dynamics.b2FixtureDef,i=new Box2D.Dynamics.b2BodyDef,s=.19;r.density=1,r.friction=.5,r.restitution=.2,r.shape=new Box2D.Collision.Shapes.b2CircleShape(s),i.type=Box2D.Dynamics.b2Body.b2_dynamicBody,i.linearDamping=.5,i.angularDamping=.5,tagpro.events.setPlayerPhysics&&tagpro.events.setPlayerPhysics.forEach(function(e){e.setPlayerPhysics(Box2D,i,r)});var o=t.CreateBody(i),u=o.CreateFixture(r);return o.SetPosition(new Box2D.Common.Math.b2Vec2(e.rx,e.ry)),e.x=e.rx*100,e.y=e.ry*100,e.angle=e.ra,o.player=e,o.fixture=u,n[e.id]=o,o}function h(e){if(e.rx==undefined||e.ry==undefined||e.lx==undefined||e.ly==undefined||e.a==undefined)return;var n=new Box2D.Dynamics.b2FixtureDef,i=new Box2D.Dynamics.b2BodyDef,s=.39;n.density=2,n.friction=.5,n.restitution=.6,n.shape=new Box2D.Collision.Shapes.b2CircleShape(s),i.type=Box2D.Dynamics.b2Body.b2_dynamicBody,i.linearDamping=.5,i.angularDamping=.5;var o=t.CreateBody(i),u=o.CreateFixture(n);return o.SetPosition(new Box2D.Common.Math.b2Vec2(e.rx,e.ry)),e.x=e.rx*100,e.y=e.ry*100,o.object=e,r[e.id]=o,o}function p(e){for(var t in n){var r=n[t],i=r.player;if(i.dead)continue;var s=r.GetWorldCenter(),o=new Box2D.Common.Math.b2Vec2(0,0);o.Add(s),o.Subtract(e.position);if(o.Length()>2.6)continue;var u=.06*r.GetMass()/Math.pow(o.Length(),2);o.NegativeSelf(),o.Multiply(u),r.ApplyImpulse(o,s)}}var e=tagpro.events.gravity?tagpro.events.gravity.map(function(e){return e.gravity})[0]:{x:0,y:0},t=new Box2D.Dynamics.b2World(new Box2D.Common.Math.b2Vec2(e.x,e.y),!0),n={},r={},i=[],o=1e3/60,u=performance.now()+o,a=!0;setTimeout(function(){a=!1},5e3),this.update=function(e){if(tagpro.state!==1)return;var s=performance.now();if(u-s>o)return;for(var a in n){var f=n[a],l=f.player;f.SetAwake(!0);if(!l.draw||l.dead){f.SetPosition(new Box2D.Common.Math.b2Vec2(-100,-100));continue}var c=f.GetPosition(),h=f.GetAngle(),d=l.sync;d&&(d.frame--,d.step.x>0&&c.x<d.to.x||d.step.x<0&&c.x>d.to.x?c.x+=d.step.x:d.step.x=0,d.step.y>0&&c.y<d.to.y||d.step.y<0&&c.y>d.to.y?c.y+=d.step.y:d.step.y=0,d.step.a>0&&h<d.to.a||d.step.a<0&&h>d.to.a?h+=d.step.a:d.step.a=0,d.frame<=0&&(l.sync=null));var v=f.GetLinearVelocity();tagpro.events.playerControls?tagpro.events.playerControls.forEach(function(e){e.playerControls(l,f,v)}):tagpro.state==1&&(l.left&&v.x>-l.ms&&(v.x-=l.ac),l.right&&v.x<l.ms&&(v.x+=l.ac),l.up&&v.y>-l.ms&&(v.y-=l.ac),l.down&&v.y<l.ms&&(v.y+=l.ac)),f.SetPosition(c),f.SetAngle(h),f.SetLinearVelocity(v),l.x=c.x*100,l.y=c.y*100,l.angle=h,tagpro.events.playerUpdate&&tagpro.events.playerUpdate.forEach(function(e){e.playerUpdate(l,f)})}i.forEach(function(e){p(e)});for(var a in r){var f=r[a],m=f.object;f.SetAwake(!0);if(!m.draw){f.SetPosition(new Box2D.Common.Math.b2Vec2(-100,-100));continue}var c=f.GetPosition(),d=m.sync;d&&(d.frame--,d.step.x>0&&c.x<d.to.x||d.step.x<0&&c.x>d.to.x?c.x+=d.step.x:d.step.x=0,d.step.y>0&&c.y<d.to.y||d.step.y<0&&c.y>d.to.y?c.y+=d.step.y:d.step.y=0,d.frame<=0&&(m.sync=null)),f.SetPosition(c),m.x=c.x*100,m.y=c.y*100}t.Step(1/60,8,3),tagpro.events.update&&tagpro.events.update.forEach(function(e){e.update()}),u+=o;var s=performance.now();if(s>=u){if(e>=10){u=s;return}tagpro.world.update((e||0)+1)}};var f=new Box2D.Dynamics.b2FixtureDef,l=new Box2D.Dynamics.b2BodyDef;f.density=1,f.friction=.5,f.restitution=.2,l.type=Box2D.Dynamics.b2Body.b2_staticBody,tagpro.events.setWallPhysics&&tagpro.events.setWallPhysics.forEach(function(e){e.setWallPhysics(Box2D,l,f)}),s(function(){var e=tagpro.map;for(var n=0,r=e.length;n!=r;n++)for(var i=0,s=e[0].length;i!=s;i++){if(parseInt(e[n][i])!=1)continue;f.shape=new Box2D.Collision.Shapes.b2PolygonShape,e[n][i]==1.1?f.shape.SetAsArray([new Box2D.Common.Math.b2Vec2(-0.2,.2),new Box2D.Common.Math.b2Vec2(-0.2,-0.2),new Box2D.Common.Math.b2Vec2(.2,.2)]):e[n][i]==1.2?f.shape.SetAsArray([new Box2D.Common.Math.b2Vec2(-0.2,-0.2),new Box2D.Common.Math.b2Vec2(.2,-0.2),new Box2D.Common.Math.b2Vec2(-0.2,.2)]):e[n][i]==1.3?f.shape.SetAsArray([new Box2D.Common.Math.b2Vec2(.2,-0.2),new Box2D.Common.Math.b2Vec2(.2,.2),new Box2D.Common.Math.b2Vec2(-0.2,-0.2)]):e[n][i]==1.4?f.shape.SetAsArray([new Box2D.Common.Math.b2Vec2(.2,.2),new Box2D.Common.Math.b2Vec2(-0.2,.2),new Box2D.Common.Math.b2Vec2(.2,-0.2)]):f.shape.SetAsBox(.2,.2),l.position.Set(n*.4,i*.4);var o=t.CreateBody(l);o.CreateFixture(f)}}),this.syncObject=function(e,t){var n=r[e.id]||h(e);if(!n)return;if(!e.draw)return;n.SetAwake(!0);if(!t){var i=n.GetPosition();e.sync={to:{x:e.rx,y:e.ry},frame:Math.ceil((tagpro.fps||60)/10)},e.sync.step={x:(e.sync.to.x-i.x)/e.sync.frame,y:(e.sync.to.y-i.y)/e.sync.frame},e.sync.frame==0&&(e.sync=null)}else e.sync=null,n.SetPosition(new Box2D.Common.Math.b2Vec2(e.rx,e.ry));n.SetLinearVelocity(new Box2D.Common.Math.b2Vec2(e.lx,e.ly)),n.SetAngularVelocity(e.a)},this.syncPlayer=function(e,t){var r=n[e.id]||c(e);if(!r)return;r.SetAwake(!0);if(!t){if(e.dead||!e.draw)return;var i=r.GetPosition(),s=r.GetAngle();e.sync={to:{x:e.rx,y:e.ry,a:e.ra},frame:Math.ceil((tagpro.fps||60)/10)},e.sync.step={x:(e.sync.to.x-i.x)/e.sync.frame,y:(e.sync.to.y-i.y)/e.sync.frame,a:(e.sync.to.a-s)/e.sync.frame},e.sync.frame==0&&(e.sync=null)}else e.sync=null,r.SetPosition(new Box2D.Common.Math.b2Vec2(e.rx,e.ry)),r.SetAngle(e.ra),e.x=e.rx*100,e.y=e.ry*100;r.SetLinearVelocity(new Box2D.Common.Math.b2Vec2(e.lx,e.ly)),r.SetAngularVelocity(e.a),r.fixture.GetDensity()!=e.den&&(r.fixture.SetDensity(e.den),r.ResetMassData())},this.destoryPlayer=function(e){var r=n[e];if(!r)return;t.DestroyBody(r),delete n[e]},this.createGravityWell=function(e,t){i.push({position:new Box2D.Common.Math.b2Vec2(e,t)})}}}),tagpro.ready(function(){tagpro.musicPlayer=new function(){var e=$("audio#music"),t=["mp3","m4a","ogg"],n=!1,r=!1,i=this;this.list=[],this.current=null,this.disabled=!1,this.next=function(){if(!tagpro.music||i.disabled)return;n=!1;if(!r)return;var s=tagpro.musicPlayer.list.shift();s.volume=parseFloat(s.volume||.5),tagpro.musicPlayer.list.push(s),tagpro.musicPlayer.mute(),tagpro.musicPlayer.current=s,e=$("<audio id='music' volume='"+s.volume+"' autoplay='true'>").appendTo($(document.body)),e[0].volume=s.volume,t.forEach(function(t){e.append("<source type='audio/"+t+"' src='http://"+tagpro.musicHost+"/sounds/music/"+s.url+"."+t+"'></source>")}),e.on("ended",tagpro.musicPlayer.next)},this.mute=function(){n=!0;if(!e||!e.length)return;e[0].pause(),e.remove(),tagpro.musicPlayer.current=null},this.disable=function(){if(i.disabled)return;i.disabled=!0,i.mute()},this.keyBindings={190:this.next},$(document).on("keyup",function(e){if(tagpro.disableControls)return;var t=tagpro.musicPlayer.keyBindings[e.which];t&&t()}),$.ajax({timeout:1e3,dataType:"json",url:"http://"+tagpro.musicHost+"/music?callback=?",success:function(e){while(e.length)tagpro.musicPlayer.list.push(e.splice(Math.floor(Math.random()*e.length),1)[0]);r=!0;if(n||!tagpro.music)return;tagpro.musicPlayer.next()}})}}),tagpro.ready(function(){tagpro.sound=undefined,tagpro.music=undefined;var e=function(e,t){$.cookie(e,t,{expires:36500,path:"/",domain:tagpro.cookieHost}),tagpro[e]=t},t=function(e){if(!e||e=="music")tagpro.music?tagpro.musicPlayer.next():tagpro.musicPlayer.mute();if(!e||e=="sound")tagpro.sound||$("audio").not("#music").each(function(){this.play&&(this.pause(),this.readyState==4&&(this.currentTime=0))})};$(window).ready(function(){tagpro.sound=$.cookie("sound"),tagpro.music=$.cookie("music"),tagpro.sound==undefined&&e("sound",!0),tagpro.music==undefined&&e("music",!1)}),$.fn.soundControl=function(){var n=$(this),r=$(this).find("#soundEffects"),i=$(this).find("#soundMusic"),s=function(){tagpro.sound?r.removeClass("off"):r.addClass("off"),tagpro.music?i.removeClass("off"):i.addClass("off")};r.click(function(n){n.preventDefault(),e("sound",!tagpro.sound),s(),t("sound")}),i.click(function(n){n.preventDefault(),e("music",!tagpro.music),s(),t("music")}),s(),t()},$(document).ready(function(){$("div#sound").soundControl()})})